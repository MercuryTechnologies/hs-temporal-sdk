<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DefaultSignatures #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DeriveLift #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DerivingVia #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE InstanceSigs #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE PolyKinds #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-19"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-20"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-21"></span><span class="hs-pragma">{-# LANGUAGE UndecidableSuperClasses #-}</span><span>
</span><span id="line-22"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-unrecognised-pragmas #-}</span><span>
</span><span id="line-23"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-pragma">{-# HLINT ignore &quot;Use ++&quot; #-}</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="annot"><span class="hs-comment">{- |
Module      : Temporal.TH
Description : Template Haskell utilities for Temporal Workflow and Activity definitions
Stability   : experimental
Portability : POSIX

The `Temporal.TH` module provides Template Haskell-based utilities for defining,
configuring, and registering Temporal Workflows and Activities in a type-safe and
declarative manner. This module simplifies the process of integrating Temporal
with Haskell applications by automating much of the boilerplate code typically
required for setting up Workflows and Activities.

Key features of this module include:

1. Automatic registration of Workflows and Activities.
2. Type-safe configuration options for both Workflows and Activities.
3. Generation of necessary typeclass instances for Workflow and Activity functions.
4. Support for custom naming and aliasing of Activities.
5. Integration with Haskell's strong type system to ensure correctness at compile-time.

The main functions provided by this module are:

- 'registerWorkflow' and 'registerWorkflowWithOptions': For registering Workflow functions.
- 'registerActivity' and 'registerActivityWithOptions': For registering Activity functions.
- 'discoverDefinitions': For automatically discovering and collecting all defined Workflows and Activities.

When you apply the registration functions to your Workflow and Activity functions,
a number of things happen automatically:

1. The registration functions generate a new data type with the same name as your Workflow or Activity function (capitalized).
   Example: If you define a Workflow function named @myWorkflow@, the generated data type will be named @MyWorkflow@.
2. A number of type classes are generated or derived for your Workflow or Activity function to support invoking them.

Example usage:

@
{\-# LANGUAGE DerivingVia #-\}
{\-# LANGUAGE TemplateHaskell #-\}
{\-# LANGUAGE ImportQualifiedPost #-\}

module MyWorkflows where

import Language.Haskell.TH (newDeclarationGroup)
import RequireCallStack (provideCallStack)
import Temporal.Activity
import Temporal.TH
import Temporal.TH.Options
import Temporal.Workflow
import Temporal.Client qualified as Client

-- Simple activity registration
actWithoutTimeoutDefault :: Activity () ()
actWithoutTimeoutDefault = pure ()
\$(registerActivity 'actWithoutTimeoutDefault)

-- Activity registration with name override
actWithNameOverride :: Activity () ()
actWithNameOverride = pure ()
\$(registerActivityWithOptions 'actWithNameOverride defaultActivityConfiguration
  { actNameOverride = Just &quot;my-name&quot;
  })

-- Activity registration with aliases
actWithAliases :: Activity () ()
actWithAliases = pure ()
\$(registerActivityWithOptions 'actWithAliases defaultActivityConfiguration
  { actAliases = [&quot;alias1&quot;, &quot;alias2&quot;]
  })

-- Workflow registration
myWorkflow :: Int -&gt; Workflow ()
myWorkflow _ = pure ()
\$(registerWorkflow 'myWorkflow)

-- Use newDeclarationGroup to separate Template Haskell splices
\$(newDeclarationGroup)

-- Workflow referencing a child workflow
workflowReferencingChild :: Workflow ()
workflowReferencingChild = provideCallStack do
  _ &lt;- startChildWorkflow MyWorkflow defaultChildWorkflowOptions 0
  executeChildWorkflow MyWorkflow defaultChildWorkflowOptions 1

-- Activity referencing a workflow
actionReferencingWorkflow :: Activity () ()
actionReferencingWorkflow = provideCallStack do
  _ &lt;- Client.start MyWorkflow &quot;1&quot; (Client.startWorkflowOptions (TaskQueue &quot;foo&quot;)) 1
  Client.execute MyWorkflow &quot;2&quot; (Client.startWorkflowOptions (TaskQueue &quot;foo&quot;)) 1
@

Note the use of 'newDeclarationGroup' from &quot;Language.Haskell.TH&quot; to separate
Template Haskell splices, which can be necessary in some cases to avoid
compilation errors&#8211; namely, when you want to invoke a Workflow or Activity later
in the same module.

The one use case where the TH mechanism struggles is when you want to use the
'continueAsNew' function from &quot;Temporal.Workflow&quot; in a Workflow to start a new
instance of the same Workflow. In this case, you can define the machinery manually:

@
workflowThatContinuesAsNew :: Int -&gt; Workflow ()
workflowThatContinuesAsNew x = do
  if x &lt; 1000
  then continueAsNew WorkflowThatContinuesAsNew defaultContinueAsNewOptions (x + 1)
  else return ()

data WorkflowThatContinuesAsNew = WorkflowThatContinuesAsNew
  deriving anyclass (WorkflowFn)
  deriving (WorkflowDef, WorkflowRef) via WorkflowImpl WorkflowThatContinuesAsNew

instance Fn WorkflowThatContinuesAsNew where
  fnName = Text.pack $ show 'workflowThatContinuesAsNew
  fnDefinition _ = provideCallStack workflowThatContinuesAsNew
  fnSing = WorkflowThatContinuesAsNew
@
-}</span></span><span>
</span><span id="line-143"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Temporal.TH.html"><span class="hs-identifier">Temporal.TH</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-144"></span><span>  </span><span class="annot"><a href="Temporal.TH.html#discoverDefinitions"><span class="hs-identifier">discoverDefinitions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-145"></span><span>  </span><span class="annot"><span class="hs-identifier">SomeDict</span></span><span class="hs-special">,</span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><span class="hs-identifier">SomeDictOf</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><a href="Temporal.TH.html#registerActivity"><span class="hs-identifier">registerActivity</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><a href="Temporal.TH.html#registerActivityWithOptions"><span class="hs-identifier">registerActivityWithOptions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><a href="Temporal.TH.Classes.html#ActivityConfig"><span class="hs-identifier">ActivityConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><a href="Temporal.TH.Classes.html#defaultActivityConfig"><span class="hs-identifier">defaultActivityConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-151"></span><span>  </span><span class="annot"><a href="Temporal.TH.html#registerWorkflow"><span class="hs-identifier">registerWorkflow</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-152"></span><span>  </span><span class="annot"><a href="Temporal.TH.html#registerWorkflowWithOptions"><span class="hs-identifier">registerWorkflowWithOptions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-153"></span><span>  </span><span class="annot"><a href="Temporal.TH.Classes.html#WorkflowConfig"><span class="hs-identifier">WorkflowConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-154"></span><span>  </span><span class="annot"><a href="Temporal.TH.Classes.html#defaultWorkflowConfig"><span class="hs-identifier">defaultWorkflowConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><a href="Temporal.TH.Classes.html#Fn"><span class="hs-identifier">Fn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><a href="Temporal.TH.Classes.html#WorkflowFn"><span class="hs-identifier">WorkflowFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowRef"><span class="hs-identifier">WorkflowRef</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowDef"><span class="hs-identifier">WorkflowDef</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-159"></span><span>  </span><span class="annot"><a href="Temporal.TH.Classes.html#ActivityFn"><span class="hs-identifier">ActivityFn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-160"></span><span>  </span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityRef"><span class="hs-identifier">ActivityRef</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-161"></span><span>  </span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDef"><span class="hs-identifier">ActivityDef</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-162"></span><span>  </span><span class="annot"><a href="Temporal.TH.Internal.html#fnSingE"><span class="hs-identifier">fnSingE</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><a href="Temporal.TH.Internal.html#fnSingDataAndConName"><span class="hs-identifier">fnSingDataAndConName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><a href="Temporal.TH.Classes.html#ActivityImpl"><span class="hs-identifier">ActivityImpl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><a href="Temporal.TH.Classes.html#WorkflowImpl"><span class="hs-identifier">WorkflowImpl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-166"></span><span>  </span><span class="annot"><a href="Temporal.TH.html#bringRegisteredTemporalFunctionsIntoScope"><span class="hs-identifier">bringRegisteredTemporalFunctionsIntoScope</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-167"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-170"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Typeable</span></span><span>
</span><span id="line-171"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">DiscoverInstances</span></span><span>
</span><span id="line-172"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span>
</span><span id="line-173"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Lib</span></span><span>
</span><span id="line-174"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Syntax</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span>
</span><span id="line-175"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Temporal.Activity.html"><span class="hs-identifier">Temporal.Activity</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Act</span></span><span>
</span><span id="line-176"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html"><span class="hs-identifier">Temporal.Activity.Definition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDef"><span class="hs-identifier">ActivityDef</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.TH.Classes.html"><span class="hs-identifier">Temporal.TH.Classes</span></a></span><span>
</span><span id="line-178"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.TH.Internal.html"><span class="hs-identifier">Temporal.TH.Internal</span></a></span><span>
</span><span id="line-179"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Worker.html"><span class="hs-identifier">Temporal.Worker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#Definitions"><span class="hs-identifier">Definitions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Workflow.html"><span class="hs-identifier">Temporal.Workflow</span></a></span><span>
</span><span id="line-181"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Temporal.Workflow.html"><span class="hs-identifier">Temporal.Workflow</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Wf</span></span><span>
</span><span id="line-182"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Workflow.Definition.html"><span class="hs-identifier">Temporal.Workflow.Definition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowDef"><span class="hs-identifier">WorkflowDef</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="annot"><a href="Temporal.TH.html#registerActivityWithOptions"><span class="hs-identifier hs-type">registerActivityWithOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680194490"><span class="annot"><a href="#local-6989586621680194490"><span class="hs-identifier hs-type">codec</span></a></span></span><span> </span><span id="local-6989586621680194488"><span class="annot"><a href="#local-6989586621680194488"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TH.Quote</span></span><span> </span><span class="annot"><a href="#local-6989586621680194488"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Quasi</span></span><span> </span><span class="annot"><a href="#local-6989586621680194488"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Lift</span></span><span> </span><span class="annot"><a href="#local-6989586621680194490"><span class="hs-identifier hs-type">codec</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.TH.Classes.html#ActivityConfig"><span class="hs-identifier hs-type">ActivityConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680194490"><span class="hs-identifier hs-type">codec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680194488"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TH.Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-186"></span><span id="registerActivityWithOptions"><span class="annot"><span class="annottext">registerActivityWithOptions :: forall codec (m :: * -&gt; *).
(Quote m, Quasi m, Lift codec) =&gt;
Name -&gt; ActivityConfig codec -&gt; m [Dec]
</span><a href="Temporal.TH.html#registerActivityWithOptions"><span class="hs-identifier hs-var hs-var">registerActivityWithOptions</span></a></span></span><span> </span><span id="local-6989586621680194609"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680194609"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680194610"><span class="annot"><span class="annottext">ActivityConfig codec
</span><a href="#local-6989586621680194610"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-187"></span><span>  </span><span id="local-6989586621680194611"><span class="annot"><a href="#local-6989586621680194611"><span class="hs-identifier hs-var">fnType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; m Type
forall (m :: * -&gt; *). Quasi m =&gt; Name -&gt; m Type
</span><span class="hs-identifier hs-var">TH.qReifyType</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680194609"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680194613"><span class="annot"><a href="#local-6989586621680194613"><span class="hs-identifier hs-var hs-var">dataName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; m Type
forall (m :: * -&gt; *). Quote m =&gt; Name -&gt; m Type
</span><span class="hs-identifier hs-var">conT</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; m Type) -&gt; Name -&gt; m Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="Temporal.TH.Internal.html#fnSingDataAndConName"><span class="hs-identifier hs-var">fnSingDataAndConName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680194609"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-189"></span><span>  </span><span id="local-6989586621680194614"><span class="annot"><a href="#local-6989586621680194614"><span class="hs-identifier hs-var">baseDecls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.TH.Internal.html#makeFnDecls"><span class="hs-identifier hs-type">makeFnDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680194609"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680194611"><span class="hs-identifier hs-type">fnType</span></a></span><span>
</span><span id="line-190"></span><span>  </span><span id="local-6989586621680194616"><span class="annot"><a href="#local-6989586621680194616"><span class="hs-identifier hs-var">actDefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-special">[d|</span><span>
</span><span id="line-192"></span><span>      </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Temporal.TH.Classes.html#ActivityFn"><span class="hs-identifier hs-type">Temporal.TH.Classes.ActivityFn</span></a></span><span> </span><span class="hs-special">$</span><span class="annot"><a href="#local-6989586621680194613"><span class="hs-identifier hs-type">dataName</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-193"></span><span>        </span><span class="annot"><a href="Temporal.TH.Classes.html#activityConfig"><span class="hs-identifier hs-var hs-var">activityConfig</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680194610"><span class="hs-identifier hs-type">conf</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span>      </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.TH.Classes.html#ActivityImpl"><span class="hs-identifier hs-type">Temporal.TH.Classes.ActivityImpl</span></a></span><span> </span><span class="hs-special">$</span><span class="annot"><a href="#local-6989586621680194613"><span class="hs-identifier hs-type">dataName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityRef"><span class="hs-identifier hs-type">ActivityRef</span></a></span><span> </span><span class="hs-special">$</span><span class="annot"><a href="#local-6989586621680194613"><span class="hs-identifier hs-type">dataName</span></a></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>      </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.TH.Classes.html#ActivityImpl"><span class="hs-identifier hs-type">Temporal.TH.Classes.ActivityImpl</span></a></span><span> </span><span class="hs-special">$</span><span class="annot"><a href="#local-6989586621680194613"><span class="hs-identifier hs-type">dataName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDef"><span class="hs-identifier hs-type">ActivityDef</span></a></span><span> </span><span class="hs-special">$</span><span class="annot"><a href="#local-6989586621680194613"><span class="hs-identifier hs-type">dataName</span></a></span><span>
</span><span id="line-200"></span><span>      </span><span class="hs-special">|]</span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680194614"><span class="hs-identifier hs-type">baseDecls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680194616"><span class="hs-identifier hs-type">actDefs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="annot"><a href="Temporal.TH.html#registerActivity"><span class="hs-identifier hs-type">registerActivity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680194508"><span class="annot"><a href="#local-6989586621680194508"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TH.Quote</span></span><span> </span><span class="annot"><a href="#local-6989586621680194508"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Quasi</span></span><span> </span><span class="annot"><a href="#local-6989586621680194508"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680194508"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TH.Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-205"></span><span id="registerActivity"><span class="annot"><span class="annottext">registerActivity :: forall (m :: * -&gt; *). (Quote m, Quasi m) =&gt; Name -&gt; m [Dec]
</span><a href="Temporal.TH.html#registerActivity"><span class="hs-identifier hs-var hs-var">registerActivity</span></a></span></span><span> </span><span id="local-6989586621680194625"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680194625"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; ActivityConfig JSON -&gt; m [Dec]
forall codec (m :: * -&gt; *).
(Quote m, Quasi m, Lift codec) =&gt;
Name -&gt; ActivityConfig codec -&gt; m [Dec]
</span><a href="Temporal.TH.html#registerActivityWithOptions"><span class="hs-identifier hs-var">registerActivityWithOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680194625"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ActivityConfig JSON
</span><a href="Temporal.TH.Classes.html#defaultActivityConfig"><span class="hs-identifier hs-var">defaultActivityConfig</span></a></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="annot"><a href="Temporal.TH.html#registerWorkflowWithOptions"><span class="hs-identifier hs-type">registerWorkflowWithOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680194512"><span class="annot"><a href="#local-6989586621680194512"><span class="hs-identifier hs-type">codec</span></a></span></span><span> </span><span id="local-6989586621680194511"><span class="annot"><a href="#local-6989586621680194511"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TH.Quote</span></span><span> </span><span class="annot"><a href="#local-6989586621680194511"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Quasi</span></span><span> </span><span class="annot"><a href="#local-6989586621680194511"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Lift</span></span><span> </span><span class="annot"><a href="#local-6989586621680194512"><span class="hs-identifier hs-type">codec</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.TH.Classes.html#WorkflowConfig"><span class="hs-identifier hs-type">WorkflowConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680194512"><span class="hs-identifier hs-type">codec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680194511"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TH.Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-209"></span><span id="registerWorkflowWithOptions"><span class="annot"><span class="annottext">registerWorkflowWithOptions :: forall codec (m :: * -&gt; *).
(Quote m, Quasi m, Lift codec) =&gt;
Name -&gt; WorkflowConfig codec -&gt; m [Dec]
</span><a href="Temporal.TH.html#registerWorkflowWithOptions"><span class="hs-identifier hs-var hs-var">registerWorkflowWithOptions</span></a></span></span><span> </span><span id="local-6989586621680194644"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680194644"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680194645"><span class="annot"><span class="annottext">WorkflowConfig codec
</span><a href="#local-6989586621680194645"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-210"></span><span>  </span><span id="local-6989586621680194646"><span class="annot"><a href="#local-6989586621680194646"><span class="hs-identifier hs-var">fnType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; m Type
forall (m :: * -&gt; *). Quasi m =&gt; Name -&gt; m Type
</span><span class="hs-identifier hs-var">TH.qReifyType</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680194644"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680194647"><span class="annot"><a href="#local-6989586621680194647"><span class="hs-identifier hs-var hs-var">dataName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; m Type
forall (m :: * -&gt; *). Quote m =&gt; Name -&gt; m Type
</span><span class="hs-identifier hs-var">conT</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; m Type) -&gt; Name -&gt; m Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="Temporal.TH.Internal.html#fnSingDataAndConName"><span class="hs-identifier hs-var">fnSingDataAndConName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680194644"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-212"></span><span>  </span><span id="local-6989586621680194648"><span class="annot"><a href="#local-6989586621680194648"><span class="hs-identifier hs-var">baseDecls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.TH.Internal.html#makeFnDecls"><span class="hs-identifier hs-type">makeFnDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680194644"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680194646"><span class="hs-identifier hs-type">fnType</span></a></span><span>
</span><span id="line-213"></span><span>  </span><span id="local-6989586621680194649"><span class="annot"><a href="#local-6989586621680194649"><span class="hs-identifier hs-var">additionalDecls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-special">[d|</span><span>
</span><span id="line-215"></span><span>      </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Temporal.TH.Classes.html#WorkflowFn"><span class="hs-identifier hs-type">Temporal.TH.Classes.WorkflowFn</span></a></span><span> </span><span class="hs-special">$</span><span class="annot"><a href="#local-6989586621680194647"><span class="hs-identifier hs-type">dataName</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-216"></span><span>        </span><span class="annot"><a href="Temporal.TH.Classes.html#workflowConfig"><span class="hs-identifier hs-var hs-var">workflowConfig</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680194645"><span class="hs-identifier hs-type">conf</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>      </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.TH.Classes.html#WorkflowImpl"><span class="hs-identifier hs-type">Temporal.TH.Classes.WorkflowImpl</span></a></span><span> </span><span class="hs-special">$</span><span class="annot"><a href="#local-6989586621680194647"><span class="hs-identifier hs-type">dataName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowRef"><span class="hs-identifier hs-type">WorkflowRef</span></a></span><span> </span><span class="hs-special">$</span><span class="annot"><a href="#local-6989586621680194647"><span class="hs-identifier hs-type">dataName</span></a></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span>      </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.TH.Classes.html#WorkflowImpl"><span class="hs-identifier hs-type">Temporal.TH.Classes.WorkflowImpl</span></a></span><span> </span><span class="hs-special">$</span><span class="annot"><a href="#local-6989586621680194647"><span class="hs-identifier hs-type">dataName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowDef"><span class="hs-identifier hs-type">WorkflowDef</span></a></span><span> </span><span class="hs-special">$</span><span class="annot"><a href="#local-6989586621680194647"><span class="hs-identifier hs-type">dataName</span></a></span><span>
</span><span id="line-223"></span><span>      </span><span class="hs-special">|]</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680194648"><span class="hs-identifier hs-type">baseDecls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680194649"><span class="hs-identifier hs-type">additionalDecls</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="annot"><a href="Temporal.TH.html#registerWorkflow"><span class="hs-identifier hs-type">registerWorkflow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680194651"><span class="annot"><a href="#local-6989586621680194651"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TH.Quote</span></span><span> </span><span class="annot"><a href="#local-6989586621680194651"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Quasi</span></span><span> </span><span class="annot"><a href="#local-6989586621680194651"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680194651"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TH.Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-229"></span><span id="registerWorkflow"><span class="annot"><span class="annottext">registerWorkflow :: forall (m :: * -&gt; *). (Quote m, Quasi m) =&gt; Name -&gt; m [Dec]
</span><a href="Temporal.TH.html#registerWorkflow"><span class="hs-identifier hs-var hs-var">registerWorkflow</span></a></span></span><span> </span><span id="local-6989586621680194657"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680194657"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; WorkflowConfig JSON -&gt; m [Dec]
forall codec (m :: * -&gt; *).
(Quote m, Quasi m, Lift codec) =&gt;
Name -&gt; WorkflowConfig codec -&gt; m [Dec]
</span><a href="Temporal.TH.html#registerWorkflowWithOptions"><span class="hs-identifier hs-var">registerWorkflowWithOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680194657"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">WorkflowConfig JSON
</span><a href="Temporal.TH.Classes.html#defaultWorkflowConfig"><span class="hs-identifier hs-var">defaultWorkflowConfig</span></a></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="annot"><span class="hs-comment">-- | Alias for 'newDeclarationGroup' that makes the intent a bit more clear.</span></span><span>
</span><span id="line-233"></span><span class="annot"><a href="Temporal.TH.html#bringRegisteredTemporalFunctionsIntoScope"><span class="hs-identifier hs-type">bringRegisteredTemporalFunctionsIntoScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TH.Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-234"></span><span id="bringRegisteredTemporalFunctionsIntoScope"><span class="annot"><span class="annottext">bringRegisteredTemporalFunctionsIntoScope :: Q [Dec]
</span><a href="Temporal.TH.html#bringRegisteredTemporalFunctionsIntoScope"><span class="hs-identifier hs-var hs-var">bringRegisteredTemporalFunctionsIntoScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Q [Dec]
</span><span class="hs-identifier hs-var">TH.newDeclarationGroup</span></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="hs-comment">---------------------------------------------------------------------------------------</span><span>
</span><span id="line-238"></span><span class="hs-comment">-- Produce dictionaries</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="annot"><a href="Temporal.TH.html#discoverDefinitions"><span class="hs-identifier hs-type">discoverDefinitions</span></a></span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680194519"><span class="annot"><a href="#local-6989586621680194519"><span class="hs-identifier hs-type">env</span></a></span></span><span>
</span><span id="line-242"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span> </span><span class="annot"><a href="#local-6989586621680194519"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">SomeDict</span></span><span> </span><span class="annot"><a href="Temporal.TH.Classes.html#WorkflowFn"><span class="hs-identifier hs-type">WorkflowFn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">SomeDict</span></span><span> </span><span class="annot"><a href="Temporal.TH.Classes.html#ActivityFn"><span class="hs-identifier hs-type">ActivityFn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#Definitions"><span class="hs-identifier hs-type">Definitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680194519"><span class="hs-identifier hs-type">env</span></a></span><span>
</span><span id="line-246"></span><span id="discoverDefinitions"><span class="annot"><span class="annottext">discoverDefinitions :: forall env.
(RequireCallStack, Typeable env) =&gt;
[SomeDict WorkflowFn] -&gt; [SomeDict ActivityFn] -&gt; Definitions env
</span><a href="Temporal.TH.html#discoverDefinitions"><span class="hs-identifier hs-var hs-var">discoverDefinitions</span></a></span></span><span> </span><span id="local-6989586621680194682"><span class="annot"><span class="annottext">[SomeDict WorkflowFn]
</span><a href="#local-6989586621680194682"><span class="hs-identifier hs-var">wfs</span></a></span></span><span> </span><span id="local-6989586621680194683"><span class="annot"><span class="annottext">[SomeDict ActivityFn]
</span><a href="#local-6989586621680194683"><span class="hs-identifier hs-var">acts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-248"></span><span>    </span><span id="local-6989586621680194684"><span class="annot"><span class="annottext">aliasedWfs :: [(Text, WorkflowDefinition)]
</span><a href="#local-6989586621680194684"><span class="hs-identifier hs-var hs-var">aliasedWfs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-249"></span><span>      </span><span class="annot"><span class="annottext">(SomeDict WorkflowFn -&gt; [(Text, WorkflowDefinition)])
-&gt; [SomeDict WorkflowFn] -&gt; [(Text, WorkflowDefinition)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span>
</span><span id="line-250"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SomeDictOf</span></span><span> </span><span id="local-6989586621680194697"><span class="annot"><span class="annottext">Proxy a
</span><a href="#local-6989586621680194697"><span class="hs-identifier hs-var">inst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-251"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680194698"><span class="annot"><span class="annottext">def :: WorkflowDefinition
</span><a href="#local-6989586621680194698"><span class="hs-identifier hs-var hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProvidedWorkflow (FnType a) -&gt; WorkflowDefinition
forall f. ProvidedWorkflow f -&gt; WorkflowDefinition
</span><a href="Temporal.Workflow.Definition.html#definition"><span class="hs-identifier hs-var">Wf.definition</span></a></span><span> </span><span class="annot"><span class="annottext">(ProvidedWorkflow (FnType a) -&gt; WorkflowDefinition)
-&gt; ProvidedWorkflow (FnType a) -&gt; WorkflowDefinition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; ProvidedWorkflow (FnType a)
forall f.
(WorkflowFn f, RequireCallStack) =&gt;
f -&gt; ProvidedWorkflow (FnType f)
</span><a href="Temporal.TH.Classes.html#workflowImpl"><span class="hs-identifier hs-var">Temporal.TH.Classes.workflowImpl</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; ProvidedWorkflow (FnType a))
-&gt; a -&gt; ProvidedWorkflow (FnType a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Proxy a -&gt; a
forall t. Fn t =&gt; Proxy t -&gt; t
</span><a href="Temporal.TH.Classes.html#fn"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy a
</span><a href="#local-6989586621680194697"><span class="hs-identifier hs-var">inst</span></a></span><span>
</span><span id="line-252"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorkflowDefinition -&gt; Text
</span><a href="Temporal.Workflow.Definition.html#workflowName"><span class="hs-identifier hs-var">Wf.workflowName</span></a></span><span> </span><span class="annot"><span class="annottext">WorkflowDefinition
</span><a href="#local-6989586621680194698"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WorkflowDefinition
</span><a href="#local-6989586621680194698"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text, WorkflowDefinition)
-&gt; [(Text, WorkflowDefinition)] -&gt; [(Text, WorkflowDefinition)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; (Text, WorkflowDefinition))
-&gt; [Text] -&gt; [(Text, WorkflowDefinition)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680194703"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680194703"><span class="hs-identifier hs-var">alias</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680194703"><span class="hs-identifier hs-var">alias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WorkflowDefinition
</span><a href="#local-6989586621680194698"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Workflow.Definition.html#workflowName"><span class="hs-identifier hs-var">Wf.workflowName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680194703"><span class="hs-identifier hs-type">alias</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorkflowConfig (WorkflowCodec a) -&gt; [Text]
forall codec. WorkflowConfig codec -&gt; [Text]
</span><a href="Temporal.TH.Classes.html#workflowConfigAliases"><span class="hs-identifier hs-var">workflowConfigAliases</span></a></span><span> </span><span class="annot"><span class="annottext">(WorkflowConfig (WorkflowCodec a) -&gt; [Text])
-&gt; WorkflowConfig (WorkflowCodec a) -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; WorkflowConfig (WorkflowCodec a)
forall f. WorkflowFn f =&gt; f -&gt; WorkflowConfig (WorkflowCodec f)
</span><a href="Temporal.TH.Classes.html#workflowConfig"><span class="hs-identifier hs-var">workflowConfig</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; WorkflowConfig (WorkflowCodec a))
-&gt; a -&gt; WorkflowConfig (WorkflowCodec a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Proxy a -&gt; a
forall t. Fn t =&gt; Proxy t -&gt; t
</span><a href="Temporal.TH.Classes.html#fn"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy a
</span><a href="#local-6989586621680194697"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>        </span><span class="annot"><span class="annottext">[SomeDict WorkflowFn]
</span><a href="#local-6989586621680194682"><span class="hs-identifier hs-var">wfs</span></a></span><span>
</span><span id="line-255"></span><span>    </span><span id="local-6989586621680194705"><span class="annot"><span class="annottext">aliasedActs :: [(Text, ActivityDefinition env)]
</span><a href="#local-6989586621680194705"><span class="hs-identifier hs-var hs-var">aliasedActs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-256"></span><span>      </span><span class="annot"><span class="annottext">(SomeDict ActivityFn -&gt; [(Text, ActivityDefinition env)])
-&gt; [SomeDict ActivityFn] -&gt; [(Text, ActivityDefinition env)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span>
</span><span id="line-257"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SomeDictOf</span></span><span> </span><span id="local-6989586621680194721"><span class="annot"><span class="annottext">Proxy a
</span><a href="#local-6989586621680194721"><span class="hs-identifier hs-var">inst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ActivityDefinition (FnActivityEnv (FnType a))
-&gt; Maybe (ActivityDefinition env)
forall a b. (Typeable a, Typeable b) =&gt; a -&gt; Maybe b
</span><span class="hs-identifier hs-var">cast</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProvidedActivity (FnActivityEnv (FnType a)) (FnType a)
-&gt; ActivityDefinition (FnActivityEnv (FnType a))
forall env f. ProvidedActivity env f -&gt; ActivityDefinition env
</span><a href="Temporal.Activity.Definition.html#definition"><span class="hs-identifier hs-var">Act.definition</span></a></span><span> </span><span class="annot"><span class="annottext">(ProvidedActivity (FnActivityEnv (FnType a)) (FnType a)
 -&gt; ActivityDefinition (FnActivityEnv (FnType a)))
-&gt; ProvidedActivity (FnActivityEnv (FnType a)) (FnType a)
-&gt; ActivityDefinition (FnActivityEnv (FnType a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; ProvidedActivity (FnActivityEnv (FnType a)) (FnType a)
forall f.
(ActivityFn f, RequireCallStack) =&gt;
f -&gt; ProvidedActivity (FnActivityEnv (FnType f)) (FnType f)
</span><a href="Temporal.TH.Classes.html#activityImpl"><span class="hs-identifier hs-var">Temporal.TH.Classes.activityImpl</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; ProvidedActivity (FnActivityEnv (FnType a)) (FnType a))
-&gt; a -&gt; ProvidedActivity (FnActivityEnv (FnType a)) (FnType a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Proxy a -&gt; a
forall t. Fn t =&gt; Proxy t -&gt; t
</span><a href="Temporal.TH.Classes.html#fn"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy a
</span><a href="#local-6989586621680194721"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-258"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680194725"><span class="annot"><span class="annottext">ActivityDefinition env
</span><a href="#local-6989586621680194725"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDefinition"><span class="hs-identifier hs-type">Act.ActivityDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680194519"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-259"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActivityDefinition env -&gt; Text
forall env. ActivityDefinition env -&gt; Text
</span><a href="Temporal.Activity.Definition.html#activityName"><span class="hs-identifier hs-var">Act.activityName</span></a></span><span> </span><span class="annot"><span class="annottext">ActivityDefinition env
</span><a href="#local-6989586621680194725"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ActivityDefinition env
</span><a href="#local-6989586621680194725"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text, ActivityDefinition env)
-&gt; [(Text, ActivityDefinition env)]
-&gt; [(Text, ActivityDefinition env)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; (Text, ActivityDefinition env))
-&gt; [Text] -&gt; [(Text, ActivityDefinition env)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680194727"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680194727"><span class="hs-identifier hs-var">alias</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680194727"><span class="hs-identifier hs-var">alias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ActivityDefinition env
</span><a href="#local-6989586621680194725"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Activity.Definition.html#activityName"><span class="hs-identifier hs-var">Act.activityName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680194727"><span class="hs-identifier hs-type">alias</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActivityConfig (ActivityCodec a) -&gt; [Text]
forall c. ActivityConfig c -&gt; [Text]
</span><a href="Temporal.TH.Classes.html#activityConfigAliases"><span class="hs-identifier hs-var">activityConfigAliases</span></a></span><span> </span><span class="annot"><span class="annottext">(ActivityConfig (ActivityCodec a) -&gt; [Text])
-&gt; ActivityConfig (ActivityCodec a) -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; ActivityConfig (ActivityCodec a)
forall f. ActivityFn f =&gt; f -&gt; ActivityConfig (ActivityCodec f)
</span><a href="Temporal.TH.Classes.html#activityConfig"><span class="hs-identifier hs-var">activityConfig</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; ActivityConfig (ActivityCodec a))
-&gt; a -&gt; ActivityConfig (ActivityCodec a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Proxy a -&gt; a
forall t. Fn t =&gt; Proxy t -&gt; t
</span><a href="Temporal.TH.Classes.html#fn"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy a
</span><a href="#local-6989586621680194721"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>            </span><span class="annot"><span class="annottext">Maybe (ActivityDefinition env)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-261"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>        </span><span class="annot"><span class="annottext">[SomeDict ActivityFn]
</span><a href="#local-6989586621680194683"><span class="hs-identifier hs-var">acts</span></a></span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-keyword">in</span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><span class="annottext">HashMap Text WorkflowDefinition
-&gt; HashMap Text (ActivityDefinition env) -&gt; Definitions env
forall env.
HashMap Text WorkflowDefinition
-&gt; HashMap Text (ActivityDefinition env) -&gt; Definitions env
</span><a href="Temporal.Worker.html#Definitions"><span class="hs-identifier hs-var">Definitions</span></a></span><span>
</span><span id="line-265"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(WorkflowDefinition -&gt; WorkflowDefinition -&gt; WorkflowDefinition)
-&gt; [(Text, WorkflowDefinition)] -&gt; HashMap Text WorkflowDefinition
forall k v.
(Eq k, Hashable k) =&gt;
(v -&gt; v -&gt; v) -&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">Map.fromListWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680194731"><span class="annot"><span class="annottext">WorkflowDefinition
</span><a href="#local-6989586621680194731"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">WorkflowDefinition
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; WorkflowDefinition
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Encountered duplicate Workflow definition names: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorkflowDefinition -&gt; Text
</span><a href="Temporal.Workflow.Definition.html#workflowName"><span class="hs-identifier hs-var">Wf.workflowName</span></a></span><span> </span><span class="annot"><span class="annottext">WorkflowDefinition
</span><a href="#local-6989586621680194731"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Text, WorkflowDefinition)]
</span><a href="#local-6989586621680194684"><span class="hs-identifier hs-var">aliasedWfs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ActivityDefinition env
 -&gt; ActivityDefinition env -&gt; ActivityDefinition env)
-&gt; [(Text, ActivityDefinition env)]
-&gt; HashMap Text (ActivityDefinition env)
forall k v.
(Eq k, Hashable k) =&gt;
(v -&gt; v -&gt; v) -&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">Map.fromListWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680194734"><span class="annot"><span class="annottext">ActivityDefinition env
</span><a href="#local-6989586621680194734"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">ActivityDefinition env
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ActivityDefinition env
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Encountered duplicate Activity definition names: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActivityDefinition env -&gt; Text
forall env. ActivityDefinition env -&gt; Text
</span><a href="Temporal.Activity.Definition.html#activityName"><span class="hs-identifier hs-var">Act.activityName</span></a></span><span> </span><span class="annot"><span class="annottext">ActivityDefinition env
</span><a href="#local-6989586621680194734"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Text, ActivityDefinition env)]
</span><a href="#local-6989586621680194705"><span class="hs-identifier hs-var">aliasedActs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span></pre></body></html>