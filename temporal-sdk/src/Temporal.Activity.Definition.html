<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html"><span class="hs-identifier">Temporal.Activity.Definition</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Catch</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Error.Class</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Fix</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TypeLits</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Activity.Types.html"><span class="hs-identifier">Temporal.Activity.Types</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Client.Types.html"><span class="hs-identifier">Temporal.Client.Types</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Temporal.Core.Client</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Client</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Temporal.Core.Worker</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Worker</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">WorkerType</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Real</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getWorkerClient</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Payload.html"><span class="hs-identifier">Temporal.Payload</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html"><span class="hs-identifier">Temporal.Workflow.Types</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO</span></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">class</span><span> </span><span id="ActivityDef"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDef"><span class="hs-identifier hs-var">ActivityDef</span></a></span></span><span> </span><span id="local-6989586621680173804"><span class="annot"><a href="#local-6989586621680173804"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ActivityDefinitionEnv"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDefinitionEnv"><span class="hs-identifier hs-var">ActivityDefinitionEnv</span></a></span></span><span> </span><span id="local-6989586621680173804"><span class="annot"><a href="#local-6989586621680173804"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-25"></span><span>  </span><span id="activityDefinition"><span class="annot"><a href="Temporal.Activity.Definition.html#activityDefinition"><span class="hs-identifier hs-type">activityDefinition</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680173804"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDefinition"><span class="hs-identifier hs-type">ActivityDefinition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDefinitionEnv"><span class="hs-identifier hs-type">ActivityDefinitionEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173804"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680173805"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDef"><span class="hs-identifier hs-type">ActivityDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDefinition"><span class="hs-identifier hs-type">ActivityDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173805"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ActivityDefinitionEnv"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDefinitionEnv"><span class="hs-identifier hs-var">ActivityDefinitionEnv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDefinition"><span class="hs-identifier hs-type">ActivityDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173805"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680173805"><span class="hs-identifier hs-type">env</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span id="local-6989586621680174082"><span class="annot"><span class="annottext">activityDefinition :: ActivityDefinition env
-&gt; ActivityDefinition
     (ActivityDefinitionEnv (ActivityDefinition env))
</span><a href="Temporal.Activity.Definition.html#activityDefinition"><span class="hs-identifier hs-var hs-var hs-var">activityDefinition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ActivityDefinition env -&gt; ActivityDefinition env
ActivityDefinition env
-&gt; ActivityDefinition
     (ActivityDefinitionEnv (ActivityDefinition env))
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">data</span><span> </span><span id="ProvidedActivity"><span class="annot"><a href="Temporal.Activity.Definition.html#ProvidedActivity"><span class="hs-identifier hs-var">ProvidedActivity</span></a></span></span><span> </span><span id="local-6989586621680173807"><span class="annot"><a href="#local-6989586621680173807"><span class="hs-identifier hs-type">env</span></a></span></span><span> </span><span id="local-6989586621680173808"><span class="annot"><a href="#local-6989586621680173808"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ProvidedActivity"><span class="annot"><a href="Temporal.Activity.Definition.html#ProvidedActivity"><span class="hs-identifier hs-var">ProvidedActivity</span></a></span></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="definition"><span class="annot"><span class="annottext">forall env f. ProvidedActivity env f -&gt; ActivityDefinition env
</span><a href="Temporal.Activity.Definition.html#definition"><span class="hs-identifier hs-var hs-var">definition</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDefinition"><span class="hs-identifier hs-type">ActivityDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173807"><span class="hs-identifier hs-type">env</span></a></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="reference"><span class="annot"><span class="annottext">forall env f.
ProvidedActivity env f
-&gt; KnownActivity (ArgsOf f) (ResultOf (Activity env) f)
</span><a href="Temporal.Activity.Definition.html#reference"><span class="hs-identifier hs-var hs-var">reference</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#KnownActivity"><span class="hs-identifier hs-type">KnownActivity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Payload.html#ArgsOf"><span class="hs-identifier hs-type">ArgsOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173808"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Payload.html#ResultOf"><span class="hs-identifier hs-type">ResultOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-type">Activity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173807"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680173808"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680173820"><span id="local-6989586621680173821"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDef"><span class="hs-identifier hs-type">ActivityDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ProvidedActivity"><span class="hs-identifier hs-type">ProvidedActivity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173820"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173821"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ActivityDefinitionEnv"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDefinitionEnv"><span class="hs-identifier hs-var">ActivityDefinitionEnv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ProvidedActivity"><span class="hs-identifier hs-type">ProvidedActivity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173820"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173821"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680173820"><span class="hs-identifier hs-type">env</span></a></span><span>
</span><span id="line-41"></span><span>  </span><span id="local-6989586621680174089"><span class="annot"><span class="annottext">activityDefinition :: ProvidedActivity env f
-&gt; ActivityDefinition
     (ActivityDefinitionEnv (ProvidedActivity env f))
</span><a href="Temporal.Activity.Definition.html#activityDefinition"><span class="hs-identifier hs-var hs-var hs-var">activityDefinition</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ProvidedActivity"><span class="hs-identifier hs-type">ProvidedActivity</span></a></span><span> </span><span id="local-6989586621680174090"><span class="annot"><span class="annottext">ActivityDefinition env
</span><a href="#local-6989586621680174090"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="annot"><span class="annottext">KnownActivity (ArgsOf f) (ResultOf (Activity env) f)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ActivityDefinition env
ActivityDefinition (ActivityDefinitionEnv (ProvidedActivity env f))
</span><a href="#local-6989586621680174090"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">data</span><span> </span><span id="KnownActivity"><span class="annot"><a href="Temporal.Activity.Definition.html#KnownActivity"><span class="hs-identifier hs-var">KnownActivity</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680173822"><span class="annot"><a href="#local-6989586621680173822"><span class="hs-identifier hs-type">args</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680173823"><span class="annot"><a href="#local-6989586621680173823"><span class="hs-identifier hs-type">result</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680174091"><span class="annot"><a href="#local-6989586621680174091"><span class="hs-identifier hs-type">codec</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Temporal.Payload.html#FunctionSupportsCodec"><span class="hs-identifier hs-type">FunctionSupportsCodec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680174091"><span class="hs-identifier hs-type">codec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173822"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173823"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-47"></span><span>  </span><span id="KnownActivity"><span class="annot"><a href="Temporal.Activity.Definition.html#KnownActivity"><span class="hs-identifier hs-var">KnownActivity</span></a></span></span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="knownActivityCodec"><span class="annot"><span class="annottext">()
</span><a href="Temporal.Activity.Definition.html#knownActivityCodec"><span class="hs-identifier hs-var hs-var">knownActivityCodec</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680174091"><span class="hs-identifier hs-type">codec</span></a></span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="knownActivityName"><span class="annot"><span class="annottext">forall (args :: [*]) result. KnownActivity args result -&gt; Text
</span><a href="Temporal.Activity.Definition.html#knownActivityName"><span class="hs-identifier hs-var hs-var">knownActivityName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">data</span><span> </span><span id="ActivityDefinition"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDefinition"><span class="hs-identifier hs-var">ActivityDefinition</span></a></span></span><span> </span><span id="local-6989586621680173829"><span class="annot"><a href="#local-6989586621680173829"><span class="hs-identifier hs-type">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ActivityDefinition"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDefinition"><span class="hs-identifier hs-var">ActivityDefinition</span></a></span></span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="activityName"><span class="annot"><span class="annottext">forall env. ActivityDefinition env -&gt; Text
</span><a href="Temporal.Activity.Definition.html#activityName"><span class="hs-identifier hs-var hs-var">activityName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="activityRun"><span class="annot"><span class="annottext">forall env.
ActivityDefinition env
-&gt; ActivityEnv env
-&gt; ExecuteActivityInput
-&gt; IO (Either String Payload)
</span><a href="Temporal.Activity.Definition.html#activityRun"><span class="hs-identifier hs-var hs-var">activityRun</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityEnv"><span class="hs-identifier hs-type">ActivityEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173829"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#ExecuteActivityInput"><span class="hs-identifier hs-type">ExecuteActivityInput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">data</span><span> </span><span id="ActivityEnv"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityEnv"><span class="hs-identifier hs-var">ActivityEnv</span></a></span></span><span> </span><span id="local-6989586621680173835"><span class="annot"><a href="#local-6989586621680173835"><span class="hs-identifier hs-type">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ActivityEnv"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityEnv"><span class="hs-identifier hs-var">ActivityEnv</span></a></span></span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="activityWorker"><span class="annot"><span class="annottext">forall env. ActivityEnv env -&gt; Worker 'Real
</span><a href="Temporal.Activity.Definition.html#activityWorker"><span class="hs-identifier hs-var hs-var">activityWorker</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Worker</span></span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Real</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="activityInfo"><span class="annot"><span class="annottext">forall env. ActivityEnv env -&gt; ActivityInfo
</span><a href="Temporal.Activity.Definition.html#activityInfo"><span class="hs-identifier hs-var hs-var">activityInfo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Temporal.Activity.Types.html#ActivityInfo"><span class="hs-identifier hs-type">ActivityInfo</span></a></span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="activityClientInterceptors"><span class="annot"><span class="annottext">forall env. ActivityEnv env -&gt; ClientInterceptors
</span><a href="Temporal.Activity.Definition.html#activityClientInterceptors"><span class="hs-identifier hs-var hs-var">activityClientInterceptors</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Temporal.Client.Types.html#ClientInterceptors"><span class="hs-identifier hs-type">ClientInterceptors</span></a></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="activityPayloadProcessor"><span class="annot"><span class="annottext">forall env. ActivityEnv env -&gt; PayloadProcessor
</span><a href="Temporal.Activity.Definition.html#activityPayloadProcessor"><span class="hs-identifier hs-var hs-var">activityPayloadProcessor</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Temporal.Payload.html#PayloadProcessor"><span class="hs-identifier hs-type">PayloadProcessor</span></a></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="activityEnv"><span class="annot"><span class="annottext">forall env. ActivityEnv env -&gt; env
</span><a href="Temporal.Activity.Definition.html#activityEnv"><span class="hs-identifier hs-var hs-var">activityEnv</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680173835"><span class="hs-identifier hs-type">env</span></a></span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-keyword">class</span><span> </span><span id="ActivityRef"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityRef"><span class="hs-identifier hs-var">ActivityRef</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680173852"><span class="annot"><a href="#local-6989586621680173852"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ActivityArgs"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityArgs"><span class="hs-identifier hs-var">ActivityArgs</span></a></span></span><span> </span><span id="local-6989586621680173852"><span class="annot"><a href="#local-6989586621680173852"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">]</span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ActivityResult"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityResult"><span class="hs-identifier hs-var">ActivityResult</span></a></span></span><span> </span><span id="local-6989586621680173852"><span class="annot"><a href="#local-6989586621680173852"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-71"></span><span>  </span><span id="activityRef"><span class="annot"><a href="Temporal.Activity.Definition.html#activityRef"><span class="hs-identifier hs-type">activityRef</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680173852"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#KnownActivity"><span class="hs-identifier hs-type">KnownActivity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityArgs"><span class="hs-identifier hs-type">ActivityArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173852"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityResult"><span class="hs-identifier hs-type">ActivityResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173852"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680173853"><span id="local-6989586621680173854"><span class="annot"><a href="Temporal.Payload.html#VarArgs"><span class="hs-identifier hs-type">VarArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173853"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityRef"><span class="hs-identifier hs-type">ActivityRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#KnownActivity"><span class="hs-identifier hs-type">KnownActivity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173853"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173854"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ActivityArgs"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityArgs"><span class="hs-identifier hs-var">ActivityArgs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#KnownActivity"><span class="hs-identifier hs-type">KnownActivity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173853"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173854"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680173853"><span class="hs-identifier hs-type">args</span></a></span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ActivityResult"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityResult"><span class="hs-identifier hs-var">ActivityResult</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#KnownActivity"><span class="hs-identifier hs-type">KnownActivity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173853"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173854"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680173854"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-77"></span><span>  </span><span id="local-6989586621680174110"><span class="annot"><span class="annottext">activityRef :: KnownActivity args result
-&gt; KnownActivity
     (ActivityArgs (KnownActivity args result))
     (ActivityResult (KnownActivity args result))
</span><a href="Temporal.Activity.Definition.html#activityRef"><span class="hs-identifier hs-var hs-var hs-var">activityRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownActivity args result -&gt; KnownActivity args result
KnownActivity args result
-&gt; KnownActivity
     (ActivityArgs (KnownActivity args result))
     (ActivityResult (KnownActivity args result))
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680173857"><span id="local-6989586621680173858"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityRef"><span class="hs-identifier hs-type">ActivityRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ProvidedActivity"><span class="hs-identifier hs-type">ProvidedActivity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173857"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173858"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ActivityArgs"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityArgs"><span class="hs-identifier hs-var">ActivityArgs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ProvidedActivity"><span class="hs-identifier hs-type">ProvidedActivity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173857"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173858"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Temporal.Payload.html#ArgsOf"><span class="hs-identifier hs-type">ArgsOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173858"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ActivityResult"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityResult"><span class="hs-identifier hs-var">ActivityResult</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ProvidedActivity"><span class="hs-identifier hs-type">ProvidedActivity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173857"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173858"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Temporal.Payload.html#ResultOf"><span class="hs-identifier hs-type">ResultOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-type">Activity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173857"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680173858"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span id="local-6989586621680174114"><span class="annot"><span class="annottext">activityRef :: ProvidedActivity env f
-&gt; KnownActivity
     (ActivityArgs (ProvidedActivity env f))
     (ActivityResult (ProvidedActivity env f))
</span><a href="Temporal.Activity.Definition.html#activityRef"><span class="hs-identifier hs-var hs-var hs-var">activityRef</span></a></span></span><span> </span><span id="local-6989586621680174115"><span class="annot"><span class="annottext">ProvidedActivity env f
</span><a href="#local-6989586621680174115"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProvidedActivity env f
</span><a href="#local-6989586621680174115"><span class="hs-identifier hs-var">act</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">reference</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-keyword">type</span><span> </span><span id="DirectActivityReferenceMsg"><span class="annot"><a href="Temporal.Activity.Definition.html#DirectActivityReferenceMsg"><span class="hs-identifier hs-var">DirectActivityReferenceMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;You can't run an 'Activity' directly in a 'Workflow' like this.&quot;</span></span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;A 'Workflow' must be deterministic, and 'Activity' values execute arbitrary IO.&quot;</span></span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;You will want to use a reference to a registered activity like 'KnownActivity' or 'RefFromFunction' to invoke the activity here.&quot;</span></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Then, you'll be able to call 'startActivity' or 'executeActivity' on it. So, instead of writing:&quot;</span></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;    &gt; executeActivity myActivity ...&quot;</span></span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;write:&quot;</span></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;    &gt; executeActivity myActivityRef ...&quot;</span></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPPABLE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span id="local-6989586621680173864"><span id="local-6989586621680173865"><span id="local-6989586621680173866"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680173864"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Payload.html#ArgsOf"><span class="hs-identifier hs-type">ArgsOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173864"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#%3A-%3E%3A"><span class="hs-operator hs-type">:-&gt;:</span></a></span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-type">Activity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173865"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Payload.html#ResultOf"><span class="hs-identifier hs-type">ResultOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-type">Activity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173865"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680173864"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeError</span></span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#DirectActivityReferenceMsg"><span class="hs-identifier hs-type">DirectActivityReferenceMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityRef"><span class="hs-identifier hs-type">ActivityRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680173866"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680173864"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ActivityArgs"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityArgs"><span class="hs-identifier hs-var">ActivityArgs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680173866"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680173864"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ActivityResult"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityResult"><span class="hs-identifier hs-var">ActivityResult</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680173866"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680173864"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>  </span><span id="local-6989586621680174122"><span class="annot"><span class="annottext">activityRef :: (a -&gt; f)
-&gt; KnownActivity (ActivityArgs (a -&gt; f)) (ActivityResult (a -&gt; f))
</span><a href="Temporal.Activity.Definition.html#activityRef"><span class="hs-identifier hs-var hs-var hs-var">activityRef</span></a></span></span><span> </span><span class="annot"><span class="annottext">a -&gt; f
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; KnownActivity '[] ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Should never be called&quot;</span></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680173872"><span id="local-6989586621680173873"><span class="annot"><span class="hs-identifier hs-type">TypeError</span></span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#DirectActivityReferenceMsg"><span class="hs-identifier hs-type">DirectActivityReferenceMsg</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityRef"><span class="hs-identifier hs-type">ActivityRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-type">Activity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173872"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173873"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ActivityArgs"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityArgs"><span class="hs-identifier hs-var">ActivityArgs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-type">Activity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173872"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173873"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ActivityResult"><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityResult"><span class="hs-identifier hs-var">ActivityResult</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-type">Activity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173872"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173873"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680173873"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-105"></span><span>  </span><span id="local-6989586621680174129"><span class="annot"><span class="annottext">activityRef :: Activity env a
-&gt; KnownActivity
     (ActivityArgs (Activity env a)) (ActivityResult (Activity env a))
</span><a href="Temporal.Activity.Definition.html#activityRef"><span class="hs-identifier hs-var hs-var hs-var">activityRef</span></a></span></span><span> </span><span class="annot"><span class="annottext">Activity env a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; KnownActivity '[] a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Should never be called&quot;</span></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="annot"><span class="hs-comment">{- |
= What is an Activity?

An activity is a unit of work that is executed by a worker. It is a specialized function call
that can be executed one or more times, and can be cancelled while it is running.

Activity Definitions are executed as normal functions.

In the event of failure, the function begins at its initial state when retried (except when Activity Heartbeats are established).

Therefore, an Activity Definition has no restrictions on the code it contains.

= Idempotency

Temporal recommends that Activities be idempotent.

Idempotent means that performing an operation multiple times has the same result as performing it once. In the context of Temporal, Activities should be designed to be safely executed multiple times without causing unexpected or undesired side effects.

An Activity is idempotent if multiple Activity Task Executions do not change the state of the system beyond the first Activity Task Execution.

We recommend using idempotency keys for critical side effects.

The lack of idempotency might affect the correctness of your application but does not affect the Temporal Platform. In other words, lack of idempotency doesn't lead to a platform error.

In some cases, whether something is idempotent doesn't affect the correctness of an application. For example, if you have a monotonically incrementing counter, you might not care that retries increment the counter because you don&#8217;t care about the actual value, only that the current value is greater than a previous value.
-}</span></span><span>
</span><span id="line-134"></span><span class="hs-keyword">newtype</span><span> </span><span id="Activity"><span class="annot"><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-var">Activity</span></a></span></span><span> </span><span id="local-6989586621680173874"><span class="annot"><a href="#local-6989586621680173874"><span class="hs-identifier hs-type">env</span></a></span></span><span> </span><span id="local-6989586621680173875"><span class="annot"><a href="#local-6989586621680173875"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Activity"><span class="annot"><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-var">Activity</span></a></span></span><span> </span><span class="hs-special">{</span><span id="unActivity"><span class="annot"><span class="annottext">forall env a. Activity env a -&gt; ReaderT (ActivityEnv env) IO a
</span><a href="Temporal.Activity.Definition.html#unActivity"><span class="hs-identifier hs-var hs-var">unActivity</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityEnv"><span class="hs-identifier hs-type">ActivityEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680173874"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680173875"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621680174133"><span id="local-6989586621680174139"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; Activity env a -&gt; Activity env b)
-&gt; (forall a b. a -&gt; Activity env b -&gt; Activity env a)
-&gt; Functor (Activity env)
forall a b. a -&gt; Activity env b -&gt; Activity env a
forall a b. (a -&gt; b) -&gt; Activity env a -&gt; Activity env b
forall env a b. a -&gt; Activity env b -&gt; Activity env a
forall env a b. (a -&gt; b) -&gt; Activity env a -&gt; Activity env b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall env a b. (a -&gt; b) -&gt; Activity env a -&gt; Activity env b
fmap :: forall a b. (a -&gt; b) -&gt; Activity env a -&gt; Activity env b
$c&lt;$ :: forall env a b. a -&gt; Activity env b -&gt; Activity env a
&lt;$ :: forall a b. a -&gt; Activity env b -&gt; Activity env a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680174150"><span id="local-6989586621680174156"><span id="local-6989586621680174161"><span id="local-6989586621680174166"><span id="local-6989586621680174171"><span class="annot"><span class="annottext">Functor (Activity env)
Functor (Activity env) =&gt;
(forall a. a -&gt; Activity env a)
-&gt; (forall a b.
    Activity env (a -&gt; b) -&gt; Activity env a -&gt; Activity env b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c)
    -&gt; Activity env a -&gt; Activity env b -&gt; Activity env c)
-&gt; (forall a b. Activity env a -&gt; Activity env b -&gt; Activity env b)
-&gt; (forall a b. Activity env a -&gt; Activity env b -&gt; Activity env a)
-&gt; Applicative (Activity env)
forall env. Functor (Activity env)
forall a. a -&gt; Activity env a
forall env a. a -&gt; Activity env a
forall a b. Activity env a -&gt; Activity env b -&gt; Activity env a
forall a b. Activity env a -&gt; Activity env b -&gt; Activity env b
forall a b.
Activity env (a -&gt; b) -&gt; Activity env a -&gt; Activity env b
forall env a b. Activity env a -&gt; Activity env b -&gt; Activity env a
forall env a b. Activity env a -&gt; Activity env b -&gt; Activity env b
forall env a b.
Activity env (a -&gt; b) -&gt; Activity env a -&gt; Activity env b
forall a b c.
(a -&gt; b -&gt; c) -&gt; Activity env a -&gt; Activity env b -&gt; Activity env c
forall env a b c.
(a -&gt; b -&gt; c) -&gt; Activity env a -&gt; Activity env b -&gt; Activity env c
forall (f :: * -&gt; *).
Functor f =&gt;
(forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
$cpure :: forall env a. a -&gt; Activity env a
pure :: forall a. a -&gt; Activity env a
$c&lt;*&gt; :: forall env a b.
Activity env (a -&gt; b) -&gt; Activity env a -&gt; Activity env b
&lt;*&gt; :: forall a b.
Activity env (a -&gt; b) -&gt; Activity env a -&gt; Activity env b
$cliftA2 :: forall env a b c.
(a -&gt; b -&gt; c) -&gt; Activity env a -&gt; Activity env b -&gt; Activity env c
liftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; Activity env a -&gt; Activity env b -&gt; Activity env c
$c*&gt; :: forall env a b. Activity env a -&gt; Activity env b -&gt; Activity env b
*&gt; :: forall a b. Activity env a -&gt; Activity env b -&gt; Activity env b
$c&lt;* :: forall env a b. Activity env a -&gt; Activity env b -&gt; Activity env a
&lt;* :: forall a b. Activity env a -&gt; Activity env b -&gt; Activity env a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680174183"><span id="local-6989586621680174189"><span id="local-6989586621680174194"><span id="local-6989586621680174199"><span class="annot"><span class="annottext">Applicative (Activity env)
Applicative (Activity env) =&gt;
(forall a. Activity env a)
-&gt; (forall a. Activity env a -&gt; Activity env a -&gt; Activity env a)
-&gt; (forall a. Activity env a -&gt; Activity env [a])
-&gt; (forall a. Activity env a -&gt; Activity env [a])
-&gt; Alternative (Activity env)
forall env. Applicative (Activity env)
forall a. Activity env a
forall a. Activity env a -&gt; Activity env [a]
forall a. Activity env a -&gt; Activity env a -&gt; Activity env a
forall env a. Activity env a
forall env a. Activity env a -&gt; Activity env [a]
forall env a. Activity env a -&gt; Activity env a -&gt; Activity env a
forall (f :: * -&gt; *).
Applicative f =&gt;
(forall a. f a)
-&gt; (forall a. f a -&gt; f a -&gt; f a)
-&gt; (forall a. f a -&gt; f [a])
-&gt; (forall a. f a -&gt; f [a])
-&gt; Alternative f
$cempty :: forall env a. Activity env a
empty :: forall a. Activity env a
$c&lt;|&gt; :: forall env a. Activity env a -&gt; Activity env a -&gt; Activity env a
&lt;|&gt; :: forall a. Activity env a -&gt; Activity env a -&gt; Activity env a
$csome :: forall env a. Activity env a -&gt; Activity env [a]
some :: forall a. Activity env a -&gt; Activity env [a]
$cmany :: forall env a. Activity env a -&gt; Activity env [a]
many :: forall a. Activity env a -&gt; Activity env [a]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Alternative</span></span></span></span></span></span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680174213"><span id="local-6989586621680174219"><span id="local-6989586621680174224"><span class="annot"><span class="annottext">Applicative (Activity env)
Applicative (Activity env) =&gt;
(forall a b.
 Activity env a -&gt; (a -&gt; Activity env b) -&gt; Activity env b)
-&gt; (forall a b. Activity env a -&gt; Activity env b -&gt; Activity env b)
-&gt; (forall a. a -&gt; Activity env a)
-&gt; Monad (Activity env)
forall env. Applicative (Activity env)
forall a. a -&gt; Activity env a
forall env a. a -&gt; Activity env a
forall a b. Activity env a -&gt; Activity env b -&gt; Activity env b
forall a b.
Activity env a -&gt; (a -&gt; Activity env b) -&gt; Activity env b
forall env a b. Activity env a -&gt; Activity env b -&gt; Activity env b
forall env a b.
Activity env a -&gt; (a -&gt; Activity env b) -&gt; Activity env b
forall (m :: * -&gt; *).
Applicative m =&gt;
(forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall env a b.
Activity env a -&gt; (a -&gt; Activity env b) -&gt; Activity env b
&gt;&gt;= :: forall a b.
Activity env a -&gt; (a -&gt; Activity env b) -&gt; Activity env b
$c&gt;&gt; :: forall env a b. Activity env a -&gt; Activity env b -&gt; Activity env b
&gt;&gt; :: forall a b. Activity env a -&gt; Activity env b -&gt; Activity env b
$creturn :: forall env a. a -&gt; Activity env a
return :: forall a. a -&gt; Activity env a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680174234"><span class="annot"><span class="annottext">Monad (Activity env)
Monad (Activity env) =&gt;
(forall a. String -&gt; Activity env a) -&gt; MonadFail (Activity env)
forall env. Monad (Activity env)
forall a. String -&gt; Activity env a
forall env a. String -&gt; Activity env a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall a. String -&gt; m a) -&gt; MonadFail m
$cfail :: forall env a. String -&gt; Activity env a
fail :: forall a. String -&gt; Activity env a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadFail</span></span></span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680174245"><span class="annot"><span class="annottext">Monad (Activity env)
Monad (Activity env) =&gt;
(forall a. (a -&gt; Activity env a) -&gt; Activity env a)
-&gt; MonadFix (Activity env)
forall env. Monad (Activity env)
forall a. (a -&gt; Activity env a) -&gt; Activity env a
forall env a. (a -&gt; Activity env a) -&gt; Activity env a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall a. (a -&gt; m a) -&gt; m a) -&gt; MonadFix m
$cmfix :: forall env a. (a -&gt; Activity env a) -&gt; Activity env a
mfix :: forall a. (a -&gt; Activity env a) -&gt; Activity env a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadFix</span></span></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680174256"><span id="local-6989586621680174262"><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IOException</span></span></span></span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680174274"><span class="annot"><span class="annottext">Monad (Activity env)
Monad (Activity env) =&gt;
(forall a. IO a -&gt; Activity env a) -&gt; MonadIO (Activity env)
forall env. Monad (Activity env)
forall a. IO a -&gt; Activity env a
forall env a. IO a -&gt; Activity env a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall a. IO a -&gt; m a) -&gt; MonadIO m
$cliftIO :: forall env a. IO a -&gt; Activity env a
liftIO :: forall a. IO a -&gt; Activity env a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></span></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680174288"><span id="local-6989586621680174294"><span class="annot"><span class="annottext">Monad (Activity env)
Alternative (Activity env)
(Alternative (Activity env), Monad (Activity env)) =&gt;
(forall a. Activity env a)
-&gt; (forall a. Activity env a -&gt; Activity env a -&gt; Activity env a)
-&gt; MonadPlus (Activity env)
forall env. Monad (Activity env)
forall env. Alternative (Activity env)
forall a. Activity env a
forall a. Activity env a -&gt; Activity env a -&gt; Activity env a
forall env a. Activity env a
forall env a. Activity env a -&gt; Activity env a -&gt; Activity env a
forall (m :: * -&gt; *).
(Alternative m, Monad m) =&gt;
(forall a. m a) -&gt; (forall a. m a -&gt; m a -&gt; m a) -&gt; MonadPlus m
$cmzero :: forall env a. Activity env a
mzero :: forall a. Activity env a
$cmplus :: forall env a. Activity env a -&gt; Activity env a -&gt; Activity env a
mplus :: forall a. Activity env a -&gt; Activity env a -&gt; Activity env a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadPlus</span></span></span></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680174306"><span class="annot"><span class="annottext">MonadIO (Activity env)
MonadIO (Activity env) =&gt;
(forall b.
 ((forall a. Activity env a -&gt; IO a) -&gt; IO b) -&gt; Activity env b)
-&gt; MonadUnliftIO (Activity env)
forall env. MonadIO (Activity env)
forall b.
((forall a. Activity env a -&gt; IO a) -&gt; IO b) -&gt; Activity env b
forall env b.
((forall a. Activity env a -&gt; IO a) -&gt; IO b) -&gt; Activity env b
forall (m :: * -&gt; *).
MonadIO m =&gt;
(forall b. ((forall a. m a -&gt; IO a) -&gt; IO b) -&gt; m b)
-&gt; MonadUnliftIO m
$cwithRunInIO :: forall env b.
((forall a. Activity env a -&gt; IO a) -&gt; IO b) -&gt; Activity env b
withRunInIO :: forall b.
((forall a. Activity env a -&gt; IO a) -&gt; IO b) -&gt; Activity env b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadUnliftIO</span></span></span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680174323"><span class="annot"><span class="annottext">Monad (Activity env)
Monad (Activity env) =&gt;
(forall e a. (HasCallStack, Exception e) =&gt; e -&gt; Activity env a)
-&gt; MonadThrow (Activity env)
forall env. Monad (Activity env)
forall e a. (HasCallStack, Exception e) =&gt; e -&gt; Activity env a
forall env e a. (HasCallStack, Exception e) =&gt; e -&gt; Activity env a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall e a. (HasCallStack, Exception e) =&gt; e -&gt; m a)
-&gt; MonadThrow m
$cthrowM :: forall env e a. (HasCallStack, Exception e) =&gt; e -&gt; Activity env a
throwM :: forall e a. (HasCallStack, Exception e) =&gt; e -&gt; Activity env a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadThrow</span></span></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680174345"><span class="annot"><span class="annottext">MonadThrow (Activity env)
MonadThrow (Activity env) =&gt;
(forall e a.
 (HasCallStack, Exception e) =&gt;
 Activity env a -&gt; (e -&gt; Activity env a) -&gt; Activity env a)
-&gt; MonadCatch (Activity env)
forall env. MonadThrow (Activity env)
forall e a.
(HasCallStack, Exception e) =&gt;
Activity env a -&gt; (e -&gt; Activity env a) -&gt; Activity env a
forall env e a.
(HasCallStack, Exception e) =&gt;
Activity env a -&gt; (e -&gt; Activity env a) -&gt; Activity env a
forall (m :: * -&gt; *).
MonadThrow m =&gt;
(forall e a.
 (HasCallStack, Exception e) =&gt;
 m a -&gt; (e -&gt; m a) -&gt; m a)
-&gt; MonadCatch m
$ccatch :: forall env e a.
(HasCallStack, Exception e) =&gt;
Activity env a -&gt; (e -&gt; Activity env a) -&gt; Activity env a
catch :: forall e a.
(HasCallStack, Exception e) =&gt;
Activity env a -&gt; (e -&gt; Activity env a) -&gt; Activity env a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadCatch</span></span></span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680174365"><span id="local-6989586621680174377"><span id="local-6989586621680174388"><span class="annot"><span class="annottext">MonadCatch (Activity env)
MonadCatch (Activity env) =&gt;
(forall b.
 HasCallStack =&gt;
 ((forall a. Activity env a -&gt; Activity env a) -&gt; Activity env b)
 -&gt; Activity env b)
-&gt; (forall b.
    HasCallStack =&gt;
    ((forall a. Activity env a -&gt; Activity env a) -&gt; Activity env b)
    -&gt; Activity env b)
-&gt; (forall a b c.
    HasCallStack =&gt;
    Activity env a
    -&gt; (a -&gt; ExitCase b -&gt; Activity env c)
    -&gt; (a -&gt; Activity env b)
    -&gt; Activity env (b, c))
-&gt; MonadMask (Activity env)
forall env. MonadCatch (Activity env)
forall b.
HasCallStack =&gt;
((forall a. Activity env a -&gt; Activity env a) -&gt; Activity env b)
-&gt; Activity env b
forall env b.
HasCallStack =&gt;
((forall a. Activity env a -&gt; Activity env a) -&gt; Activity env b)
-&gt; Activity env b
forall a b c.
HasCallStack =&gt;
Activity env a
-&gt; (a -&gt; ExitCase b -&gt; Activity env c)
-&gt; (a -&gt; Activity env b)
-&gt; Activity env (b, c)
forall env a b c.
HasCallStack =&gt;
Activity env a
-&gt; (a -&gt; ExitCase b -&gt; Activity env c)
-&gt; (a -&gt; Activity env b)
-&gt; Activity env (b, c)
forall (m :: * -&gt; *).
MonadCatch m =&gt;
(forall b. HasCallStack =&gt; ((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b)
-&gt; (forall b.
    HasCallStack =&gt;
    ((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b)
-&gt; (forall a b c.
    HasCallStack =&gt;
    m a -&gt; (a -&gt; ExitCase b -&gt; m c) -&gt; (a -&gt; m b) -&gt; m (b, c))
-&gt; MonadMask m
$cmask :: forall env b.
HasCallStack =&gt;
((forall a. Activity env a -&gt; Activity env a) -&gt; Activity env b)
-&gt; Activity env b
mask :: forall b.
HasCallStack =&gt;
((forall a. Activity env a -&gt; Activity env a) -&gt; Activity env b)
-&gt; Activity env b
$cuninterruptibleMask :: forall env b.
HasCallStack =&gt;
((forall a. Activity env a -&gt; Activity env a) -&gt; Activity env b)
-&gt; Activity env b
uninterruptibleMask :: forall b.
HasCallStack =&gt;
((forall a. Activity env a -&gt; Activity env a) -&gt; Activity env b)
-&gt; Activity env b
$cgeneralBracket :: forall env a b c.
HasCallStack =&gt;
Activity env a
-&gt; (a -&gt; ExitCase b -&gt; Activity env c)
-&gt; (a -&gt; Activity env b)
-&gt; Activity env (b, c)
generalBracket :: forall a b c.
HasCallStack =&gt;
Activity env a
-&gt; (a -&gt; ExitCase b -&gt; Activity env c)
-&gt; (a -&gt; Activity env b)
-&gt; Activity env (b, c)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadMask</span></span></span></span></span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span id="local-6989586621680174042"><span id="local-6989586621680174043"><span class="annot"><a href="Temporal.Activity.Definition.html#runActivity"><span class="hs-identifier hs-type">runActivity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityEnv"><span class="hs-identifier hs-type">ActivityEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680174042"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-type">Activity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680174042"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680174043"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680174043"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-153"></span><span id="runActivity"><span class="annot"><span class="annottext">runActivity :: forall env a. ActivityEnv env -&gt; Activity env a -&gt; IO a
</span><a href="Temporal.Activity.Definition.html#runActivity"><span class="hs-identifier hs-var hs-var">runActivity</span></a></span></span><span> </span><span id="local-6989586621680174402"><span class="annot"><span class="annottext">ActivityEnv env
</span><a href="#local-6989586621680174402"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-type">Activity</span></a></span><span> </span><span id="local-6989586621680174403"><span class="annot"><span class="annottext">ReaderT (ActivityEnv env) IO a
</span><a href="#local-6989586621680174403"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT (ActivityEnv env) IO a -&gt; ActivityEnv env -&gt; IO a
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">ReaderT (ActivityEnv env) IO a
</span><a href="#local-6989586621680174403"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ActivityEnv env
</span><a href="#local-6989586621680174402"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span id="local-6989586621680174049"><span class="annot"><a href="Temporal.Activity.Definition.html#askActivityInfo"><span class="hs-identifier hs-type">askActivityInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-type">Activity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680174049"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="Temporal.Activity.Types.html#ActivityInfo"><span class="hs-identifier hs-type">ActivityInfo</span></a></span></span><span>
</span><span id="line-157"></span><span id="askActivityInfo"><span class="annot"><span class="annottext">askActivityInfo :: forall env. Activity env ActivityInfo
</span><a href="Temporal.Activity.Definition.html#askActivityInfo"><span class="hs-identifier hs-var hs-var">askActivityInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT (ActivityEnv env) IO ActivityInfo
-&gt; Activity env ActivityInfo
forall env a. ReaderT (ActivityEnv env) IO a -&gt; Activity env a
</span><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-var">Activity</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT (ActivityEnv env) IO ActivityInfo
 -&gt; Activity env ActivityInfo)
-&gt; ReaderT (ActivityEnv env) IO ActivityInfo
-&gt; Activity env ActivityInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ActivityEnv env -&gt; ActivityInfo)
-&gt; ReaderT (ActivityEnv env) IO ActivityInfo
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="hs-operator">.</span><span class="hs-identifier">activityInfo</span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span id="local-6989586621680174061"><span class="annot"><a href="Temporal.Activity.Definition.html#askActivityWorker"><span class="hs-identifier hs-type">askActivityWorker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-type">Activity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680174061"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Worker</span></span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Real</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-161"></span><span id="askActivityWorker"><span class="annot"><span class="annottext">askActivityWorker :: forall env. Activity env (Worker 'Real)
</span><a href="Temporal.Activity.Definition.html#askActivityWorker"><span class="hs-identifier hs-var hs-var">askActivityWorker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT (ActivityEnv env) IO (Worker 'Real)
-&gt; Activity env (Worker 'Real)
forall env a. ReaderT (ActivityEnv env) IO a -&gt; Activity env a
</span><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-var">Activity</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT (ActivityEnv env) IO (Worker 'Real)
 -&gt; Activity env (Worker 'Real))
-&gt; ReaderT (ActivityEnv env) IO (Worker 'Real)
-&gt; Activity env (Worker 'Real)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ActivityEnv env -&gt; Worker 'Real)
-&gt; ReaderT (ActivityEnv env) IO (Worker 'Real)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="hs-operator">.</span><span class="hs-identifier">activityWorker</span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="annot"><span class="hs-comment">{- | The Activity monad provides access to the underlying Temporal client
since it is very common for an Activity to interact with other Workflows.

A common use-case is to use 'Temporal.Client.signal' to signal another Workflow
from an Activity.

Using the provided client ensures that a consistent set of interceptors are used
for all relevant actions.
-}</span></span><span>
</span><span id="line-173"></span><span id="local-6989586621680174063"><span class="annot"><a href="Temporal.Activity.Definition.html#askActivityClient"><span class="hs-identifier hs-type">askActivityClient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-type">Activity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680174063"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Client</span></span></span><span>
</span><span id="line-174"></span><span id="askActivityClient"><span class="annot"><span class="annottext">askActivityClient :: forall env. Activity env Client
</span><a href="Temporal.Activity.Definition.html#askActivityClient"><span class="hs-identifier hs-var hs-var">askActivityClient</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT (ActivityEnv env) IO Client -&gt; Activity env Client
forall env a. ReaderT (ActivityEnv env) IO a -&gt; Activity env a
</span><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-var">Activity</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT (ActivityEnv env) IO Client -&gt; Activity env Client)
-&gt; ReaderT (ActivityEnv env) IO Client -&gt; Activity env Client
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ActivityEnv env -&gt; Client) -&gt; ReaderT (ActivityEnv env) IO Client
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Worker 'Real -&gt; Client
</span><span class="hs-identifier hs-var">getWorkerClient</span></span><span> </span><span class="annot"><span class="annottext">(Worker 'Real -&gt; Client)
-&gt; (ActivityEnv env -&gt; Worker 'Real) -&gt; ActivityEnv env -&gt; Client
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-operator">.</span><span class="hs-identifier">activityWorker</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680174074"><span id="local-6989586621680174425"><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621680174074"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-type">Activity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680174074"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-178"></span><span>  </span><span id="local-6989586621680174432"><span class="annot"><span class="annottext">ask :: Activity env env
</span><a href="#local-6989586621680174432"><span class="hs-identifier hs-var hs-var hs-var">ask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT (ActivityEnv env) IO env -&gt; Activity env env
forall env a. ReaderT (ActivityEnv env) IO a -&gt; Activity env a
</span><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-var">Activity</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT (ActivityEnv env) IO env -&gt; Activity env env)
-&gt; ReaderT (ActivityEnv env) IO env -&gt; Activity env env
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ActivityEnv env -&gt; env) -&gt; ReaderT (ActivityEnv env) IO env
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="hs-operator">.</span><span class="hs-identifier">activityEnv</span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>  </span><span id="local-6989586621680174436"><span class="annot"><span class="annottext">local :: forall a. (env -&gt; env) -&gt; Activity env a -&gt; Activity env a
</span><a href="#local-6989586621680174436"><span class="hs-identifier hs-var hs-var hs-var">local</span></a></span></span><span> </span><span id="local-6989586621680174438"><span class="annot"><span class="annottext">env -&gt; env
</span><a href="#local-6989586621680174438"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-type">Activity</span></a></span><span> </span><span id="local-6989586621680174439"><span class="annot"><span class="annottext">ReaderT (ActivityEnv env) IO a
</span><a href="#local-6989586621680174439"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT (ActivityEnv env) IO a -&gt; Activity env a
forall env a. ReaderT (ActivityEnv env) IO a -&gt; Activity env a
</span><a href="Temporal.Activity.Definition.html#Activity"><span class="hs-identifier hs-var">Activity</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT (ActivityEnv env) IO a -&gt; Activity env a)
-&gt; ReaderT (ActivityEnv env) IO a -&gt; Activity env a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ActivityEnv env -&gt; ActivityEnv env)
-&gt; ReaderT (ActivityEnv env) IO a -&gt; ReaderT (ActivityEnv env) IO a
forall a.
(ActivityEnv env -&gt; ActivityEnv env)
-&gt; ReaderT (ActivityEnv env) IO a -&gt; ReaderT (ActivityEnv env) IO a
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680174440"><span class="annot"><span class="annottext">ActivityEnv env
</span><a href="#local-6989586621680174440"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ActivityEnv env
</span><a href="#local-6989586621680174440"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Activity.Definition.html#activityEnv"><span class="hs-identifier hs-var">Temporal.Activity.Definition.activityEnv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680174438"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#activityEnv"><span class="hs-identifier hs-var">Temporal.Activity.Definition.activityEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680174440"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReaderT (ActivityEnv env) IO a
</span><a href="#local-6989586621680174439"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-180"></span></pre></body></html>