<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="annot"><span class="hs-comment">{- |
Module: Temporal.Contrib.OpenTelemetry
Description: OpenTelemetry instrumentation for Temporal workflows and activities.

OpenTelemetry instrumentation for Temporal workflows and activities.

This module provides an interceptor for Temporal workflows and activities that
automatically instruments them with OpenTelemetry tracing. It also provides
functions for extracting and injecting OpenTelemetry context from and to
Temporal headers.

To use, initialize the OpenTelemetry 'globalTracerProvider'. Then, add
the interceptor to your Temporal client and worker configuration.
-}</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Temporal.Contrib.OpenTelemetry.html"><span class="hs-identifier">Temporal.Contrib.OpenTelemetry</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HashMap</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Int</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Version</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">showVersion</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Word32</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OpenTelemetry.Attributes</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">emptyAttributes</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">OpenTelemetry.Context</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ctxt</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OpenTelemetry.Context.ThreadLocal</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">attachContext</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getContext</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OpenTelemetry.Propagator</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OpenTelemetry.Propagator.W3CTraceContext</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OpenTelemetry.Trace.Core</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Paths_temporal_sdk.html"><span class="hs-identifier">Paths_temporal_sdk</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Activity.Types.html"><span class="hs-identifier">Temporal.Activity.Types</span></a></span><span>
</span><span id="line-35"></span><span class="hs-comment">-- TODO rework WorkflowExitVariant to not expose internals</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Client.Types.html"><span class="hs-identifier">Temporal.Client.Types</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><a href="Temporal.Client.Types.html#StartWorkflowOptions"><span class="hs-identifier">StartWorkflowOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Common.html"><span class="hs-identifier">Temporal.Common</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Duration.html"><span class="hs-identifier">Temporal.Duration</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Interceptor.html"><span class="hs-identifier">Temporal.Interceptor</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Payload.html"><span class="hs-identifier">Temporal.Payload</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier">Payload</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Workflow.html"><span class="hs-identifier">Temporal.Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html"><span class="hs-identifier">Temporal.Workflow.Types</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">span</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="annot"><span class="hs-comment">-- | &quot;_tracer-data&quot;</span></span><span>
</span><span id="line-50"></span><span class="annot"><a href="Temporal.Contrib.OpenTelemetry.html#defaultHeaderKey"><span class="hs-identifier hs-type">defaultHeaderKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-51"></span><span id="defaultHeaderKey"><span class="annot"><span class="annottext">defaultHeaderKey :: Text
</span><a href="Temporal.Contrib.OpenTelemetry.html#defaultHeaderKey"><span class="hs-identifier hs-var hs-var">defaultHeaderKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_tracer-data&quot;</span></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">data</span><span> </span><span id="OpenTelemetryInterceptorOptions"><span class="annot"><a href="Temporal.Contrib.OpenTelemetry.html#OpenTelemetryInterceptorOptions"><span class="hs-identifier hs-var">OpenTelemetryInterceptorOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="OpenTelemetryInterceptorOptions"><span class="annot"><a href="Temporal.Contrib.OpenTelemetry.html#OpenTelemetryInterceptorOptions"><span class="hs-identifier hs-var">OpenTelemetryInterceptorOptions</span></a></span></span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="tracerProvider"><span class="annot"><span class="annottext">OpenTelemetryInterceptorOptions -&gt; Maybe TracerProvider
</span><a href="Temporal.Contrib.OpenTelemetry.html#tracerProvider"><span class="hs-identifier hs-var hs-var">tracerProvider</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TracerProvider</span></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="headerKey"><span class="annot"><span class="annottext">OpenTelemetryInterceptorOptions -&gt; Text
</span><a href="Temporal.Contrib.OpenTelemetry.html#headerKey"><span class="hs-identifier hs-var hs-var">headerKey</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="annot"><a href="Temporal.Contrib.OpenTelemetry.html#defaultOpenTelemetryInterceptorOptions"><span class="hs-identifier hs-type">defaultOpenTelemetryInterceptorOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Contrib.OpenTelemetry.html#OpenTelemetryInterceptorOptions"><span class="hs-identifier hs-type">OpenTelemetryInterceptorOptions</span></a></span><span>
</span><span id="line-61"></span><span id="defaultOpenTelemetryInterceptorOptions"><span class="annot"><span class="annottext">defaultOpenTelemetryInterceptorOptions :: OpenTelemetryInterceptorOptions
</span><a href="Temporal.Contrib.OpenTelemetry.html#defaultOpenTelemetryInterceptorOptions"><span class="hs-identifier hs-var hs-var">defaultOpenTelemetryInterceptorOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><a href="Temporal.Contrib.OpenTelemetry.html#OpenTelemetryInterceptorOptions"><span class="hs-identifier hs-type">OpenTelemetryInterceptorOptions</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tracerProvider :: Maybe TracerProvider
</span><a href="Temporal.Contrib.OpenTelemetry.html#tracerProvider"><span class="hs-identifier hs-var">tracerProvider</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TracerProvider
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">headerKey :: Text
</span><a href="Temporal.Contrib.OpenTelemetry.html#headerKey"><span class="hs-identifier hs-var">headerKey</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Temporal.Contrib.OpenTelemetry.html#defaultHeaderKey"><span class="hs-identifier hs-var">defaultHeaderKey</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="annot"><a href="Temporal.Contrib.OpenTelemetry.html#headersPropagator"><span class="hs-identifier hs-type">headersPropagator</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Propagator</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ctxt.Context</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span id="headersPropagator"><span class="annot"><span class="annottext">headersPropagator :: Propagator Context (Map Text Payload) (Map Text Payload)
</span><a href="Temporal.Contrib.OpenTelemetry.html#headersPropagator"><span class="hs-identifier hs-var hs-var">headersPropagator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Propagator</span></span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">propagatorNames :: [Text]
</span><span class="hs-identifier hs-var">propagatorNames</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;tracecontext&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">extractor :: Map Text Payload -&gt; Context -&gt; IO Context
</span><span class="hs-identifier hs-var">extractor</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680185637"><span class="annot"><span class="annottext">Map Text Payload
</span><a href="#local-6989586621680185637"><span class="hs-identifier hs-var">hs</span></a></span></span><span> </span><span id="local-6989586621680185638"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621680185638"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-73"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680185639"><span class="annot"><span class="annottext">traceParentHeader :: Maybe ByteString
</span><a href="#local-6989586621680185639"><span class="hs-identifier hs-var hs-var">traceParentHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Payload -&gt; ByteString
</span><a href="Temporal.Payload.html#payloadData"><span class="hs-identifier hs-var">payloadData</span></a></span><span> </span><span class="annot"><span class="annottext">(Payload -&gt; ByteString) -&gt; Maybe Payload -&gt; Maybe ByteString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Map Text Payload -&gt; Maybe Payload
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;traceparent&quot;</span></span><span> </span><span class="annot"><span class="annottext">Map Text Payload
</span><a href="#local-6989586621680185637"><span class="hs-identifier hs-var">hs</span></a></span><span>
</span><span id="line-74"></span><span>            </span><span id="local-6989586621680185643"><span class="annot"><span class="annottext">traceStateHeader :: Maybe ByteString
</span><a href="#local-6989586621680185643"><span class="hs-identifier hs-var hs-var">traceStateHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Payload -&gt; ByteString
</span><a href="Temporal.Payload.html#payloadData"><span class="hs-identifier hs-var">payloadData</span></a></span><span> </span><span class="annot"><span class="annottext">(Payload -&gt; ByteString) -&gt; Maybe Payload -&gt; Maybe ByteString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Map Text Payload -&gt; Maybe Payload
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;tracestate&quot;</span></span><span> </span><span class="annot"><span class="annottext">Map Text Payload
</span><a href="#local-6989586621680185637"><span class="hs-identifier hs-var">hs</span></a></span><span>
</span><span id="line-75"></span><span>            </span><span id="local-6989586621680185644"><span class="annot"><span class="annottext">mspanContext :: Maybe SpanContext
</span><a href="#local-6989586621680185644"><span class="hs-identifier hs-var hs-var">mspanContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; Maybe ByteString -&gt; Maybe SpanContext
</span><span class="hs-identifier hs-var">decodeSpanContext</span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621680185639"><span class="hs-identifier hs-var">traceParentHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621680185643"><span class="hs-identifier hs-var">traceStateHeader</span></a></span><span>
</span><span id="line-76"></span><span>        </span><span class="annot"><span class="annottext">Context -&gt; IO Context
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Context -&gt; IO Context) -&gt; Context -&gt; IO Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe SpanContext
</span><a href="#local-6989586621680185644"><span class="hs-identifier hs-var">mspanContext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-77"></span><span>          </span><span class="annot"><span class="annottext">Maybe SpanContext
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621680185638"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-78"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680185647"><span class="annot"><span class="annottext">SpanContext
</span><a href="#local-6989586621680185647"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Span -&gt; Context -&gt; Context
</span><span class="hs-identifier hs-var">Ctxt.insertSpan</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SpanContext -&gt; Span
</span><span class="hs-identifier hs-var">wrapSpanContext</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SpanContext
</span><a href="#local-6989586621680185647"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="hs-identifier hs-var">isRemote</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621680185638"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">injector :: Context -&gt; Map Text Payload -&gt; IO (Map Text Payload)
</span><span class="hs-identifier hs-var">injector</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680185652"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621680185652"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680185653"><span class="annot"><span class="annottext">Map Text Payload
</span><a href="#local-6989586621680185653"><span class="hs-identifier hs-var">hs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Context -&gt; Maybe Span
</span><span class="hs-identifier hs-var">Ctxt.lookupSpan</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621680185652"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-80"></span><span>        </span><span class="annot"><span class="annottext">Maybe Span
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Text Payload -&gt; IO (Map Text Payload)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Map Text Payload
</span><a href="#local-6989586621680185653"><span class="hs-identifier hs-var">hs</span></a></span><span>
</span><span id="line-81"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680185655"><span class="annot"><span class="annottext">Span
</span><a href="#local-6989586621680185655"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-82"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621680185656"><span class="annot"><a href="#local-6989586621680185656"><span class="hs-identifier hs-var">traceParentHeader</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680185657"><span class="annot"><a href="#local-6989586621680185657"><span class="hs-identifier hs-var">traceStateHeader</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Span -&gt; IO (ByteString, ByteString)
</span><span class="hs-identifier hs-var">encodeSpanContext</span></span><span> </span><span class="annot"><span class="annottext">Span
</span><a href="#local-6989586621680185655"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-83"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-84"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Map.insert</span></span><span> </span><span class="annot"><span class="hs-string">&quot;traceparent&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680185656"><span class="hs-identifier hs-type">traceParentHeader</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-85"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Map.insert</span></span><span> </span><span class="annot"><span class="hs-string">&quot;tracestate&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680185657"><span class="hs-identifier hs-type">traceStateHeader</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680185653"><span class="hs-identifier hs-type">hs</span></a></span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-comment">--    * Workflow is scheduled by a client</span><span>
</span><span id="line-90"></span><span class="hs-comment">--    */</span><span>
</span><span id="line-91"></span><span class="hs-comment">--   WORKFLOW_START = 'StartWorkflow',</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-comment">--   /**</span><span>
</span><span id="line-94"></span><span class="hs-comment">--    * Workflow is client calls signalWithStart</span><span>
</span><span id="line-95"></span><span class="hs-comment">--    */</span><span>
</span><span id="line-96"></span><span class="hs-comment">--   WORKFLOW_SIGNAL_WITH_START = 'SignalWithStartWorkflow',</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">--   /**</span><span>
</span><span id="line-99"></span><span class="hs-comment">--    * Workflow run is executing</span><span>
</span><span id="line-100"></span><span class="hs-comment">--    */</span><span>
</span><span id="line-101"></span><span class="hs-comment">--   WORKFLOW_EXECUTE = 'RunWorkflow',</span><span>
</span><span id="line-102"></span><span class="hs-comment">--   /**</span><span>
</span><span id="line-103"></span><span class="hs-comment">--    * Child Workflow is started (by parent Workflow)</span><span>
</span><span id="line-104"></span><span class="hs-comment">--    */</span><span>
</span><span id="line-105"></span><span class="hs-comment">--   CHILD_WORKFLOW_START = 'StartChildWorkflow',</span><span>
</span><span id="line-106"></span><span class="hs-comment">--   /**</span><span>
</span><span id="line-107"></span><span class="hs-comment">--    * Activity is scheduled by a Workflow</span><span>
</span><span id="line-108"></span><span class="hs-comment">--    */</span><span>
</span><span id="line-109"></span><span class="hs-comment">--   ACTIVITY_START = 'StartActivity',</span><span>
</span><span id="line-110"></span><span class="hs-comment">--   /**</span><span>
</span><span id="line-111"></span><span class="hs-comment">--    * Activity is executing</span><span>
</span><span id="line-112"></span><span class="hs-comment">--    */</span><span>
</span><span id="line-113"></span><span class="hs-comment">--   ACTIVITY_EXECUTE = 'RunActivity',</span><span>
</span><span id="line-114"></span><span class="hs-comment">--   /**</span><span>
</span><span id="line-115"></span><span class="hs-comment">--    * Workflow is continuing as new</span><span>
</span><span id="line-116"></span><span class="hs-comment">--    */</span><span>
</span><span id="line-117"></span><span class="hs-comment">-- CONTINUE_AS_NEW = 'ContinueAsNew',</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-comment">-- TODO, we will need to account for replays when we support them</span><span>
</span><span id="line-120"></span><span id="local-6989586621680185498"><span id="local-6989586621680185500"><span class="annot"><a href="Temporal.Contrib.OpenTelemetry.html#makeOpenTelemetryInterceptor"><span class="hs-identifier hs-type">makeOpenTelemetryInterceptor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621680185498"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680185498"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Interceptor.html#Interceptors"><span class="hs-identifier hs-type">Interceptors</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680185500"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-121"></span><span id="makeOpenTelemetryInterceptor"><span class="annot"><span class="annottext">makeOpenTelemetryInterceptor :: forall (m :: * -&gt; *) env. MonadIO m =&gt; m (Interceptors env)
</span><a href="Temporal.Contrib.OpenTelemetry.html#makeOpenTelemetryInterceptor"><span class="hs-identifier hs-var hs-var">makeOpenTelemetryInterceptor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-122"></span><span>  </span><span id="local-6989586621680185871"><span class="annot"><a href="#local-6989586621680185871"><span class="hs-identifier hs-var">tracerProvider</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m TracerProvider
forall (m :: * -&gt; *). MonadIO m =&gt; m TracerProvider
</span><span class="hs-identifier hs-var">getGlobalTracerProvider</span></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680185873"><span class="annot"><a href="#local-6989586621680185873"><span class="hs-identifier hs-var hs-var">tracer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-124"></span><span>        </span><span class="annot"><span class="annottext">TracerProvider -&gt; InstrumentationLibrary -&gt; TracerOptions -&gt; Tracer
</span><span class="hs-identifier hs-var">makeTracer</span></span><span>
</span><span id="line-125"></span><span>          </span><span class="annot"><span class="annottext">TracerProvider
</span><a href="#local-6989586621680185871"><span class="hs-identifier hs-var">tracerProvider</span></a></span><span>
</span><span id="line-126"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; InstrumentationLibrary
</span><span class="hs-identifier hs-var">InstrumentationLibrary</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;temporal-sdk&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; String -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Version -&gt; String
</span><span class="hs-identifier hs-var">showVersion</span></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="Paths_temporal_sdk.html#version"><span class="hs-identifier hs-var">Paths_temporal_sdk.version</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Text -&gt; TracerOptions
</span><span class="hs-identifier hs-var">TracerOptions</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><a href="Temporal.Interceptor.html#Interceptors"><span class="hs-identifier hs-type">Interceptors</span></a></span><span>
</span><span id="line-130"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Temporal.Interceptor.html#workflowInboundInterceptors"><span class="hs-identifier hs-var">workflowInboundInterceptors</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-131"></span><span>          </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowInboundInterceptor"><span class="hs-identifier hs-type">WorkflowInboundInterceptor</span></a></span><span>
</span><span id="line-132"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#executeWorkflow"><span class="hs-identifier hs-var">executeWorkflow</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680185883"><span class="annot"><span class="annottext">ExecuteWorkflowInput
</span><a href="#local-6989586621680185883"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621680185884"><span class="annot"><span class="annottext">ExecuteWorkflowInput -&gt; IO (WorkflowExitVariant Payload)
</span><a href="#local-6989586621680185884"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-133"></span><span>                </span><span id="local-6989586621680185885"><span class="annot"><a href="#local-6989586621680185885"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Propagator Context (Map Text Payload) (Map Text Payload)
-&gt; Map Text Payload -&gt; Context -&gt; IO Context
forall (m :: * -&gt; *) context i o.
MonadIO m =&gt;
Propagator context i o -&gt; i -&gt; context -&gt; m context
</span><span class="hs-identifier hs-var">extract</span></span><span> </span><span class="annot"><span class="annottext">Propagator Context (Map Text Payload) (Map Text Payload)
</span><a href="Temporal.Contrib.OpenTelemetry.html#headersPropagator"><span class="hs-identifier hs-var">headersPropagator</span></a></span><span> </span><span class="annot"><span class="annottext">ExecuteWorkflowInput
</span><a href="#local-6989586621680185883"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">executeWorkflowInputHeaders</span><span> </span><span class="annot"><span class="annottext">Context
</span><span class="hs-identifier hs-var">Ctxt.empty</span></span><span>
</span><span id="line-134"></span><span>                </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">attachContext</span></span><span> </span><span class="annot"><a href="#local-6989586621680185885"><span class="hs-identifier hs-type">ctxt</span></a></span><span>
</span><span id="line-135"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680185888"><span class="annot"><a href="#local-6989586621680185888"><span class="hs-identifier hs-var hs-var">spanArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-136"></span><span>                      </span><span class="annot"><span class="annottext">SpanArguments
</span><span class="hs-identifier hs-var">defaultSpanArguments</span></span><span>
</span><span id="line-137"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">kind</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span>
</span><span id="line-138"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">attributes</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-139"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">HashMap.fromList</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-140"></span><span>                              </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span>
</span><span id="line-141"></span><span>                                </span><span class="hs-special">[</span><span>
</span><span id="line-142"></span><span>                                  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;temporal.workflow_id&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">toAttribute</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#rawWorkflowId"><span class="hs-identifier hs-var">rawWorkflowId</span></a></span><span> </span><span class="annot"><span class="hs-identifier">input</span></span><span class="hs-operator">.</span><span class="hs-identifier">executeWorkflowInputInfo</span><span class="hs-operator">.</span><span class="hs-identifier">workflowId</span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;temporal.run_id&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">toAttribute</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#rawRunId"><span class="hs-identifier hs-var">rawRunId</span></a></span><span> </span><span class="annot"><span class="hs-identifier">input</span></span><span class="hs-operator">.</span><span class="hs-identifier">executeWorkflowInputInfo</span><span class="hs-operator">.</span><span class="hs-identifier">runId</span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;temporal.workflow_type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">toAttribute</span></span><span> </span><span class="annot"><span class="hs-identifier">input</span></span><span class="hs-operator">.</span><span class="hs-identifier">executeWorkflowInputType</span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;temporal.attempt&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">toAttribute</span></span><span> </span><span class="annot"><span class="hs-identifier">input</span></span><span class="hs-operator">.</span><span class="hs-identifier">executeWorkflowInputInfo</span><span class="hs-operator">.</span><span class="hs-identifier">attempt</span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;temporal.namespace&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">toAttribute</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#rawNamespace"><span class="hs-identifier hs-var">rawNamespace</span></a></span><span> </span><span class="annot"><span class="hs-identifier">input</span></span><span class="hs-operator">.</span><span class="hs-identifier">executeWorkflowInputInfo</span><span class="hs-operator">.</span><span class="hs-identifier">namespace</span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;temporal.task_queue&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">toAttribute</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#rawTaskQueue"><span class="hs-identifier hs-var">rawTaskQueue</span></a></span><span> </span><span class="annot"><span class="hs-identifier">input</span></span><span class="hs-operator">.</span><span class="hs-identifier">executeWorkflowInputInfo</span><span class="hs-operator">.</span><span class="hs-identifier">taskQueue</span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>                                  </span><span class="hs-special">]</span><span>
</span><span id="line-149"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span>
</span><span id="line-150"></span><span>                                    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-151"></span><span>                                    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680185901"><span class="annot"><span class="annottext">Duration
</span><a href="#local-6989586621680185901"><span class="hs-identifier hs-var">executionTimeout</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;temporal.execution_timeout_ms&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Attribute
forall a. ToAttribute a =&gt; a -&gt; Attribute
</span><span class="hs-identifier hs-var">toAttribute</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Attribute) -&gt; Double -&gt; Attribute
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Duration -&gt; Double
</span><a href="Temporal.Duration.html#durationToMilliseconds"><span class="hs-identifier hs-var">durationToMilliseconds</span></a></span><span> </span><span class="annot"><span class="annottext">Duration
</span><a href="#local-6989586621680185901"><span class="hs-identifier hs-var">executionTimeout</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>                                    </span><span class="annot"><span class="hs-identifier">input</span></span><span class="hs-operator">.</span><span class="hs-identifier">executeWorkflowInputInfo</span><span class="hs-operator">.</span><span class="hs-identifier">executionTimeout</span><span>
</span><span id="line-153"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span>
</span><span id="line-154"></span><span>                                    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-155"></span><span>                                    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680185903"><span class="annot"><span class="annottext">RunId
</span><a href="#local-6989586621680185903"><span class="hs-identifier hs-var">continuedRunId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-156"></span><span>                                        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;temporal.continued_run_id&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Attribute
forall a. ToAttribute a =&gt; a -&gt; Attribute
</span><span class="hs-identifier hs-var">toAttribute</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Attribute) -&gt; Text -&gt; Attribute
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RunId -&gt; Text
</span><a href="Temporal.Common.html#rawRunId"><span class="hs-identifier hs-var">rawRunId</span></a></span><span> </span><span class="annot"><span class="annottext">RunId
</span><a href="#local-6989586621680185903"><span class="hs-identifier hs-var">continuedRunId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>                                        </span><span class="hs-special">]</span><span>
</span><span id="line-158"></span><span>                                    </span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>                                    </span><span class="annot"><span class="hs-identifier">input</span></span><span class="hs-operator">.</span><span class="hs-identifier">executeWorkflowInputInfo</span><span class="hs-operator">.</span><span class="hs-identifier">continuedRunId</span><span>
</span><span id="line-160"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span>
</span><span id="line-161"></span><span>                                    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-162"></span><span>                                    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680185904"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680185904"><span class="hs-identifier hs-var">cronSchedule</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-163"></span><span>                                        </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;temporal.cron_schedule&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Attribute
forall a. ToAttribute a =&gt; a -&gt; Attribute
</span><span class="hs-identifier hs-var">toAttribute</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680185904"><span class="hs-identifier hs-var">cronSchedule</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-164"></span><span>                                    </span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>                                    </span><span class="annot"><span class="hs-identifier">input</span></span><span class="hs-operator">.</span><span class="hs-identifier">executeWorkflowInputInfo</span><span class="hs-operator">.</span><span class="hs-identifier">cronSchedule</span><span>
</span><span id="line-166"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span>
</span><span id="line-167"></span><span>                                    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-168"></span><span>                                    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680185905"><span class="annot"><span class="annottext">ParentInfo
</span><a href="#local-6989586621680185905"><span class="hs-identifier hs-var">parentInfo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-169"></span><span>                                        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;temporal.parent.namespace&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Attribute
forall a. ToAttribute a =&gt; a -&gt; Attribute
</span><span class="hs-identifier hs-var">toAttribute</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Attribute) -&gt; Text -&gt; Attribute
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Namespace -&gt; Text
</span><a href="Temporal.Common.html#rawNamespace"><span class="hs-identifier hs-var">rawNamespace</span></a></span><span> </span><span class="annot"><span class="annottext">ParentInfo
</span><a href="#local-6989586621680185905"><span class="hs-identifier hs-var">parentInfo</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">parentNamespace</span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;temporal.parent.run_id&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Attribute
forall a. ToAttribute a =&gt; a -&gt; Attribute
</span><span class="hs-identifier hs-var">toAttribute</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Attribute) -&gt; Text -&gt; Attribute
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RunId -&gt; Text
</span><a href="Temporal.Common.html#rawRunId"><span class="hs-identifier hs-var">rawRunId</span></a></span><span> </span><span class="annot"><span class="annottext">ParentInfo
</span><a href="#local-6989586621680185905"><span class="hs-identifier hs-var">parentInfo</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">parentRunId</span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;temporal.parent.workflow_id&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Attribute
forall a. ToAttribute a =&gt; a -&gt; Attribute
</span><span class="hs-identifier hs-var">toAttribute</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Attribute) -&gt; Text -&gt; Attribute
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WorkflowId -&gt; Text
</span><a href="Temporal.Common.html#rawWorkflowId"><span class="hs-identifier hs-var">rawWorkflowId</span></a></span><span> </span><span class="annot"><span class="annottext">ParentInfo
</span><a href="#local-6989586621680185905"><span class="hs-identifier hs-var">parentInfo</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">parentWorkflowId</span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>                                        </span><span class="hs-special">]</span><span>
</span><span id="line-173"></span><span>                                    </span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>                                    </span><span class="annot"><span class="hs-identifier">input</span></span><span class="hs-operator">.</span><span class="hs-identifier">executeWorkflowInputInfo</span><span class="hs-operator">.</span><span class="hs-identifier">parent</span><span>
</span><span id="line-175"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span>
</span><span id="line-176"></span><span>                                    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-177"></span><span>                                    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680185906"><span class="annot"><span class="annottext">RetryPolicy
</span><a href="#local-6989586621680185906"><span class="hs-identifier hs-var">retryPolicy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-178"></span><span>                                        </span><span class="annot"><span class="annottext">([(Text, Attribute)] -&gt; [(Text, Attribute)])
-&gt; (Duration -&gt; [(Text, Attribute)] -&gt; [(Text, Attribute)])
-&gt; Maybe Duration
-&gt; [(Text, Attribute)]
-&gt; [(Text, Attribute)]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span>
</span><span id="line-179"></span><span>                                          </span><span class="annot"><span class="annottext">[(Text, Attribute)] -&gt; [(Text, Attribute)]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-180"></span><span>                                          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680185908"><span class="annot"><span class="annottext">Duration
</span><a href="#local-6989586621680185908"><span class="hs-identifier hs-var">maxInterval</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;temporal.retry_policy.maximum_interval_ms&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Attribute
forall a. ToAttribute a =&gt; a -&gt; Attribute
</span><span class="hs-identifier hs-var">toAttribute</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Attribute) -&gt; Double -&gt; Attribute
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Duration -&gt; Double
</span><a href="Temporal.Duration.html#durationToMilliseconds"><span class="hs-identifier hs-var">durationToMilliseconds</span></a></span><span> </span><span class="annot"><span class="annottext">Duration
</span><a href="#local-6989586621680185908"><span class="hs-identifier hs-var">maxInterval</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text, Attribute) -&gt; [(Text, Attribute)] -&gt; [(Text, Attribute)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>                                          </span><span class="annot"><span class="annottext">RetryPolicy
</span><a href="#local-6989586621680185906"><span class="hs-identifier hs-var">retryPolicy</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">maximumInterval</span><span>
</span><span id="line-182"></span><span>                                          </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;temporal.retry_policy.initial_interval_ms&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Attribute
forall a. ToAttribute a =&gt; a -&gt; Attribute
</span><span class="hs-identifier hs-var">toAttribute</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Attribute) -&gt; Double -&gt; Attribute
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Duration -&gt; Double
</span><a href="Temporal.Duration.html#durationToMilliseconds"><span class="hs-identifier hs-var">durationToMilliseconds</span></a></span><span> </span><span class="annot"><span class="annottext">RetryPolicy
</span><a href="#local-6989586621680185906"><span class="hs-identifier hs-var">retryPolicy</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">initialInterval</span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>                                          </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;temporal.retry_policy.backoff_coefficient&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Attribute
forall a. ToAttribute a =&gt; a -&gt; Attribute
</span><span class="hs-identifier hs-var">toAttribute</span></span><span> </span><span class="annot"><span class="annottext">RetryPolicy
</span><a href="#local-6989586621680185906"><span class="hs-identifier hs-var">retryPolicy</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">backoffCoefficient</span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>                                          </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;temporal.retry_policy.maximum_attempts&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Attribute
forall a. ToAttribute a =&gt; a -&gt; Attribute
</span><span class="hs-identifier hs-var">toAttribute</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Attribute) -&gt; Int -&gt; Attribute
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="annottext">(Int32 -&gt; Int) -&gt; Int32 -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RetryPolicy
</span><a href="#local-6989586621680185906"><span class="hs-identifier hs-var">retryPolicy</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">maximumAttempts</span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>                                          </span><span class="hs-special">]</span><span>
</span><span id="line-186"></span><span>                                    </span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>                                    </span><span class="annot"><span class="hs-identifier">input</span></span><span class="hs-operator">.</span><span class="hs-identifier">executeWorkflowInputInfo</span><span class="hs-operator">.</span><span class="hs-identifier">retryPolicy</span><span>
</span><span id="line-188"></span><span>                                </span><span class="hs-special">]</span><span>
</span><span id="line-189"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-190"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">inSpan''</span></span><span> </span><span class="annot"><a href="#local-6989586621680185873"><span class="hs-identifier hs-type">tracer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;RunWorkflow:&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier">input</span></span><span class="hs-operator">.</span><span class="hs-identifier">executeWorkflowInputType</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680185888"><span class="hs-identifier hs-type">spanArgs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680185910"><span class="annot"><span class="annottext">Span
</span><a href="#local-6989586621680185910"><span class="hs-identifier hs-var">span</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-191"></span><span>                  </span><span id="local-6989586621680185911"><span class="annot"><a href="#local-6989586621680185911"><span class="hs-identifier hs-var">execution</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExecuteWorkflowInput -&gt; IO (WorkflowExitVariant Payload)
</span><a href="#local-6989586621680185884"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">ExecuteWorkflowInput
</span><a href="#local-6989586621680185883"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-192"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680185911"><span class="hs-identifier hs-type">execution</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-193"></span><span>                    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowExitFailed"><span class="hs-identifier hs-type">WorkflowExitFailed</span></a></span><span> </span><span id="local-6989586621680185913"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680185913"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-194"></span><span>                      </span><span class="hs-comment">-- TODO use our enrichment handlers here</span><span>
</span><span id="line-195"></span><span>                      </span><span class="annot"><span class="annottext">Span -&gt; SpanStatus -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Span -&gt; SpanStatus -&gt; m ()
</span><span class="hs-identifier hs-var">setStatus</span></span><span> </span><span class="annot"><span class="annottext">Span
</span><a href="#local-6989586621680185910"><span class="hs-identifier hs-var">span</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SpanStatus
</span><span class="hs-identifier hs-var">Error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SpanStatus) -&gt; Text -&gt; SpanStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; String -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680185913"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>                      </span><span class="annot"><span class="annottext">Span
-&gt; HashMap Text Attribute
-&gt; Maybe Timestamp
-&gt; SomeException
-&gt; IO ()
forall (m :: * -&gt; *) e.
(MonadIO m, Exception e) =&gt;
Span -&gt; HashMap Text Attribute -&gt; Maybe Timestamp -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">recordException</span></span><span> </span><span class="annot"><span class="annottext">Span
</span><a href="#local-6989586621680185910"><span class="hs-identifier hs-var">span</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text Attribute
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Maybe Timestamp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680185913"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-197"></span><span>                    </span><span class="annot"><span class="annottext">WorkflowExitVariant Payload
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621680185911"><span class="hs-identifier hs-type">execution</span></a></span><span>
</span><span id="line-199"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#handleQuery"><span class="hs-identifier hs-var">handleQuery</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680185919"><span class="annot"><span class="annottext">HandleQueryInput
</span><a href="#local-6989586621680185919"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621680185920"><span class="annot"><span class="annottext">HandleQueryInput -&gt; IO (Either SomeException Payload)
</span><a href="#local-6989586621680185920"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-200"></span><span>                </span><span class="hs-comment">-- Only trace this if there is a header, and make that span the parent.</span><span>
</span><span id="line-201"></span><span>                </span><span class="hs-comment">-- We do not put anything that happens in a query handler on the workflow</span><span>
</span><span id="line-202"></span><span>                </span><span class="hs-comment">-- span.</span><span>
</span><span id="line-203"></span><span>                </span><span class="hs-comment">--</span><span>
</span><span id="line-204"></span><span>                </span><span class="hs-comment">-- However, we do _link_ the query span to the workflow span if we have the</span><span>
</span><span id="line-205"></span><span>                </span><span class="hs-comment">-- context for it.</span><span>
</span><span id="line-206"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680185924"><span class="annot"><span class="annottext">spanArgs :: SpanArguments
</span><a href="#local-6989586621680185924"><span class="hs-identifier hs-var hs-var hs-var">spanArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-207"></span><span>                      </span><span class="annot"><span class="annottext">SpanArguments
</span><span class="hs-identifier hs-var">defaultSpanArguments</span></span><span>
</span><span id="line-208"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">kind</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span>
</span><span id="line-209"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">attributes</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span>
</span><span id="line-210"></span><span>                        </span><span class="hs-comment">-- HashMap.fromList</span><span>
</span><span id="line-211"></span><span>                        </span><span class="hs-comment">--   [ (&quot;temporal.workflow_id&quot;, toAttribute $ rawWorkflowId $ input.handleQueryInputInfo.workflowId)</span><span>
</span><span id="line-212"></span><span>                        </span><span class="hs-comment">--   , (&quot;temporal.run_id&quot;, toAttribute $ rawRunId $ input.handleQueryInputInfo.runId)</span><span>
</span><span id="line-213"></span><span>                        </span><span class="hs-comment">--   , (&quot;temporal.workflow_type&quot;, toAttribute $ input.handleQueryInputType)</span><span>
</span><span id="line-214"></span><span>                        </span><span class="hs-comment">--   ]</span><span>
</span><span id="line-215"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-216"></span><span>                </span><span id="local-6989586621680185925"><span class="annot"><a href="#local-6989586621680185925"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Propagator Context (Map Text Payload) (Map Text Payload)
-&gt; Map Text Payload -&gt; Context -&gt; IO Context
forall (m :: * -&gt; *) context i o.
MonadIO m =&gt;
Propagator context i o -&gt; i -&gt; context -&gt; m context
</span><span class="hs-identifier hs-var">extract</span></span><span> </span><span class="annot"><span class="annottext">Propagator Context (Map Text Payload) (Map Text Payload)
</span><a href="Temporal.Contrib.OpenTelemetry.html#headersPropagator"><span class="hs-identifier hs-var">headersPropagator</span></a></span><span> </span><span class="annot"><span class="annottext">HandleQueryInput
</span><a href="#local-6989586621680185919"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">handleQueryInputHeaders</span><span> </span><span class="annot"><span class="annottext">Context
</span><span class="hs-identifier hs-var">Ctxt.empty</span></span><span>
</span><span id="line-217"></span><span>                </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">attachContext</span></span><span> </span><span class="annot"><a href="#local-6989586621680185925"><span class="hs-identifier hs-type">ctxt</span></a></span><span>
</span><span id="line-218"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ctxt.lookupSpan</span></span><span> </span><span class="annot"><a href="#local-6989586621680185925"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-219"></span><span>                  </span><span class="annot"><span class="annottext">Maybe Span
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HandleQueryInput -&gt; IO (Either SomeException Payload)
</span><a href="#local-6989586621680185920"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">HandleQueryInput
</span><a href="#local-6989586621680185919"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-220"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Span
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-221"></span><span>                    </span><span class="annot"><span class="annottext">Tracer
-&gt; Text
-&gt; SpanArguments
-&gt; (Span -&gt; IO (Either SomeException Payload))
-&gt; IO (Either SomeException Payload)
forall (m :: * -&gt; *) a.
(MonadUnliftIO m, HasCallStack) =&gt;
Tracer -&gt; Text -&gt; SpanArguments -&gt; (Span -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">inSpan''</span></span><span> </span><span class="annot"><span class="annottext">Tracer
</span><a href="#local-6989586621680185873"><span class="hs-identifier hs-var">tracer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;HandleQuery:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HandleQueryInput
</span><a href="#local-6989586621680185919"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">handleQueryInputType</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SpanArguments
</span><a href="#local-6989586621680185924"><span class="hs-identifier hs-var">spanArgs</span></a></span><span> </span><span class="annot"><span class="annottext">((Span -&gt; IO (Either SomeException Payload))
 -&gt; IO (Either SomeException Payload))
-&gt; (Span -&gt; IO (Either SomeException Payload))
-&gt; IO (Either SomeException Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Span
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-222"></span><span>                      </span><span class="annot"><span class="annottext">HandleQueryInput -&gt; IO (Either SomeException Payload)
</span><a href="#local-6989586621680185920"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">HandleQueryInput
</span><a href="#local-6989586621680185919"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-223"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-224"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Interceptor.html#workflowOutboundInterceptors"><span class="hs-identifier hs-var">workflowOutboundInterceptors</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-225"></span><span>          </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowOutboundInterceptor"><span class="hs-identifier hs-type">WorkflowOutboundInterceptor</span></a></span><span>
</span><span id="line-226"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#scheduleActivity"><span class="hs-identifier hs-var">scheduleActivity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680185929"><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680185929"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621680185930"><span class="annot"><span class="annottext">ActivityInput -&gt; IO (Task Payload)
</span><a href="#local-6989586621680185930"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-227"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#StartActivityOptions"><span class="hs-identifier hs-type">StartActivityOptions</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680185932"><span id="local-6989586621680185933"><span id="local-6989586621680185934"><span id="local-6989586621680185935"><span id="local-6989586621680185936"><span id="local-6989586621680185937"><span id="local-6989586621680185938"><span id="local-6989586621680185939"><span id="local-6989586621680185940"><span class="annot"><span class="annottext">Bool
Maybe Duration
Maybe RetryPolicy
Maybe ActivityId
Maybe TaskQueue
Map Text Payload
ActivityCancellationType
ActivityTimeoutPolicy
activityId :: Maybe ActivityId
taskQueue :: Maybe TaskQueue
timeout :: ActivityTimeoutPolicy
scheduleToStartTimeout :: Maybe Duration
heartbeatTimeout :: Maybe Duration
retryPolicy :: Maybe RetryPolicy
cancellationType :: ActivityCancellationType
headers :: Map Text Payload
disableEagerExecution :: Bool
disableEagerExecution :: StartActivityOptions -&gt; Bool
headers :: StartActivityOptions -&gt; Map Text Payload
cancellationType :: StartActivityOptions -&gt; ActivityCancellationType
retryPolicy :: StartActivityOptions -&gt; Maybe RetryPolicy
heartbeatTimeout :: StartActivityOptions -&gt; Maybe Duration
scheduleToStartTimeout :: StartActivityOptions -&gt; Maybe Duration
timeout :: StartActivityOptions -&gt; ActivityTimeoutPolicy
taskQueue :: StartActivityOptions -&gt; Maybe TaskQueue
activityId :: StartActivityOptions -&gt; Maybe ActivityId
</span><a href="#local-6989586621680185932"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680185929"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">options</span><span>
</span><span id="line-228"></span><span>                    </span><span id="local-6989586621680185950"><span class="annot"><span class="annottext">spanArgs :: SpanArguments
</span><a href="#local-6989586621680185950"><span class="hs-identifier hs-var hs-var">spanArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-229"></span><span>                      </span><span class="annot"><span class="annottext">SpanArguments
</span><span class="hs-identifier hs-var">defaultSpanArguments</span></span><span>
</span><span id="line-230"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">kind</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Client</span></span><span>
</span><span id="line-231"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-232"></span><span>                </span><span class="annot"><span class="annottext">Tracer
-&gt; Text
-&gt; SpanArguments
-&gt; (Span -&gt; IO (Task Payload))
-&gt; IO (Task Payload)
forall (m :: * -&gt; *) a.
(MonadUnliftIO m, HasCallStack) =&gt;
Tracer -&gt; Text -&gt; SpanArguments -&gt; (Span -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">inSpan''</span></span><span> </span><span class="annot"><span class="annottext">Tracer
</span><a href="#local-6989586621680185873"><span class="hs-identifier hs-var">tracer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;StartActivity:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680185929"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">activityType</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SpanArguments
</span><a href="#local-6989586621680185950"><span class="hs-identifier hs-var">spanArgs</span></a></span><span> </span><span class="annot"><span class="annottext">((Span -&gt; IO (Task Payload)) -&gt; IO (Task Payload))
-&gt; (Span -&gt; IO (Task Payload)) -&gt; IO (Task Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Span
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-233"></span><span>                  </span><span id="local-6989586621680185952"><span class="annot"><a href="#local-6989586621680185952"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Context
forall (m :: * -&gt; *). MonadIO m =&gt; m Context
</span><span class="hs-identifier hs-var">getContext</span></span><span>
</span><span id="line-234"></span><span>                  </span><span id="local-6989586621680185953"><span class="annot"><a href="#local-6989586621680185953"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">inject</span></span><span> </span><span class="annot"><a href="Temporal.Contrib.OpenTelemetry.html#headersPropagator"><span class="hs-identifier hs-type">headersPropagator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680185952"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680185939"><span class="hs-identifier hs-type">headers</span></a></span><span>
</span><span id="line-235"></span><span>                  </span><span class="annot"><a href="#local-6989586621680185930"><span class="hs-identifier hs-type">next</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621680185929"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#options"><span class="hs-identifier hs-var">options</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#StartActivityOptions"><span class="hs-identifier hs-type">StartActivityOptions</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Workflow.Types.html#headers"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680185953"><span class="hs-identifier hs-type">hdrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680185932"><span class="hs-glyph hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-236"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#continueAsNew"><span class="hs-identifier hs-var">continueAsNew</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680185961"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680185961"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#ContinueAsNewOptions"><span class="hs-identifier hs-type">ContinueAsNewOptions</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680185963"><span id="local-6989586621680185964"><span id="local-6989586621680185965"><span id="local-6989586621680185966"><span id="local-6989586621680185967"><span id="local-6989586621680185968"><span id="local-6989586621680185969"><span class="annot"><span class="annottext">Maybe Duration
Maybe RetryPolicy
Maybe TaskQueue
Map Text Payload
Map SearchAttributeKey SearchAttributeType
taskQueue :: Maybe TaskQueue
runTimeout :: Maybe Duration
taskTimeout :: Maybe Duration
retryPolicy :: Maybe RetryPolicy
memo :: Map Text Payload
searchAttributes :: Map SearchAttributeKey SearchAttributeType
headers :: Map Text Payload
headers :: ContinueAsNewOptions -&gt; Map Text Payload
searchAttributes :: ContinueAsNewOptions -&gt; Map SearchAttributeKey SearchAttributeType
memo :: ContinueAsNewOptions -&gt; Map Text Payload
retryPolicy :: ContinueAsNewOptions -&gt; Maybe RetryPolicy
taskTimeout :: ContinueAsNewOptions -&gt; Maybe Duration
runTimeout :: ContinueAsNewOptions -&gt; Maybe Duration
taskQueue :: ContinueAsNewOptions -&gt; Maybe TaskQueue
</span><a href="#local-6989586621680185963"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680185977"><span class="annot"><span class="annottext">Text -&gt; ContinueAsNewOptions -&gt; IO a
</span><a href="#local-6989586621680185977"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-237"></span><span>                </span><span id="local-6989586621680185978"><span class="annot"><a href="#local-6989586621680185978"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Context
forall (m :: * -&gt; *). MonadIO m =&gt; m Context
</span><span class="hs-identifier hs-var">getContext</span></span><span>
</span><span id="line-238"></span><span>                </span><span id="local-6989586621680185979"><span class="annot"><a href="#local-6989586621680185979"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">inject</span></span><span> </span><span class="annot"><a href="Temporal.Contrib.OpenTelemetry.html#headersPropagator"><span class="hs-identifier hs-type">headersPropagator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680185978"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680185969"><span class="hs-identifier hs-type">headers</span></a></span><span>
</span><span id="line-239"></span><span>                </span><span class="annot"><a href="#local-6989586621680185977"><span class="hs-identifier hs-type">next</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680185961"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Types.html#ContinueAsNewOptions"><span class="hs-identifier hs-type">ContinueAsNewOptions</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Workflow.Types.html#headers"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680185979"><span class="hs-identifier hs-type">hdrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680185963"><span class="hs-glyph hs-type hs-type hs-type hs-type hs-type hs-type hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#startChildWorkflowExecution"><span class="hs-identifier hs-var">startChildWorkflowExecution</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680185981"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680185981"><span class="hs-identifier hs-var">wfName</span></a></span></span><span> </span><span id="local-6989586621680185982"><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680185982"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621680185983"><span class="annot"><span class="annottext">Text
-&gt; StartChildWorkflowOptions -&gt; IO (ChildWorkflowHandle Payload)
</span><a href="#local-6989586621680185983"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-241"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#StartChildWorkflowOptions"><span class="hs-identifier hs-type">StartChildWorkflowOptions</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680185985"><span id="local-6989586621680185986"><span id="local-6989586621680185987"><span id="local-6989586621680185988"><span id="local-6989586621680185989"><span id="local-6989586621680185990"><span id="local-6989586621680185991"><span id="local-6989586621680185992"><span id="local-6989586621680185993"><span id="local-6989586621680185994"><span id="local-6989586621680185995"><span class="annot"><span class="annottext">Maybe Text
Maybe RetryPolicy
Maybe TaskQueue
Maybe WorkflowId
Map Text Payload
Map SearchAttributeKey SearchAttributeType
TimeoutOptions
WorkflowIdReusePolicy
ParentClosePolicy
ChildWorkflowCancellationType
cancellationType :: ChildWorkflowCancellationType
parentClosePolicy :: ParentClosePolicy
timeoutOptions :: TimeoutOptions
retryPolicy :: Maybe RetryPolicy
cronSchedule :: Maybe Text
initialMemo :: Map Text Payload
searchAttributes :: Map SearchAttributeKey SearchAttributeType
headers :: Map Text Payload
workflowIdReusePolicy :: WorkflowIdReusePolicy
workflowId :: Maybe WorkflowId
taskQueue :: Maybe TaskQueue
taskQueue :: StartChildWorkflowOptions -&gt; Maybe TaskQueue
workflowId :: StartChildWorkflowOptions -&gt; Maybe WorkflowId
workflowIdReusePolicy :: StartChildWorkflowOptions -&gt; WorkflowIdReusePolicy
headers :: StartChildWorkflowOptions -&gt; Map Text Payload
searchAttributes :: StartChildWorkflowOptions
-&gt; Map SearchAttributeKey SearchAttributeType
initialMemo :: StartChildWorkflowOptions -&gt; Map Text Payload
cronSchedule :: StartChildWorkflowOptions -&gt; Maybe Text
retryPolicy :: StartChildWorkflowOptions -&gt; Maybe RetryPolicy
timeoutOptions :: StartChildWorkflowOptions -&gt; TimeoutOptions
parentClosePolicy :: StartChildWorkflowOptions -&gt; ParentClosePolicy
cancellationType :: StartChildWorkflowOptions -&gt; ChildWorkflowCancellationType
</span><a href="#local-6989586621680185985"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680185982"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-242"></span><span>                    </span><span id="local-6989586621680186007"><span class="annot"><span class="annottext">spanArgs :: SpanArguments
</span><a href="#local-6989586621680186007"><span class="hs-identifier hs-var hs-var">spanArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-243"></span><span>                      </span><span class="annot"><span class="annottext">SpanArguments
</span><span class="hs-identifier hs-var">defaultSpanArguments</span></span><span>
</span><span id="line-244"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">kind</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Client</span></span><span>
</span><span id="line-245"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-246"></span><span>                </span><span class="annot"><span class="annottext">Tracer
-&gt; Text
-&gt; SpanArguments
-&gt; (Span -&gt; IO (ChildWorkflowHandle Payload))
-&gt; IO (ChildWorkflowHandle Payload)
forall (m :: * -&gt; *) a.
(MonadUnliftIO m, HasCallStack) =&gt;
Tracer -&gt; Text -&gt; SpanArguments -&gt; (Span -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">inSpan''</span></span><span> </span><span class="annot"><span class="annottext">Tracer
</span><a href="#local-6989586621680185873"><span class="hs-identifier hs-var">tracer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;StartChildWorkflow:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680185981"><span class="hs-identifier hs-var">wfName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SpanArguments
</span><a href="#local-6989586621680186007"><span class="hs-identifier hs-var">spanArgs</span></a></span><span> </span><span class="annot"><span class="annottext">((Span -&gt; IO (ChildWorkflowHandle Payload))
 -&gt; IO (ChildWorkflowHandle Payload))
-&gt; (Span -&gt; IO (ChildWorkflowHandle Payload))
-&gt; IO (ChildWorkflowHandle Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Span
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-247"></span><span>                  </span><span id="local-6989586621680186008"><span class="annot"><a href="#local-6989586621680186008"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Context
forall (m :: * -&gt; *). MonadIO m =&gt; m Context
</span><span class="hs-identifier hs-var">getContext</span></span><span>
</span><span id="line-248"></span><span>                  </span><span id="local-6989586621680186009"><span class="annot"><a href="#local-6989586621680186009"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">inject</span></span><span> </span><span class="annot"><a href="Temporal.Contrib.OpenTelemetry.html#headersPropagator"><span class="hs-identifier hs-type">headersPropagator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680186008"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680185992"><span class="hs-identifier hs-type">headers</span></a></span><span>
</span><span id="line-249"></span><span>                  </span><span class="annot"><a href="#local-6989586621680185983"><span class="hs-identifier hs-type">next</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680185981"><span class="hs-identifier hs-type">wfName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#StartChildWorkflowOptions"><span class="hs-identifier hs-type">StartChildWorkflowOptions</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Workflow.Types.html#headers"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680186009"><span class="hs-identifier hs-type">hdrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680185985"><span class="hs-glyph hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-250"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-251"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Interceptor.html#activityInboundInterceptors"><span class="hs-identifier hs-var">activityInboundInterceptors</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-252"></span><span>          </span><span class="annot"><a href="Temporal.Interceptor.html#ActivityInboundInterceptor"><span class="hs-identifier hs-type">ActivityInboundInterceptor</span></a></span><span>
</span><span id="line-253"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Temporal.Interceptor.html#executeActivity"><span class="hs-identifier hs-var">executeActivity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680186013"><span class="annot"><span class="annottext">env
</span><a href="#local-6989586621680186013"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680186014"><span class="annot"><span class="annottext">ExecuteActivityInput
</span><a href="#local-6989586621680186014"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621680186015"><span class="annot"><span class="annottext">env -&gt; ExecuteActivityInput -&gt; IO (Either String Payload)
</span><a href="#local-6989586621680186015"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-254"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Temporal.Activity.Types.html#ActivityInfo"><span class="hs-identifier hs-type">ActivityInfo</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680186017"><span id="local-6989586621680186018"><span id="local-6989586621680186019"><span id="local-6989586621680186020"><span id="local-6989586621680186021"><span id="local-6989586621680186022"><span id="local-6989586621680186023"><span id="local-6989586621680186024"><span id="local-6989586621680186025"><span id="local-6989586621680186026"><span id="local-6989586621680186027"><span id="local-6989586621680186028"><span id="local-6989586621680186029"><span id="local-6989586621680186030"><span id="local-6989586621680186031"><span id="local-6989586621680186032"><span id="local-6989586621680186033"><span id="local-6989586621680186034"><span class="annot"><span class="annottext">Bool
Maybe Duration
Maybe RetryPolicy
Word32
Text
Vector Payload
Map Text Payload
SystemTime
TaskToken
ActivityId
RunId
Namespace
WorkflowId
WorkflowType
workflowNamespace :: Namespace
workflowType :: WorkflowType
workflowId :: WorkflowId
runId :: RunId
activityId :: ActivityId
activityType :: Text
headerFields :: Map Text Payload
heartbeatDetails :: Vector Payload
scheduledTime :: SystemTime
currentAttemptScheduledTime :: SystemTime
startedTime :: SystemTime
attempt :: Word32
scheduleToCloseTimeout :: Maybe Duration
startToCloseTimeout :: Maybe Duration
heartbeatTimeout :: Maybe Duration
retryPolicy :: Maybe RetryPolicy
isLocal :: Bool
taskToken :: TaskToken
taskToken :: ActivityInfo -&gt; TaskToken
isLocal :: ActivityInfo -&gt; Bool
retryPolicy :: ActivityInfo -&gt; Maybe RetryPolicy
heartbeatTimeout :: ActivityInfo -&gt; Maybe Duration
startToCloseTimeout :: ActivityInfo -&gt; Maybe Duration
scheduleToCloseTimeout :: ActivityInfo -&gt; Maybe Duration
attempt :: ActivityInfo -&gt; Word32
startedTime :: ActivityInfo -&gt; SystemTime
currentAttemptScheduledTime :: ActivityInfo -&gt; SystemTime
scheduledTime :: ActivityInfo -&gt; SystemTime
heartbeatDetails :: ActivityInfo -&gt; Vector Payload
headerFields :: ActivityInfo -&gt; Map Text Payload
activityType :: ActivityInfo -&gt; Text
activityId :: ActivityInfo -&gt; ActivityId
runId :: ActivityInfo -&gt; RunId
workflowId :: ActivityInfo -&gt; WorkflowId
workflowType :: ActivityInfo -&gt; WorkflowType
workflowNamespace :: ActivityInfo -&gt; Namespace
</span><a href="#local-6989586621680186017"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExecuteActivityInput
</span><a href="#local-6989586621680186014"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">activityInfo</span><span>
</span><span id="line-255"></span><span>                    </span><span id="local-6989586621680186053"><span class="annot"><span class="annottext">spanArgs :: SpanArguments
</span><a href="#local-6989586621680186053"><span class="hs-identifier hs-var hs-var hs-var">spanArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-256"></span><span>                      </span><span class="annot"><span class="annottext">SpanArguments
</span><span class="hs-identifier hs-var">defaultSpanArguments</span></span><span>
</span><span id="line-257"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">kind</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span>
</span><span id="line-258"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">attributes</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-259"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">HashMap.fromList</span></span><span>
</span><span id="line-260"></span><span>                              </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;temporal.workflow_id&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">toAttribute</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#rawWorkflowId"><span class="hs-identifier hs-var">rawWorkflowId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680186019"><span class="hs-identifier hs-type">workflowId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;temporal.workflow_type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">toAttribute</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#rawWorkflowType"><span class="hs-identifier hs-var">rawWorkflowType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680186018"><span class="hs-identifier hs-type">workflowType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;temporal.run_id&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">toAttribute</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#rawRunId"><span class="hs-identifier hs-var">rawRunId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680186020"><span class="hs-identifier hs-type">runId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;temporal.activity_id&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">toAttribute</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#rawActivityId"><span class="hs-identifier hs-var">rawActivityId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680186021"><span class="hs-identifier hs-type">activityId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;temporal.activity_type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">toAttribute</span></span><span> </span><span class="annot"><a href="#local-6989586621680186022"><span class="hs-identifier hs-type">activityType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;temporal.attempt&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">toAttribute</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromIntegral</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621680186028"><span class="hs-identifier hs-type">attempt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- , (&quot;temporal.namespace&quot;, toAttribute $ rawNamespace $ input.activityInfo.namespace)</span><span>
</span><span id="line-267"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;temporal.activity_is_local&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">toAttribute</span></span><span> </span><span class="annot"><a href="#local-6989586621680186033"><span class="hs-identifier hs-type">isLocal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>                              </span><span class="hs-special">]</span><span>
</span><span id="line-269"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span>                </span><span id="local-6989586621680186056"><span class="annot"><a href="#local-6989586621680186056"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Propagator Context (Map Text Payload) (Map Text Payload)
-&gt; Map Text Payload -&gt; Context -&gt; IO Context
forall (m :: * -&gt; *) context i o.
MonadIO m =&gt;
Propagator context i o -&gt; i -&gt; context -&gt; m context
</span><span class="hs-identifier hs-var">extract</span></span><span> </span><span class="annot"><span class="annottext">Propagator Context (Map Text Payload) (Map Text Payload)
</span><a href="Temporal.Contrib.OpenTelemetry.html#headersPropagator"><span class="hs-identifier hs-var">headersPropagator</span></a></span><span> </span><span class="annot"><span class="annottext">ExecuteActivityInput
</span><a href="#local-6989586621680186014"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">activityHeaders</span><span> </span><span class="annot"><span class="annottext">Context
</span><span class="hs-identifier hs-var">Ctxt.empty</span></span><span>
</span><span id="line-272"></span><span>                </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">attachContext</span></span><span> </span><span class="annot"><a href="#local-6989586621680186056"><span class="hs-identifier hs-type">ctxt</span></a></span><span>
</span><span id="line-273"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">inSpan''</span></span><span> </span><span class="annot"><a href="#local-6989586621680185873"><span class="hs-identifier hs-type">tracer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;RunActivity:&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier">input</span></span><span class="hs-operator">.</span><span class="hs-identifier">activityInfo</span><span class="hs-operator">.</span><span class="hs-identifier">activityType</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680186053"><span class="hs-identifier hs-type">spanArgs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680186057"><span class="annot"><span class="annottext">Span
</span><a href="#local-6989586621680186057"><span class="hs-identifier hs-var">_span</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-274"></span><span>                  </span><span class="annot"><span class="annottext">env -&gt; ExecuteActivityInput -&gt; IO (Either String Payload)
</span><a href="#local-6989586621680186015"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">env
</span><a href="#local-6989586621680186013"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">ExecuteActivityInput
</span><a href="#local-6989586621680186014"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-275"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-276"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Interceptor.html#activityOutboundInterceptors"><span class="hs-identifier hs-var">activityOutboundInterceptors</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Temporal.Interceptor.html#ActivityOutboundInterceptor"><span class="hs-identifier hs-type">ActivityOutboundInterceptor</span></a></span><span>
</span><span id="line-277"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Interceptor.html#clientInterceptors"><span class="hs-identifier hs-var">clientInterceptors</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-278"></span><span>          </span><span class="annot"><a href="Temporal.Client.Types.html#ClientInterceptors"><span class="hs-identifier hs-type">ClientInterceptors</span></a></span><span>
</span><span id="line-279"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Temporal.Client.Types.html#start"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680186063"><span class="annot"><span class="annottext">WorkflowType
</span><a href="#local-6989586621680186063"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680186064"><span class="annot"><span class="annottext">WorkflowId
</span><a href="#local-6989586621680186064"><span class="hs-identifier hs-var">wfId</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Client.Types.html#StartWorkflowOptions"><span class="hs-identifier hs-type">StartWorkflowOptions</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680186066"><span id="local-6989586621680186067"><span id="local-6989586621680186068"><span id="local-6989586621680186069"><span id="local-6989586621680186070"><span id="local-6989586621680186071"><span id="local-6989586621680186072"><span id="local-6989586621680186073"><span id="local-6989586621680186074"><span id="local-6989586621680186075"><span id="local-6989586621680186076"><span class="annot"><span class="annottext">Bool
Maybe Text
Maybe Duration
Maybe WorkflowIdReusePolicy
Maybe RetryPolicy
Map Text Payload
Map SearchAttributeKey SearchAttributeType
TimeoutOptions
TaskQueue
taskQueue :: TaskQueue
followRuns :: Bool
workflowIdReusePolicy :: Maybe WorkflowIdReusePolicy
retryPolicy :: Maybe RetryPolicy
cronSchedule :: Maybe Text
memo :: Map Text Payload
searchAttributes :: Map SearchAttributeKey SearchAttributeType
headers :: Map Text Payload
timeouts :: TimeoutOptions
requestEagerExecution :: Bool
workflowStartDelay :: Maybe Duration
workflowStartDelay :: StartWorkflowOptions -&gt; Maybe Duration
requestEagerExecution :: StartWorkflowOptions -&gt; Bool
timeouts :: StartWorkflowOptions -&gt; TimeoutOptions
headers :: StartWorkflowOptions -&gt; Map Text Payload
searchAttributes :: StartWorkflowOptions -&gt; Map SearchAttributeKey SearchAttributeType
memo :: StartWorkflowOptions -&gt; Map Text Payload
cronSchedule :: StartWorkflowOptions -&gt; Maybe Text
retryPolicy :: StartWorkflowOptions -&gt; Maybe RetryPolicy
workflowIdReusePolicy :: StartWorkflowOptions -&gt; Maybe WorkflowIdReusePolicy
followRuns :: StartWorkflowOptions -&gt; Bool
taskQueue :: StartWorkflowOptions -&gt; TaskQueue
</span><a href="#local-6989586621680186066"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680186088"><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680186088"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621680186089"><span class="annot"><span class="annottext">WorkflowType
-&gt; WorkflowId
-&gt; StartWorkflowOptions
-&gt; Vector Payload
-&gt; IO (WorkflowHandle Payload)
</span><a href="#local-6989586621680186089"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-280"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680186090"><span class="annot"><span class="annottext">spanArgs :: SpanArguments
</span><a href="#local-6989586621680186090"><span class="hs-identifier hs-var hs-var">spanArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-281"></span><span>                      </span><span class="annot"><span class="annottext">SpanArguments
</span><span class="hs-identifier hs-var">defaultSpanArguments</span></span><span>
</span><span id="line-282"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">kind</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Client</span></span><span>
</span><span id="line-283"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">attributes</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-284"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">HashMap.fromList</span></span><span>
</span><span id="line-285"></span><span>                              </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;temporal.workflow_id&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">toAttribute</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#rawWorkflowId"><span class="hs-identifier hs-var">rawWorkflowId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680186064"><span class="hs-identifier hs-type">wfId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;temporal.workflow_type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">toAttribute</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#rawWorkflowType"><span class="hs-identifier hs-var">rawWorkflowType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680186063"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>                              </span><span class="hs-special">]</span><span>
</span><span id="line-288"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-289"></span><span>                </span><span class="annot"><span class="annottext">Tracer
-&gt; Text
-&gt; SpanArguments
-&gt; (Span -&gt; IO (WorkflowHandle Payload))
-&gt; IO (WorkflowHandle Payload)
forall (m :: * -&gt; *) a.
(MonadUnliftIO m, HasCallStack) =&gt;
Tracer -&gt; Text -&gt; SpanArguments -&gt; (Span -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">inSpan''</span></span><span> </span><span class="annot"><span class="annottext">Tracer
</span><a href="#local-6989586621680185873"><span class="hs-identifier hs-var">tracer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;StartWorkflow:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">WorkflowType -&gt; Text
</span><a href="Temporal.Common.html#rawWorkflowType"><span class="hs-identifier hs-var">rawWorkflowType</span></a></span><span> </span><span class="annot"><span class="annottext">WorkflowType
</span><a href="#local-6989586621680186063"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SpanArguments
</span><a href="#local-6989586621680186090"><span class="hs-identifier hs-var">spanArgs</span></a></span><span> </span><span class="annot"><span class="annottext">((Span -&gt; IO (WorkflowHandle Payload))
 -&gt; IO (WorkflowHandle Payload))
-&gt; (Span -&gt; IO (WorkflowHandle Payload))
-&gt; IO (WorkflowHandle Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Span
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-290"></span><span>                  </span><span id="local-6989586621680186091"><span class="annot"><a href="#local-6989586621680186091"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Context
forall (m :: * -&gt; *). MonadIO m =&gt; m Context
</span><span class="hs-identifier hs-var">getContext</span></span><span>
</span><span id="line-291"></span><span>                  </span><span id="local-6989586621680186092"><span class="annot"><a href="#local-6989586621680186092"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">inject</span></span><span> </span><span class="annot"><a href="Temporal.Contrib.OpenTelemetry.html#headersPropagator"><span class="hs-identifier hs-type">headersPropagator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680186091"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680186073"><span class="hs-identifier hs-type">headers</span></a></span><span>
</span><span id="line-292"></span><span>                  </span><span class="annot"><a href="#local-6989586621680186089"><span class="hs-identifier hs-type">next</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680186063"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680186064"><span class="hs-identifier hs-type">wfId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Client.Types.html#StartWorkflowOptions"><span class="hs-identifier hs-type">StartWorkflowOptions</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Client.Types.html#headers"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680186092"><span class="hs-identifier hs-type">hdrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680186066"><span class="hs-glyph hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680186088"><span class="hs-identifier hs-type">ps</span></a></span><span>
</span><span id="line-293"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Client.Types.html#queryWorkflow"><span class="hs-identifier hs-var">queryWorkflow</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680186094"><span class="annot"><span class="annottext">QueryWorkflowInput
</span><a href="#local-6989586621680186094"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621680186095"><span class="annot"><span class="annottext">QueryWorkflowInput -&gt; IO (Either QueryRejected Payload)
</span><a href="#local-6989586621680186095"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-294"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680186096"><span class="annot"><span class="annottext">spanArgs :: SpanArguments
</span><a href="#local-6989586621680186096"><span class="hs-identifier hs-var hs-var">spanArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-295"></span><span>                      </span><span class="annot"><span class="annottext">SpanArguments
</span><span class="hs-identifier hs-var">defaultSpanArguments</span></span><span>
</span><span id="line-296"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">kind</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Client</span></span><span>
</span><span id="line-297"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-298"></span><span>                </span><span class="annot"><span class="annottext">Tracer
-&gt; Text
-&gt; SpanArguments
-&gt; (Span -&gt; IO (Either QueryRejected Payload))
-&gt; IO (Either QueryRejected Payload)
forall (m :: * -&gt; *) a.
(MonadUnliftIO m, HasCallStack) =&gt;
Tracer -&gt; Text -&gt; SpanArguments -&gt; (Span -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">inSpan''</span></span><span> </span><span class="annot"><span class="annottext">Tracer
</span><a href="#local-6989586621680185873"><span class="hs-identifier hs-var">tracer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;QueryWorkflow:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">QueryWorkflowInput -&gt; Text
</span><a href="Temporal.Client.Types.html#queryWorkflowType"><span class="hs-identifier hs-var">queryWorkflowType</span></a></span><span> </span><span class="annot"><span class="annottext">QueryWorkflowInput
</span><a href="#local-6989586621680186094"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SpanArguments
</span><a href="#local-6989586621680186096"><span class="hs-identifier hs-var">spanArgs</span></a></span><span> </span><span class="annot"><span class="annottext">((Span -&gt; IO (Either QueryRejected Payload))
 -&gt; IO (Either QueryRejected Payload))
-&gt; (Span -&gt; IO (Either QueryRejected Payload))
-&gt; IO (Either QueryRejected Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Span
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-299"></span><span>                  </span><span id="local-6989586621680186098"><span class="annot"><a href="#local-6989586621680186098"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Context
forall (m :: * -&gt; *). MonadIO m =&gt; m Context
</span><span class="hs-identifier hs-var">getContext</span></span><span>
</span><span id="line-300"></span><span>                  </span><span id="local-6989586621680186099"><span class="annot"><a href="#local-6989586621680186099"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">inject</span></span><span> </span><span class="annot"><a href="Temporal.Contrib.OpenTelemetry.html#headersPropagator"><span class="hs-identifier hs-type">headersPropagator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680186098"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><span class="hs-identifier">input</span></span><span class="hs-operator">.</span><span class="hs-identifier">queryWorkflowHeaders</span><span>
</span><span id="line-301"></span><span>                  </span><span class="annot"><a href="#local-6989586621680186095"><span class="hs-identifier hs-type">next</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680186094"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Client.Types.html#queryWorkflowHeaders"><span class="hs-identifier hs-var">queryWorkflowHeaders</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680186099"><span class="hs-identifier hs-type">hdrs</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Client.Types.html#signalWithStart"><span class="hs-identifier hs-var">signalWithStart</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680186102"><span class="annot"><span class="annottext">SignalWithStartWorkflowInput
</span><a href="#local-6989586621680186102"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621680186103"><span class="annot"><span class="annottext">SignalWithStartWorkflowInput -&gt; IO (WorkflowHandle Payload)
</span><a href="#local-6989586621680186103"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-303"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680186104"><span class="annot"><span class="annottext">spanArgs :: SpanArguments
</span><a href="#local-6989586621680186104"><span class="hs-identifier hs-var hs-var">spanArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-304"></span><span>                      </span><span class="annot"><span class="annottext">SpanArguments
</span><span class="hs-identifier hs-var">defaultSpanArguments</span></span><span>
</span><span id="line-305"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">kind</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Client</span></span><span>
</span><span id="line-306"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-307"></span><span>                </span><span class="annot"><span class="annottext">Tracer
-&gt; Text
-&gt; SpanArguments
-&gt; (Span -&gt; IO (WorkflowHandle Payload))
-&gt; IO (WorkflowHandle Payload)
forall (m :: * -&gt; *) a.
(MonadUnliftIO m, HasCallStack) =&gt;
Tracer -&gt; Text -&gt; SpanArguments -&gt; (Span -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">inSpan''</span></span><span> </span><span class="annot"><span class="annottext">Tracer
</span><a href="#local-6989586621680185873"><span class="hs-identifier hs-var">tracer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;SignalWithStartWorkflow:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">WorkflowType -&gt; Text
</span><a href="Temporal.Common.html#rawWorkflowType"><span class="hs-identifier hs-var">rawWorkflowType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SignalWithStartWorkflowInput -&gt; WorkflowType
</span><a href="Temporal.Client.Types.html#signalWithStartWorkflowType"><span class="hs-identifier hs-var">signalWithStartWorkflowType</span></a></span><span> </span><span class="annot"><span class="annottext">SignalWithStartWorkflowInput
</span><a href="#local-6989586621680186102"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SpanArguments
</span><a href="#local-6989586621680186104"><span class="hs-identifier hs-var">spanArgs</span></a></span><span> </span><span class="annot"><span class="annottext">((Span -&gt; IO (WorkflowHandle Payload))
 -&gt; IO (WorkflowHandle Payload))
-&gt; (Span -&gt; IO (WorkflowHandle Payload))
-&gt; IO (WorkflowHandle Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Span
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-308"></span><span>                  </span><span id="local-6989586621680186106"><span class="annot"><a href="#local-6989586621680186106"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Context
forall (m :: * -&gt; *). MonadIO m =&gt; m Context
</span><span class="hs-identifier hs-var">getContext</span></span><span>
</span><span id="line-309"></span><span>                  </span><span id="local-6989586621680186107"><span class="annot"><a href="#local-6989586621680186107"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">inject</span></span><span> </span><span class="annot"><a href="Temporal.Contrib.OpenTelemetry.html#headersPropagator"><span class="hs-identifier hs-type">headersPropagator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680186106"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><span class="hs-identifier">input</span></span><span class="hs-operator">.</span><span class="hs-identifier">signalWithStartOptions</span><span class="hs-operator">.</span><span class="hs-identifier">headers</span><span>
</span><span id="line-310"></span><span>                  </span><span class="annot"><a href="#local-6989586621680186103"><span class="hs-identifier hs-type">next</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680186102"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Client.Types.html#signalWithStartOptions"><span class="hs-identifier hs-var">signalWithStartOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Client.Types.html#signalWithStartOptions"><span class="hs-identifier hs-var">signalWithStartOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680186102"><span class="hs-identifier hs-type">input</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Client.Types.html#headers"><span class="hs-identifier hs-var">Temporal.Client.Types.headers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680186107"><span class="hs-identifier hs-type">hdrs</span></a></span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-312"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Not really anything to do here since new cron jobs should be in their own context</span><span>
</span><span id="line-313"></span><span>        </span><span class="annot"><a href="Temporal.Interceptor.html#scheduleClientInterceptors"><span class="hs-identifier hs-var">scheduleClientInterceptors</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span>
</span><span id="line-314"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-315"></span></pre></body></html>