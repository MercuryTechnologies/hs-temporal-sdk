<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DuplicateRecordFields #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE PolyKinds #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilyDependencies #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-unrecognised-pragmas #-}</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# HLINT ignore &quot;Use replicateM&quot; #-}</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="annot"><span class="hs-comment">{- |

This module provides the core functionality for defining functions that can be
executed as Temporal workflows.

In day-to-day conversations, the term Workflow frequently denotes either a Workflow Type, a Workflow Definition, or a Workflow Execution.

= What is a Workflow Definition?

A Workflow Definition is the code that defines the constraints of a Workflow Execution.

A Workflow Definition is often also referred to as a Workflow Function. In Temporal's documentation, a Workflow Definition refers to the source for the instance of a Workflow Execution, while a Workflow Function refers to the source for the instance of a Workflow Function Execution.

A Workflow Execution effectively executes once to completion, while a Workflow Function Execution occurs many times during the life of a Workflow Execution.

= Deterministic constraints

A critical aspect of developing Workflow Definitions is ensuring they exhibit certain deterministic traits &#8211; that is, making sure that the same Commands are emitted in the same sequence, whenever a corresponding Workflow Function Execution (instance of the Function Definition) is re-executed.

The execution semantics of a Workflow Execution include the re-execution of a Workflow Function, which is called a Replay. The use of Workflow APIs in the function is what generates Commands. Commands tell the Cluster which Events to create and add to the Workflow Execution's Event History. When a Workflow Function executes, the Commands that are emitted are compared with the existing Event History. If a corresponding Event already exists within the Event History that maps to the generation of that Command in the same sequence, and some specific metadata of that Command matches with some specific metadata of the Event, then the Function Execution progresses.

For example, using an SDK's &quot;Execute Activity&quot; API generates the ScheduleActivityTask Command. When this API is called upon re-execution, that Command is compared with the Event that is in the same location within the sequence. The Event in the sequence must be an ActivityTaskScheduled Event, where the Activity name is the same as what is in the Command.

If a generated Command doesn't match what it needs to in the existing Event History, then the Workflow Execution returns a non-deterministic error.

The following are the two reasons why a Command might be generated out of sequence or the wrong Command might be generated altogether:

- Code changes are made to a Workflow Definition that is in use by a running Workflow Execution.
- There is intrinsic non-deterministic logic (such as inline random branching).

= Code changes can cause non-deterministic behavior

The Workflow Definition can change in very limited ways once there is a Workflow Execution depending on it. To alleviate non-deterministic issues that arise from code changes, we recommend using Workflow Versioning.

For example, let's say we have a Workflow Definition that defines the following sequence:

1. Start and wait on a Timer/sleep.
2. Spawn and wait on an Activity Execution.
3. Complete.

We start a Worker and spawn a Workflow Execution that uses that Workflow Definition. The Worker would emit the StartTimer Command and the Workflow Execution would become suspended.

Before the Timer is up, we change the Workflow Definition to the following sequence:

1. Spawn and wait on an Activity Execution.
2. Start and wait on a Timer/sleep.
3. Complete.

When the Timer fires, the next Workflow Task will cause the Workflow Function to re-execute. The first Command the Worker sees would be ScheduleActivityTask Command, which wouldn't match up to the expected TimerStarted Event.

The Workflow Execution would fail and return a non-deterministic error.

The following are examples of minor changes that would not result in non-determinism errors when re-executing a History which already contain the Events:

- Changing the duration of a Timer
- Changing the arguments to:

    * The Activity Options in a call to spawn an Activity Execution (local or nonlocal).
    * The Child Workflow Options in a call to spawn a Child Workflow Execution.
    * Call to Signal an External Workflow Execution.

- Adding a Signal Handler for a Signal Type that has not been sent to this Workflow Execution.

= Workflow Versioning

Note: not yet implemented

The Workflow Versioning feature enables the creation of logical branching inside a Workflow Definition based on a developer specified version identifier. This feature is useful for Workflow Definition logic needs to be updated, but there are running Workflow Executions that currently depends on it. It is important to note that a practical way to handle different versions of Workflow Definitions, without using the versioning API, is to run the different versions on separate Task Queues.

= Handling unreliable Worker Processes

You do not handle Worker Process failure or restarts in a Workflow Definition.

Workflow Function Executions are completely oblivious to the Worker Process in terms of failures or downtime. The Temporal Platform ensures that the state of a Workflow Execution is recovered and progress resumes if there is an outage of either Worker Processes or the Temporal Cluster itself. The only reason a Workflow Execution might fail is due to the code throwing an error or exception, not because of underlying infrastructure outages.
-}</span></span><span>
</span><span id="line-95"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Temporal.Workflow.html"><span class="hs-identifier">Temporal.Workflow</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier">Workflow</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowDefinition"><span class="hs-identifier">WorkflowDefinition</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Definition.html#KnownWorkflow"><span class="hs-identifier">KnownWorkflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Definition.html#ProvidedWorkflow"><span class="hs-identifier">ProvidedWorkflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Definition.html#provideWorkflow"><span class="hs-identifier">provideWorkflow</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier">Task</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><a href="Temporal.Common.TimeoutType.html#StartToClose"><span class="hs-identifier">StartToClose</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><a href="Temporal.Common.TimeoutType.html#ScheduleToClose"><span class="hs-identifier">ScheduleToClose</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><span class="hs-identifier">These</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Workflow monad operations</span></span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><span class="hs-comment">-- $workflowBasics</span></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Activity operations</span></span><span>
</span><span id="line-110"></span><span>  </span><span class="annot"><span class="hs-comment">-- $activityBasics</span></span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityRef"><span class="hs-identifier">ActivityRef</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><a href="Temporal.Activity.Definition.html#KnownActivity"><span class="hs-identifier">KnownActivity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-113"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Types.html#StartActivityOptions"><span class="hs-identifier">StartActivityOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- TODO fields conflict</span><span>
</span><span id="line-114"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Types.html#ActivityCancellationType"><span class="hs-identifier">ActivityCancellationType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Types.html#ActivityTimeoutPolicy"><span class="hs-identifier">ActivityTimeoutPolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Types.html#StartActivityTimeoutOption"><span class="hs-identifier">StartActivityTimeoutOption</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Types.html#defaultStartActivityOptions"><span class="hs-identifier">defaultStartActivityOptions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-118"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#startActivity"><span class="hs-identifier">startActivity</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-119"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#executeActivity"><span class="hs-identifier">executeActivity</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#StartLocalActivityOptions"><span class="hs-identifier">StartLocalActivityOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#defaultStartLocalActivityOptions"><span class="hs-identifier">defaultStartLocalActivityOptions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-122"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#startLocalActivity"><span class="hs-identifier">startLocalActivity</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Child workflow operations</span></span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><span class="hs-comment">-- $childWorkflow</span></span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Types.html#StartChildWorkflowOptions"><span class="hs-identifier">StartChildWorkflowOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Types.html#defaultChildWorkflowOptions"><span class="hs-identifier">defaultChildWorkflowOptions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowRef"><span class="hs-identifier">WorkflowRef</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-129"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#startChildWorkflow"><span class="hs-identifier">startChildWorkflow</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#executeChildWorkflow"><span class="hs-identifier">executeChildWorkflow</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ChildWorkflowHandle"><span class="hs-identifier">ChildWorkflowHandle</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Unsafe.Handle.html#Wait"><span class="hs-identifier">Wait</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Unsafe.Handle.html#Cancel"><span class="hs-identifier">Cancel</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#WorkflowHandle"><span class="hs-identifier">WorkflowHandle</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Unsafe.Handle.html#waitChildWorkflowResult"><span class="hs-identifier">waitChildWorkflowResult</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-136"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Unsafe.Handle.html#waitChildWorkflowStart"><span class="hs-identifier">waitChildWorkflowStart</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-137"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Unsafe.Handle.html#cancelChildWorkflowExecution"><span class="hs-identifier">cancelChildWorkflowExecution</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ExternalWorkflowHandle"><span class="hs-identifier">ExternalWorkflowHandle</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-139"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#getExternalWorkflowHandle"><span class="hs-identifier">getExternalWorkflowHandle</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-140"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Types.html#Info"><span class="hs-identifier">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><a href="Temporal.Common.html#RetryPolicy"><span class="hs-identifier">RetryPolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-142"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#defaultRetryPolicy"><span class="hs-identifier">defaultRetryPolicy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-143"></span><span>  </span><span class="annot"><a href="Temporal.Common.html#ParentInfo"><span class="hs-identifier">ParentInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Workflow metadata</span></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#info"><span class="hs-identifier">info</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#getMemoValues"><span class="hs-identifier">getMemoValues</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#lookupMemoValue"><span class="hs-identifier">lookupMemoValue</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-151"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#upsertSearchAttributes"><span class="hs-identifier">upsertSearchAttributes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Versioning workflows</span></span><span>
</span><span id="line-154"></span><span>  </span><span class="annot"><span class="hs-comment">-- $versioning</span></span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#patched"><span class="hs-identifier">patched</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#deprecatePatch"><span class="hs-identifier">deprecatePatch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Concurrency within Workflows</span></span><span>
</span><span id="line-159"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#race"><span class="hs-identifier">Temporal.Workflow.race</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-160"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#race_"><span class="hs-identifier">Temporal.Workflow.race_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-161"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#concurrently"><span class="hs-identifier">Temporal.Workflow.concurrently</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-162"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#concurrently_"><span class="hs-identifier">Temporal.Workflow.concurrently_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#mapConcurrently"><span class="hs-identifier">Temporal.Workflow.mapConcurrently</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#mapConcurrently_"><span class="hs-identifier">Temporal.Workflow.mapConcurrently_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#replicateConcurrently"><span class="hs-identifier">Temporal.Workflow.replicateConcurrently</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-166"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#replicateConcurrently_"><span class="hs-identifier">Temporal.Workflow.replicateConcurrently_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-167"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#forConcurrently"><span class="hs-identifier">Temporal.Workflow.forConcurrently</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-168"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#forConcurrently_"><span class="hs-identifier">Temporal.Workflow.forConcurrently_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-169"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#traverseConcurrently"><span class="hs-identifier">traverseConcurrently</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-170"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#traverseConcurrently_"><span class="hs-identifier">traverseConcurrently_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-171"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#sequenceConcurrently"><span class="hs-identifier">sequenceConcurrently</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-172"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#sequenceConcurrently_"><span class="hs-identifier">sequenceConcurrently_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-173"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier">ConcurrentWorkflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-174"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#independently"><span class="hs-identifier">independently</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-175"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#biselect"><span class="hs-identifier">biselect</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-176"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#biselectOpt"><span class="hs-identifier">biselectOpt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Interacting with running Workflows</span></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Queries</span></span><span>
</span><span id="line-181"></span><span>  </span><span class="annot"><span class="hs-comment">-- $queries</span></span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Query.html#QueryRef"><span class="hs-identifier">QueryRef</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-183"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Query"><span class="hs-identifier">Query</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Query.html#KnownQuery"><span class="hs-identifier">KnownQuery</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-185"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#setQueryHandler"><span class="hs-identifier">setQueryHandler</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Signals</span></span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><span class="hs-comment">-- $signals</span></span><span>
</span><span id="line-189"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Signal.html#SignalRef"><span class="hs-identifier">SignalRef</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-190"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Signal.html#KnownSignal"><span class="hs-identifier">KnownSignal</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-191"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#setSignalHandler"><span class="hs-identifier">setSignalHandler</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-192"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#ValidSignalHandler"><span class="hs-identifier">ValidSignalHandler</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-193"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Condition"><span class="hs-identifier">Condition</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-194"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#waitCondition"><span class="hs-identifier">waitCondition</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Other utilities</span></span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#unsafeAsyncEffectSink"><span class="hs-identifier">unsafeAsyncEffectSink</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>  </span><span class="annot"><span class="hs-comment">-- * State vars</span></span><span>
</span><span id="line-200"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#StateVar"><span class="hs-identifier">StateVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#newStateVar"><span class="hs-identifier">newStateVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-202"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#MonadReadStateVar"><span class="hs-identifier">MonadReadStateVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-203"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#MonadWriteStateVar"><span class="hs-identifier">MonadWriteStateVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Time and timers</span></span><span>
</span><span id="line-206"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#now"><span class="hs-identifier">now</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-207"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#time"><span class="hs-identifier">time</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-208"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#sleep"><span class="hs-identifier">sleep</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-209"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#Timer"><span class="hs-identifier">Timer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#createTimer"><span class="hs-identifier">createTimer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-211"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#scheduledTime"><span class="hs-identifier">scheduledTime</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Workflow cancellation</span></span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#isCancelRequested"><span class="hs-identifier">isCancelRequested</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-215"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#waitCancellation"><span class="hs-identifier">waitCancellation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Random value generation</span></span><span>
</span><span id="line-218"></span><span>  </span><span class="annot"><span class="hs-comment">-- $randomness</span></span><span>
</span><span id="line-219"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#randomGen"><span class="hs-identifier">randomGen</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-220"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#uuid4"><span class="hs-identifier">uuid4</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-221"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#uuid7"><span class="hs-identifier">uuid7</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-222"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowGenM"><span class="hs-identifier">WorkflowGenM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Continue as new</span></span><span>
</span><span id="line-225"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Types.html#ContinueAsNewOptions"><span class="hs-identifier">ContinueAsNewOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- TODO, fields conflict</span><span>
</span><span id="line-226"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Types.html#defaultContinueAsNewOptions"><span class="hs-identifier">defaultContinueAsNewOptions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-227"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#continueAsNew"><span class="hs-identifier">Temporal.Workflow.continueAsNew</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Type definitions</span></span><span>
</span><span id="line-230"></span><span>  </span><span class="annot"><a href="Temporal.Payload.html#GatherArgs"><span class="hs-identifier">GatherArgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-231"></span><span>  </span><span class="annot"><a href="Temporal.Common.html#ActivityId"><span class="hs-identifier">ActivityId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-232"></span><span>  </span><span class="annot"><a href="Temporal.Common.html#WorkflowId"><span class="hs-identifier">WorkflowId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-233"></span><span>  </span><span class="annot"><a href="Temporal.Common.html#Namespace"><span class="hs-identifier">Namespace</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-234"></span><span>  </span><span class="annot"><a href="Temporal.Common.html#TaskQueue"><span class="hs-identifier">TaskQueue</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-235"></span><span>  </span><span class="annot"><a href="Temporal.Common.html#PatchId"><span class="hs-identifier">PatchId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-236"></span><span>  </span><span class="annot"><a href="Temporal.Common.html#RunId"><span class="hs-identifier">RunId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-237"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Types.html#ParentClosePolicy"><span class="hs-identifier">ParentClosePolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Types.html#ChildWorkflowCancellationType"><span class="hs-identifier">ChildWorkflowCancellationType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-239"></span><span>  </span><span class="annot"><a href="Temporal.Common.html#WorkflowIdReusePolicy"><span class="hs-identifier">WorkflowIdReusePolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><a href="Temporal.Common.html#WorkflowType"><span class="hs-identifier">WorkflowType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-241"></span><span>  </span><span class="annot"><span class="hs-identifier">RequireCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-242"></span><span>  </span><span class="annot"><a href="Temporal.Common.html#TimeoutOptions"><span class="hs-identifier">TimeoutOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-243"></span><span>  </span><span class="annot"><a href="Temporal.Common.html#defaultTimeoutOptions"><span class="hs-identifier">defaultTimeoutOptions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Commonly used</span></span><span>
</span><span id="line-246"></span><span>  </span><span class="annot"><a href="Temporal.Payload.html#%3A-%3E%3A"><span class="hs-operator">(:-&gt;:)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-247"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Alternative</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forkIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception.Annotated</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">throwWithCallStack</span></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-253"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Catch</span></span><span>
</span><span id="line-254"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Logger</span></span><span>
</span><span id="line-255"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-256"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bits</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Bits</span></span><span>
</span><span id="line-257"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Short</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SBS</span></span><span>
</span><span id="line-258"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Coerce</span></span><span>
</span><span id="line-259"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Foldable</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">traverse_</span></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HashMap</span></span><span>
</span><span id="line-261"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Int64</span></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-264"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-265"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ProtoLens</span></span><span>
</span><span id="line-266"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span>
</span><span id="line-267"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-268"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-270"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.These</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">These</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time.Clock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UTCTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time.Clock.System</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SystemTime</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">systemToUTCTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time.Format</span></span><span>
</span><span id="line-274"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.UUID</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UUID</span></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.UUID</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UUID</span></span><span>
</span><span id="line-276"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.UUID.Types.Internal</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">buildFromBytes</span></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Vector</span></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-279"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Word32</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Word64</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Word8</span></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Stack</span></span><span>
</span><span id="line-281"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Lens.Family2</span></span><span>
</span><span id="line-282"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Proto.Temporal.Api.Common.V1.Message_Fields</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Payloads</span></span><span>
</span><span id="line-283"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Proto.Temporal.Api.Failure.V1.Message_Fields</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Failure</span></span><span>
</span><span id="line-284"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Proto.Temporal.Sdk.Core.ActivityResult.ActivityResult</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ActivityResult</span></span><span>
</span><span id="line-285"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Proto.Temporal.Sdk.Core.ActivityResult.ActivityResult_Fields</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ActivityResult</span></span><span>
</span><span id="line-286"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Proto.Temporal.Sdk.Core.Common.Common_Fields</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Common</span></span><span>
</span><span id="line-287"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Proto.Temporal.Sdk.Core.WorkflowActivation.WorkflowActivation_Fields</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Activation</span></span><span>
</span><span id="line-288"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Proto.Temporal.Sdk.Core.WorkflowCommands.WorkflowCommands</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Command</span></span><span>
</span><span id="line-289"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Proto.Temporal.Sdk.Core.WorkflowCommands.WorkflowCommands_Fields</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Command</span></span><span>
</span><span id="line-290"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">RequireCallStack</span></span><span>
</span><span id="line-291"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Random.Stateful</span></span><span>
</span><span id="line-292"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html"><span class="hs-identifier">Temporal.Activity.Definition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityRef"><span class="hs-identifier">ActivityRef</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#KnownActivity"><span class="hs-identifier">KnownActivity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Common.html"><span class="hs-identifier">Temporal.Common</span></a></span><span>
</span><span id="line-294"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Common.TimeoutType.html"><span class="hs-identifier">Temporal.Common.TimeoutType</span></a></span><span>
</span><span id="line-295"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Duration.html"><span class="hs-identifier">Temporal.Duration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Duration.html#Duration"><span class="hs-identifier">Duration</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Duration.html#durationFromProto"><span class="hs-identifier">durationFromProto</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Duration.html#durationToProto"><span class="hs-identifier">durationToProto</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Duration.html#nanoseconds"><span class="hs-identifier">nanoseconds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Duration.html#seconds"><span class="hs-identifier">seconds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Exception.html"><span class="hs-identifier">Temporal.Exception</span></a></span><span>
</span><span id="line-297"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Payload.html"><span class="hs-identifier">Temporal.Payload</span></a></span><span>
</span><span id="line-298"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.SearchAttributes.html"><span class="hs-identifier">Temporal.SearchAttributes</span></a></span><span>
</span><span id="line-299"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.SearchAttributes.Internal.html"><span class="hs-identifier">Temporal.SearchAttributes.Internal</span></a></span><span>
</span><span id="line-300"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Workflow.Definition.html"><span class="hs-identifier">Temporal.Workflow.Definition</span></a></span><span>
</span><span id="line-301"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html"><span class="hs-identifier">Temporal.Workflow.Internal.Monad</span></a></span><span>
</span><span id="line-302"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Workflow.Query.html"><span class="hs-identifier">Temporal.Workflow.Query</span></a></span><span>
</span><span id="line-303"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Workflow.Signal.html"><span class="hs-identifier">Temporal.Workflow.Signal</span></a></span><span>
</span><span id="line-304"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html"><span class="hs-identifier">Temporal.Workflow.Types</span></a></span><span>
</span><span id="line-305"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Workflow.Unsafe.Handle.html"><span class="hs-identifier">Temporal.Workflow.Unsafe.Handle</span></a></span><span>
</span><span id="line-306"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Workflow.WorkflowInstance.html"><span class="hs-identifier">Temporal.Workflow.WorkflowInstance</span></a></span><span>
</span><span id="line-307"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.WorkflowInstance.html"><span class="hs-identifier">Temporal.WorkflowInstance</span></a></span><span>
</span><span id="line-308"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO</span></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="hs-comment">-- class MonadWorkflow m where</span><span>
</span><span id="line-312"></span><span class="hs-comment">-- startChildWorkflowFromPayloads :: forall args result. RequireCallStack =&gt; KnownWorkflow args result -&gt; StartChildWorkflowOptions -&gt; [IO Payload] -&gt; m (ChildWorkflowHandle result)</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- startActivityFromPayloads :: forall args result. RequireCallStack =&gt; KnownActivity args result -&gt; StartActivityOptions -&gt; [IO Payload] -&gt; m (Task result)</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- askInfo :: m Info</span><span>
</span><span id="line-315"></span><span class="hs-comment">-- getMemoValues :: m (Map Text Payload)</span><span>
</span><span id="line-316"></span><span class="hs-comment">-- upsertSearchAttributes :: RequireCallStack =&gt; Map Text SearchAttributeType -&gt; m ()</span><span>
</span><span id="line-317"></span><span class="hs-comment">-- applyPatch :: RequireCallStack =&gt; PatchId -&gt; Bool -&gt; m Bool</span><span>
</span><span id="line-318"></span><span class="hs-comment">-- randomGen :: m StdGen</span><span>
</span><span id="line-319"></span><span class="hs-comment">-- uuid4 :: m UUID</span><span>
</span><span id="line-320"></span><span class="hs-comment">-- setQueryHandler</span><span>
</span><span id="line-321"></span><span class="hs-comment">-- setSignalHandler</span><span>
</span><span id="line-322"></span><span class="hs-comment">-- time</span><span>
</span><span id="line-323"></span><span class="hs-comment">-- createTimer</span><span>
</span><span id="line-324"></span><span class="hs-comment">-- continueAsNew</span><span>
</span><span id="line-325"></span><span class="hs-comment">-- getExternalWorkflowHandle</span><span>
</span><span id="line-326"></span><span class="hs-comment">-- waitCondition</span><span>
</span><span id="line-327"></span><span class="hs-comment">-- unsafeEffectSink</span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="hs-keyword">newtype</span><span> </span><span id="WorkflowInternal"><span class="annot"><a href="Temporal.Workflow.html#WorkflowInternal"><span class="hs-identifier hs-var">WorkflowInternal</span></a></span></span><span> </span><span id="local-6989586621680182743"><span class="annot"><a href="#local-6989586621680182743"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WorkflowInternal"><span class="annot"><a href="Temporal.Workflow.html#WorkflowInternal"><span class="hs-identifier hs-var">WorkflowInternal</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ContinuationEnv"><span class="hs-identifier hs-type">ContinuationEnv</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#InstanceM"><span class="hs-identifier hs-type">InstanceM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182743"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680182746"><span id="local-6989586621680182751"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; WorkflowInternal a -&gt; WorkflowInternal b)
-&gt; (forall a b. a -&gt; WorkflowInternal b -&gt; WorkflowInternal a)
-&gt; Functor WorkflowInternal
forall a b. a -&gt; WorkflowInternal b -&gt; WorkflowInternal a
forall a b. (a -&gt; b) -&gt; WorkflowInternal a -&gt; WorkflowInternal b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; WorkflowInternal a -&gt; WorkflowInternal b
fmap :: forall a b. (a -&gt; b) -&gt; WorkflowInternal a -&gt; WorkflowInternal b
$c&lt;$ :: forall a b. a -&gt; WorkflowInternal b -&gt; WorkflowInternal a
&lt;$ :: forall a b. a -&gt; WorkflowInternal b -&gt; WorkflowInternal a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680182760"><span id="local-6989586621680182765"><span id="local-6989586621680182769"><span id="local-6989586621680182773"><span id="local-6989586621680182777"><span class="annot"><span class="annottext">Functor WorkflowInternal
Functor WorkflowInternal =&gt;
(forall a. a -&gt; WorkflowInternal a)
-&gt; (forall a b.
    WorkflowInternal (a -&gt; b)
    -&gt; WorkflowInternal a -&gt; WorkflowInternal b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c)
    -&gt; WorkflowInternal a -&gt; WorkflowInternal b -&gt; WorkflowInternal c)
-&gt; (forall a b.
    WorkflowInternal a -&gt; WorkflowInternal b -&gt; WorkflowInternal b)
-&gt; (forall a b.
    WorkflowInternal a -&gt; WorkflowInternal b -&gt; WorkflowInternal a)
-&gt; Applicative WorkflowInternal
forall a. a -&gt; WorkflowInternal a
forall a b.
WorkflowInternal a -&gt; WorkflowInternal b -&gt; WorkflowInternal a
forall a b.
WorkflowInternal a -&gt; WorkflowInternal b -&gt; WorkflowInternal b
forall a b.
WorkflowInternal (a -&gt; b)
-&gt; WorkflowInternal a -&gt; WorkflowInternal b
forall a b c.
(a -&gt; b -&gt; c)
-&gt; WorkflowInternal a -&gt; WorkflowInternal b -&gt; WorkflowInternal c
forall (f :: * -&gt; *).
Functor f =&gt;
(forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
$cpure :: forall a. a -&gt; WorkflowInternal a
pure :: forall a. a -&gt; WorkflowInternal a
$c&lt;*&gt; :: forall a b.
WorkflowInternal (a -&gt; b)
-&gt; WorkflowInternal a -&gt; WorkflowInternal b
&lt;*&gt; :: forall a b.
WorkflowInternal (a -&gt; b)
-&gt; WorkflowInternal a -&gt; WorkflowInternal b
$cliftA2 :: forall a b c.
(a -&gt; b -&gt; c)
-&gt; WorkflowInternal a -&gt; WorkflowInternal b -&gt; WorkflowInternal c
liftA2 :: forall a b c.
(a -&gt; b -&gt; c)
-&gt; WorkflowInternal a -&gt; WorkflowInternal b -&gt; WorkflowInternal c
$c*&gt; :: forall a b.
WorkflowInternal a -&gt; WorkflowInternal b -&gt; WorkflowInternal b
*&gt; :: forall a b.
WorkflowInternal a -&gt; WorkflowInternal b -&gt; WorkflowInternal b
$c&lt;* :: forall a b.
WorkflowInternal a -&gt; WorkflowInternal b -&gt; WorkflowInternal a
&lt;* :: forall a b.
WorkflowInternal a -&gt; WorkflowInternal b -&gt; WorkflowInternal a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680182787"><span id="local-6989586621680182792"><span id="local-6989586621680182796"><span class="annot"><span class="annottext">Applicative WorkflowInternal
Applicative WorkflowInternal =&gt;
(forall a b.
 WorkflowInternal a
 -&gt; (a -&gt; WorkflowInternal b) -&gt; WorkflowInternal b)
-&gt; (forall a b.
    WorkflowInternal a -&gt; WorkflowInternal b -&gt; WorkflowInternal b)
-&gt; (forall a. a -&gt; WorkflowInternal a)
-&gt; Monad WorkflowInternal
forall a. a -&gt; WorkflowInternal a
forall a b.
WorkflowInternal a -&gt; WorkflowInternal b -&gt; WorkflowInternal b
forall a b.
WorkflowInternal a
-&gt; (a -&gt; WorkflowInternal b) -&gt; WorkflowInternal b
forall (m :: * -&gt; *).
Applicative m =&gt;
(forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall a b.
WorkflowInternal a
-&gt; (a -&gt; WorkflowInternal b) -&gt; WorkflowInternal b
&gt;&gt;= :: forall a b.
WorkflowInternal a
-&gt; (a -&gt; WorkflowInternal b) -&gt; WorkflowInternal b
$c&gt;&gt; :: forall a b.
WorkflowInternal a -&gt; WorkflowInternal b -&gt; WorkflowInternal b
&gt;&gt; :: forall a b.
WorkflowInternal a -&gt; WorkflowInternal b -&gt; WorkflowInternal b
$creturn :: forall a. a -&gt; WorkflowInternal a
return :: forall a. a -&gt; WorkflowInternal a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680182804"><span class="annot"><span class="annottext">Monad WorkflowInternal
Monad WorkflowInternal =&gt;
(forall a. IO a -&gt; WorkflowInternal a) -&gt; MonadIO WorkflowInternal
forall a. IO a -&gt; WorkflowInternal a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall a. IO a -&gt; m a) -&gt; MonadIO m
$cliftIO :: forall a. IO a -&gt; WorkflowInternal a
liftIO :: forall a. IO a -&gt; WorkflowInternal a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span class="annot"><span class="hs-comment">-- | We need a specialized version of 'withArgs' since we aren't supposed to introduce arbitrary effects in the 'Workflow' monad.</span></span><span>
</span><span id="line-334"></span><span class="annot"><a href="Temporal.Workflow.html#withWorkflowArgs"><span class="hs-identifier hs-type">withWorkflowArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680181775"><span class="annot"><a href="#local-6989586621680181775"><span class="hs-identifier hs-type">args</span></a></span></span><span> </span><span id="local-6989586621680181780"><span class="annot"><a href="#local-6989586621680181780"><span class="hs-identifier hs-type">result</span></a></span></span><span> </span><span id="local-6989586621680181777"><span class="annot"><a href="#local-6989586621680181777"><span class="hs-identifier hs-type">codec</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Payload.html#VarArgs"><span class="hs-identifier hs-type">VarArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181775"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Payload.html#AllArgs"><span class="hs-identifier hs-type">AllArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Payload.html#Codec"><span class="hs-identifier hs-type">Codec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181777"><span class="hs-identifier hs-type">codec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680181775"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680181777"><span class="hs-identifier hs-type">codec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181780"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680181775"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#%3A-%3E%3A"><span class="hs-operator hs-type">:-&gt;:</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181780"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-335"></span><span id="withWorkflowArgs"><span class="annot"><span class="annottext">withWorkflowArgs :: forall (args :: [*]) result codec.
(VarArgs args, AllArgs (Codec codec) args) =&gt;
codec
-&gt; (Vector Payload -&gt; Workflow result) -&gt; args :-&gt;: Workflow result
</span><a href="Temporal.Workflow.html#withWorkflowArgs"><span class="hs-identifier hs-var hs-var">withWorkflowArgs</span></a></span></span><span> </span><span id="local-6989586621680182825"><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680182825"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680182826"><span class="annot"><span class="annottext">Vector Payload -&gt; Workflow result
</span><a href="#local-6989586621680182826"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-336"></span><span>  </span><span class="annot"><span class="annottext">forall (args :: [*]) result result'.
VarArgs args =&gt;
(result -&gt; result') -&gt; (args :-&gt;: result) -&gt; args :-&gt;: result'
</span><a href="Temporal.Payload.html#mapResult"><span class="hs-identifier hs-var">mapResult</span></a></span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680181775"><span class="hs-identifier hs-type">args</span></a></span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.html#WorkflowInternal"><span class="hs-identifier hs-type">WorkflowInternal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181780"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181780"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>    </span><span class="annot"><span class="annottext">WorkflowInternal (Result result) -&gt; Workflow result
forall a. WorkflowInternal (Result a) -&gt; Workflow a
</span><a href="#local-6989586621680182828"><span class="hs-identifier hs-var">safely</span></a></span><span>
</span><span id="line-341"></span><span>    </span><span class="annot"><span class="annottext">((args :-&gt;: WorkflowInternal (Result result))
 -&gt; args :-&gt;: Workflow result)
-&gt; (args :-&gt;: WorkflowInternal (Result result))
-&gt; args :-&gt;: Workflow result
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (args :: [*]) result codec.
(VarArgs args, AllArgs (Codec codec) args) =&gt;
codec -&gt; (Vector UnencodedPayload -&gt; result) -&gt; args :-&gt;: result
</span><a href="Temporal.Payload.html#withArgs"><span class="hs-identifier hs-var">withArgs</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680181775"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.html#WorkflowInternal"><span class="hs-identifier hs-type">WorkflowInternal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181780"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680182825"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-342"></span><span>    </span><span class="annot"><span class="annottext">((Vector UnencodedPayload -&gt; WorkflowInternal (Result result))
 -&gt; args :-&gt;: WorkflowInternal (Result result))
-&gt; (Vector UnencodedPayload -&gt; WorkflowInternal (Result result))
-&gt; args :-&gt;: WorkflowInternal (Result result)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680182829"><span class="annot"><span class="annottext">Vector UnencodedPayload
</span><a href="#local-6989586621680182829"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-343"></span><span>      </span><span id="local-6989586621680182830"><span class="annot"><a href="#local-6989586621680182830"><span class="hs-identifier hs-var">args'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Vector Payload) -&gt; WorkflowInternal (Vector Payload)
forall a. IO a -&gt; WorkflowInternal a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Vector Payload) -&gt; WorkflowInternal (Vector Payload))
-&gt; IO (Vector Payload) -&gt; WorkflowInternal (Vector Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Vector UnencodedPayload -&gt; IO (Vector Payload)
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
forall (m :: * -&gt; *) a. Monad m =&gt; Vector (m a) -&gt; m (Vector a)
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="annot"><span class="annottext">Vector UnencodedPayload
</span><a href="#local-6989586621680182829"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-344"></span><span>      </span><span class="annot"><a href="#local-6989586621680182832"><span class="hs-identifier hs-type">unsafely</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621680182826"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182830"><span class="hs-identifier hs-type">args'</span></a></span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-346"></span><span>    </span><span id="local-6989586621680181801"><span class="annot"><a href="#local-6989586621680182832"><span class="hs-identifier hs-type">unsafely</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181801"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.html#WorkflowInternal"><span class="hs-identifier hs-type">WorkflowInternal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181801"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-347"></span><span>    </span><span id="local-6989586621680182832"><span class="annot"><span class="annottext">unsafely :: forall a. Workflow a -&gt; WorkflowInternal (Result a)
</span><a href="#local-6989586621680182832"><span class="hs-identifier hs-var hs-var">unsafely</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Workflow a -&gt; WorkflowInternal (Result a)
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span>
</span><span id="line-348"></span><span>    </span><span id="local-6989586621680181789"><span class="annot"><a href="#local-6989586621680182828"><span class="hs-identifier hs-type">safely</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.html#WorkflowInternal"><span class="hs-identifier hs-type">WorkflowInternal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181789"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181789"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-349"></span><span>    </span><span id="local-6989586621680182828"><span class="annot"><span class="annottext">safely :: forall a. WorkflowInternal (Result a) -&gt; Workflow a
</span><a href="#local-6989586621680182828"><span class="hs-identifier hs-var hs-var">safely</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkflowInternal (Result a) -&gt; Workflow a
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="annot"><span class="hs-comment">{- $activityBasics

An Activity is an IO-based function that executes a single, well-defined action (either short or long running),
such as calling another service, transcoding a media file, or sending an email message.
Activity code can be non-deterministic.

We recommend that it be idempotent.

Workflow code orchestrates the execution of Activities, persisting the results.
If an Activity Function Execution fails, any future execution starts from initial state (except Heartbeats).

Activity Functions are executed by Worker Processes. When the Activity Function returns,
the Worker sends the results back to the Temporal Cluster as part of the ActivityTaskCompleted Event.
The Event is added to the Workflow Execution's Event History.
-}</span></span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span class="annot"><a href="Temporal.Workflow.html#startActivityFromPayloads"><span class="hs-identifier hs-type">startActivityFromPayloads</span></a></span><span>
</span><span id="line-370"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680181805"><span class="annot"><a href="#local-6989586621680181805"><span class="hs-identifier hs-type">args</span></a></span></span><span> </span><span id="local-6989586621680181806"><span class="annot"><a href="#local-6989586621680181806"><span class="hs-identifier hs-type">result</span></a></span></span><span>
</span><span id="line-371"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#KnownActivity"><span class="hs-identifier hs-type">KnownActivity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181805"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181806"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#StartActivityOptions"><span class="hs-identifier hs-type">StartActivityOptions</span></a></span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span>
</span><span id="line-375"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181806"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span id="startActivityFromPayloads"><span class="annot"><span class="annottext">startActivityFromPayloads :: forall (args :: [*]) result.
RequireCallStack =&gt;
KnownActivity args result
-&gt; StartActivityOptions -&gt; Vector Payload -&gt; Workflow (Task result)
</span><a href="Temporal.Workflow.html#startActivityFromPayloads"><span class="hs-identifier hs-var hs-var">startActivityFromPayloads</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#KnownActivity"><span class="hs-identifier hs-type">KnownActivity</span></a></span><span> </span><span id="local-6989586621680183036"><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680183036"><span class="hs-identifier hs-var">codec</span></a></span></span><span> </span><span id="local-6989586621680183037"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680183037"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680183038"><span class="annot"><span class="annottext">StartActivityOptions
</span><a href="#local-6989586621680183038"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621680183039"><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680183039"><span class="hs-identifier hs-var">typedPayloads</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstanceM (Task result) -&gt; Workflow (Task result)
forall a. RequireCallStack =&gt; InstanceM a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#ilift"><span class="hs-identifier hs-var">ilift</span></a></span><span> </span><span class="annot"><span class="annottext">(InstanceM (Task result) -&gt; Workflow (Task result))
-&gt; InstanceM (Task result) -&gt; Workflow (Task result)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-377"></span><span>  </span><span id="local-6989586621680183041"><span class="annot"><a href="#local-6989586621680183041"><span class="hs-identifier hs-var">runInIO</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM (InstanceM (Task Payload) -&gt; IO (Task Payload))
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; m (m a -&gt; IO a)
</span><span class="hs-identifier hs-var">askRunInIO</span></span><span>
</span><span id="line-378"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#updateCallStack"><span class="hs-identifier hs-type">updateCallStack</span></a></span><span>
</span><span id="line-379"></span><span>  </span><span id="local-6989586621680183044"><span class="annot"><a href="#local-6989586621680183044"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ask</span></span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680183046"><span class="hs-identifier hs-type">intercept</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ActivityInput"><span class="hs-identifier hs-type">ActivityInput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ActivityInput"><span class="hs-identifier hs-type">ActivityInput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>      </span><span id="local-6989586621680183046"><span class="annot"><a href="#local-6989586621680183046"><span class="hs-identifier hs-var hs-var">intercept</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkflowInstance
</span><a href="#local-6989586621680183044"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">outboundInterceptor</span><span class="hs-operator">.</span><span class="hs-identifier">scheduleActivity</span><span>
</span><span id="line-382"></span><span>  </span><span id="local-6989586621680183047"><span class="annot"><a href="#local-6989586621680183047"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Common.html#Sequence"><span class="hs-identifier hs-type">Sequence</span></a></span><span> </span><span id="local-6989586621680183049"><span class="annot"><a href="#local-6989586621680183049"><span class="hs-identifier hs-var">actSeq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Instance.html#nextActivitySequence"><span class="hs-identifier hs-type">nextActivitySequence</span></a></span><span>
</span><span id="line-383"></span><span>  </span><span id="local-6989586621680183051"><span class="annot"><a href="#local-6989586621680183051"><span class="hs-identifier hs-var">rawTask</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621680183046"><span class="hs-identifier hs-type">intercept</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ActivityInput"><span class="hs-identifier hs-type">ActivityInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183037"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183039"><span class="hs-identifier hs-type">typedPayloads</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183038"><span class="hs-identifier hs-type">opts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183047"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680183053"><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680183053"><span class="hs-identifier hs-var">activityInput</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InstanceM (Task Payload) -&gt; IO (Task Payload)
</span><a href="#local-6989586621680183041"><span class="hs-identifier hs-var">runInIO</span></a></span><span> </span><span class="annot"><span class="annottext">(InstanceM (Task Payload) -&gt; IO (Task Payload))
-&gt; InstanceM (Task Payload) -&gt; IO (Task Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-384"></span><span>    </span><span id="local-6989586621680183054"><span class="annot"><a href="#local-6989586621680183054"><span class="hs-identifier hs-var">resultSlot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM (IVar ResolveActivity)
forall (m :: * -&gt; *) a. MonadIO m =&gt; m (IVar a)
</span><a href="Temporal.Workflow.Internal.Monad.html#newIVar"><span class="hs-identifier hs-var">newIVar</span></a></span><span>
</span><span id="line-385"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">atomically</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">modifyTVar'</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowSequenceMaps</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680183058"><span class="annot"><span class="annottext">SequenceMaps
</span><a href="#local-6989586621680183058"><span class="hs-identifier hs-var">seqMaps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-386"></span><span>      </span><span class="annot"><span class="annottext">SequenceMaps
</span><a href="#local-6989586621680183058"><span class="hs-identifier hs-var">seqMaps</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#activities"><span class="hs-identifier hs-var">activities</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621680183047"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183054"><span class="hs-identifier hs-type">resultSlot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#activities"><span class="hs-identifier hs-var">activities</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183058"><span class="hs-identifier hs-type">seqMaps</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span>    </span><span id="local-6989586621680183061"><span class="annot"><a href="#local-6989586621680183061"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowInstanceInfo</span><span>
</span><span id="line-389"></span><span>    </span><span id="local-6989586621680183063"><span class="annot"><a href="#local-6989586621680183063"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Payload.html#processorEncodePayloads"><span class="hs-identifier hs-type">processorEncodePayloads</span></a></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">payloadProcessor</span><span> </span><span class="annot"><span class="hs-identifier">activityInput</span></span><span class="hs-operator">.</span><span class="hs-identifier">options</span><span class="hs-operator">.</span><span class="hs-identifier">headers</span><span>
</span><span id="line-390"></span><span>    </span><span id="local-6989586621680183065"><span class="annot"><a href="#local-6989586621680183065"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Payload.html#processorEncodePayloads"><span class="hs-identifier hs-type">processorEncodePayloads</span></a></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">payloadProcessor</span><span> </span><span class="annot"><span class="hs-identifier">activityInput</span></span><span class="hs-operator">.</span><span class="hs-identifier">args</span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680183066"><span class="annot"><a href="#local-6989586621680183066"><span class="hs-identifier hs-var hs-var">actId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (ActivityId -&gt; Text) -&gt; Maybe ActivityId -&gt; Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; String -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621680183049"><span class="hs-identifier hs-var">actSeq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ActivityId -&gt; Text
</span><a href="Temporal.Common.html#rawActivityId"><span class="hs-identifier hs-var">rawActivityId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680183053"><span class="hs-identifier hs-var">activityInput</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">options</span><span class="hs-operator">.</span><span class="hs-identifier">activityId</span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>        </span><span id="local-6989586621680183071"><span class="annot"><a href="#local-6989586621680183071"><span class="hs-identifier hs-var hs-var">scheduleActivity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-393"></span><span>          </span><span class="annot"><span class="annottext">ScheduleActivity
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-394"></span><span>            </span><span class="annot"><span class="annottext">ScheduleActivity
-&gt; (ScheduleActivity -&gt; ScheduleActivity) -&gt; ScheduleActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleActivity Word32
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleActivity Word32
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;seq&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.seq</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleActivity Word32)
-&gt; Word32 -&gt; ScheduleActivity -&gt; ScheduleActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621680183049"><span class="hs-identifier hs-var">actSeq</span></a></span><span>
</span><span id="line-395"></span><span>            </span><span class="annot"><span class="annottext">ScheduleActivity
-&gt; (ScheduleActivity -&gt; ScheduleActivity) -&gt; ScheduleActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleActivity Text
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleActivity Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;activityId&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.activityId</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleActivity Text)
-&gt; Text -&gt; ScheduleActivity -&gt; ScheduleActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680183066"><span class="hs-identifier hs-var">actId</span></a></span><span>
</span><span id="line-396"></span><span>            </span><span class="annot"><span class="annottext">ScheduleActivity
-&gt; (ScheduleActivity -&gt; ScheduleActivity) -&gt; ScheduleActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleActivity Text
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleActivity Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;activityType&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.activityType</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleActivity Text)
-&gt; Text -&gt; ScheduleActivity -&gt; ScheduleActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680183053"><span class="hs-identifier hs-var">activityInput</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">activityType</span><span>
</span><span id="line-397"></span><span>            </span><span class="annot"><span class="annottext">ScheduleActivity
-&gt; (ScheduleActivity -&gt; ScheduleActivity) -&gt; ScheduleActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleActivity Text
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleActivity Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;taskQueue&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.taskQueue</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleActivity Text)
-&gt; Text -&gt; ScheduleActivity -&gt; ScheduleActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">TaskQueue -&gt; Text
</span><a href="Temporal.Common.html#rawTaskQueue"><span class="hs-identifier hs-var">rawTaskQueue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TaskQueue -&gt; Maybe TaskQueue -&gt; TaskQueue
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621680183061"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">taskQueue</span><span> </span><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680183053"><span class="hs-identifier hs-var">activityInput</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">options</span><span class="hs-operator">.</span><span class="hs-identifier">taskQueue</span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>            </span><span class="annot"><span class="annottext">ScheduleActivity
-&gt; (ScheduleActivity -&gt; ScheduleActivity) -&gt; ScheduleActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleActivity (Map Text Payload)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleActivity (Map Text Payload)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;headers&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.headers</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleActivity (Map Text Payload))
-&gt; Map Text Payload -&gt; ScheduleActivity -&gt; ScheduleActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">(Payload -&gt; Payload) -&gt; Map Text Payload -&gt; Map Text Payload
forall a b. (a -&gt; b) -&gt; Map Text a -&gt; Map Text b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Payload -&gt; Payload
</span><a href="Temporal.Payload.html#convertToProtoPayload"><span class="hs-identifier hs-var">convertToProtoPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Payload
</span><a href="#local-6989586621680183063"><span class="hs-identifier hs-var">hdrs</span></a></span><span>
</span><span id="line-399"></span><span>            </span><span class="annot"><span class="annottext">ScheduleActivity
-&gt; (ScheduleActivity -&gt; ScheduleActivity) -&gt; ScheduleActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleActivity (Vector Payload)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleActivity (Vector Payload)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;vec'arguments&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.vec'arguments</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleActivity (Vector Payload))
-&gt; Vector Payload -&gt; ScheduleActivity -&gt; ScheduleActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">(Payload -&gt; Payload) -&gt; Vector Payload -&gt; Vector Payload
forall a b. (a -&gt; b) -&gt; Vector a -&gt; Vector b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Payload -&gt; Payload
</span><a href="Temporal.Payload.html#convertToProtoPayload"><span class="hs-identifier hs-var">convertToProtoPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680183065"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-400"></span><span>            </span><span class="annot"><span class="annottext">ScheduleActivity
-&gt; (ScheduleActivity -&gt; ScheduleActivity) -&gt; ScheduleActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleActivity (Maybe RetryPolicy)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleActivity (Maybe RetryPolicy)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;maybe'retryPolicy&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.maybe'retryPolicy</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleActivity (Maybe RetryPolicy))
-&gt; Maybe RetryPolicy -&gt; ScheduleActivity -&gt; ScheduleActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">(RetryPolicy -&gt; RetryPolicy)
-&gt; Maybe RetryPolicy -&gt; Maybe RetryPolicy
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">RetryPolicy -&gt; RetryPolicy
</span><a href="Temporal.Common.html#retryPolicyToProto"><span class="hs-identifier hs-var">retryPolicyToProto</span></a></span><span> </span><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680183053"><span class="hs-identifier hs-var">activityInput</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">options</span><span class="hs-operator">.</span><span class="hs-identifier">retryPolicy</span><span>
</span><span id="line-401"></span><span>            </span><span class="annot"><span class="annottext">ScheduleActivity
-&gt; (ScheduleActivity -&gt; ScheduleActivity) -&gt; ScheduleActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleActivity ActivityCancellationType
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleActivity ActivityCancellationType
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;cancellationType&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.cancellationType</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleActivity ActivityCancellationType)
-&gt; ActivityCancellationType -&gt; ScheduleActivity -&gt; ScheduleActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">ActivityCancellationType -&gt; ActivityCancellationType
</span><a href="Temporal.Workflow.WorkflowInstance.html#activityCancellationTypeToProto"><span class="hs-identifier hs-var">activityCancellationTypeToProto</span></a></span><span> </span><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680183053"><span class="hs-identifier hs-var">activityInput</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">options</span><span class="hs-operator">.</span><span class="hs-identifier">cancellationType</span><span>
</span><span id="line-402"></span><span>            </span><span class="annot"><span class="annottext">ScheduleActivity
-&gt; (ScheduleActivity -&gt; ScheduleActivity) -&gt; ScheduleActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleActivity (Maybe Duration)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleActivity (Maybe Duration)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;maybe'scheduleToStartTimeout&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.maybe'scheduleToStartTimeout</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleActivity (Maybe Duration))
-&gt; Maybe Duration -&gt; ScheduleActivity -&gt; ScheduleActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">(Duration -&gt; Duration) -&gt; Maybe Duration -&gt; Maybe Duration
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Duration -&gt; Duration
</span><a href="Temporal.Duration.html#durationToProto"><span class="hs-identifier hs-var">durationToProto</span></a></span><span> </span><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680183053"><span class="hs-identifier hs-var">activityInput</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">options</span><span class="hs-operator">.</span><span class="hs-identifier">scheduleToStartTimeout</span><span>
</span><span id="line-403"></span><span>            </span><span class="annot"><span class="annottext">ScheduleActivity
-&gt; (ScheduleActivity -&gt; ScheduleActivity) -&gt; ScheduleActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleActivity (Maybe Duration)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleActivity (Maybe Duration)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;maybe'heartbeatTimeout&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.maybe'heartbeatTimeout</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleActivity (Maybe Duration))
-&gt; Maybe Duration -&gt; ScheduleActivity -&gt; ScheduleActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">(Duration -&gt; Duration) -&gt; Maybe Duration -&gt; Maybe Duration
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Duration -&gt; Duration
</span><a href="Temporal.Duration.html#durationToProto"><span class="hs-identifier hs-var">durationToProto</span></a></span><span> </span><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680183053"><span class="hs-identifier hs-var">activityInput</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">options</span><span class="hs-operator">.</span><span class="hs-identifier">heartbeatTimeout</span><span>
</span><span id="line-404"></span><span>            </span><span class="annot"><span class="annottext">ScheduleActivity
-&gt; (ScheduleActivity -&gt; ScheduleActivity) -&gt; ScheduleActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680183152"><span class="annot"><span class="annottext">ScheduleActivity
</span><a href="#local-6989586621680183152"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-405"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680183053"><span class="hs-identifier hs-var">activityInput</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">options</span><span class="hs-operator">.</span><span class="hs-identifier">timeout</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-406"></span><span>                </span><span class="annot"><a href="Temporal.Workflow.Types.html#StartToCloseTimeout"><span class="hs-identifier hs-type">StartToCloseTimeout</span></a></span><span> </span><span id="local-6989586621680183154"><span class="annot"><span class="annottext">Duration
</span><a href="#local-6989586621680183154"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScheduleActivity
</span><a href="#local-6989586621680183152"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduleActivity
-&gt; (ScheduleActivity -&gt; ScheduleActivity) -&gt; ScheduleActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleActivity Duration
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleActivity Duration
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;startToCloseTimeout&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.startToCloseTimeout</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleActivity Duration)
-&gt; Duration -&gt; ScheduleActivity -&gt; ScheduleActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Duration -&gt; Duration
</span><a href="Temporal.Duration.html#durationToProto"><span class="hs-identifier hs-var">durationToProto</span></a></span><span> </span><span class="annot"><span class="annottext">Duration
</span><a href="#local-6989586621680183154"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-407"></span><span>                </span><span class="annot"><a href="Temporal.Workflow.Types.html#ScheduleToCloseTimeout"><span class="hs-identifier hs-type">ScheduleToCloseTimeout</span></a></span><span> </span><span id="local-6989586621680183163"><span class="annot"><span class="annottext">Duration
</span><a href="#local-6989586621680183163"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScheduleActivity
</span><a href="#local-6989586621680183152"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">ScheduleActivity
-&gt; (ScheduleActivity -&gt; ScheduleActivity) -&gt; ScheduleActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleActivity Duration
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleActivity Duration
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;scheduleToCloseTimeout&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.scheduleToCloseTimeout</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleActivity Duration)
-&gt; Duration -&gt; ScheduleActivity -&gt; ScheduleActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Duration -&gt; Duration
</span><a href="Temporal.Duration.html#durationToProto"><span class="hs-identifier hs-var">durationToProto</span></a></span><span> </span><span class="annot"><span class="annottext">Duration
</span><a href="#local-6989586621680183163"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-408"></span><span>                </span><span class="annot"><a href="Temporal.Workflow.Types.html#StartToCloseAndScheduleToCloseTimeout"><span class="hs-identifier hs-type">StartToCloseAndScheduleToCloseTimeout</span></a></span><span> </span><span id="local-6989586621680183172"><span class="annot"><span class="annottext">Duration
</span><a href="#local-6989586621680183172"><span class="hs-identifier hs-var">stc</span></a></span></span><span> </span><span id="local-6989586621680183173"><span class="annot"><span class="annottext">Duration
</span><a href="#local-6989586621680183173"><span class="hs-identifier hs-var">stc'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-409"></span><span>                  </span><span class="annot"><span class="annottext">ScheduleActivity
</span><a href="#local-6989586621680183152"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-410"></span><span>                    </span><span class="annot"><span class="annottext">ScheduleActivity
-&gt; (ScheduleActivity -&gt; ScheduleActivity) -&gt; ScheduleActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleActivity Duration
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleActivity Duration
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;startToCloseTimeout&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.startToCloseTimeout</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleActivity Duration)
-&gt; Duration -&gt; ScheduleActivity -&gt; ScheduleActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Duration -&gt; Duration
</span><a href="Temporal.Duration.html#durationToProto"><span class="hs-identifier hs-var">durationToProto</span></a></span><span> </span><span class="annot"><span class="annottext">Duration
</span><a href="#local-6989586621680183172"><span class="hs-identifier hs-var">stc</span></a></span><span>
</span><span id="line-411"></span><span>                    </span><span class="annot"><span class="annottext">ScheduleActivity
-&gt; (ScheduleActivity -&gt; ScheduleActivity) -&gt; ScheduleActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleActivity Duration
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleActivity Duration
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;scheduleToCloseTimeout&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.scheduleToCloseTimeout</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleActivity Duration)
-&gt; Duration -&gt; ScheduleActivity -&gt; ScheduleActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Duration -&gt; Duration
</span><a href="Temporal.Duration.html#durationToProto"><span class="hs-identifier hs-var">durationToProto</span></a></span><span> </span><span class="annot"><span class="annottext">Duration
</span><a href="#local-6989586621680183173"><span class="hs-identifier hs-var">stc'</span></a></span><span>
</span><span id="line-412"></span><span>                </span><span class="annot"><span class="annottext">ScheduleActivity
-&gt; (ScheduleActivity -&gt; ScheduleActivity) -&gt; ScheduleActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleActivity Bool
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleActivity Bool
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;doNotEagerlyExecute&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.doNotEagerlyExecute</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleActivity Bool)
-&gt; Bool -&gt; ScheduleActivity -&gt; ScheduleActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680183053"><span class="hs-identifier hs-var">activityInput</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">options</span><span class="hs-operator">.</span><span class="hs-identifier">disableEagerExecution</span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680183191"><span class="annot"><a href="#local-6989586621680183191"><span class="hs-identifier hs-var hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkflowCommand
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span> </span><span class="annot"><span class="annottext">WorkflowCommand
-&gt; (WorkflowCommand -&gt; WorkflowCommand) -&gt; WorkflowCommand
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f WorkflowCommand ScheduleActivity
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f WorkflowCommand ScheduleActivity
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;scheduleActivity&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.scheduleActivity</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f WorkflowCommand ScheduleActivity)
-&gt; ScheduleActivity -&gt; WorkflowCommand -&gt; WorkflowCommand
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">ScheduleActivity
</span><a href="#local-6989586621680183071"><span class="hs-identifier hs-var">scheduleActivity</span></a></span><span>
</span><span id="line-415"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#addCommand"><span class="hs-identifier hs-type">addCommand</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183191"><span class="hs-identifier hs-type">cmd</span></a></span><span>
</span><span id="line-416"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-417"></span><span>      </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span>
</span><span id="line-418"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#waitAction"><span class="hs-identifier hs-var">waitAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-419"></span><span>            </span><span id="local-6989586621680183202"><span class="annot"><a href="#local-6989586621680183202"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#getIVar"><span class="hs-identifier hs-type">getIVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183054"><span class="hs-identifier hs-type">resultSlot</span></a></span><span>
</span><span id="line-420"></span><span>            </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">logInfo</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;Activity result: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621680183202"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>            </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ResolveActivity
</span><a href="#local-6989586621680183202"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">ResolveActivity
-&gt; FoldLike
     (Maybe ActivityResolution'Status)
     ResolveActivity
     ResolveActivity
     (Maybe ActivityResolution'Status)
     (Maybe ActivityResolution'Status)
-&gt; Maybe ActivityResolution'Status
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">LensLike'
  (Constant (Maybe ActivityResolution'Status))
  ResolveActivity
  ActivityResolution
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;result&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Activation.result</span></span><span> </span><span class="annot"><span class="annottext">LensLike'
  (Constant (Maybe ActivityResolution'Status))
  ResolveActivity
  ActivityResolution
-&gt; ((Maybe ActivityResolution'Status
     -&gt; Constant
          (Maybe ActivityResolution'Status)
          (Maybe ActivityResolution'Status))
    -&gt; ActivityResolution
    -&gt; Constant (Maybe ActivityResolution'Status) ActivityResolution)
-&gt; FoldLike
     (Maybe ActivityResolution'Status)
     ResolveActivity
     ResolveActivity
     (Maybe ActivityResolution'Status)
     (Maybe ActivityResolution'Status)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ActivityResolution'Status
 -&gt; Constant
      (Maybe ActivityResolution'Status)
      (Maybe ActivityResolution'Status))
-&gt; ActivityResolution
-&gt; Constant (Maybe ActivityResolution'Status) ActivityResolution
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;maybe'status&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">ActivityResult.maybe'status</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-422"></span><span>              </span><span class="annot"><span class="annottext">Maybe ActivityResolution'Status
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; InstanceM (Result Payload)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Activity result missing status&quot;</span></span><span>
</span><span id="line-423"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ActivityResult.ActivityResolution'Completed</span></span><span> </span><span id="local-6989586621680183215"><span class="annot"><span class="annottext">Success
</span><a href="#local-6989586621680183215"><span class="hs-identifier hs-var">success</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-424"></span><span>                </span><span id="local-6989586621680183216"><span class="annot"><a href="#local-6989586621680183216"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either String Payload) -&gt; InstanceM (Either String Payload)
forall a. IO a -&gt; InstanceM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either String Payload) -&gt; InstanceM (Either String Payload))
-&gt; IO (Either String Payload) -&gt; InstanceM (Either String Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PayloadProcessor -&gt; Payload -&gt; IO (Either String Payload)
</span><a href="Temporal.Payload.html#payloadProcessorDecode"><span class="hs-identifier hs-var">payloadProcessorDecode</span></a></span><span> </span><span class="annot"><span class="annottext">WorkflowInstance
</span><a href="#local-6989586621680183044"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">payloadProcessor</span><span> </span><span class="annot"><span class="annottext">(Payload -&gt; IO (Either String Payload))
-&gt; Payload -&gt; IO (Either String Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Payload -&gt; Payload
</span><a href="Temporal.Payload.html#convertFromProtoPayload"><span class="hs-identifier hs-var">convertFromProtoPayload</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Success
</span><a href="#local-6989586621680183215"><span class="hs-identifier hs-var">success</span></a></span><span> </span><span class="annot"><span class="annottext">Success
-&gt; FoldLike Payload Success Success Payload Payload -&gt; Payload
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">FoldLike Payload Success Success Payload Payload
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;result&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">ActivityResult.result</span></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680183216"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-426"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680183220"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680183220"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Result Payload
forall a. SomeException -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-var">Throw</span></a></span><span> </span><span class="annot"><span class="annottext">(SomeException -&gt; Result Payload)
-&gt; SomeException -&gt; Result Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ValueError -&gt; SomeException
forall e. Exception e =&gt; e -&gt; SomeException
</span><span class="hs-identifier hs-var">toException</span></span><span> </span><span class="annot"><span class="annottext">(ValueError -&gt; SomeException) -&gt; ValueError -&gt; SomeException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ValueError
</span><a href="Temporal.Payload.html#ValueError"><span class="hs-identifier hs-var">ValueError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680183220"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-427"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680183224"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621680183224"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Payload -&gt; Result Payload
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621680183224"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-428"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ActivityResult.ActivityResolution'Failed</span></span><span> </span><span id="local-6989586621680183227"><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680183227"><span class="hs-identifier hs-var">failure_</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-429"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680183228"><span class="annot"><span class="annottext">failure :: Failure
</span><a href="#local-6989586621680183228"><span class="hs-identifier hs-var hs-var">failure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680183227"><span class="hs-identifier hs-var">failure_</span></a></span><span> </span><span class="annot"><span class="annottext">Failure
-&gt; FoldLike Failure Failure Failure Failure Failure -&gt; Failure
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">FoldLike Failure Failure Failure Failure Failure
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;failure&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">ActivityResult.failure</span></span><span>
</span><span id="line-430"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Result Payload -&gt; InstanceM (Result Payload)
forall a. a -&gt; InstanceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Result Payload -&gt; InstanceM (Result Payload))
-&gt; Result Payload -&gt; InstanceM (Result Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-431"></span><span>                    </span><span class="annot"><span class="annottext">SomeException -&gt; Result Payload
forall a. SomeException -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-var">Throw</span></a></span><span> </span><span class="annot"><span class="annottext">(SomeException -&gt; Result Payload)
-&gt; SomeException -&gt; Result Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-432"></span><span>                      </span><span class="annot"><span class="annottext">ActivityFailure -&gt; SomeException
forall e. Exception e =&gt; e -&gt; SomeException
</span><span class="hs-identifier hs-var">toException</span></span><span> </span><span class="annot"><span class="annottext">(ActivityFailure -&gt; SomeException)
-&gt; ActivityFailure -&gt; SomeException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-433"></span><span>                        </span><span class="annot"><a href="Temporal.Exception.html#ActivityFailure"><span class="hs-identifier hs-type">ActivityFailure</span></a></span><span>
</span><span id="line-434"></span><span>                          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">message :: Text
</span><a href="#local-6989586621680183231"><span class="hs-identifier hs-var">message</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680183228"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">Failure -&gt; FoldLike Text Failure Failure Text Text -&gt; Text
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">FoldLike Text Failure Failure Text Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;message&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.message</span></span><span>
</span><span id="line-435"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">activityType :: ActivityType
</span><a href="#local-6989586621680183233"><span class="hs-identifier hs-var">activityType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ActivityType
</span><a href="Temporal.Common.html#ActivityType"><span class="hs-identifier hs-var">ActivityType</span></a></span><span> </span><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680183053"><span class="hs-identifier hs-var">activityInput</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">activityType</span><span>
</span><span id="line-436"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">activityId :: ActivityId
</span><a href="#local-6989586621680183235"><span class="hs-identifier hs-var">activityId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ActivityId
</span><a href="Temporal.Common.html#ActivityId"><span class="hs-identifier hs-var">ActivityId</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680183066"><span class="hs-identifier hs-var">actId</span></a></span><span>
</span><span id="line-437"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">retryState :: RetryState
</span><a href="#local-6989586621680183237"><span class="hs-identifier hs-var">retryState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RetryState -&gt; RetryState
</span><a href="Temporal.Common.html#retryStateFromProto"><span class="hs-identifier hs-var">retryStateFromProto</span></a></span><span> </span><span class="annot"><span class="annottext">(RetryState -&gt; RetryState) -&gt; RetryState -&gt; RetryState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680183228"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">Failure
-&gt; FoldLike RetryState Failure Failure RetryState RetryState
-&gt; RetryState
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant RetryState) Failure ActivityFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;activityFailureInfo&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.activityFailureInfo</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant RetryState) Failure ActivityFailureInfo
-&gt; ((RetryState -&gt; Constant RetryState RetryState)
    -&gt; ActivityFailureInfo -&gt; Constant RetryState ActivityFailureInfo)
-&gt; FoldLike RetryState Failure Failure RetryState RetryState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(RetryState -&gt; Constant RetryState RetryState)
-&gt; ActivityFailureInfo -&gt; Constant RetryState ActivityFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;retryState&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.retryState</span></span><span>
</span><span id="line-438"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">identity :: Text
</span><a href="#local-6989586621680183241"><span class="hs-identifier hs-var">identity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680183228"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">Failure -&gt; FoldLike Text Failure Failure Text Text -&gt; Text
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Text) Failure ActivityFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;activityFailureInfo&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.activityFailureInfo</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Text) Failure ActivityFailureInfo
-&gt; ((Text -&gt; Constant Text Text)
    -&gt; ActivityFailureInfo -&gt; Constant Text ActivityFailureInfo)
-&gt; FoldLike Text Failure Failure Text Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Constant Text Text)
-&gt; ActivityFailureInfo -&gt; Constant Text ActivityFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;identity&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.identity</span></span><span>
</span><span id="line-439"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cause :: ApplicationFailure
</span><a href="#local-6989586621680183243"><span class="hs-identifier hs-var">cause</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-440"></span><span>                              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680183244"><span class="annot"><span class="annottext">cause_ :: Failure
</span><a href="#local-6989586621680183244"><span class="hs-identifier hs-var hs-var">cause_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680183228"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">Failure
-&gt; FoldLike Failure Failure Failure Failure Failure -&gt; Failure
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">FoldLike Failure Failure Failure Failure Failure
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;cause&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.cause</span></span><span>
</span><span id="line-441"></span><span>                              </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="Temporal.Exception.html#ApplicationFailure"><span class="hs-identifier hs-type">ApplicationFailure</span></a></span><span>
</span><span id="line-442"></span><span>                                  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">type' :: Text
</span><a href="#local-6989586621680183247"><span class="hs-identifier hs-var">type'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680183244"><span class="hs-identifier hs-var">cause_</span></a></span><span> </span><span class="annot"><span class="annottext">Failure -&gt; FoldLike Text Failure Failure Text Text -&gt; Text
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Text) Failure ApplicationFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;applicationFailureInfo&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.applicationFailureInfo</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Text) Failure ApplicationFailureInfo
-&gt; ((Text -&gt; Constant Text Text)
    -&gt; ApplicationFailureInfo -&gt; Constant Text ApplicationFailureInfo)
-&gt; FoldLike Text Failure Failure Text Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Constant Text Text)
-&gt; ApplicationFailureInfo -&gt; Constant Text ApplicationFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;type'&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.type'</span></span><span>
</span><span id="line-443"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">message :: Text
</span><a href="#local-6989586621680183250"><span class="hs-identifier hs-var">message</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680183244"><span class="hs-identifier hs-var">cause_</span></a></span><span> </span><span class="annot"><span class="annottext">Failure -&gt; FoldLike Text Failure Failure Text Text -&gt; Text
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">FoldLike Text Failure Failure Text Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;message&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.message</span></span><span>
</span><span id="line-444"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nonRetryable :: Bool
</span><a href="#local-6989586621680183251"><span class="hs-identifier hs-var">nonRetryable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680183244"><span class="hs-identifier hs-var">cause_</span></a></span><span> </span><span class="annot"><span class="annottext">Failure -&gt; FoldLike Bool Failure Failure Bool Bool -&gt; Bool
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Bool) Failure ApplicationFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;applicationFailureInfo&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.applicationFailureInfo</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Bool) Failure ApplicationFailureInfo
-&gt; ((Bool -&gt; Constant Bool Bool)
    -&gt; ApplicationFailureInfo -&gt; Constant Bool ApplicationFailureInfo)
-&gt; FoldLike Bool Failure Failure Bool Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Constant Bool Bool)
-&gt; ApplicationFailureInfo -&gt; Constant Bool ApplicationFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;nonRetryable&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.nonRetryable</span></span><span>
</span><span id="line-445"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">details :: [Payload]
</span><a href="#local-6989586621680183253"><span class="hs-identifier hs-var">details</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680183244"><span class="hs-identifier hs-var">cause_</span></a></span><span> </span><span class="annot"><span class="annottext">Failure
-&gt; FoldLike [Payload] Failure Failure [Payload] Any -&gt; [Payload]
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant [Payload]) Failure ApplicationFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;applicationFailureInfo&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.applicationFailureInfo</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant [Payload]) Failure ApplicationFailureInfo
-&gt; (([Payload] -&gt; Constant [Payload] Any)
    -&gt; ApplicationFailureInfo
    -&gt; Constant [Payload] ApplicationFailureInfo)
-&gt; FoldLike [Payload] Failure Failure [Payload] Any
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant [Payload]) ApplicationFailureInfo Payloads
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;details&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.details</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant [Payload]) ApplicationFailureInfo Payloads
-&gt; (([Payload] -&gt; Constant [Payload] Any)
    -&gt; Payloads -&gt; Constant [Payload] Payloads)
-&gt; ([Payload] -&gt; Constant [Payload] Any)
-&gt; ApplicationFailureInfo
-&gt; Constant [Payload] ApplicationFailureInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant [Payload]) Payloads [Payload]
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;payloads&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Payloads.payloads</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant [Payload]) Payloads [Payload]
-&gt; (([Payload] -&gt; Constant [Payload] Any)
    -&gt; [Payload] -&gt; Constant [Payload] [Payload])
-&gt; ([Payload] -&gt; Constant [Payload] Any)
-&gt; Payloads
-&gt; Constant [Payload] Payloads
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([Payload] -&gt; [Payload])
-&gt; Getter [Payload] [Payload] [Payload] Any
forall s a t b. (s -&gt; a) -&gt; Getter s t a b
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Payload -&gt; Payload) -&gt; [Payload] -&gt; [Payload]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Payload -&gt; Payload
</span><a href="Temporal.Payload.html#convertFromProtoPayload"><span class="hs-identifier hs-var">convertFromProtoPayload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stack :: Text
</span><a href="#local-6989586621680183257"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680183244"><span class="hs-identifier hs-var">cause_</span></a></span><span> </span><span class="annot"><span class="annottext">Failure -&gt; FoldLike Text Failure Failure Text Text -&gt; Text
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">FoldLike Text Failure Failure Text Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;stackTrace&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.stackTrace</span></span><span>
</span><span id="line-447"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nextRetryDelay :: Maybe Duration
</span><a href="#local-6989586621680183259"><span class="hs-identifier hs-var">nextRetryDelay</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Duration -&gt; Duration) -&gt; Maybe Duration -&gt; Maybe Duration
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Duration -&gt; Duration
</span><a href="Temporal.Duration.html#durationFromProto"><span class="hs-identifier hs-var">durationFromProto</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680183244"><span class="hs-identifier hs-var">cause_</span></a></span><span> </span><span class="annot"><span class="annottext">Failure
-&gt; FoldLike
     (Maybe Duration) Failure Failure (Maybe Duration) (Maybe Duration)
-&gt; Maybe Duration
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">LensLike'
  (Constant (Maybe Duration)) Failure ApplicationFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;applicationFailureInfo&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.applicationFailureInfo</span></span><span> </span><span class="annot"><span class="annottext">LensLike'
  (Constant (Maybe Duration)) Failure ApplicationFailureInfo
-&gt; ((Maybe Duration -&gt; Constant (Maybe Duration) (Maybe Duration))
    -&gt; ApplicationFailureInfo
    -&gt; Constant (Maybe Duration) ApplicationFailureInfo)
-&gt; FoldLike
     (Maybe Duration) Failure Failure (Maybe Duration) (Maybe Duration)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Duration -&gt; Constant (Maybe Duration) (Maybe Duration))
-&gt; ApplicationFailureInfo
-&gt; Constant (Maybe Duration) ApplicationFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;maybe'nextRetryDelay&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.maybe'nextRetryDelay</span></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>                                  </span><span class="hs-special">}</span><span>
</span><span id="line-449"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">scheduledEventId :: Int64
</span><a href="#local-6989586621680183261"><span class="hs-identifier hs-var">scheduledEventId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680183228"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">Failure -&gt; FoldLike Int64 Failure Failure Int64 Int64 -&gt; Int64
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Int64) Failure ActivityFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;activityFailureInfo&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.activityFailureInfo</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Int64) Failure ActivityFailureInfo
-&gt; ((Int64 -&gt; Constant Int64 Int64)
    -&gt; ActivityFailureInfo -&gt; Constant Int64 ActivityFailureInfo)
-&gt; FoldLike Int64 Failure Failure Int64 Int64
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int64 -&gt; Constant Int64 Int64)
-&gt; ActivityFailureInfo -&gt; Constant Int64 ActivityFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;scheduledEventId&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.scheduledEventId</span></span><span>
</span><span id="line-450"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">startedEventId :: Int64
</span><a href="#local-6989586621680183263"><span class="hs-identifier hs-var">startedEventId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680183228"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">Failure -&gt; FoldLike Int64 Failure Failure Int64 Int64 -&gt; Int64
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Int64) Failure ActivityFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;activityFailureInfo&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.activityFailureInfo</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Int64) Failure ActivityFailureInfo
-&gt; ((Int64 -&gt; Constant Int64 Int64)
    -&gt; ActivityFailureInfo -&gt; Constant Int64 ActivityFailureInfo)
-&gt; FoldLike Int64 Failure Failure Int64 Int64
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int64 -&gt; Constant Int64 Int64)
-&gt; ActivityFailureInfo -&gt; Constant Int64 ActivityFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;startedEventId&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.startedEventId</span></span><span>
</span><span id="line-451"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">original :: ActivityFailureInfo
</span><a href="#local-6989586621680183265"><span class="hs-identifier hs-var">original</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680183228"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">Failure
-&gt; FoldLike
     ActivityFailureInfo
     Failure
     Failure
     ActivityFailureInfo
     ActivityFailureInfo
-&gt; ActivityFailureInfo
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">FoldLike
  ActivityFailureInfo
  Failure
  Failure
  ActivityFailureInfo
  ActivityFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;activityFailureInfo&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.activityFailureInfo</span></span><span>
</span><span id="line-452"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stack :: Text
</span><a href="#local-6989586621680183266"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; String -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CallStack -&gt; String
</span><a href="Temporal.Exception.html#prettyCallStack"><span class="hs-identifier hs-var">Temporal.Exception.prettyCallStack</span></a></span><span> </span><span class="annot"><span class="annottext">CallStack
HasCallStack =&gt; CallStack
</span><span class="hs-identifier hs-var">callStack</span></span><span>
</span><span id="line-453"></span><span>                          </span><span class="hs-special">}</span><span>
</span><span id="line-454"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ActivityResult.ActivityResolution'Cancelled</span></span><span> </span><span id="local-6989586621680183270"><span class="annot"><span class="annottext">Cancellation
</span><a href="#local-6989586621680183270"><span class="hs-identifier hs-var">details</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result Payload -&gt; InstanceM (Result Payload)
forall a. a -&gt; InstanceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Result Payload -&gt; InstanceM (Result Payload))
-&gt; Result Payload -&gt; InstanceM (Result Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Result Payload
forall a. SomeException -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-var">Throw</span></a></span><span> </span><span class="annot"><span class="annottext">(SomeException -&gt; Result Payload)
-&gt; SomeException -&gt; Result Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ActivityCancelled -&gt; SomeException
forall e. Exception e =&gt; e -&gt; SomeException
</span><span class="hs-identifier hs-var">toException</span></span><span> </span><span class="annot"><span class="annottext">(ActivityCancelled -&gt; SomeException)
-&gt; ActivityCancelled -&gt; SomeException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Failure -&gt; ActivityCancelled
</span><a href="Temporal.Exception.html#ActivityCancelled"><span class="hs-identifier hs-var">ActivityCancelled</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cancellation
</span><a href="#local-6989586621680183270"><span class="hs-identifier hs-var">details</span></a></span><span> </span><span class="annot"><span class="annottext">Cancellation
-&gt; FoldLike Failure Cancellation Cancellation Failure Failure
-&gt; Failure
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">FoldLike Failure Cancellation Cancellation Failure Failure
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;failure&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">ActivityResult.failure</span></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ActivityResult.ActivityResolution'Backoff</span></span><span> </span><span id="local-6989586621680183273"><span class="annot"><span class="annottext">DoBackoff
</span><a href="#local-6989586621680183273"><span class="hs-identifier hs-var">_doBackoff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; InstanceM (Result Payload)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;not implemented&quot;</span></span><span>
</span><span id="line-456"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#cancelAction"><span class="hs-identifier hs-var">cancelAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-457"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680183275"><span class="annot"><a href="#local-6989586621680183275"><span class="hs-identifier hs-var hs-var">cancelCmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-458"></span><span>                  </span><span class="annot"><span class="annottext">WorkflowCommand
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-459"></span><span>                    </span><span class="annot"><span class="annottext">WorkflowCommand
-&gt; (WorkflowCommand -&gt; WorkflowCommand) -&gt; WorkflowCommand
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f WorkflowCommand RequestCancelActivity
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f WorkflowCommand RequestCancelActivity
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;requestCancelActivity&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.requestCancelActivity</span></span><span>
</span><span id="line-460"></span><span>                      </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f WorkflowCommand RequestCancelActivity)
-&gt; RequestCancelActivity -&gt; WorkflowCommand -&gt; WorkflowCommand
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">RequestCancelActivity
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-461"></span><span>                            </span><span class="annot"><span class="annottext">RequestCancelActivity
-&gt; (RequestCancelActivity -&gt; RequestCancelActivity)
-&gt; RequestCancelActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f RequestCancelActivity Word32
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f RequestCancelActivity Word32
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;seq&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.seq</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f RequestCancelActivity Word32)
-&gt; Word32 -&gt; RequestCancelActivity -&gt; RequestCancelActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621680183049"><span class="hs-identifier hs-var">actSeq</span></a></span><span>
</span><span id="line-462"></span><span>                         </span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>            </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ilift"><span class="hs-identifier hs-type">ilift</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#addCommand"><span class="hs-identifier hs-type">addCommand</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183275"><span class="hs-identifier hs-type">cancelCmd</span></a></span><span>
</span><span id="line-464"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-465"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span>
</span><span id="line-466"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621680183051"><span class="hs-identifier hs-type">rawTask</span></a></span><span>
</span><span id="line-467"></span><span>        </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#bindTask"><span class="hs-operator hs-type">`bindTask`</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680183290"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621680183290"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result result)) -&gt; Workflow result
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result result)) -&gt; Workflow result)
-&gt; (ContinuationEnv -&gt; InstanceM (Result result))
-&gt; Workflow result
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-468"></span><span>                      </span><span id="local-6989586621680183291"><span class="annot"><a href="#local-6989586621680183291"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either String result) -&gt; InstanceM (Either String result)
forall a. IO a -&gt; InstanceM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either String result) -&gt; InstanceM (Either String result))
-&gt; IO (Either String result) -&gt; InstanceM (Either String result)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">codec -&gt; Payload -&gt; IO (Either String result)
forall fmt a. Codec fmt a =&gt; fmt -&gt; Payload -&gt; IO (Either String a)
</span><a href="Temporal.Payload.html#decode"><span class="hs-identifier hs-var">decode</span></a></span><span> </span><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680183036"><span class="hs-identifier hs-var">codec</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621680183290"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-469"></span><span>                      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680183291"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-470"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680183293"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680183293"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result result -&gt; InstanceM (Result result)
forall a. a -&gt; InstanceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Result result -&gt; InstanceM (Result result))
-&gt; Result result -&gt; InstanceM (Result result)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Result result
forall a. SomeException -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-var">Throw</span></a></span><span> </span><span class="annot"><span class="annottext">(SomeException -&gt; Result result) -&gt; SomeException -&gt; Result result
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ValueError -&gt; SomeException
forall e. Exception e =&gt; e -&gt; SomeException
</span><span class="hs-identifier hs-var">toException</span></span><span> </span><span class="annot"><span class="annottext">(ValueError -&gt; SomeException) -&gt; ValueError -&gt; SomeException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ValueError
</span><a href="Temporal.Payload.html#ValueError"><span class="hs-identifier hs-var">ValueError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680183293"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-471"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680183294"><span class="annot"><span class="annottext">result
</span><a href="#local-6989586621680183294"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result result -&gt; InstanceM (Result result)
forall a. a -&gt; InstanceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Result result -&gt; InstanceM (Result result))
-&gt; Result result -&gt; InstanceM (Result result)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">result -&gt; Result result
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">result
</span><a href="#local-6989586621680183294"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-472"></span><span>                   </span><span class="hs-special">)</span><span>
</span><span id="line-473"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span class="annot"><a href="Temporal.Workflow.html#startActivity"><span class="hs-identifier hs-type">startActivity</span></a></span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680182048"><span class="annot"><a href="#local-6989586621680182048"><span class="hs-identifier hs-type">activity</span></a></span></span><span>
</span><span id="line-478"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityRef"><span class="hs-identifier hs-type">ActivityRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182048"><span class="hs-identifier hs-type">activity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182048"><span class="hs-identifier hs-type">activity</span></a></span><span>
</span><span id="line-480"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#StartActivityOptions"><span class="hs-identifier hs-type">StartActivityOptions</span></a></span><span>
</span><span id="line-481"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityArgs"><span class="hs-identifier hs-type">ActivityArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182048"><span class="hs-identifier hs-type">activity</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#%3A-%3E%3A"><span class="hs-operator hs-type">:-&gt;:</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityResult"><span class="hs-identifier hs-type">ActivityResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182048"><span class="hs-identifier hs-type">activity</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span id="startActivity"><span class="annot"><span class="annottext">startActivity :: forall activity.
(RequireCallStack, ActivityRef activity) =&gt;
activity
-&gt; StartActivityOptions
-&gt; ActivityArgs activity
   :-&gt;: Workflow (Task (ActivityResult activity))
</span><a href="Temporal.Workflow.html#startActivity"><span class="hs-identifier hs-var hs-var">startActivity</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">activity
-&gt; KnownActivity (ActivityArgs activity) (ActivityResult activity)
forall f.
ActivityRef f =&gt;
f -&gt; KnownActivity (ActivityArgs f) (ActivityResult f)
</span><a href="Temporal.Activity.Definition.html#activityRef"><span class="hs-identifier hs-var">activityRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621680183301"><span class="annot"><span class="annottext">k :: KnownActivity (ActivityArgs activity) (ActivityResult activity)
</span><a href="#local-6989586621680183301"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#KnownActivity"><span class="hs-identifier hs-type">KnownActivity</span></a></span><span> </span><span id="local-6989586621680183311"><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680183311"><span class="hs-identifier hs-var">codec</span></a></span></span><span> </span><span id="local-6989586621680183312"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680183312"><span class="hs-identifier hs-var">_name</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680183313"><span class="annot"><span class="annottext">StartActivityOptions
</span><a href="#local-6989586621680183313"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-483"></span><span>  </span><span class="annot"><span class="annottext">forall (args :: [*]) result codec.
(VarArgs args, AllArgs (Codec codec) args) =&gt;
codec
-&gt; (Vector Payload -&gt; Workflow result) -&gt; args :-&gt;: Workflow result
</span><a href="Temporal.Workflow.html#withWorkflowArgs"><span class="hs-identifier hs-var">withWorkflowArgs</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityArgs"><span class="hs-identifier hs-type">ActivityArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182048"><span class="hs-identifier hs-type">activity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityResult"><span class="hs-identifier hs-type">ActivityResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182048"><span class="hs-identifier hs-type">activity</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680183311"><span class="hs-identifier hs-var">codec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KnownActivity (ActivityArgs activity) (ActivityResult activity)
-&gt; StartActivityOptions
-&gt; Vector Payload
-&gt; Workflow (Task (ActivityResult activity))
forall (args :: [*]) result.
RequireCallStack =&gt;
KnownActivity args result
-&gt; StartActivityOptions -&gt; Vector Payload -&gt; Workflow (Task result)
</span><a href="Temporal.Workflow.html#startActivityFromPayloads"><span class="hs-identifier hs-var">startActivityFromPayloads</span></a></span><span> </span><span class="annot"><span class="annottext">KnownActivity (ActivityArgs activity) (ActivityResult activity)
</span><a href="#local-6989586621680183301"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StartActivityOptions
</span><a href="#local-6989586621680183313"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span class="annot"><a href="Temporal.Workflow.html#executeActivity"><span class="hs-identifier hs-type">executeActivity</span></a></span><span>
</span><span id="line-487"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680182055"><span class="annot"><a href="#local-6989586621680182055"><span class="hs-identifier hs-type">activity</span></a></span></span><span>
</span><span id="line-488"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityRef"><span class="hs-identifier hs-type">ActivityRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182055"><span class="hs-identifier hs-type">activity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182055"><span class="hs-identifier hs-type">activity</span></a></span><span>
</span><span id="line-490"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#StartActivityOptions"><span class="hs-identifier hs-type">StartActivityOptions</span></a></span><span>
</span><span id="line-491"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityArgs"><span class="hs-identifier hs-type">ActivityArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182055"><span class="hs-identifier hs-type">activity</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#%3A-%3E%3A"><span class="hs-operator hs-type">:-&gt;:</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityResult"><span class="hs-identifier hs-type">ActivityResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182055"><span class="hs-identifier hs-type">activity</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span id="executeActivity"><span class="annot"><span class="annottext">executeActivity :: forall activity.
(RequireCallStack, ActivityRef activity) =&gt;
activity
-&gt; StartActivityOptions
-&gt; ActivityArgs activity :-&gt;: Workflow (ActivityResult activity)
</span><a href="Temporal.Workflow.html#executeActivity"><span class="hs-identifier hs-var hs-var">executeActivity</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">activity
-&gt; KnownActivity (ActivityArgs activity) (ActivityResult activity)
forall f.
ActivityRef f =&gt;
f -&gt; KnownActivity (ActivityArgs f) (ActivityResult f)
</span><a href="Temporal.Activity.Definition.html#activityRef"><span class="hs-identifier hs-var">activityRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621680183319"><span class="annot"><span class="annottext">k :: KnownActivity (ActivityArgs activity) (ActivityResult activity)
</span><a href="#local-6989586621680183319"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#KnownActivity"><span class="hs-identifier hs-type">KnownActivity</span></a></span><span> </span><span id="local-6989586621680183333"><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680183333"><span class="hs-identifier hs-var">codec</span></a></span></span><span> </span><span id="local-6989586621680183334"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680183334"><span class="hs-identifier hs-var">_name</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680183335"><span class="annot"><span class="annottext">StartActivityOptions
</span><a href="#local-6989586621680183335"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (args :: [*]) result codec.
(VarArgs args, AllArgs (Codec codec) args) =&gt;
codec
-&gt; (Vector Payload -&gt; Workflow result) -&gt; args :-&gt;: Workflow result
</span><a href="Temporal.Workflow.html#withWorkflowArgs"><span class="hs-identifier hs-var">withWorkflowArgs</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityArgs"><span class="hs-identifier hs-type">ActivityArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182055"><span class="hs-identifier hs-type">activity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityResult"><span class="hs-identifier hs-type">ActivityResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182055"><span class="hs-identifier hs-type">activity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680183333"><span class="hs-identifier hs-var">codec</span></a></span><span> </span><span class="annot"><span class="annottext">((Vector Payload -&gt; Workflow (ActivityResult activity))
 -&gt; ActivityArgs activity :-&gt;: Workflow (ActivityResult activity))
-&gt; (Vector Payload -&gt; Workflow (ActivityResult activity))
-&gt; ActivityArgs activity :-&gt;: Workflow (ActivityResult activity)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680183336"><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680183336"><span class="hs-identifier hs-var">typedPayloads</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-493"></span><span>  </span><span class="hs-comment">-- gatherArgs (Proxy @(ActivityArgs activity)) codec id $ \typedPayloads -&gt; do</span><span>
</span><span id="line-494"></span><span>  </span><span id="local-6989586621680183337"><span class="annot"><a href="#local-6989586621680183337"><span class="hs-identifier hs-var">actHandle</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">KnownActivity (ActivityArgs activity) (ActivityResult activity)
-&gt; StartActivityOptions
-&gt; Vector Payload
-&gt; Workflow (Task (ActivityResult activity))
forall (args :: [*]) result.
RequireCallStack =&gt;
KnownActivity args result
-&gt; StartActivityOptions -&gt; Vector Payload -&gt; Workflow (Task result)
</span><a href="Temporal.Workflow.html#startActivityFromPayloads"><span class="hs-identifier hs-var">startActivityFromPayloads</span></a></span><span> </span><span class="annot"><span class="annottext">KnownActivity (ActivityArgs activity) (ActivityResult activity)
</span><a href="#local-6989586621680183319"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StartActivityOptions
</span><a href="#local-6989586621680183335"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680183336"><span class="hs-identifier hs-var">typedPayloads</span></a></span><span>
</span><span id="line-495"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Unsafe.Handle.html#wait"><span class="hs-identifier hs-type">Temporal.Workflow.Unsafe.Handle.wait</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183337"><span class="hs-identifier hs-type">actHandle</span></a></span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span class="annot"><span class="hs-comment">{- | A client side handle to a single Workflow instance. It can be used to signal a workflow execution.

Given the following Workflow definition:
-}</span></span><span>
</span><span id="line-502"></span><span class="hs-keyword">class</span><span> </span><span id="WorkflowHandle"><span class="annot"><a href="Temporal.Workflow.html#WorkflowHandle"><span class="hs-identifier hs-var">WorkflowHandle</span></a></span></span><span> </span><span id="local-6989586621680182069"><span class="annot"><a href="#local-6989586621680182069"><span class="hs-identifier hs-type">h</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-503"></span><span>  </span><span class="hs-comment">-- | Signal a running Workflow.</span><span>
</span><span id="line-504"></span><span>  </span><span id="signal"><span class="annot"><a href="Temporal.Workflow.html#signal"><span class="hs-identifier hs-type">signal</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621680182062"><span id="local-6989586621680182064"><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Signal.html#SignalRef"><span class="hs-identifier hs-type">SignalRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182062"><span class="hs-identifier hs-type">ref</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182069"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182064"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182062"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Signal.html#SignalArgs"><span class="hs-identifier hs-type">SignalArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182062"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#%3A-%3E%3A"><span class="hs-operator hs-type">:-&gt;:</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-505"></span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Temporal.Workflow.html#WorkflowHandle"><span class="hs-identifier hs-type">WorkflowHandle</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ChildWorkflowHandle"><span class="hs-identifier hs-type">ChildWorkflowHandle</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-508"></span><span>  </span><span id="local-6989586621680183352"><span class="annot"><span class="annottext">signal :: forall ref result.
(SignalRef ref, RequireCallStack) =&gt;
ChildWorkflowHandle result
-&gt; ref -&gt; SignalArgs ref :-&gt;: Workflow (Task ())
</span><a href="Temporal.Workflow.html#signal"><span class="hs-identifier hs-var hs-var hs-var">signal</span></a></span></span><span> </span><span id="local-6989586621680183353"><span class="annot"><span class="annottext">ChildWorkflowHandle result
</span><a href="#local-6989586621680183353"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-509"></span><span>    </span><span class="annot"><span class="annottext">ChildWorkflowHandle result
-&gt; (SignalExternalWorkflowExecution
    -&gt; SignalExternalWorkflowExecution)
-&gt; ref
-&gt; SignalArgs ref :-&gt;: Workflow (Task ())
forall {k} (result :: k) (h :: k -&gt; *) ref.
(RequireCallStack, SignalRef ref) =&gt;
h result
-&gt; (SignalExternalWorkflowExecution
    -&gt; SignalExternalWorkflowExecution)
-&gt; ref
-&gt; SignalArgs ref :-&gt;: Workflow (Task ())
</span><a href="Temporal.Workflow.html#signalWorkflow"><span class="hs-identifier hs-var">signalWorkflow</span></a></span><span> </span><span class="annot"><span class="annottext">ChildWorkflowHandle result
</span><a href="#local-6989586621680183353"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LensLike' f SignalExternalWorkflowExecution Text
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f SignalExternalWorkflowExecution Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;childWorkflowId&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.childWorkflowId</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f SignalExternalWorkflowExecution Text)
-&gt; Text
-&gt; SignalExternalWorkflowExecution
-&gt; SignalExternalWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">WorkflowId -&gt; Text
</span><a href="Temporal.Common.html#rawWorkflowId"><span class="hs-identifier hs-var">rawWorkflowId</span></a></span><span> </span><span class="annot"><span class="annottext">ChildWorkflowHandle result
</span><a href="#local-6989586621680183353"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">childWorkflowId</span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Temporal.Workflow.html#WorkflowHandle"><span class="hs-identifier hs-type">WorkflowHandle</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ExternalWorkflowHandle"><span class="hs-identifier hs-type">ExternalWorkflowHandle</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-513"></span><span>  </span><span id="local-6989586621680183378"><span class="annot"><span class="annottext">signal :: forall ref result.
(SignalRef ref, RequireCallStack) =&gt;
ExternalWorkflowHandle result
-&gt; ref -&gt; SignalArgs ref :-&gt;: Workflow (Task ())
</span><a href="Temporal.Workflow.html#signal"><span class="hs-identifier hs-var hs-var hs-var">signal</span></a></span></span><span> </span><span id="local-6989586621680183379"><span class="annot"><span class="annottext">ExternalWorkflowHandle result
</span><a href="#local-6989586621680183379"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-514"></span><span>    </span><span class="annot"><span class="annottext">ExternalWorkflowHandle result
-&gt; (SignalExternalWorkflowExecution
    -&gt; SignalExternalWorkflowExecution)
-&gt; ref
-&gt; SignalArgs ref :-&gt;: Workflow (Task ())
forall {k} (result :: k) (h :: k -&gt; *) ref.
(RequireCallStack, SignalRef ref) =&gt;
h result
-&gt; (SignalExternalWorkflowExecution
    -&gt; SignalExternalWorkflowExecution)
-&gt; ref
-&gt; SignalArgs ref :-&gt;: Workflow (Task ())
</span><a href="Temporal.Workflow.html#signalWorkflow"><span class="hs-identifier hs-var">signalWorkflow</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalWorkflowHandle result
</span><a href="#local-6989586621680183379"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LensLike'
  f SignalExternalWorkflowExecution NamespacedWorkflowExecution
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike'
  f SignalExternalWorkflowExecution NamespacedWorkflowExecution
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;workflowExecution&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.workflowExecution</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike'
   f SignalExternalWorkflowExecution NamespacedWorkflowExecution)
-&gt; NamespacedWorkflowExecution
-&gt; SignalExternalWorkflowExecution
-&gt; SignalExternalWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">NamespacedWorkflowExecution
</span><a href="#local-6989586621680183387"><span class="hs-identifier hs-var">converted</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-516"></span><span>      </span><span id="local-6989586621680183387"><span class="annot"><span class="annottext">converted :: NamespacedWorkflowExecution
</span><a href="#local-6989586621680183387"><span class="hs-identifier hs-var hs-var">converted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-517"></span><span>        </span><span class="annot"><span class="annottext">NamespacedWorkflowExecution
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-518"></span><span>          </span><span class="annot"><span class="annottext">NamespacedWorkflowExecution
-&gt; (NamespacedWorkflowExecution -&gt; NamespacedWorkflowExecution)
-&gt; NamespacedWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f NamespacedWorkflowExecution Text
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f NamespacedWorkflowExecution Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;workflowId&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Common.workflowId</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f NamespacedWorkflowExecution Text)
-&gt; Text
-&gt; NamespacedWorkflowExecution
-&gt; NamespacedWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">WorkflowId -&gt; Text
</span><a href="Temporal.Common.html#rawWorkflowId"><span class="hs-identifier hs-var">rawWorkflowId</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalWorkflowHandle result
</span><a href="#local-6989586621680183379"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">externalWorkflowWorkflowId</span><span>
</span><span id="line-519"></span><span>          </span><span class="annot"><span class="annottext">NamespacedWorkflowExecution
-&gt; (NamespacedWorkflowExecution -&gt; NamespacedWorkflowExecution)
-&gt; NamespacedWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f NamespacedWorkflowExecution Text
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f NamespacedWorkflowExecution Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;runId&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Common.runId</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f NamespacedWorkflowExecution Text)
-&gt; Text
-&gt; NamespacedWorkflowExecution
-&gt; NamespacedWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; (RunId -&gt; Text) -&gt; Maybe RunId -&gt; Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">RunId -&gt; Text
</span><a href="Temporal.Common.html#rawRunId"><span class="hs-identifier hs-var">rawRunId</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalWorkflowHandle result
</span><a href="#local-6989586621680183379"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">externalWorkflowRunId</span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span class="hs-comment">-- TODO</span><span>
</span><span id="line-523"></span><span class="hs-comment">-- &amp; Common.namespace .~ rawNamespace h.externalNamespace</span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span class="annot"><span class="hs-comment">-- | A Workflow can send a Signal to another Workflow, in which case it's called an External Signal.</span></span><span>
</span><span id="line-526"></span><span class="annot"><a href="Temporal.Workflow.html#signalWorkflow"><span class="hs-identifier hs-type">signalWorkflow</span></a></span><span>
</span><span id="line-527"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680182077"><span class="annot"><a href="#local-6989586621680182077"><span class="hs-identifier hs-type">result</span></a></span></span><span> </span><span id="local-6989586621680182076"><span class="annot"><a href="#local-6989586621680182076"><span class="hs-identifier hs-type">h</span></a></span></span><span> </span><span id="local-6989586621680182075"><span class="annot"><a href="#local-6989586621680182075"><span class="hs-identifier hs-type">ref</span></a></span></span><span>
</span><span id="line-528"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Workflow.Signal.html#SignalRef"><span class="hs-identifier hs-type">SignalRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182075"><span class="hs-identifier hs-type">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182076"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182077"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-530"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Command.SignalExternalWorkflowExecution</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Command.SignalExternalWorkflowExecution</span></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182075"><span class="hs-identifier hs-type">ref</span></a></span><span>
</span><span id="line-532"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Signal.html#SignalArgs"><span class="hs-identifier hs-type">SignalArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182075"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#%3A-%3E%3A"><span class="hs-operator hs-type">:-&gt;:</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span id="signalWorkflow"><span class="annot"><span class="annottext">signalWorkflow :: forall {k} (result :: k) (h :: k -&gt; *) ref.
(RequireCallStack, SignalRef ref) =&gt;
h result
-&gt; (SignalExternalWorkflowExecution
    -&gt; SignalExternalWorkflowExecution)
-&gt; ref
-&gt; SignalArgs ref :-&gt;: Workflow (Task ())
</span><a href="Temporal.Workflow.html#signalWorkflow"><span class="hs-identifier hs-var hs-var">signalWorkflow</span></a></span></span><span> </span><span class="annot"><span class="annottext">h result
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680183408"><span class="annot"><span class="annottext">SignalExternalWorkflowExecution -&gt; SignalExternalWorkflowExecution
</span><a href="#local-6989586621680183408"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ref -&gt; KnownSignal (SignalArgs ref)
forall sig. SignalRef sig =&gt; sig -&gt; KnownSignal (SignalArgs sig)
</span><a href="Temporal.Workflow.Signal.html#signalRef"><span class="hs-identifier hs-var">signalRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Signal.html#KnownSignal"><span class="hs-identifier hs-type">KnownSignal</span></a></span><span> </span><span id="local-6989586621680183456"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680183456"><span class="hs-identifier hs-var">signalName</span></a></span></span><span> </span><span id="local-6989586621680183457"><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680183457"><span class="hs-identifier hs-var">signalCodec</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (args :: [*]) result codec.
(VarArgs args, AllArgs (Codec codec) args) =&gt;
codec
-&gt; (Vector Payload -&gt; Workflow result) -&gt; args :-&gt;: Workflow result
</span><a href="Temporal.Workflow.html#withWorkflowArgs"><span class="hs-identifier hs-var">withWorkflowArgs</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Signal.html#SignalArgs"><span class="hs-identifier hs-type">SignalArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182075"><span class="hs-identifier hs-type">ref</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680183457"><span class="hs-identifier hs-var">signalCodec</span></a></span><span> </span><span class="annot"><span class="annottext">((Vector Payload -&gt; Workflow (Task ()))
 -&gt; SignalArgs ref :-&gt;: Workflow (Task ()))
-&gt; (Vector Payload -&gt; Workflow (Task ()))
-&gt; SignalArgs ref :-&gt;: Workflow (Task ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680183458"><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680183458"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-534"></span><span>  </span><span class="annot"><span class="annottext">InstanceM (Task ()) -&gt; Workflow (Task ())
forall a. RequireCallStack =&gt; InstanceM a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#ilift"><span class="hs-identifier hs-var">ilift</span></a></span><span> </span><span class="annot"><span class="annottext">(InstanceM (Task ()) -&gt; Workflow (Task ()))
-&gt; InstanceM (Task ()) -&gt; Workflow (Task ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-535"></span><span>    </span><span class="annot"><span class="annottext">InstanceM ()
RequireCallStack =&gt; InstanceM ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStack"><span class="hs-identifier hs-var">updateCallStack</span></a></span><span>
</span><span id="line-536"></span><span>    </span><span id="local-6989586621680183459"><span class="annot"><a href="#local-6989586621680183459"><span class="hs-identifier hs-var">resVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM (IVar ResolveSignalExternalWorkflow)
forall (m :: * -&gt; *) a. MonadIO m =&gt; m (IVar a)
</span><a href="Temporal.Workflow.Internal.Monad.html#newIVar"><span class="hs-identifier hs-var">newIVar</span></a></span><span>
</span><span id="line-537"></span><span>    </span><span id="local-6989586621680183460"><span class="annot"><a href="#local-6989586621680183460"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ask</span></span><span>
</span><span id="line-538"></span><span>    </span><span id="local-6989586621680183461"><span class="annot"><a href="#local-6989586621680183461"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Instance.html#nextExternalSignalSequence"><span class="hs-identifier hs-type">nextExternalSignalSequence</span></a></span><span>
</span><span id="line-539"></span><span>    </span><span id="local-6989586621680183463"><span class="annot"><a href="#local-6989586621680183463"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Payload.html#processorEncodePayloads"><span class="hs-identifier hs-type">processorEncodePayloads</span></a></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">payloadProcessor</span><span> </span><span class="annot"><a href="#local-6989586621680183458"><span class="hs-identifier hs-type">ps</span></a></span><span>
</span><span id="line-540"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680183464"><span class="annot"><a href="#local-6989586621680183464"><span class="hs-identifier hs-var hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-541"></span><span>          </span><span class="annot"><span class="annottext">WorkflowCommand
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-542"></span><span>            </span><span class="annot"><span class="annottext">WorkflowCommand
-&gt; (WorkflowCommand -&gt; WorkflowCommand) -&gt; WorkflowCommand
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f WorkflowCommand SignalExternalWorkflowExecution
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f WorkflowCommand SignalExternalWorkflowExecution
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;signalExternalWorkflowExecution&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.signalExternalWorkflowExecution</span></span><span>
</span><span id="line-543"></span><span>              </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f WorkflowCommand SignalExternalWorkflowExecution)
-&gt; SignalExternalWorkflowExecution
-&gt; WorkflowCommand
-&gt; WorkflowCommand
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">SignalExternalWorkflowExecution -&gt; SignalExternalWorkflowExecution
</span><a href="#local-6989586621680183408"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-544"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">SignalExternalWorkflowExecution
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-545"></span><span>                    </span><span class="annot"><span class="annottext">SignalExternalWorkflowExecution
-&gt; (SignalExternalWorkflowExecution
    -&gt; SignalExternalWorkflowExecution)
-&gt; SignalExternalWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f SignalExternalWorkflowExecution Word32
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f SignalExternalWorkflowExecution Word32
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;seq&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.seq</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f SignalExternalWorkflowExecution Word32)
-&gt; Word32
-&gt; SignalExternalWorkflowExecution
-&gt; SignalExternalWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Sequence -&gt; Word32
</span><a href="Temporal.Common.html#rawSequence"><span class="hs-identifier hs-var">rawSequence</span></a></span><span> </span><span class="annot"><span class="annottext">Sequence
</span><a href="#local-6989586621680183461"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-546"></span><span>                    </span><span class="annot"><span class="annottext">SignalExternalWorkflowExecution
-&gt; (SignalExternalWorkflowExecution
    -&gt; SignalExternalWorkflowExecution)
-&gt; SignalExternalWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f SignalExternalWorkflowExecution Text
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f SignalExternalWorkflowExecution Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;signalName&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.signalName</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f SignalExternalWorkflowExecution Text)
-&gt; Text
-&gt; SignalExternalWorkflowExecution
-&gt; SignalExternalWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680183456"><span class="hs-identifier hs-var">signalName</span></a></span><span>
</span><span id="line-547"></span><span>                    </span><span class="annot"><span class="annottext">SignalExternalWorkflowExecution
-&gt; (SignalExternalWorkflowExecution
    -&gt; SignalExternalWorkflowExecution)
-&gt; SignalExternalWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f SignalExternalWorkflowExecution (Vector Payload)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f SignalExternalWorkflowExecution (Vector Payload)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;vec'args&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.vec'args</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f SignalExternalWorkflowExecution (Vector Payload))
-&gt; Vector Payload
-&gt; SignalExternalWorkflowExecution
-&gt; SignalExternalWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">(Payload -&gt; Payload) -&gt; Vector Payload -&gt; Vector Payload
forall a b. (a -&gt; b) -&gt; Vector a -&gt; Vector b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Payload -&gt; Payload
</span><a href="Temporal.Payload.html#convertToProtoPayload"><span class="hs-identifier hs-var">convertToProtoPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680183463"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-548"></span><span>                    </span><span class="hs-comment">-- TODO</span><span>
</span><span id="line-549"></span><span>                    </span><span class="hs-comment">-- &amp; Command.headers .~ _</span><span>
</span><span id="line-550"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#addCommand"><span class="hs-identifier hs-type">addCommand</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183464"><span class="hs-identifier hs-type">cmd</span></a></span><span>
</span><span id="line-552"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">atomically</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">modifyTVar'</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowSequenceMaps</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680183493"><span class="annot"><span class="annottext">SequenceMaps
</span><a href="#local-6989586621680183493"><span class="hs-identifier hs-var">seqMaps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-553"></span><span>      </span><span class="annot"><span class="annottext">SequenceMaps
</span><a href="#local-6989586621680183493"><span class="hs-identifier hs-var">seqMaps</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#externalSignals"><span class="hs-identifier hs-var">externalSignals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621680183461"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183459"><span class="hs-identifier hs-type">resVar</span></a></span><span> </span><span class="annot"><span class="hs-identifier">seqMaps</span></span><span class="hs-operator">.</span><span class="hs-identifier">externalSignals</span><span class="hs-special">}</span><span>
</span><span id="line-554"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-555"></span><span>      </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span>
</span><span id="line-556"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#waitAction"><span class="hs-identifier hs-var">waitAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-557"></span><span>            </span><span id="local-6989586621680183495"><span class="annot"><a href="#local-6989586621680183495"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#getIVar"><span class="hs-identifier hs-type">getIVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183459"><span class="hs-identifier hs-type">resVar</span></a></span><span>
</span><span id="line-558"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680183495"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">^.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Activation.maybe'failure</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-559"></span><span>              </span><span class="annot"><span class="annottext">Maybe Failure
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Workflow ()
forall a. a -&gt; Workflow a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-560"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680183497"><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680183497"><span class="hs-identifier hs-var">failureInfo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SignalExternalWorkflowFailed -&gt; Workflow ()
forall e a. (HasCallStack, Exception e) =&gt; e -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#throw"><span class="hs-identifier hs-var">throw</span></a></span><span> </span><span class="annot"><span class="annottext">(SignalExternalWorkflowFailed -&gt; Workflow ())
-&gt; SignalExternalWorkflowFailed -&gt; Workflow ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Failure -&gt; SignalExternalWorkflowFailed
</span><a href="Temporal.Exception.html#SignalExternalWorkflowFailed"><span class="hs-identifier hs-var">SignalExternalWorkflowFailed</span></a></span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680183497"><span class="hs-identifier hs-var">failureInfo</span></a></span><span>
</span><span id="line-561"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#cancelAction"><span class="hs-identifier hs-var">cancelAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-562"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680183500"><span class="annot"><a href="#local-6989586621680183500"><span class="hs-identifier hs-var hs-var">cancelCmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-563"></span><span>                  </span><span class="annot"><span class="annottext">WorkflowCommand
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-564"></span><span>                    </span><span class="annot"><span class="annottext">WorkflowCommand
-&gt; (WorkflowCommand -&gt; WorkflowCommand) -&gt; WorkflowCommand
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f WorkflowCommand CancelSignalWorkflow
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f WorkflowCommand CancelSignalWorkflow
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;cancelSignalWorkflow&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.cancelSignalWorkflow</span></span><span>
</span><span id="line-565"></span><span>                      </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f WorkflowCommand CancelSignalWorkflow)
-&gt; CancelSignalWorkflow -&gt; WorkflowCommand -&gt; WorkflowCommand
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">CancelSignalWorkflow
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-566"></span><span>                            </span><span class="annot"><span class="annottext">CancelSignalWorkflow
-&gt; (CancelSignalWorkflow -&gt; CancelSignalWorkflow)
-&gt; CancelSignalWorkflow
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f CancelSignalWorkflow Word32
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f CancelSignalWorkflow Word32
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;seq&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.seq</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f CancelSignalWorkflow Word32)
-&gt; Word32 -&gt; CancelSignalWorkflow -&gt; CancelSignalWorkflow
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Sequence -&gt; Word32
</span><a href="Temporal.Common.html#rawSequence"><span class="hs-identifier hs-var">rawSequence</span></a></span><span> </span><span class="annot"><span class="annottext">Sequence
</span><a href="#local-6989586621680183461"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-567"></span><span>                         </span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span>            </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ilift"><span class="hs-identifier hs-type">ilift</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#addCommand"><span class="hs-identifier hs-type">addCommand</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183500"><span class="hs-identifier hs-type">cancelCmd</span></a></span><span>
</span><span id="line-569"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span>
</span><span id="line-572"></span><span class="annot"><a href="Temporal.Workflow.html#startChildWorkflowFromPayloads"><span class="hs-identifier hs-type">startChildWorkflowFromPayloads</span></a></span><span>
</span><span id="line-573"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680182133"><span class="annot"><a href="#local-6989586621680182133"><span class="hs-identifier hs-type">wf</span></a></span></span><span>
</span><span id="line-574"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowRef"><span class="hs-identifier hs-type">WorkflowRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182133"><span class="hs-identifier hs-type">wf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182133"><span class="hs-identifier hs-type">wf</span></a></span><span>
</span><span id="line-576"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#StartChildWorkflowOptions"><span class="hs-identifier hs-type">StartChildWorkflowOptions</span></a></span><span>
</span><span id="line-577"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span>
</span><span id="line-578"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ChildWorkflowHandle"><span class="hs-identifier hs-type">ChildWorkflowHandle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowResult"><span class="hs-identifier hs-type">WorkflowResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182133"><span class="hs-identifier hs-type">wf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span id="startChildWorkflowFromPayloads"><span class="annot"><span class="annottext">startChildWorkflowFromPayloads :: forall wf.
(RequireCallStack, WorkflowRef wf) =&gt;
wf
-&gt; StartChildWorkflowOptions
-&gt; Vector Payload
-&gt; Workflow (ChildWorkflowHandle (WorkflowResult wf))
</span><a href="Temporal.Workflow.html#startChildWorkflowFromPayloads"><span class="hs-identifier hs-var hs-var">startChildWorkflowFromPayloads</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">wf -&gt; KnownWorkflow (WorkflowArgs wf) (WorkflowResult wf)
forall f.
WorkflowRef f =&gt;
f -&gt; KnownWorkflow (WorkflowArgs f) (WorkflowResult f)
</span><a href="Temporal.Workflow.Definition.html#workflowRef"><span class="hs-identifier hs-var">workflowRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621680183521"><span class="annot"><span class="annottext">k :: KnownWorkflow (WorkflowArgs wf) (WorkflowResult wf)
</span><a href="#local-6989586621680183521"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#KnownWorkflow"><span class="hs-identifier hs-type">KnownWorkflow</span></a></span><span> </span><span id="local-6989586621680183617"><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680183617"><span class="hs-identifier hs-var">codec</span></a></span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680183618"><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680183618"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621680183619"><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680183619"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-580"></span><span>  </span><span id="local-6989586621680183620"><span class="annot"><a href="#local-6989586621680183620"><span class="hs-identifier hs-var">wfId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680183618"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">workflowId</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-581"></span><span>    </span><span class="annot"><span class="annottext">Maybe WorkflowId
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; WorkflowId
</span><a href="Temporal.Common.html#WorkflowId"><span class="hs-identifier hs-var">WorkflowId</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; WorkflowId) -&gt; (UUID -&gt; Text) -&gt; UUID -&gt; WorkflowId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UUID -&gt; Text
</span><span class="hs-identifier hs-var">UUID.toText</span></span><span> </span><span class="annot"><span class="annottext">(UUID -&gt; WorkflowId) -&gt; Workflow UUID -&gt; Workflow WorkflowId
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Workflow UUID
</span><a href="Temporal.Workflow.html#uuid4"><span class="hs-identifier hs-var">uuid4</span></a></span><span>
</span><span id="line-582"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680183624"><span class="annot"><span class="annottext">WorkflowId
</span><a href="#local-6989586621680183624"><span class="hs-identifier hs-var">wfId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkflowId -&gt; Workflow WorkflowId
forall a. a -&gt; Workflow a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">WorkflowId
</span><a href="#local-6989586621680183624"><span class="hs-identifier hs-var">wfId</span></a></span><span>
</span><span id="line-583"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ilift"><span class="hs-identifier hs-type">ilift</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621680183625"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183619"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183620"><span class="hs-identifier hs-type">wfId</span></a></span><span>
</span><span id="line-584"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-585"></span><span>    </span><span class="annot"><a href="#local-6989586621680183625"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Common.html#WorkflowId"><span class="hs-identifier hs-type">WorkflowId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#InstanceM"><span class="hs-identifier hs-type">InstanceM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ChildWorkflowHandle"><span class="hs-identifier hs-type">ChildWorkflowHandle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowResult"><span class="hs-identifier hs-type">WorkflowResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182133"><span class="hs-identifier hs-type">wf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span>    </span><span id="local-6989586621680183625"><span class="annot"><span class="annottext">go :: Vector Payload
-&gt; WorkflowId
-&gt; InstanceM (ChildWorkflowHandle (WorkflowResult wf))
</span><a href="#local-6989586621680183625"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680183626"><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680183626"><span class="hs-identifier hs-var">typedPayloads</span></a></span></span><span> </span><span id="local-6989586621680183627"><span class="annot"><span class="annottext">WorkflowId
</span><a href="#local-6989586621680183627"><span class="hs-identifier hs-var">wfId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-587"></span><span>      </span><span class="annot"><span class="annottext">InstanceM ()
RequireCallStack =&gt; InstanceM ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStack"><span class="hs-identifier hs-var">updateCallStack</span></a></span><span>
</span><span id="line-588"></span><span>      </span><span class="annot"><span class="annottext">Vector Payload
-&gt; WorkflowId
-&gt; InstanceM (ChildWorkflowHandle (WorkflowResult wf))
</span><a href="#local-6989586621680183628"><span class="hs-identifier hs-var">sendChildWorkflowCommand</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680183626"><span class="hs-identifier hs-var">typedPayloads</span></a></span><span> </span><span class="annot"><span class="annottext">WorkflowId
</span><a href="#local-6989586621680183627"><span class="hs-identifier hs-var">wfId</span></a></span><span>
</span><span id="line-589"></span><span>    </span><span id="local-6989586621680183628"><span class="annot"><span class="annottext">sendChildWorkflowCommand :: Vector Payload
-&gt; WorkflowId
-&gt; InstanceM (ChildWorkflowHandle (WorkflowResult wf))
</span><a href="#local-6989586621680183628"><span class="hs-identifier hs-var hs-var">sendChildWorkflowCommand</span></a></span></span><span> </span><span id="local-6989586621680183629"><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680183629"><span class="hs-identifier hs-var">typedPayloads</span></a></span></span><span> </span><span id="local-6989586621680183630"><span class="annot"><span class="annottext">WorkflowId
</span><a href="#local-6989586621680183630"><span class="hs-identifier hs-var">wfId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-590"></span><span>      </span><span id="local-6989586621680183631"><span class="annot"><a href="#local-6989586621680183631"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM WorkflowInstance
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-591"></span><span>      </span><span class="hs-comment">-- TODO these need to pass through the interceptor</span><span>
</span><span id="line-592"></span><span>      </span><span id="local-6989586621680183632"><span class="annot"><a href="#local-6989586621680183632"><span class="hs-identifier hs-var">runInIO</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">askRunInIO</span></span><span>
</span><span id="line-593"></span><span>      </span><span id="local-6989586621680183633"><span class="annot"><a href="#local-6989586621680183633"><span class="hs-identifier hs-var">wfHandle</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">outboundInterceptor</span><span class="hs-operator">.</span><span class="hs-identifier">startChildWorkflowExecution</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#knownWorkflowName"><span class="hs-identifier hs-var">knownWorkflowName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183521"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680183618"><span class="hs-identifier hs-type">opts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680183635"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680183635"><span class="hs-identifier hs-var">wfName</span></a></span></span><span> </span><span id="local-6989586621680183636"><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680183636"><span class="hs-identifier hs-var">opts'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InstanceM (ChildWorkflowHandle Payload)
-&gt; IO (ChildWorkflowHandle Payload)
</span><a href="#local-6989586621680183632"><span class="hs-identifier hs-var">runInIO</span></a></span><span> </span><span class="annot"><span class="annottext">(InstanceM (ChildWorkflowHandle Payload)
 -&gt; IO (ChildWorkflowHandle Payload))
-&gt; InstanceM (ChildWorkflowHandle Payload)
-&gt; IO (ChildWorkflowHandle Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-594"></span><span>        </span><span id="local-6989586621680183637"><span class="annot"><a href="#local-6989586621680183637"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PayloadProcessor -&gt; Vector Payload -&gt; InstanceM (Vector Payload)
forall (m :: * -&gt; *) (f :: * -&gt; *).
(MonadIO m, Traversable f) =&gt;
PayloadProcessor -&gt; f Payload -&gt; m (f Payload)
</span><a href="Temporal.Payload.html#processorEncodePayloads"><span class="hs-identifier hs-var">processorEncodePayloads</span></a></span><span> </span><span class="annot"><span class="annottext">WorkflowInstance
</span><a href="#local-6989586621680183631"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">payloadProcessor</span><span> </span><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680183629"><span class="hs-identifier hs-var">typedPayloads</span></a></span><span>
</span><span id="line-595"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680183638"><span class="annot"><a href="#local-6989586621680183638"><span class="hs-identifier hs-var hs-var">convertedPayloads</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Payload -&gt; Payload) -&gt; Vector Payload -&gt; Vector Payload
forall a b. (a -&gt; b) -&gt; Vector a -&gt; Vector b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Payload -&gt; Payload
</span><a href="Temporal.Payload.html#convertToProtoPayload"><span class="hs-identifier hs-var">convertToProtoPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680183637"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-596"></span><span>        </span><span id="local-6989586621680183639"><span class="annot"><a href="#local-6989586621680183639"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Payload.html#processorEncodePayloads"><span class="hs-identifier hs-type">processorEncodePayloads</span></a></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">payloadProcessor</span><span> </span><span class="annot"><span class="hs-identifier">opts'</span></span><span class="hs-operator">.</span><span class="hs-identifier">headers</span><span>
</span><span id="line-597"></span><span>        </span><span id="local-6989586621680183640"><span class="annot"><a href="#local-6989586621680183640"><span class="hs-identifier hs-var">memo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Payload.html#processorEncodePayloads"><span class="hs-identifier hs-type">processorEncodePayloads</span></a></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">payloadProcessor</span><span> </span><span class="annot"><span class="hs-identifier">opts'</span></span><span class="hs-operator">.</span><span class="hs-identifier">initialMemo</span><span>
</span><span id="line-598"></span><span>
</span><span id="line-599"></span><span>        </span><span id="local-6989586621680183641"><span class="annot"><a href="#local-6989586621680183641"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Common.html#Sequence"><span class="hs-identifier hs-type">Sequence</span></a></span><span> </span><span id="local-6989586621680183642"><span class="annot"><a href="#local-6989586621680183642"><span class="hs-identifier hs-var">wfSeq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Instance.html#nextChildWorkflowSequence"><span class="hs-identifier hs-type">nextChildWorkflowSequence</span></a></span><span>
</span><span id="line-600"></span><span>        </span><span id="local-6989586621680183644"><span class="annot"><a href="#local-6989586621680183644"><span class="hs-identifier hs-var">startSlot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#newIVar"><span class="hs-identifier hs-type">newIVar</span></a></span><span>
</span><span id="line-601"></span><span>        </span><span id="local-6989586621680183645"><span class="annot"><a href="#local-6989586621680183645"><span class="hs-identifier hs-var">resultSlot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#newIVar"><span class="hs-identifier hs-type">newIVar</span></a></span><span>
</span><span id="line-602"></span><span>        </span><span id="local-6989586621680183646"><span class="annot"><a href="#local-6989586621680183646"><span class="hs-identifier hs-var">firstExecutionRunId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#newIVar"><span class="hs-identifier hs-type">newIVar</span></a></span><span>
</span><span id="line-603"></span><span>        </span><span id="local-6989586621680183647"><span class="annot"><a href="#local-6989586621680183647"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowInstanceInfo</span><span>
</span><span id="line-604"></span><span>        </span><span id="local-6989586621680183648"><span class="annot"><a href="#local-6989586621680183648"><span class="hs-identifier hs-var">searchAttrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.SearchAttributes.Internal.html#searchAttributesToProto"><span class="hs-identifier hs-type">searchAttributesToProto</span></a></span><span> </span><span class="annot"><span class="hs-identifier">opts'</span></span><span class="hs-operator">.</span><span class="hs-identifier">searchAttributes</span><span>
</span><span id="line-605"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680183650"><span class="annot"><a href="#local-6989586621680183650"><span class="hs-identifier hs-var hs-var">childWorkflowOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-606"></span><span>              </span><span class="annot"><span class="annottext">StartChildWorkflowExecution
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-607"></span><span>                </span><span class="annot"><span class="annottext">StartChildWorkflowExecution
-&gt; (StartChildWorkflowExecution -&gt; StartChildWorkflowExecution)
-&gt; StartChildWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f StartChildWorkflowExecution Word32
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f StartChildWorkflowExecution Word32
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;seq&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.seq</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f StartChildWorkflowExecution Word32)
-&gt; Word32
-&gt; StartChildWorkflowExecution
-&gt; StartChildWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621680183642"><span class="hs-identifier hs-var">wfSeq</span></a></span><span>
</span><span id="line-608"></span><span>                </span><span class="annot"><span class="annottext">StartChildWorkflowExecution
-&gt; (StartChildWorkflowExecution -&gt; StartChildWorkflowExecution)
-&gt; StartChildWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f StartChildWorkflowExecution Text
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f StartChildWorkflowExecution Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;namespace&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.namespace</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f StartChildWorkflowExecution Text)
-&gt; Text
-&gt; StartChildWorkflowExecution
-&gt; StartChildWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Namespace -&gt; Text
</span><a href="Temporal.Common.html#rawNamespace"><span class="hs-identifier hs-var">rawNamespace</span></a></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621680183647"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">namespace</span><span>
</span><span id="line-609"></span><span>                </span><span class="annot"><span class="annottext">StartChildWorkflowExecution
-&gt; (StartChildWorkflowExecution -&gt; StartChildWorkflowExecution)
-&gt; StartChildWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f StartChildWorkflowExecution Text
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f StartChildWorkflowExecution Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;workflowId&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.workflowId</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f StartChildWorkflowExecution Text)
-&gt; Text
-&gt; StartChildWorkflowExecution
-&gt; StartChildWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">WorkflowId -&gt; Text
</span><a href="Temporal.Common.html#rawWorkflowId"><span class="hs-identifier hs-var">rawWorkflowId</span></a></span><span> </span><span class="annot"><span class="annottext">WorkflowId
</span><a href="#local-6989586621680183630"><span class="hs-identifier hs-var">wfId</span></a></span><span>
</span><span id="line-610"></span><span>                </span><span class="annot"><span class="annottext">StartChildWorkflowExecution
-&gt; (StartChildWorkflowExecution -&gt; StartChildWorkflowExecution)
-&gt; StartChildWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f StartChildWorkflowExecution Text
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f StartChildWorkflowExecution Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;workflowType&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.workflowType</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f StartChildWorkflowExecution Text)
-&gt; Text
-&gt; StartChildWorkflowExecution
-&gt; StartChildWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680183635"><span class="hs-identifier hs-var">wfName</span></a></span><span>
</span><span id="line-611"></span><span>                </span><span class="annot"><span class="annottext">StartChildWorkflowExecution
-&gt; (StartChildWorkflowExecution -&gt; StartChildWorkflowExecution)
-&gt; StartChildWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f StartChildWorkflowExecution Text
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f StartChildWorkflowExecution Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;taskQueue&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.taskQueue</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f StartChildWorkflowExecution Text)
-&gt; Text
-&gt; StartChildWorkflowExecution
-&gt; StartChildWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">TaskQueue -&gt; Text
</span><a href="Temporal.Common.html#rawTaskQueue"><span class="hs-identifier hs-var">rawTaskQueue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TaskQueue -&gt; Maybe TaskQueue -&gt; TaskQueue
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621680183647"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">taskQueue</span><span> </span><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680183636"><span class="hs-identifier hs-var">opts'</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">taskQueue</span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span>                </span><span class="annot"><span class="annottext">StartChildWorkflowExecution
-&gt; (StartChildWorkflowExecution -&gt; StartChildWorkflowExecution)
-&gt; StartChildWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f StartChildWorkflowExecution (Vector Payload)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f StartChildWorkflowExecution (Vector Payload)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;vec'input&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.vec'input</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f StartChildWorkflowExecution (Vector Payload))
-&gt; Vector Payload
-&gt; StartChildWorkflowExecution
-&gt; StartChildWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680183638"><span class="hs-identifier hs-var">convertedPayloads</span></a></span><span>
</span><span id="line-613"></span><span>                </span><span class="annot"><span class="annottext">StartChildWorkflowExecution
-&gt; (StartChildWorkflowExecution -&gt; StartChildWorkflowExecution)
-&gt; StartChildWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f StartChildWorkflowExecution (Maybe Duration)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f StartChildWorkflowExecution (Maybe Duration)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;maybe'workflowExecutionTimeout&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.maybe'workflowExecutionTimeout</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f StartChildWorkflowExecution (Maybe Duration))
-&gt; Maybe Duration
-&gt; StartChildWorkflowExecution
-&gt; StartChildWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">(Duration -&gt; Duration) -&gt; Maybe Duration -&gt; Maybe Duration
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Duration -&gt; Duration
</span><a href="Temporal.Duration.html#durationToProto"><span class="hs-identifier hs-var">durationToProto</span></a></span><span> </span><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680183636"><span class="hs-identifier hs-var">opts'</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">timeoutOptions</span><span class="hs-operator">.</span><span class="hs-identifier">executionTimeout</span><span>
</span><span id="line-614"></span><span>                </span><span class="annot"><span class="annottext">StartChildWorkflowExecution
-&gt; (StartChildWorkflowExecution -&gt; StartChildWorkflowExecution)
-&gt; StartChildWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f StartChildWorkflowExecution (Maybe Duration)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f StartChildWorkflowExecution (Maybe Duration)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;maybe'workflowRunTimeout&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.maybe'workflowRunTimeout</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f StartChildWorkflowExecution (Maybe Duration))
-&gt; Maybe Duration
-&gt; StartChildWorkflowExecution
-&gt; StartChildWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">(Duration -&gt; Duration) -&gt; Maybe Duration -&gt; Maybe Duration
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Duration -&gt; Duration
</span><a href="Temporal.Duration.html#durationToProto"><span class="hs-identifier hs-var">durationToProto</span></a></span><span> </span><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680183636"><span class="hs-identifier hs-var">opts'</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">timeoutOptions</span><span class="hs-operator">.</span><span class="hs-identifier">runTimeout</span><span>
</span><span id="line-615"></span><span>                </span><span class="annot"><span class="annottext">StartChildWorkflowExecution
-&gt; (StartChildWorkflowExecution -&gt; StartChildWorkflowExecution)
-&gt; StartChildWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f StartChildWorkflowExecution (Maybe Duration)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f StartChildWorkflowExecution (Maybe Duration)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;maybe'workflowTaskTimeout&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.maybe'workflowTaskTimeout</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f StartChildWorkflowExecution (Maybe Duration))
-&gt; Maybe Duration
-&gt; StartChildWorkflowExecution
-&gt; StartChildWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">(Duration -&gt; Duration) -&gt; Maybe Duration -&gt; Maybe Duration
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Duration -&gt; Duration
</span><a href="Temporal.Duration.html#durationToProto"><span class="hs-identifier hs-var">durationToProto</span></a></span><span> </span><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680183636"><span class="hs-identifier hs-var">opts'</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">timeoutOptions</span><span class="hs-operator">.</span><span class="hs-identifier">taskTimeout</span><span>
</span><span id="line-616"></span><span>                </span><span class="annot"><span class="annottext">StartChildWorkflowExecution
-&gt; (StartChildWorkflowExecution -&gt; StartChildWorkflowExecution)
-&gt; StartChildWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f StartChildWorkflowExecution ParentClosePolicy
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f StartChildWorkflowExecution ParentClosePolicy
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;parentClosePolicy&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.parentClosePolicy</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f StartChildWorkflowExecution ParentClosePolicy)
-&gt; ParentClosePolicy
-&gt; StartChildWorkflowExecution
-&gt; StartChildWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">ParentClosePolicy -&gt; ParentClosePolicy
</span><a href="Temporal.Workflow.Types.html#parentClosePolicyToProto"><span class="hs-identifier hs-var">parentClosePolicyToProto</span></a></span><span> </span><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680183636"><span class="hs-identifier hs-var">opts'</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">parentClosePolicy</span><span>
</span><span id="line-617"></span><span>                </span><span class="annot"><span class="annottext">StartChildWorkflowExecution
-&gt; (StartChildWorkflowExecution -&gt; StartChildWorkflowExecution)
-&gt; StartChildWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f StartChildWorkflowExecution WorkflowIdReusePolicy
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f StartChildWorkflowExecution WorkflowIdReusePolicy
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;workflowIdReusePolicy&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.workflowIdReusePolicy</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f StartChildWorkflowExecution WorkflowIdReusePolicy)
-&gt; WorkflowIdReusePolicy
-&gt; StartChildWorkflowExecution
-&gt; StartChildWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">WorkflowIdReusePolicy -&gt; WorkflowIdReusePolicy
</span><a href="Temporal.Common.html#workflowIdReusePolicyToProto"><span class="hs-identifier hs-var">workflowIdReusePolicyToProto</span></a></span><span> </span><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680183636"><span class="hs-identifier hs-var">opts'</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">workflowIdReusePolicy</span><span>
</span><span id="line-618"></span><span>                </span><span class="annot"><span class="annottext">StartChildWorkflowExecution
-&gt; (StartChildWorkflowExecution -&gt; StartChildWorkflowExecution)
-&gt; StartChildWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f StartChildWorkflowExecution (Maybe RetryPolicy)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f StartChildWorkflowExecution (Maybe RetryPolicy)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;maybe'retryPolicy&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.maybe'retryPolicy</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f StartChildWorkflowExecution (Maybe RetryPolicy))
-&gt; Maybe RetryPolicy
-&gt; StartChildWorkflowExecution
-&gt; StartChildWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">(RetryPolicy -&gt; RetryPolicy)
-&gt; Maybe RetryPolicy -&gt; Maybe RetryPolicy
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">RetryPolicy -&gt; RetryPolicy
</span><a href="Temporal.Common.html#retryPolicyToProto"><span class="hs-identifier hs-var">retryPolicyToProto</span></a></span><span> </span><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680183636"><span class="hs-identifier hs-var">opts'</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">retryPolicy</span><span>
</span><span id="line-619"></span><span>                </span><span class="annot"><span class="annottext">StartChildWorkflowExecution
-&gt; (StartChildWorkflowExecution -&gt; StartChildWorkflowExecution)
-&gt; StartChildWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f StartChildWorkflowExecution Text
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f StartChildWorkflowExecution Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;cronSchedule&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.cronSchedule</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f StartChildWorkflowExecution Text)
-&gt; Text
-&gt; StartChildWorkflowExecution
-&gt; StartChildWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text -&gt; Text
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680183636"><span class="hs-identifier hs-var">opts'</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">cronSchedule</span><span>
</span><span id="line-620"></span><span>                </span><span class="annot"><span class="annottext">StartChildWorkflowExecution
-&gt; (StartChildWorkflowExecution -&gt; StartChildWorkflowExecution)
-&gt; StartChildWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f StartChildWorkflowExecution (Map Text Payload)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f StartChildWorkflowExecution (Map Text Payload)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;headers&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.headers</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f StartChildWorkflowExecution (Map Text Payload))
-&gt; Map Text Payload
-&gt; StartChildWorkflowExecution
-&gt; StartChildWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">(Payload -&gt; Payload) -&gt; Map Text Payload -&gt; Map Text Payload
forall a b. (a -&gt; b) -&gt; Map Text a -&gt; Map Text b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Payload -&gt; Payload
</span><a href="Temporal.Payload.html#convertToProtoPayload"><span class="hs-identifier hs-var">convertToProtoPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Payload
</span><a href="#local-6989586621680183639"><span class="hs-identifier hs-var">hdrs</span></a></span><span>
</span><span id="line-621"></span><span>                </span><span class="annot"><span class="annottext">StartChildWorkflowExecution
-&gt; (StartChildWorkflowExecution -&gt; StartChildWorkflowExecution)
-&gt; StartChildWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f StartChildWorkflowExecution (Map Text Payload)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f StartChildWorkflowExecution (Map Text Payload)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;memo&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.memo</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f StartChildWorkflowExecution (Map Text Payload))
-&gt; Map Text Payload
-&gt; StartChildWorkflowExecution
-&gt; StartChildWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">(Payload -&gt; Payload) -&gt; Map Text Payload -&gt; Map Text Payload
forall a b. (a -&gt; b) -&gt; Map Text a -&gt; Map Text b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Payload -&gt; Payload
</span><a href="Temporal.Payload.html#convertToProtoPayload"><span class="hs-identifier hs-var">convertToProtoPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Payload
</span><a href="#local-6989586621680183640"><span class="hs-identifier hs-var">memo</span></a></span><span>
</span><span id="line-622"></span><span>                </span><span class="annot"><span class="annottext">StartChildWorkflowExecution
-&gt; (StartChildWorkflowExecution -&gt; StartChildWorkflowExecution)
-&gt; StartChildWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f StartChildWorkflowExecution (Map Text Payload)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f StartChildWorkflowExecution (Map Text Payload)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;searchAttributes&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.searchAttributes</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f StartChildWorkflowExecution (Map Text Payload))
-&gt; Map Text Payload
-&gt; StartChildWorkflowExecution
-&gt; StartChildWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Map Text Payload
</span><a href="#local-6989586621680183648"><span class="hs-identifier hs-var">searchAttrs</span></a></span><span>
</span><span id="line-623"></span><span>                </span><span class="annot"><span class="annottext">StartChildWorkflowExecution
-&gt; (StartChildWorkflowExecution -&gt; StartChildWorkflowExecution)
-&gt; StartChildWorkflowExecution
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike'
  f StartChildWorkflowExecution ChildWorkflowCancellationType
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike'
  f StartChildWorkflowExecution ChildWorkflowCancellationType
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;cancellationType&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.cancellationType</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike'
   f StartChildWorkflowExecution ChildWorkflowCancellationType)
-&gt; ChildWorkflowCancellationType
-&gt; StartChildWorkflowExecution
-&gt; StartChildWorkflowExecution
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">ChildWorkflowCancellationType -&gt; ChildWorkflowCancellationType
</span><a href="Temporal.Workflow.Types.html#childWorkflowCancellationTypeToProto"><span class="hs-identifier hs-var">childWorkflowCancellationTypeToProto</span></a></span><span> </span><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680183636"><span class="hs-identifier hs-var">opts'</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">cancellationType</span><span>
</span><span id="line-624"></span><span>
</span><span id="line-625"></span><span>            </span><span id="local-6989586621680183769"><span class="annot"><a href="#local-6989586621680183769"><span class="hs-identifier hs-var hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-626"></span><span>              </span><span class="annot"><span class="annottext">WorkflowCommand
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-627"></span><span>                </span><span class="annot"><span class="annottext">WorkflowCommand
-&gt; (WorkflowCommand -&gt; WorkflowCommand) -&gt; WorkflowCommand
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f WorkflowCommand StartChildWorkflowExecution
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f WorkflowCommand StartChildWorkflowExecution
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;startChildWorkflowExecution&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.startChildWorkflowExecution</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f WorkflowCommand StartChildWorkflowExecution)
-&gt; StartChildWorkflowExecution
-&gt; WorkflowCommand
-&gt; WorkflowCommand
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">StartChildWorkflowExecution
</span><a href="#local-6989586621680183650"><span class="hs-identifier hs-var">childWorkflowOptions</span></a></span><span>
</span><span id="line-628"></span><span>
</span><span id="line-629"></span><span>            </span><span id="local-6989586621680183777"><span class="annot"><a href="#local-6989586621680183777"><span class="hs-identifier hs-var hs-var">wfHandle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-630"></span><span>              </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ChildWorkflowHandle"><span class="hs-identifier hs-type">ChildWorkflowHandle</span></a></span><span>
</span><span id="line-631"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">childWorkflowSequence :: Sequence
</span><a href="#local-6989586621680183779"><span class="hs-identifier hs-var">childWorkflowSequence</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sequence
</span><a href="#local-6989586621680183641"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-632"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">startHandle :: IVar ()
</span><a href="#local-6989586621680183780"><span class="hs-identifier hs-var">startHandle</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IVar ()
</span><a href="#local-6989586621680183644"><span class="hs-identifier hs-var">startSlot</span></a></span><span>
</span><span id="line-633"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">resultHandle :: IVar ResolveChildWorkflowExecution
</span><a href="#local-6989586621680183781"><span class="hs-identifier hs-var">resultHandle</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IVar ResolveChildWorkflowExecution
</span><a href="#local-6989586621680183645"><span class="hs-identifier hs-var">resultSlot</span></a></span><span>
</span><span id="line-634"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">firstExecutionRunId :: IVar RunId
</span><a href="#local-6989586621680183782"><span class="hs-identifier hs-var">firstExecutionRunId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IVar RunId
</span><a href="#local-6989586621680183646"><span class="hs-identifier hs-var">firstExecutionRunId</span></a></span><span>
</span><span id="line-635"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">childWorkflowResultConverter :: Payload -&gt; UnencodedPayload
</span><a href="Temporal.Workflow.Internal.Monad.html#childWorkflowResultConverter"><span class="hs-identifier hs-var">childWorkflowResultConverter</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Payload -&gt; UnencodedPayload
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-636"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">childWorkflowId :: WorkflowId
</span><a href="#local-6989586621680183784"><span class="hs-identifier hs-var">childWorkflowId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkflowId
</span><a href="#local-6989586621680183630"><span class="hs-identifier hs-var">wfId</span></a></span><span>
</span><span id="line-637"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">atomically</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">modifyTVar'</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowSequenceMaps</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680183785"><span class="annot"><span class="annottext">SequenceMaps
</span><a href="#local-6989586621680183785"><span class="hs-identifier hs-var">seqMaps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-640"></span><span>          </span><span class="annot"><span class="annottext">SequenceMaps
</span><a href="#local-6989586621680183785"><span class="hs-identifier hs-var">seqMaps</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#childWorkflows"><span class="hs-identifier hs-var">childWorkflows</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621680183641"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#SomeChildWorkflowHandle"><span class="hs-identifier hs-type">SomeChildWorkflowHandle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183777"><span class="hs-identifier hs-type">wfHandle</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier">seqMaps</span></span><span class="hs-operator">.</span><span class="hs-identifier">childWorkflows</span><span class="hs-special">}</span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span>        </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#addCommand"><span class="hs-identifier hs-type">addCommand</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183769"><span class="hs-identifier hs-type">cmd</span></a></span><span>
</span><span id="line-643"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621680183777"><span class="hs-identifier hs-type">wfHandle</span></a></span><span>
</span><span id="line-644"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-645"></span><span>        </span><span class="annot"><a href="#local-6989586621680183633"><span class="hs-identifier hs-type">wfHandle</span></a></span><span>
</span><span id="line-646"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#childWorkflowResultConverter"><span class="hs-identifier hs-var">childWorkflowResultConverter</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680183788"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621680183788"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-647"></span><span>              </span><span id="local-6989586621680183789"><span class="annot"><a href="#local-6989586621680183789"><span class="hs-identifier hs-var">decodingResult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">codec -&gt; Payload -&gt; IO (Either String (WorkflowResult wf))
forall fmt a. Codec fmt a =&gt; fmt -&gt; Payload -&gt; IO (Either String a)
</span><a href="Temporal.Payload.html#decode"><span class="hs-identifier hs-var">decode</span></a></span><span> </span><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680183617"><span class="hs-identifier hs-var">codec</span></a></span><span> </span><span class="annot"><span class="annottext">(Payload -&gt; IO (Either String (WorkflowResult wf)))
-&gt; UnencodedPayload -&gt; IO (Either String (WorkflowResult wf))
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; UnencodedPayload)
-&gt; (Payload -&gt; UnencodedPayload)
-&gt; Either String Payload
-&gt; UnencodedPayload
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValueError -&gt; UnencodedPayload
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(ValueError -&gt; UnencodedPayload)
-&gt; (String -&gt; ValueError) -&gt; String -&gt; UnencodedPayload
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ValueError
</span><a href="Temporal.Payload.html#ValueError"><span class="hs-identifier hs-var">ValueError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Payload -&gt; UnencodedPayload
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either String Payload -&gt; UnencodedPayload)
-&gt; IO (Either String Payload) -&gt; UnencodedPayload
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">PayloadProcessor -&gt; Payload -&gt; IO (Either String Payload)
</span><a href="Temporal.Payload.html#payloadProcessorDecode"><span class="hs-identifier hs-var">payloadProcessorDecode</span></a></span><span> </span><span class="annot"><span class="annottext">WorkflowInstance
</span><a href="#local-6989586621680183631"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">payloadProcessor</span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621680183788"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-648"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680183789"><span class="hs-identifier hs-type">decodingResult</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-649"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680183793"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680183793"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ValueError -&gt; IO (WorkflowResult wf)
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(ValueError -&gt; IO (WorkflowResult wf))
-&gt; ValueError -&gt; IO (WorkflowResult wf)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ValueError
</span><a href="Temporal.Payload.html#ValueError"><span class="hs-identifier hs-var">ValueError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680183793"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-650"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680183794"><span class="annot"><span class="annottext">WorkflowResult wf
</span><a href="#local-6989586621680183794"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkflowResult wf -&gt; IO (WorkflowResult wf)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">WorkflowResult wf
</span><a href="#local-6989586621680183794"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-651"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span class="annot"><span class="hs-comment">{- $childWorkflow

A Child Workflow Execution is a Workflow Execution that is spawned from within another Workflow.

A Workflow Execution can be both a Parent and a Child Workflow Execution because any Workflow can spawn another Workflow.
-}</span></span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span>
</span><span id="line-662"></span><span class="annot"><span class="hs-comment">{- | Start a child Workflow execution

Returns a client-side handle that implements a child Workflow interface.

By default, a child will be scheduled on the same task queue as its parent.

A child Workflow handle supports awaiting completion, signaling and cancellation via the returned handle.

In order to query the child, use a WorkflowClient from an Activity.
-}</span></span><span>
</span><span id="line-672"></span><span class="annot"><a href="Temporal.Workflow.html#startChildWorkflow"><span class="hs-identifier hs-type">startChildWorkflow</span></a></span><span>
</span><span id="line-673"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680182223"><span class="annot"><a href="#local-6989586621680182223"><span class="hs-identifier hs-type">wf</span></a></span></span><span>
</span><span id="line-674"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowRef"><span class="hs-identifier hs-type">WorkflowRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182223"><span class="hs-identifier hs-type">wf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-675"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182223"><span class="hs-identifier hs-type">wf</span></a></span><span>
</span><span id="line-676"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#StartChildWorkflowOptions"><span class="hs-identifier hs-type">StartChildWorkflowOptions</span></a></span><span>
</span><span id="line-677"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowArgs"><span class="hs-identifier hs-type">WorkflowArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182223"><span class="hs-identifier hs-type">wf</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#%3A-%3E%3A"><span class="hs-operator hs-type">:-&gt;:</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ChildWorkflowHandle"><span class="hs-identifier hs-type">ChildWorkflowHandle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowResult"><span class="hs-identifier hs-type">WorkflowResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182223"><span class="hs-identifier hs-type">wf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-678"></span><span id="startChildWorkflow"><span class="annot"><span class="annottext">startChildWorkflow :: forall wf.
(RequireCallStack, WorkflowRef wf) =&gt;
wf
-&gt; StartChildWorkflowOptions
-&gt; WorkflowArgs wf
   :-&gt;: Workflow (ChildWorkflowHandle (WorkflowResult wf))
</span><a href="Temporal.Workflow.html#startChildWorkflow"><span class="hs-identifier hs-var hs-var">startChildWorkflow</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">wf -&gt; KnownWorkflow (WorkflowArgs wf) (WorkflowResult wf)
forall f.
WorkflowRef f =&gt;
f -&gt; KnownWorkflow (WorkflowArgs f) (WorkflowResult f)
</span><a href="Temporal.Workflow.Definition.html#workflowRef"><span class="hs-identifier hs-var">workflowRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621680183800"><span class="annot"><span class="annottext">k :: KnownWorkflow (WorkflowArgs wf) (WorkflowResult wf)
</span><a href="#local-6989586621680183800"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#KnownWorkflow"><span class="hs-identifier hs-type">KnownWorkflow</span></a></span><span> </span><span id="local-6989586621680183812"><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680183812"><span class="hs-identifier hs-var">codec</span></a></span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680183813"><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680183813"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-679"></span><span>  </span><span class="annot"><span class="annottext">forall (args :: [*]) result codec.
(VarArgs args, AllArgs (Codec codec) args) =&gt;
codec
-&gt; (Vector Payload -&gt; Workflow result) -&gt; args :-&gt;: Workflow result
</span><a href="Temporal.Workflow.html#withWorkflowArgs"><span class="hs-identifier hs-var">withWorkflowArgs</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowArgs"><span class="hs-identifier hs-type">WorkflowArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182223"><span class="hs-identifier hs-type">wf</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ChildWorkflowHandle"><span class="hs-identifier hs-type">ChildWorkflowHandle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowResult"><span class="hs-identifier hs-type">WorkflowResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182223"><span class="hs-identifier hs-type">wf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680183812"><span class="hs-identifier hs-var">codec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KnownWorkflow (WorkflowArgs wf) (WorkflowResult wf)
-&gt; StartChildWorkflowOptions
-&gt; Vector Payload
-&gt; Workflow
     (ChildWorkflowHandle
        (WorkflowResult
           (KnownWorkflow (WorkflowArgs wf) (WorkflowResult wf))))
forall wf.
(RequireCallStack, WorkflowRef wf) =&gt;
wf
-&gt; StartChildWorkflowOptions
-&gt; Vector Payload
-&gt; Workflow (ChildWorkflowHandle (WorkflowResult wf))
</span><a href="Temporal.Workflow.html#startChildWorkflowFromPayloads"><span class="hs-identifier hs-var">startChildWorkflowFromPayloads</span></a></span><span> </span><span class="annot"><span class="annottext">KnownWorkflow (WorkflowArgs wf) (WorkflowResult wf)
</span><a href="#local-6989586621680183800"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680183813"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span>
</span><span id="line-682"></span><span class="annot"><a href="Temporal.Workflow.html#executeChildWorkflow"><span class="hs-identifier hs-type">executeChildWorkflow</span></a></span><span>
</span><span id="line-683"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680182228"><span class="annot"><a href="#local-6989586621680182228"><span class="hs-identifier hs-type">wf</span></a></span></span><span>
</span><span id="line-684"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowRef"><span class="hs-identifier hs-type">WorkflowRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182228"><span class="hs-identifier hs-type">wf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182228"><span class="hs-identifier hs-type">wf</span></a></span><span>
</span><span id="line-686"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#StartChildWorkflowOptions"><span class="hs-identifier hs-type">StartChildWorkflowOptions</span></a></span><span>
</span><span id="line-687"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowArgs"><span class="hs-identifier hs-type">WorkflowArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182228"><span class="hs-identifier hs-type">wf</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#%3A-%3E%3A"><span class="hs-operator hs-type">:-&gt;:</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowResult"><span class="hs-identifier hs-type">WorkflowResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182228"><span class="hs-identifier hs-type">wf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-688"></span><span id="executeChildWorkflow"><span class="annot"><span class="annottext">executeChildWorkflow :: forall wf.
(RequireCallStack, WorkflowRef wf) =&gt;
wf
-&gt; StartChildWorkflowOptions
-&gt; WorkflowArgs wf :-&gt;: Workflow (WorkflowResult wf)
</span><a href="Temporal.Workflow.html#executeChildWorkflow"><span class="hs-identifier hs-var hs-var">executeChildWorkflow</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">wf -&gt; KnownWorkflow (WorkflowArgs wf) (WorkflowResult wf)
forall f.
WorkflowRef f =&gt;
f -&gt; KnownWorkflow (WorkflowArgs f) (WorkflowResult f)
</span><a href="Temporal.Workflow.Definition.html#workflowRef"><span class="hs-identifier hs-var">workflowRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621680183819"><span class="annot"><span class="annottext">k :: KnownWorkflow (WorkflowArgs wf) (WorkflowResult wf)
</span><a href="#local-6989586621680183819"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#KnownWorkflow"><span class="hs-identifier hs-type">KnownWorkflow</span></a></span><span> </span><span id="local-6989586621680183832"><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680183832"><span class="hs-identifier hs-var">codec</span></a></span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680183833"><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680183833"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (args :: [*]) result codec.
(VarArgs args, AllArgs (Codec codec) args) =&gt;
codec
-&gt; (Vector Payload -&gt; Workflow result) -&gt; args :-&gt;: Workflow result
</span><a href="Temporal.Workflow.html#withWorkflowArgs"><span class="hs-identifier hs-var">withWorkflowArgs</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowArgs"><span class="hs-identifier hs-type">WorkflowArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182228"><span class="hs-identifier hs-type">wf</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowResult"><span class="hs-identifier hs-type">WorkflowResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182228"><span class="hs-identifier hs-type">wf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680183832"><span class="hs-identifier hs-var">codec</span></a></span><span> </span><span class="annot"><span class="annottext">((Vector Payload -&gt; Workflow (WorkflowResult wf))
 -&gt; WorkflowArgs wf :-&gt;: Workflow (WorkflowResult wf))
-&gt; (Vector Payload -&gt; Workflow (WorkflowResult wf))
-&gt; WorkflowArgs wf :-&gt;: Workflow (WorkflowResult wf)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680183834"><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680183834"><span class="hs-identifier hs-var">typedPayloads</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-689"></span><span>  </span><span id="local-6989586621680183835"><span class="annot"><a href="#local-6989586621680183835"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">KnownWorkflow (WorkflowArgs wf) (WorkflowResult wf)
-&gt; StartChildWorkflowOptions
-&gt; Vector Payload
-&gt; Workflow
     (ChildWorkflowHandle
        (WorkflowResult
           (KnownWorkflow (WorkflowArgs wf) (WorkflowResult wf))))
forall wf.
(RequireCallStack, WorkflowRef wf) =&gt;
wf
-&gt; StartChildWorkflowOptions
-&gt; Vector Payload
-&gt; Workflow (ChildWorkflowHandle (WorkflowResult wf))
</span><a href="Temporal.Workflow.html#startChildWorkflowFromPayloads"><span class="hs-identifier hs-var">startChildWorkflowFromPayloads</span></a></span><span> </span><span class="annot"><span class="annottext">KnownWorkflow (WorkflowArgs wf) (WorkflowResult wf)
</span><a href="#local-6989586621680183819"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680183833"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680183834"><span class="hs-identifier hs-var">typedPayloads</span></a></span><span>
</span><span id="line-690"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Unsafe.Handle.html#waitChildWorkflowResult"><span class="hs-identifier hs-type">waitChildWorkflowResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183835"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-691"></span><span>
</span><span id="line-692"></span><span>
</span><span id="line-693"></span><span class="hs-keyword">data</span><span> </span><span id="StartLocalActivityOptions"><span class="annot"><a href="Temporal.Workflow.html#StartLocalActivityOptions"><span class="hs-identifier hs-var">StartLocalActivityOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="StartLocalActivityOptions"><span class="annot"><a href="Temporal.Workflow.html#StartLocalActivityOptions"><span class="hs-identifier hs-var">StartLocalActivityOptions</span></a></span></span><span>
</span><span id="line-694"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="activityId"><span class="annot"><span class="annottext">StartLocalActivityOptions -&gt; Maybe ActivityId
</span><a href="Temporal.Workflow.html#activityId"><span class="hs-identifier hs-var hs-var">activityId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#ActivityId"><span class="hs-identifier hs-type">ActivityId</span></a></span><span>
</span><span id="line-695"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="scheduleToCloseTimeout"><span class="annot"><span class="annottext">StartLocalActivityOptions -&gt; Maybe Duration
</span><a href="Temporal.Workflow.html#scheduleToCloseTimeout"><span class="hs-identifier hs-var hs-var">scheduleToCloseTimeout</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Temporal.Duration.html#Duration"><span class="hs-identifier hs-type">Duration</span></a></span><span>
</span><span id="line-696"></span><span>  </span><span class="hs-comment">-- ^ Indicates how long the caller is willing to wait for local activity completion. Limits how</span><span>
</span><span id="line-697"></span><span>  </span><span class="hs-comment">-- long retries will be attempted. When not specified defaults to the workflow execution</span><span>
</span><span id="line-698"></span><span>  </span><span class="hs-comment">-- timeout (which may be unset).</span><span>
</span><span id="line-699"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="scheduleToStartTimeout"><span class="annot"><span class="annottext">StartLocalActivityOptions -&gt; Maybe Duration
</span><a href="Temporal.Workflow.html#scheduleToStartTimeout"><span class="hs-identifier hs-var hs-var">scheduleToStartTimeout</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Temporal.Duration.html#Duration"><span class="hs-identifier hs-type">Duration</span></a></span><span>
</span><span id="line-700"></span><span>  </span><span class="hs-comment">-- ^ Limits time the local activity can idle internally before being executed. That can happen if</span><span>
</span><span id="line-701"></span><span>  </span><span class="hs-comment">-- the worker is currently at max concurrent local activity executions. This timeout is always</span><span>
</span><span id="line-702"></span><span>  </span><span class="hs-comment">-- non retryable as all a retry would achieve is to put it back into the same queue. Defaults</span><span>
</span><span id="line-703"></span><span>  </span><span class="hs-comment">-- to `schedule_to_close_timeout` if not specified and that is set. Must be &lt;=</span><span>
</span><span id="line-704"></span><span>  </span><span class="hs-comment">-- `schedule_to_close_timeout` when set, otherwise, it will be clamped down.</span><span>
</span><span id="line-705"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="startToCloseTimeout"><span class="annot"><span class="annottext">StartLocalActivityOptions -&gt; Maybe Duration
</span><a href="Temporal.Workflow.html#startToCloseTimeout"><span class="hs-identifier hs-var hs-var">startToCloseTimeout</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Temporal.Duration.html#Duration"><span class="hs-identifier hs-type">Duration</span></a></span><span>
</span><span id="line-706"></span><span>  </span><span class="hs-comment">-- ^ Maximum time the local activity is allowed to execute after the task is dispatched. This</span><span>
</span><span id="line-707"></span><span>  </span><span class="hs-comment">-- timeout is always retryable. Either or both of `schedule_to_close_timeout` and this must be</span><span>
</span><span id="line-708"></span><span>  </span><span class="hs-comment">-- specified. If set, this must be &lt;= `schedule_to_close_timeout`, otherwise, it will be</span><span>
</span><span id="line-709"></span><span>  </span><span class="hs-comment">-- clamped down.</span><span>
</span><span id="line-710"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="retryPolicy"><span class="annot"><span class="annottext">StartLocalActivityOptions -&gt; Maybe RetryPolicy
</span><a href="Temporal.Workflow.html#retryPolicy"><span class="hs-identifier hs-var hs-var">retryPolicy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#RetryPolicy"><span class="hs-identifier hs-type">RetryPolicy</span></a></span><span>
</span><span id="line-711"></span><span>  </span><span class="hs-comment">-- ^ Specify a retry policy for the local activity. By default local activities will be retried</span><span>
</span><span id="line-712"></span><span>  </span><span class="hs-comment">-- indefinitely.</span><span>
</span><span id="line-713"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="localRetryThreshold"><span class="annot"><span class="annottext">StartLocalActivityOptions -&gt; Maybe Duration
</span><a href="Temporal.Workflow.html#localRetryThreshold"><span class="hs-identifier hs-var hs-var">localRetryThreshold</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Temporal.Duration.html#Duration"><span class="hs-identifier hs-type">Duration</span></a></span><span>
</span><span id="line-714"></span><span>  </span><span class="hs-comment">-- ^ If the activity is retrying and backoff would exceed this value, lang will be told to</span><span>
</span><span id="line-715"></span><span>  </span><span class="hs-comment">-- schedule a timer and retry the activity after. Otherwise, backoff will happen internally in</span><span>
</span><span id="line-716"></span><span>  </span><span class="hs-comment">-- core. Defaults to 1 minute.</span><span>
</span><span id="line-717"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="cancellationType"><span class="annot"><span class="annottext">StartLocalActivityOptions -&gt; ActivityCancellationType
</span><a href="Temporal.Workflow.html#cancellationType"><span class="hs-identifier hs-var hs-var">cancellationType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#ActivityCancellationType"><span class="hs-identifier hs-type">ActivityCancellationType</span></a></span><span>
</span><span id="line-718"></span><span>  </span><span class="hs-comment">-- ^ Defines how the workflow will wait (or not) for cancellation of the activity to be</span><span>
</span><span id="line-719"></span><span>  </span><span class="hs-comment">-- confirmed. Lang should default this to `WAIT_CANCELLATION_COMPLETED`, even though proto</span><span>
</span><span id="line-720"></span><span>  </span><span class="hs-comment">-- will default to `TRY_CANCEL` automatically.</span><span>
</span><span id="line-721"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="headers"><span class="annot"><span class="annottext">StartLocalActivityOptions -&gt; Map Text Payload
</span><a href="Temporal.Workflow.html#headers"><span class="hs-identifier hs-var hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span>
</span><span id="line-722"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-723"></span><span>
</span><span id="line-724"></span><span>
</span><span id="line-725"></span><span class="annot"><a href="Temporal.Workflow.html#defaultStartLocalActivityOptions"><span class="hs-identifier hs-type">defaultStartLocalActivityOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.html#StartLocalActivityOptions"><span class="hs-identifier hs-type">StartLocalActivityOptions</span></a></span><span>
</span><span id="line-726"></span><span id="defaultStartLocalActivityOptions"><span class="annot"><span class="annottext">defaultStartLocalActivityOptions :: StartLocalActivityOptions
</span><a href="Temporal.Workflow.html#defaultStartLocalActivityOptions"><span class="hs-identifier hs-var hs-var">defaultStartLocalActivityOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-727"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#StartLocalActivityOptions"><span class="hs-identifier hs-type">StartLocalActivityOptions</span></a></span><span>
</span><span id="line-728"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">activityId :: Maybe ActivityId
</span><a href="Temporal.Workflow.html#activityId"><span class="hs-identifier hs-var">activityId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ActivityId
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-729"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">scheduleToCloseTimeout :: Maybe Duration
</span><a href="Temporal.Workflow.html#scheduleToCloseTimeout"><span class="hs-identifier hs-var">scheduleToCloseTimeout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Duration
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-730"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">scheduleToStartTimeout :: Maybe Duration
</span><a href="Temporal.Workflow.html#scheduleToStartTimeout"><span class="hs-identifier hs-var">scheduleToStartTimeout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Duration
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-731"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">startToCloseTimeout :: Maybe Duration
</span><a href="Temporal.Workflow.html#startToCloseTimeout"><span class="hs-identifier hs-var">startToCloseTimeout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Duration
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-732"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">retryPolicy :: Maybe RetryPolicy
</span><a href="Temporal.Workflow.html#retryPolicy"><span class="hs-identifier hs-var">retryPolicy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe RetryPolicy
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-733"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">localRetryThreshold :: Maybe Duration
</span><a href="Temporal.Workflow.html#localRetryThreshold"><span class="hs-identifier hs-var">localRetryThreshold</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Duration
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-734"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cancellationType :: ActivityCancellationType
</span><a href="Temporal.Workflow.html#cancellationType"><span class="hs-identifier hs-var">cancellationType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ActivityCancellationType
</span><a href="Temporal.Workflow.Types.html#ActivityCancellationWaitCancellationCompleted"><span class="hs-identifier hs-var">ActivityCancellationWaitCancellationCompleted</span></a></span><span>
</span><span id="line-735"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">headers :: Map Text Payload
</span><a href="Temporal.Workflow.html#headers"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Text Payload
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-736"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-737"></span><span>
</span><span id="line-738"></span><span>
</span><span id="line-739"></span><span class="annot"><a href="Temporal.Workflow.html#startLocalActivity"><span class="hs-identifier hs-type">startLocalActivity</span></a></span><span>
</span><span id="line-740"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680182234"><span class="annot"><a href="#local-6989586621680182234"><span class="hs-identifier hs-type">act</span></a></span></span><span>
</span><span id="line-741"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityRef"><span class="hs-identifier hs-type">ActivityRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182234"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-742"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182234"><span class="hs-identifier hs-type">act</span></a></span><span>
</span><span id="line-743"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.html#StartLocalActivityOptions"><span class="hs-identifier hs-type">StartLocalActivityOptions</span></a></span><span>
</span><span id="line-744"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityArgs"><span class="hs-identifier hs-type">ActivityArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182234"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#%3A-%3E%3A"><span class="hs-operator hs-type">:-&gt;:</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityResult"><span class="hs-identifier hs-type">ActivityResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182234"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-745"></span><span id="startLocalActivity"><span class="annot"><span class="annottext">startLocalActivity :: forall act.
(RequireCallStack, ActivityRef act) =&gt;
act
-&gt; StartLocalActivityOptions
-&gt; ActivityArgs act :-&gt;: Workflow (Task (ActivityResult act))
</span><a href="Temporal.Workflow.html#startLocalActivity"><span class="hs-identifier hs-var hs-var">startLocalActivity</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">act -&gt; KnownActivity (ActivityArgs act) (ActivityResult act)
forall f.
ActivityRef f =&gt;
f -&gt; KnownActivity (ActivityArgs f) (ActivityResult f)
</span><a href="Temporal.Activity.Definition.html#activityRef"><span class="hs-identifier hs-var">activityRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html#KnownActivity"><span class="hs-identifier hs-type">KnownActivity</span></a></span><span> </span><span id="local-6989586621680183976"><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680183976"><span class="hs-identifier hs-var">codec</span></a></span></span><span> </span><span id="local-6989586621680183977"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680183977"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680183978"><span class="annot"><span class="annottext">StartLocalActivityOptions
</span><a href="#local-6989586621680183978"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (args :: [*]) result codec.
(VarArgs args, AllArgs (Codec codec) args) =&gt;
codec
-&gt; (Vector Payload -&gt; Workflow result) -&gt; args :-&gt;: Workflow result
</span><a href="Temporal.Workflow.html#withWorkflowArgs"><span class="hs-identifier hs-var">withWorkflowArgs</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityArgs"><span class="hs-identifier hs-type">ActivityArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182234"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityResult"><span class="hs-identifier hs-type">ActivityResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182234"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680183976"><span class="hs-identifier hs-var">codec</span></a></span><span> </span><span class="annot"><span class="annottext">((Vector Payload -&gt; Workflow (Task (ActivityResult act)))
 -&gt; ActivityArgs act :-&gt;: Workflow (Task (ActivityResult act)))
-&gt; (Vector Payload -&gt; Workflow (Task (ActivityResult act)))
-&gt; ActivityArgs act :-&gt;: Workflow (Task (ActivityResult act))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680183979"><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680183979"><span class="hs-identifier hs-var">typedPayloads</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-746"></span><span>  </span><span class="annot"><span class="annottext">Workflow ()
RequireCallStack =&gt; Workflow ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStackW"><span class="hs-identifier hs-var">updateCallStackW</span></a></span><span>
</span><span id="line-747"></span><span>  </span><span id="local-6989586621680183981"><span class="annot"><a href="#local-6989586621680183981"><span class="hs-identifier hs-var">originalTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Workflow SystemTime
RequireCallStack =&gt; Workflow SystemTime
</span><a href="Temporal.Workflow.html#time"><span class="hs-identifier hs-var">time</span></a></span><span>
</span><span id="line-748"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ilift"><span class="hs-identifier hs-type">ilift</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-749"></span><span>    </span><span id="local-6989586621680183982"><span class="annot"><a href="#local-6989586621680183982"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ask</span></span><span>
</span><span id="line-750"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680183983"><span class="annot"><a href="#local-6989586621680183983"><span class="hs-identifier hs-var hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Payload -&gt; Payload) -&gt; Vector Payload -&gt; Vector Payload
forall a b. (a -&gt; b) -&gt; Vector a -&gt; Vector b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Payload -&gt; Payload
</span><a href="Temporal.Payload.html#convertToProtoPayload"><span class="hs-identifier hs-var">convertToProtoPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680183979"><span class="hs-identifier hs-var">typedPayloads</span></a></span><span>
</span><span id="line-751"></span><span>    </span><span id="local-6989586621680183984"><span class="annot"><a href="#local-6989586621680183984"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Common.html#Sequence"><span class="hs-identifier hs-type">Sequence</span></a></span><span> </span><span id="local-6989586621680183985"><span class="annot"><a href="#local-6989586621680183985"><span class="hs-identifier hs-var">actSeq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Instance.html#nextActivitySequence"><span class="hs-identifier hs-type">nextActivitySequence</span></a></span><span>
</span><span id="line-752"></span><span>    </span><span id="local-6989586621680183986"><span class="annot"><a href="#local-6989586621680183986"><span class="hs-identifier hs-var">resultSlot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#newIVar"><span class="hs-identifier hs-type">newIVar</span></a></span><span>
</span><span id="line-753"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">atomically</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">modifyTVar'</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowSequenceMaps</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680183987"><span class="annot"><span class="annottext">SequenceMaps
</span><a href="#local-6989586621680183987"><span class="hs-identifier hs-var">seqMaps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-754"></span><span>      </span><span class="annot"><span class="annottext">SequenceMaps
</span><a href="#local-6989586621680183987"><span class="hs-identifier hs-var">seqMaps</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#activities"><span class="hs-identifier hs-var">activities</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621680183984"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183986"><span class="hs-identifier hs-type">resultSlot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#activities"><span class="hs-identifier hs-var">activities</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183987"><span class="hs-identifier hs-type">seqMaps</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-755"></span><span>    </span><span class="hs-comment">-- TODO, seems like `attempt` and `originalScheduledTime`</span><span>
</span><span id="line-756"></span><span>    </span><span class="hs-comment">-- imply that we are in charge of retrying local activities ourselves?</span><span>
</span><span id="line-757"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680183988"><span class="annot"><a href="#local-6989586621680183988"><span class="hs-identifier hs-var hs-var">actId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (ActivityId -&gt; Text) -&gt; Maybe ActivityId -&gt; Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; String -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621680183985"><span class="hs-identifier hs-var">actSeq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ActivityId -&gt; Text
</span><a href="Temporal.Common.html#rawActivityId"><span class="hs-identifier hs-var">rawActivityId</span></a></span><span> </span><span class="annot"><span class="annottext">StartLocalActivityOptions
</span><a href="#local-6989586621680183978"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">activityId</span><span>
</span><span id="line-758"></span><span>        </span><span id="local-6989586621680183989"><span class="annot"><a href="#local-6989586621680183989"><span class="hs-identifier hs-var hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-759"></span><span>          </span><span class="annot"><span class="annottext">WorkflowCommand
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-760"></span><span>            </span><span class="annot"><span class="annottext">WorkflowCommand
-&gt; (WorkflowCommand -&gt; WorkflowCommand) -&gt; WorkflowCommand
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f WorkflowCommand ScheduleLocalActivity
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f WorkflowCommand ScheduleLocalActivity
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;scheduleLocalActivity&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.scheduleLocalActivity</span></span><span>
</span><span id="line-761"></span><span>              </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f WorkflowCommand ScheduleLocalActivity)
-&gt; ScheduleLocalActivity -&gt; WorkflowCommand -&gt; WorkflowCommand
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ScheduleLocalActivity
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-762"></span><span>                    </span><span class="annot"><span class="annottext">ScheduleLocalActivity
-&gt; (ScheduleLocalActivity -&gt; ScheduleLocalActivity)
-&gt; ScheduleLocalActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleLocalActivity Word32
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleLocalActivity Word32
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;seq&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.seq</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleLocalActivity Word32)
-&gt; Word32 -&gt; ScheduleLocalActivity -&gt; ScheduleLocalActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621680183985"><span class="hs-identifier hs-var">actSeq</span></a></span><span>
</span><span id="line-763"></span><span>                    </span><span class="annot"><span class="annottext">ScheduleLocalActivity
-&gt; (ScheduleLocalActivity -&gt; ScheduleLocalActivity)
-&gt; ScheduleLocalActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleLocalActivity Text
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleLocalActivity Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;activityId&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.activityId</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleLocalActivity Text)
-&gt; Text -&gt; ScheduleLocalActivity -&gt; ScheduleLocalActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680183988"><span class="hs-identifier hs-var">actId</span></a></span><span>
</span><span id="line-764"></span><span>                    </span><span class="annot"><span class="annottext">ScheduleLocalActivity
-&gt; (ScheduleLocalActivity -&gt; ScheduleLocalActivity)
-&gt; ScheduleLocalActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleLocalActivity Text
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleLocalActivity Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;activityType&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.activityType</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleLocalActivity Text)
-&gt; Text -&gt; ScheduleLocalActivity -&gt; ScheduleLocalActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680183977"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-765"></span><span>                    </span><span class="hs-comment">-- &amp; attempt .~ _</span><span>
</span><span id="line-766"></span><span>                    </span><span class="hs-comment">-- &amp; headers .~ _</span><span>
</span><span id="line-767"></span><span>                    </span><span class="annot"><span class="annottext">ScheduleLocalActivity
-&gt; (ScheduleLocalActivity -&gt; ScheduleLocalActivity)
-&gt; ScheduleLocalActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleLocalActivity Timestamp
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleLocalActivity Timestamp
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;originalScheduleTime&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.originalScheduleTime</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleLocalActivity Timestamp)
-&gt; Timestamp -&gt; ScheduleLocalActivity -&gt; ScheduleLocalActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">SystemTime -&gt; Timestamp
</span><a href="Temporal.Common.html#timespecToTimestamp"><span class="hs-identifier hs-var">timespecToTimestamp</span></a></span><span> </span><span class="annot"><span class="annottext">SystemTime
</span><a href="#local-6989586621680183981"><span class="hs-identifier hs-var">originalTime</span></a></span><span>
</span><span id="line-768"></span><span>                    </span><span class="annot"><span class="annottext">ScheduleLocalActivity
-&gt; (ScheduleLocalActivity -&gt; ScheduleLocalActivity)
-&gt; ScheduleLocalActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleLocalActivity (Vector Payload)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleLocalActivity (Vector Payload)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;vec'arguments&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.vec'arguments</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleLocalActivity (Vector Payload))
-&gt; Vector Payload -&gt; ScheduleLocalActivity -&gt; ScheduleLocalActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680183983"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-769"></span><span>                    </span><span class="annot"><span class="annottext">ScheduleLocalActivity
-&gt; (ScheduleLocalActivity -&gt; ScheduleLocalActivity)
-&gt; ScheduleLocalActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleLocalActivity (Maybe Duration)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleLocalActivity (Maybe Duration)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;maybe'scheduleToCloseTimeout&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.maybe'scheduleToCloseTimeout</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleLocalActivity (Maybe Duration))
-&gt; Maybe Duration -&gt; ScheduleLocalActivity -&gt; ScheduleLocalActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Duration -&gt; Duration
</span><a href="Temporal.Duration.html#durationToProto"><span class="hs-identifier hs-var">durationToProto</span></a></span><span> </span><span class="annot"><span class="annottext">(Duration -&gt; Duration) -&gt; Maybe Duration -&gt; Maybe Duration
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StartLocalActivityOptions
</span><a href="#local-6989586621680183978"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">scheduleToCloseTimeout</span><span class="hs-special">)</span><span>
</span><span id="line-770"></span><span>                    </span><span class="annot"><span class="annottext">ScheduleLocalActivity
-&gt; (ScheduleLocalActivity -&gt; ScheduleLocalActivity)
-&gt; ScheduleLocalActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleLocalActivity (Maybe Duration)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleLocalActivity (Maybe Duration)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;maybe'scheduleToStartTimeout&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.maybe'scheduleToStartTimeout</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleLocalActivity (Maybe Duration))
-&gt; Maybe Duration -&gt; ScheduleLocalActivity -&gt; ScheduleLocalActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Duration -&gt; Duration
</span><a href="Temporal.Duration.html#durationToProto"><span class="hs-identifier hs-var">durationToProto</span></a></span><span> </span><span class="annot"><span class="annottext">(Duration -&gt; Duration) -&gt; Maybe Duration -&gt; Maybe Duration
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StartLocalActivityOptions
</span><a href="#local-6989586621680183978"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">scheduleToStartTimeout</span><span class="hs-special">)</span><span>
</span><span id="line-771"></span><span>                    </span><span class="annot"><span class="annottext">ScheduleLocalActivity
-&gt; (ScheduleLocalActivity -&gt; ScheduleLocalActivity)
-&gt; ScheduleLocalActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleLocalActivity (Maybe Duration)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleLocalActivity (Maybe Duration)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;maybe'startToCloseTimeout&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.maybe'startToCloseTimeout</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleLocalActivity (Maybe Duration))
-&gt; Maybe Duration -&gt; ScheduleLocalActivity -&gt; ScheduleLocalActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Duration -&gt; Duration
</span><a href="Temporal.Duration.html#durationToProto"><span class="hs-identifier hs-var">durationToProto</span></a></span><span> </span><span class="annot"><span class="annottext">(Duration -&gt; Duration) -&gt; Maybe Duration -&gt; Maybe Duration
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StartLocalActivityOptions
</span><a href="#local-6989586621680183978"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">startToCloseTimeout</span><span class="hs-special">)</span><span>
</span><span id="line-772"></span><span>                    </span><span class="annot"><span class="annottext">ScheduleLocalActivity
-&gt; (ScheduleLocalActivity -&gt; ScheduleLocalActivity)
-&gt; ScheduleLocalActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleLocalActivity (Maybe RetryPolicy)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleLocalActivity (Maybe RetryPolicy)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;maybe'retryPolicy&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.maybe'retryPolicy</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleLocalActivity (Maybe RetryPolicy))
-&gt; Maybe RetryPolicy
-&gt; ScheduleLocalActivity
-&gt; ScheduleLocalActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RetryPolicy -&gt; RetryPolicy
</span><a href="Temporal.Common.html#retryPolicyToProto"><span class="hs-identifier hs-var">retryPolicyToProto</span></a></span><span> </span><span class="annot"><span class="annottext">(RetryPolicy -&gt; RetryPolicy)
-&gt; Maybe RetryPolicy -&gt; Maybe RetryPolicy
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StartLocalActivityOptions
</span><a href="#local-6989586621680183978"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">retryPolicy</span><span class="hs-special">)</span><span>
</span><span id="line-773"></span><span>                    </span><span class="annot"><span class="annottext">ScheduleLocalActivity
-&gt; (ScheduleLocalActivity -&gt; ScheduleLocalActivity)
-&gt; ScheduleLocalActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleLocalActivity (Maybe Duration)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleLocalActivity (Maybe Duration)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;maybe'localRetryThreshold&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.maybe'localRetryThreshold</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleLocalActivity (Maybe Duration))
-&gt; Maybe Duration -&gt; ScheduleLocalActivity -&gt; ScheduleLocalActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Duration -&gt; Duration
</span><a href="Temporal.Duration.html#durationToProto"><span class="hs-identifier hs-var">durationToProto</span></a></span><span> </span><span class="annot"><span class="annottext">(Duration -&gt; Duration) -&gt; Maybe Duration -&gt; Maybe Duration
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StartLocalActivityOptions
</span><a href="#local-6989586621680183978"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">localRetryThreshold</span><span class="hs-special">)</span><span>
</span><span id="line-774"></span><span>                    </span><span class="annot"><span class="annottext">ScheduleLocalActivity
-&gt; (ScheduleLocalActivity -&gt; ScheduleLocalActivity)
-&gt; ScheduleLocalActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f ScheduleLocalActivity ActivityCancellationType
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f ScheduleLocalActivity ActivityCancellationType
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;cancellationType&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.cancellationType</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f ScheduleLocalActivity ActivityCancellationType)
-&gt; ActivityCancellationType
-&gt; ScheduleLocalActivity
-&gt; ScheduleLocalActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">ActivityCancellationType -&gt; ActivityCancellationType
</span><a href="Temporal.Workflow.WorkflowInstance.html#activityCancellationTypeToProto"><span class="hs-identifier hs-var">activityCancellationTypeToProto</span></a></span><span> </span><span class="annot"><span class="annottext">StartLocalActivityOptions
</span><a href="#local-6989586621680183978"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">cancellationType</span><span>
</span><span id="line-775"></span><span>                 </span><span class="hs-special">)</span><span>
</span><span id="line-776"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#addCommand"><span class="hs-identifier hs-type">addCommand</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183989"><span class="hs-identifier hs-type">cmd</span></a></span><span>
</span><span id="line-777"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-778"></span><span>      </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span>
</span><span id="line-779"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#waitAction"><span class="hs-identifier hs-var">waitAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-780"></span><span>            </span><span id="local-6989586621680184068"><span class="annot"><a href="#local-6989586621680184068"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#getIVar"><span class="hs-identifier hs-type">getIVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680183986"><span class="hs-identifier hs-type">resultSlot</span></a></span><span>
</span><span id="line-781"></span><span>            </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ResolveActivity
</span><a href="#local-6989586621680184068"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">ResolveActivity
-&gt; FoldLike
     (Maybe ActivityResolution'Status)
     ResolveActivity
     ResolveActivity
     (Maybe ActivityResolution'Status)
     (Maybe ActivityResolution'Status)
-&gt; Maybe ActivityResolution'Status
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">LensLike'
  (Constant (Maybe ActivityResolution'Status))
  ResolveActivity
  ActivityResolution
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;result&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Activation.result</span></span><span> </span><span class="annot"><span class="annottext">LensLike'
  (Constant (Maybe ActivityResolution'Status))
  ResolveActivity
  ActivityResolution
-&gt; ((Maybe ActivityResolution'Status
     -&gt; Constant
          (Maybe ActivityResolution'Status)
          (Maybe ActivityResolution'Status))
    -&gt; ActivityResolution
    -&gt; Constant (Maybe ActivityResolution'Status) ActivityResolution)
-&gt; FoldLike
     (Maybe ActivityResolution'Status)
     ResolveActivity
     ResolveActivity
     (Maybe ActivityResolution'Status)
     (Maybe ActivityResolution'Status)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ActivityResolution'Status
 -&gt; Constant
      (Maybe ActivityResolution'Status)
      (Maybe ActivityResolution'Status))
-&gt; ActivityResolution
-&gt; Constant (Maybe ActivityResolution'Status) ActivityResolution
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;maybe'status&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">ActivityResult.maybe'status</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-782"></span><span>              </span><span class="annot"><span class="annottext">Maybe ActivityResolution'Status
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; InstanceM (Result (ActivityResult act))
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Activity result missing status&quot;</span></span><span>
</span><span id="line-783"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ActivityResult.ActivityResolution'Completed</span></span><span> </span><span id="local-6989586621680184069"><span class="annot"><span class="annottext">Success
</span><a href="#local-6989586621680184069"><span class="hs-identifier hs-var">success</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-784"></span><span>                </span><span id="local-6989586621680184070"><span class="annot"><a href="#local-6989586621680184070"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either String (ActivityResult act))
-&gt; InstanceM (Either String (ActivityResult act))
forall a. IO a -&gt; InstanceM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either String (ActivityResult act))
 -&gt; InstanceM (Either String (ActivityResult act)))
-&gt; IO (Either String (ActivityResult act))
-&gt; InstanceM (Either String (ActivityResult act))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">codec -&gt; Payload -&gt; IO (Either String (ActivityResult act))
forall fmt a. Codec fmt a =&gt; fmt -&gt; Payload -&gt; IO (Either String a)
</span><a href="Temporal.Payload.html#decode"><span class="hs-identifier hs-var">decode</span></a></span><span> </span><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680183976"><span class="hs-identifier hs-var">codec</span></a></span><span> </span><span class="annot"><span class="annottext">(Payload -&gt; IO (Either String (ActivityResult act)))
-&gt; Payload -&gt; IO (Either String (ActivityResult act))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Payload -&gt; Payload
</span><a href="Temporal.Payload.html#convertFromProtoPayload"><span class="hs-identifier hs-var">convertFromProtoPayload</span></a></span><span> </span><span class="annot"><span class="annottext">(Payload -&gt; Payload) -&gt; Payload -&gt; Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Success
</span><a href="#local-6989586621680184069"><span class="hs-identifier hs-var">success</span></a></span><span> </span><span class="annot"><span class="annottext">Success
-&gt; FoldLike Payload Success Success Payload Payload -&gt; Payload
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">FoldLike Payload Success Success Payload Payload
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;result&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">ActivityResult.result</span></span><span>
</span><span id="line-785"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680184070"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-786"></span><span>                  </span><span class="hs-comment">-- TODO handle properly</span><span>
</span><span id="line-787"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680184071"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680184071"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; InstanceM (Result (ActivityResult act))
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; InstanceM (Result (ActivityResult act)))
-&gt; String -&gt; InstanceM (Result (ActivityResult act))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failed to decode activity result: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680184071"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-788"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680184072"><span class="annot"><span class="annottext">ActivityResult act
</span><a href="#local-6989586621680184072"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result (ActivityResult act)
-&gt; InstanceM (Result (ActivityResult act))
forall a. a -&gt; InstanceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Result (ActivityResult act)
 -&gt; InstanceM (Result (ActivityResult act)))
-&gt; Result (ActivityResult act)
-&gt; InstanceM (Result (ActivityResult act))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ActivityResult act -&gt; Result (ActivityResult act)
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">ActivityResult act
</span><a href="#local-6989586621680184072"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-789"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ActivityResult.ActivityResolution'Failed</span></span><span> </span><span id="local-6989586621680184073"><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680184073"><span class="hs-identifier hs-var">failure_</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-790"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680184074"><span class="annot"><span class="annottext">failure :: Failure
</span><a href="#local-6989586621680184074"><span class="hs-identifier hs-var hs-var">failure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680184073"><span class="hs-identifier hs-var">failure_</span></a></span><span> </span><span class="annot"><span class="annottext">Failure
-&gt; FoldLike Failure Failure Failure Failure Failure -&gt; Failure
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">FoldLike Failure Failure Failure Failure Failure
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;failure&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">ActivityResult.failure</span></span><span>
</span><span id="line-791"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Result (ActivityResult act)
-&gt; InstanceM (Result (ActivityResult act))
forall a. a -&gt; InstanceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Result (ActivityResult act)
 -&gt; InstanceM (Result (ActivityResult act)))
-&gt; Result (ActivityResult act)
-&gt; InstanceM (Result (ActivityResult act))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-792"></span><span>                    </span><span class="annot"><span class="annottext">SomeException -&gt; Result (ActivityResult act)
forall a. SomeException -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-var">Throw</span></a></span><span> </span><span class="annot"><span class="annottext">(SomeException -&gt; Result (ActivityResult act))
-&gt; SomeException -&gt; Result (ActivityResult act)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-793"></span><span>                      </span><span class="annot"><span class="annottext">ActivityFailure -&gt; SomeException
forall e. Exception e =&gt; e -&gt; SomeException
</span><span class="hs-identifier hs-var">toException</span></span><span> </span><span class="annot"><span class="annottext">(ActivityFailure -&gt; SomeException)
-&gt; ActivityFailure -&gt; SomeException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-794"></span><span>                        </span><span class="annot"><a href="Temporal.Exception.html#ActivityFailure"><span class="hs-identifier hs-type">ActivityFailure</span></a></span><span>
</span><span id="line-795"></span><span>                          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">message :: Text
</span><a href="#local-6989586621680183231"><span class="hs-identifier hs-var">message</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680184074"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">Failure -&gt; FoldLike Text Failure Failure Text Text -&gt; Text
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">FoldLike Text Failure Failure Text Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;message&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.message</span></span><span>
</span><span id="line-796"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">activityType :: ActivityType
</span><a href="#local-6989586621680183233"><span class="hs-identifier hs-var">activityType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ActivityType
</span><a href="Temporal.Common.html#ActivityType"><span class="hs-identifier hs-var">ActivityType</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680183977"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-797"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">activityId :: ActivityId
</span><a href="#local-6989586621680183235"><span class="hs-identifier hs-var">activityId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ActivityId
</span><a href="Temporal.Common.html#ActivityId"><span class="hs-identifier hs-var">ActivityId</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680183988"><span class="hs-identifier hs-var">actId</span></a></span><span>
</span><span id="line-798"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">retryState :: RetryState
</span><a href="#local-6989586621680183237"><span class="hs-identifier hs-var">retryState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RetryState -&gt; RetryState
</span><a href="Temporal.Common.html#retryStateFromProto"><span class="hs-identifier hs-var">retryStateFromProto</span></a></span><span> </span><span class="annot"><span class="annottext">(RetryState -&gt; RetryState) -&gt; RetryState -&gt; RetryState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680184074"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">Failure
-&gt; FoldLike RetryState Failure Failure RetryState RetryState
-&gt; RetryState
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant RetryState) Failure ActivityFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;activityFailureInfo&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.activityFailureInfo</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant RetryState) Failure ActivityFailureInfo
-&gt; ((RetryState -&gt; Constant RetryState RetryState)
    -&gt; ActivityFailureInfo -&gt; Constant RetryState ActivityFailureInfo)
-&gt; FoldLike RetryState Failure Failure RetryState RetryState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(RetryState -&gt; Constant RetryState RetryState)
-&gt; ActivityFailureInfo -&gt; Constant RetryState ActivityFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;retryState&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.retryState</span></span><span>
</span><span id="line-799"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">identity :: Text
</span><a href="#local-6989586621680183241"><span class="hs-identifier hs-var">identity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680184074"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">Failure -&gt; FoldLike Text Failure Failure Text Text -&gt; Text
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Text) Failure ActivityFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;activityFailureInfo&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.activityFailureInfo</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Text) Failure ActivityFailureInfo
-&gt; ((Text -&gt; Constant Text Text)
    -&gt; ActivityFailureInfo -&gt; Constant Text ActivityFailureInfo)
-&gt; FoldLike Text Failure Failure Text Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Constant Text Text)
-&gt; ActivityFailureInfo -&gt; Constant Text ActivityFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;identity&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.identity</span></span><span>
</span><span id="line-800"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cause :: ApplicationFailure
</span><a href="#local-6989586621680183243"><span class="hs-identifier hs-var">cause</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-801"></span><span>                              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680184075"><span class="annot"><span class="annottext">cause_ :: Failure
</span><a href="#local-6989586621680184075"><span class="hs-identifier hs-var hs-var">cause_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680184074"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">Failure
-&gt; FoldLike Failure Failure Failure Failure Failure -&gt; Failure
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">FoldLike Failure Failure Failure Failure Failure
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;cause&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.cause</span></span><span>
</span><span id="line-802"></span><span>                              </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="Temporal.Exception.html#ApplicationFailure"><span class="hs-identifier hs-type">ApplicationFailure</span></a></span><span>
</span><span id="line-803"></span><span>                                  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">type' :: Text
</span><a href="#local-6989586621680183247"><span class="hs-identifier hs-var">type'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680184075"><span class="hs-identifier hs-var">cause_</span></a></span><span> </span><span class="annot"><span class="annottext">Failure -&gt; FoldLike Text Failure Failure Text Text -&gt; Text
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Text) Failure ApplicationFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;applicationFailureInfo&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.applicationFailureInfo</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Text) Failure ApplicationFailureInfo
-&gt; ((Text -&gt; Constant Text Text)
    -&gt; ApplicationFailureInfo -&gt; Constant Text ApplicationFailureInfo)
-&gt; FoldLike Text Failure Failure Text Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Constant Text Text)
-&gt; ApplicationFailureInfo -&gt; Constant Text ApplicationFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;type'&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.type'</span></span><span>
</span><span id="line-804"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">message :: Text
</span><a href="#local-6989586621680183250"><span class="hs-identifier hs-var">message</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680184075"><span class="hs-identifier hs-var">cause_</span></a></span><span> </span><span class="annot"><span class="annottext">Failure -&gt; FoldLike Text Failure Failure Text Text -&gt; Text
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">FoldLike Text Failure Failure Text Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;message&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.message</span></span><span>
</span><span id="line-805"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nonRetryable :: Bool
</span><a href="#local-6989586621680183251"><span class="hs-identifier hs-var">nonRetryable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680184075"><span class="hs-identifier hs-var">cause_</span></a></span><span> </span><span class="annot"><span class="annottext">Failure -&gt; FoldLike Bool Failure Failure Bool Bool -&gt; Bool
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Bool) Failure ApplicationFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;applicationFailureInfo&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.applicationFailureInfo</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Bool) Failure ApplicationFailureInfo
-&gt; ((Bool -&gt; Constant Bool Bool)
    -&gt; ApplicationFailureInfo -&gt; Constant Bool ApplicationFailureInfo)
-&gt; FoldLike Bool Failure Failure Bool Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Constant Bool Bool)
-&gt; ApplicationFailureInfo -&gt; Constant Bool ApplicationFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;nonRetryable&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.nonRetryable</span></span><span>
</span><span id="line-806"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">details :: [Payload]
</span><a href="#local-6989586621680183253"><span class="hs-identifier hs-var">details</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680184075"><span class="hs-identifier hs-var">cause_</span></a></span><span> </span><span class="annot"><span class="annottext">Failure
-&gt; FoldLike [Payload] Failure Failure [Payload] Any -&gt; [Payload]
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant [Payload]) Failure ApplicationFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;applicationFailureInfo&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.applicationFailureInfo</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant [Payload]) Failure ApplicationFailureInfo
-&gt; (([Payload] -&gt; Constant [Payload] Any)
    -&gt; ApplicationFailureInfo
    -&gt; Constant [Payload] ApplicationFailureInfo)
-&gt; FoldLike [Payload] Failure Failure [Payload] Any
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant [Payload]) ApplicationFailureInfo Payloads
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;details&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.details</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant [Payload]) ApplicationFailureInfo Payloads
-&gt; (([Payload] -&gt; Constant [Payload] Any)
    -&gt; Payloads -&gt; Constant [Payload] Payloads)
-&gt; ([Payload] -&gt; Constant [Payload] Any)
-&gt; ApplicationFailureInfo
-&gt; Constant [Payload] ApplicationFailureInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant [Payload]) Payloads [Payload]
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;payloads&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Payloads.payloads</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant [Payload]) Payloads [Payload]
-&gt; (([Payload] -&gt; Constant [Payload] Any)
    -&gt; [Payload] -&gt; Constant [Payload] [Payload])
-&gt; ([Payload] -&gt; Constant [Payload] Any)
-&gt; Payloads
-&gt; Constant [Payload] Payloads
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([Payload] -&gt; [Payload])
-&gt; Getter [Payload] [Payload] [Payload] Any
forall s a t b. (s -&gt; a) -&gt; Getter s t a b
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Payload -&gt; Payload) -&gt; [Payload] -&gt; [Payload]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Payload -&gt; Payload
</span><a href="Temporal.Payload.html#convertFromProtoPayload"><span class="hs-identifier hs-var">convertFromProtoPayload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-807"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stack :: Text
</span><a href="#local-6989586621680183257"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680184075"><span class="hs-identifier hs-var">cause_</span></a></span><span> </span><span class="annot"><span class="annottext">Failure -&gt; FoldLike Text Failure Failure Text Text -&gt; Text
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">FoldLike Text Failure Failure Text Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;stackTrace&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.stackTrace</span></span><span>
</span><span id="line-808"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nextRetryDelay :: Maybe Duration
</span><a href="#local-6989586621680183259"><span class="hs-identifier hs-var">nextRetryDelay</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Duration
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-809"></span><span>                                  </span><span class="hs-special">}</span><span>
</span><span id="line-810"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">scheduledEventId :: Int64
</span><a href="#local-6989586621680183261"><span class="hs-identifier hs-var">scheduledEventId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680184074"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">Failure -&gt; FoldLike Int64 Failure Failure Int64 Int64 -&gt; Int64
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Int64) Failure ActivityFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;activityFailureInfo&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.activityFailureInfo</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Int64) Failure ActivityFailureInfo
-&gt; ((Int64 -&gt; Constant Int64 Int64)
    -&gt; ActivityFailureInfo -&gt; Constant Int64 ActivityFailureInfo)
-&gt; FoldLike Int64 Failure Failure Int64 Int64
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int64 -&gt; Constant Int64 Int64)
-&gt; ActivityFailureInfo -&gt; Constant Int64 ActivityFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;scheduledEventId&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.scheduledEventId</span></span><span>
</span><span id="line-811"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">startedEventId :: Int64
</span><a href="#local-6989586621680183263"><span class="hs-identifier hs-var">startedEventId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680184074"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">Failure -&gt; FoldLike Int64 Failure Failure Int64 Int64 -&gt; Int64
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Int64) Failure ActivityFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;activityFailureInfo&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.activityFailureInfo</span></span><span> </span><span class="annot"><span class="annottext">LensLike' (Constant Int64) Failure ActivityFailureInfo
-&gt; ((Int64 -&gt; Constant Int64 Int64)
    -&gt; ActivityFailureInfo -&gt; Constant Int64 ActivityFailureInfo)
-&gt; FoldLike Int64 Failure Failure Int64 Int64
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int64 -&gt; Constant Int64 Int64)
-&gt; ActivityFailureInfo -&gt; Constant Int64 ActivityFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;startedEventId&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.startedEventId</span></span><span>
</span><span id="line-812"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">original :: ActivityFailureInfo
</span><a href="#local-6989586621680183265"><span class="hs-identifier hs-var">original</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Failure
</span><a href="#local-6989586621680184074"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">Failure
-&gt; FoldLike
     ActivityFailureInfo
     Failure
     Failure
     ActivityFailureInfo
     ActivityFailureInfo
-&gt; ActivityFailureInfo
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">FoldLike
  ActivityFailureInfo
  Failure
  Failure
  ActivityFailureInfo
  ActivityFailureInfo
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;activityFailureInfo&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Failure.activityFailureInfo</span></span><span>
</span><span id="line-813"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stack :: Text
</span><a href="#local-6989586621680183266"><span class="hs-identifier hs-var">stack</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; String -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CallStack -&gt; String
</span><a href="Temporal.Exception.html#prettyCallStack"><span class="hs-identifier hs-var">Temporal.Exception.prettyCallStack</span></a></span><span> </span><span class="annot"><span class="annottext">CallStack
HasCallStack =&gt; CallStack
</span><span class="hs-identifier hs-var">callStack</span></span><span>
</span><span id="line-814"></span><span>                          </span><span class="hs-special">}</span><span>
</span><span id="line-815"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ActivityResult.ActivityResolution'Cancelled</span></span><span> </span><span id="local-6989586621680184076"><span class="annot"><span class="annottext">Cancellation
</span><a href="#local-6989586621680184076"><span class="hs-identifier hs-var">details</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result (ActivityResult act)
-&gt; InstanceM (Result (ActivityResult act))
forall a. a -&gt; InstanceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Result (ActivityResult act)
 -&gt; InstanceM (Result (ActivityResult act)))
-&gt; Result (ActivityResult act)
-&gt; InstanceM (Result (ActivityResult act))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Result (ActivityResult act)
forall a. SomeException -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-var">Throw</span></a></span><span> </span><span class="annot"><span class="annottext">(SomeException -&gt; Result (ActivityResult act))
-&gt; SomeException -&gt; Result (ActivityResult act)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ActivityCancelled -&gt; SomeException
forall e. Exception e =&gt; e -&gt; SomeException
</span><span class="hs-identifier hs-var">toException</span></span><span> </span><span class="annot"><span class="annottext">(ActivityCancelled -&gt; SomeException)
-&gt; ActivityCancelled -&gt; SomeException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Failure -&gt; ActivityCancelled
</span><a href="Temporal.Exception.html#ActivityCancelled"><span class="hs-identifier hs-var">ActivityCancelled</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cancellation
</span><a href="#local-6989586621680184076"><span class="hs-identifier hs-var">details</span></a></span><span> </span><span class="annot"><span class="annottext">Cancellation
-&gt; FoldLike Failure Cancellation Cancellation Failure Failure
-&gt; Failure
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">FoldLike Failure Cancellation Cancellation Failure Failure
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;failure&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">ActivityResult.failure</span></span><span class="hs-special">)</span><span>
</span><span id="line-816"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ActivityResult.ActivityResolution'Backoff</span></span><span> </span><span id="local-6989586621680184077"><span class="annot"><span class="annottext">DoBackoff
</span><a href="#local-6989586621680184077"><span class="hs-identifier hs-var">_doBackoff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; InstanceM (Result (ActivityResult act))
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;not implemented&quot;</span></span><span>
</span><span id="line-817"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#cancelAction"><span class="hs-identifier hs-var">cancelAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-818"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680184078"><span class="annot"><a href="#local-6989586621680184078"><span class="hs-identifier hs-var hs-var">cancelCmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-819"></span><span>                  </span><span class="annot"><span class="annottext">WorkflowCommand
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-820"></span><span>                    </span><span class="annot"><span class="annottext">WorkflowCommand
-&gt; (WorkflowCommand -&gt; WorkflowCommand) -&gt; WorkflowCommand
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f WorkflowCommand RequestCancelLocalActivity
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f WorkflowCommand RequestCancelLocalActivity
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;requestCancelLocalActivity&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.requestCancelLocalActivity</span></span><span>
</span><span id="line-821"></span><span>                      </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f WorkflowCommand RequestCancelLocalActivity)
-&gt; RequestCancelLocalActivity -&gt; WorkflowCommand -&gt; WorkflowCommand
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">RequestCancelLocalActivity
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-822"></span><span>                            </span><span class="annot"><span class="annottext">RequestCancelLocalActivity
-&gt; (RequestCancelLocalActivity -&gt; RequestCancelLocalActivity)
-&gt; RequestCancelLocalActivity
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f RequestCancelLocalActivity Word32
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f RequestCancelLocalActivity Word32
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;seq&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.seq</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f RequestCancelLocalActivity Word32)
-&gt; Word32
-&gt; RequestCancelLocalActivity
-&gt; RequestCancelLocalActivity
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621680183985"><span class="hs-identifier hs-var">actSeq</span></a></span><span>
</span><span id="line-823"></span><span>                         </span><span class="hs-special">)</span><span>
</span><span id="line-824"></span><span>            </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ilift"><span class="hs-identifier hs-type">ilift</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#addCommand"><span class="hs-identifier hs-type">addCommand</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184078"><span class="hs-identifier hs-type">cancelCmd</span></a></span><span>
</span><span id="line-825"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-826"></span><span>
</span><span id="line-827"></span><span>
</span><span id="line-828"></span><span class="annot"><span class="hs-comment">{- $metadata

Temporal provides a number of ways to access metadata about the current Workflow execution.

Some are useful for debugging (like 'memo', and 'upsertSearchAttributes'), and some are useful for
making decisions about how to proceed (like using 'info' to decide whether to continue-as-new).
-}</span></span><span>
</span><span id="line-835"></span><span>
</span><span id="line-836"></span><span>
</span><span id="line-837"></span><span class="annot"><span class="hs-comment">{- | We recommend calling 'info' whenever accessing 'Info' fields. Some 'Info' fields change during the lifetime of an Execution&#8212;
like historyLength and searchAttributes&#8212; and some may be changeable in the future&#8212; like taskQueue.
-}</span></span><span>
</span><span id="line-840"></span><span class="annot"><a href="Temporal.Workflow.html#info"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span>
</span><span id="line-841"></span><span id="info"><span class="annot"><span class="annottext">info :: Workflow Info
</span><a href="Temporal.Workflow.html#info"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Workflow WorkflowInstance
</span><a href="Temporal.Workflow.Internal.Monad.html#askInstance"><span class="hs-identifier hs-var">askInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow WorkflowInstance
-&gt; (WorkflowInstance -&gt; Workflow Info) -&gt; Workflow Info
forall a b. Workflow a -&gt; (a -&gt; Workflow b) -&gt; Workflow b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680184095"><span class="annot"><span class="annottext">InstanceM Info
</span><a href="#local-6989586621680184095"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result Info)) -&gt; Workflow Info
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result Info)) -&gt; Workflow Info)
-&gt; (ContinuationEnv -&gt; InstanceM (Result Info)) -&gt; Workflow Info
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; Result Info
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">(Info -&gt; Result Info) -&gt; InstanceM Info -&gt; InstanceM (Result Info)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">InstanceM Info
</span><a href="#local-6989586621680184095"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(InstanceM Info -&gt; Workflow Info)
-&gt; (WorkflowInstance -&gt; InstanceM Info)
-&gt; WorkflowInstance
-&gt; Workflow Info
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IORef Info -&gt; InstanceM Info
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; m a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">(IORef Info -&gt; InstanceM Info)
-&gt; (WorkflowInstance -&gt; IORef Info)
-&gt; WorkflowInstance
-&gt; InstanceM Info
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">WorkflowInstance -&gt; IORef Info
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowInstanceInfo"><span class="hs-identifier hs-var">workflowInstanceInfo</span></a></span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span>
</span><span id="line-844"></span><span class="hs-comment">-- (ask &gt;&gt;= readIORef) workflowInstanceInfo &lt;$&gt; askInstance</span><span>
</span><span id="line-845"></span><span>
</span><span id="line-846"></span><span class="annot"><span class="hs-comment">-- | Current workflow's raw memo values.</span></span><span>
</span><span id="line-847"></span><span class="annot"><a href="Temporal.Workflow.html#getMemoValues"><span class="hs-identifier hs-type">getMemoValues</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-848"></span><span id="getMemoValues"><span class="annot"><span class="annottext">getMemoValues :: Workflow (Map Text Payload)
</span><a href="Temporal.Workflow.html#getMemoValues"><span class="hs-identifier hs-var hs-var">getMemoValues</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator">.</span><span class="hs-identifier">rawMemo</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Info -&gt; Map Text Payload)
-&gt; Workflow Info -&gt; Workflow (Map Text Payload)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Workflow Info
</span><a href="Temporal.Workflow.html#info"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-849"></span><span>
</span><span id="line-850"></span><span>
</span><span id="line-851"></span><span class="annot"><span class="hs-comment">-- | Lookup a memo value by key.</span></span><span>
</span><span id="line-852"></span><span class="annot"><a href="Temporal.Workflow.html#lookupMemoValue"><span class="hs-identifier hs-type">lookupMemoValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-853"></span><span id="lookupMemoValue"><span class="annot"><span class="annottext">lookupMemoValue :: Text -&gt; Workflow (Maybe Payload)
</span><a href="Temporal.Workflow.html#lookupMemoValue"><span class="hs-identifier hs-var hs-var">lookupMemoValue</span></a></span></span><span> </span><span id="local-6989586621680184097"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680184097"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Map Text Payload -&gt; Maybe Payload
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680184097"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Text Payload -&gt; Maybe Payload)
-&gt; Workflow (Map Text Payload) -&gt; Workflow (Maybe Payload)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Workflow (Map Text Payload)
</span><a href="Temporal.Workflow.html#getMemoValues"><span class="hs-identifier hs-var">getMemoValues</span></a></span><span>
</span><span id="line-854"></span><span>
</span><span id="line-855"></span><span>
</span><span id="line-856"></span><span class="annot"><span class="hs-comment">{- | Updates this Workflow's Search Attributes by merging the provided searchAttributes with the existing Search Attributes

Using this function will overwrite any existing Search Attributes with the same key.
-}</span></span><span>
</span><span id="line-860"></span><span class="annot"><a href="Temporal.Workflow.html#upsertSearchAttributes"><span class="hs-identifier hs-type">upsertSearchAttributes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Temporal.SearchAttributes.html#SearchAttributeKey"><span class="hs-identifier hs-type">SearchAttributeKey</span></a></span><span> </span><span class="annot"><a href="Temporal.SearchAttributes.html#SearchAttributeType"><span class="hs-identifier hs-type">SearchAttributeType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-861"></span><span id="upsertSearchAttributes"><span class="annot"><span class="annottext">upsertSearchAttributes :: RequireCallStack =&gt;
Map SearchAttributeKey SearchAttributeType -&gt; Workflow ()
</span><a href="Temporal.Workflow.html#upsertSearchAttributes"><span class="hs-identifier hs-var hs-var">upsertSearchAttributes</span></a></span></span><span> </span><span id="local-6989586621680184119"><span class="annot"><span class="annottext">Map SearchAttributeKey SearchAttributeType
</span><a href="#local-6989586621680184119"><span class="hs-identifier hs-var">values</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstanceM () -&gt; Workflow ()
forall a. RequireCallStack =&gt; InstanceM a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#ilift"><span class="hs-identifier hs-var">ilift</span></a></span><span> </span><span class="annot"><span class="annottext">(InstanceM () -&gt; Workflow ()) -&gt; InstanceM () -&gt; Workflow ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-862"></span><span>  </span><span class="annot"><span class="annottext">InstanceM ()
RequireCallStack =&gt; InstanceM ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStack"><span class="hs-identifier hs-var">updateCallStack</span></a></span><span>
</span><span id="line-863"></span><span>  </span><span id="local-6989586621680184120"><span class="annot"><a href="#local-6989586621680184120"><span class="hs-identifier hs-var">attrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Map Text Payload) -&gt; InstanceM (Map Text Payload)
forall a. IO a -&gt; InstanceM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Map Text Payload) -&gt; InstanceM (Map Text Payload))
-&gt; IO (Map Text Payload) -&gt; InstanceM (Map Text Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map SearchAttributeKey SearchAttributeType -&gt; IO (Map Text Payload)
</span><a href="Temporal.SearchAttributes.Internal.html#searchAttributesToProto"><span class="hs-identifier hs-var">searchAttributesToProto</span></a></span><span> </span><span class="annot"><span class="annottext">Map SearchAttributeKey SearchAttributeType
</span><a href="#local-6989586621680184119"><span class="hs-identifier hs-var">values</span></a></span><span>
</span><span id="line-864"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680184121"><span class="annot"><a href="#local-6989586621680184121"><span class="hs-identifier hs-var hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-865"></span><span>        </span><span class="annot"><span class="annottext">WorkflowCommand
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-866"></span><span>          </span><span class="annot"><span class="annottext">WorkflowCommand
-&gt; (WorkflowCommand -&gt; WorkflowCommand) -&gt; WorkflowCommand
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f WorkflowCommand UpsertWorkflowSearchAttributes
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f WorkflowCommand UpsertWorkflowSearchAttributes
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;upsertWorkflowSearchAttributes&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.upsertWorkflowSearchAttributes</span></span><span>
</span><span id="line-867"></span><span>            </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f WorkflowCommand UpsertWorkflowSearchAttributes)
-&gt; UpsertWorkflowSearchAttributes
-&gt; WorkflowCommand
-&gt; WorkflowCommand
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">UpsertWorkflowSearchAttributes
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-868"></span><span>                  </span><span class="annot"><span class="annottext">UpsertWorkflowSearchAttributes
-&gt; (UpsertWorkflowSearchAttributes
    -&gt; UpsertWorkflowSearchAttributes)
-&gt; UpsertWorkflowSearchAttributes
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f UpsertWorkflowSearchAttributes (Map Text Payload)
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f UpsertWorkflowSearchAttributes (Map Text Payload)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;searchAttributes&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.searchAttributes</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f UpsertWorkflowSearchAttributes (Map Text Payload))
-&gt; Map Text Payload
-&gt; UpsertWorkflowSearchAttributes
-&gt; UpsertWorkflowSearchAttributes
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Map Text Payload
</span><a href="#local-6989586621680184120"><span class="hs-identifier hs-var">attrs</span></a></span><span>
</span><span id="line-869"></span><span>               </span><span class="hs-special">)</span><span>
</span><span id="line-870"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#addCommand"><span class="hs-identifier hs-type">addCommand</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184121"><span class="hs-identifier hs-type">cmd</span></a></span><span>
</span><span id="line-871"></span><span>  </span><span id="local-6989586621680184135"><span class="annot"><a href="#local-6989586621680184135"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ask</span></span><span>
</span><span id="line-872"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">modifyIORef'</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowInstanceInfo</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Temporal.Workflow.Types.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680184137"><span id="local-6989586621680184138"><span id="local-6989586621680184139"><span id="local-6989586621680184140"><span id="local-6989586621680184141"><span id="local-6989586621680184142"><span id="local-6989586621680184143"><span id="local-6989586621680184144"><span id="local-6989586621680184145"><span id="local-6989586621680184146"><span id="local-6989586621680184147"><span id="local-6989586621680184148"><span id="local-6989586621680184149"><span id="local-6989586621680184150"><span id="local-6989586621680184151"><span id="local-6989586621680184152"><span id="local-6989586621680184153"><span id="local-6989586621680184154"><span id="local-6989586621680184155"><span class="annot"><span class="annottext">Bool
Int
Maybe Text
Maybe Duration
Maybe ParentInfo
Maybe RetryPolicy
Maybe RunId
Word32
Map Text Payload
Map SearchAttributeKey SearchAttributeType
SystemTime
Duration
TaskQueue
RunId
Namespace
WorkflowId
WorkflowType
historyLength :: Word32
attempt :: Int
continuedRunId :: Maybe RunId
cronSchedule :: Maybe Text
executionTimeout :: Maybe Duration
headers :: Map Text Payload
namespace :: Namespace
parent :: Maybe ParentInfo
rawMemo :: Map Text Payload
retryPolicy :: Maybe RetryPolicy
runId :: RunId
runTimeout :: Maybe Duration
searchAttributes :: Map SearchAttributeKey SearchAttributeType
startTime :: SystemTime
taskQueue :: TaskQueue
taskTimeout :: Duration
workflowId :: WorkflowId
workflowType :: WorkflowType
continueAsNewSuggested :: Bool
continueAsNewSuggested :: Info -&gt; Bool
workflowType :: Info -&gt; WorkflowType
workflowId :: Info -&gt; WorkflowId
taskTimeout :: Info -&gt; Duration
taskQueue :: Info -&gt; TaskQueue
startTime :: Info -&gt; SystemTime
searchAttributes :: Info -&gt; Map SearchAttributeKey SearchAttributeType
runTimeout :: Info -&gt; Maybe Duration
runId :: Info -&gt; RunId
retryPolicy :: Info -&gt; Maybe RetryPolicy
rawMemo :: Info -&gt; Map Text Payload
parent :: Info -&gt; Maybe ParentInfo
namespace :: Info -&gt; Namespace
headers :: Info -&gt; Map Text Payload
executionTimeout :: Info -&gt; Maybe Duration
cronSchedule :: Info -&gt; Maybe Text
continuedRunId :: Info -&gt; Maybe RunId
attempt :: Info -&gt; Int
historyLength :: Info -&gt; Word32
</span><a href="#local-6989586621680184137"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-873"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Types.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">searchAttributes :: Map SearchAttributeKey SearchAttributeType
</span><a href="Temporal.Workflow.Types.html#searchAttributes"><span class="hs-identifier hs-var">searchAttributes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map SearchAttributeKey SearchAttributeType
</span><a href="#local-6989586621680184149"><span class="hs-identifier hs-var">searchAttributes</span></a></span><span> </span><span class="annot"><span class="annottext">Map SearchAttributeKey SearchAttributeType
-&gt; Map SearchAttributeKey SearchAttributeType
-&gt; Map SearchAttributeKey SearchAttributeType
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map SearchAttributeKey SearchAttributeType
</span><a href="#local-6989586621680184119"><span class="hs-identifier hs-var">values</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
Int
Maybe Text
Maybe Duration
Maybe ParentInfo
Maybe RetryPolicy
Maybe RunId
Word32
Map Text Payload
SystemTime
Duration
TaskQueue
RunId
Namespace
WorkflowId
WorkflowType
historyLength :: Word32
attempt :: Int
continuedRunId :: Maybe RunId
cronSchedule :: Maybe Text
executionTimeout :: Maybe Duration
headers :: Map Text Payload
namespace :: Namespace
parent :: Maybe ParentInfo
rawMemo :: Map Text Payload
retryPolicy :: Maybe RetryPolicy
runId :: RunId
runTimeout :: Maybe Duration
startTime :: SystemTime
taskQueue :: TaskQueue
taskTimeout :: Duration
workflowId :: WorkflowId
workflowType :: WorkflowType
continueAsNewSuggested :: Bool
continueAsNewSuggested :: Bool
workflowType :: WorkflowType
workflowId :: WorkflowId
taskTimeout :: Duration
taskQueue :: TaskQueue
startTime :: SystemTime
runTimeout :: Maybe Duration
runId :: RunId
retryPolicy :: Maybe RetryPolicy
rawMemo :: Map Text Payload
parent :: Maybe ParentInfo
namespace :: Namespace
headers :: Map Text Payload
executionTimeout :: Maybe Duration
cronSchedule :: Maybe Text
continuedRunId :: Maybe RunId
attempt :: Int
historyLength :: Word32
</span><a href="#local-6989586621680184137"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-874"></span><span>
</span><span id="line-875"></span><span>
</span><span id="line-876"></span><span class="annot"><span class="hs-comment">{- | Current time from the workflow perspective.

The time returned is updated only when the workflow performs an
operation in the Workflow monad that blocks. Examples of such operations
are 'sleep', 'awaitCondition', 'awaitActivity', 'awaitWorkflow', etc.

Equivalent to `getCurrentTime` from the `time` package.
-}</span></span><span>
</span><span id="line-884"></span><span class="annot"><a href="Temporal.Workflow.html#now"><span class="hs-identifier hs-type">now</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span>
</span><span id="line-885"></span><span id="now"><span class="annot"><span class="annottext">now :: Workflow UTCTime
</span><a href="Temporal.Workflow.html#now"><span class="hs-identifier hs-var hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result UTCTime)) -&gt; Workflow UTCTime
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result UTCTime))
 -&gt; Workflow UTCTime)
-&gt; (ContinuationEnv -&gt; InstanceM (Result UTCTime))
-&gt; Workflow UTCTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-886"></span><span>  </span><span class="annot"><span class="annottext">UTCTime -&gt; Result UTCTime
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">(UTCTime -&gt; Result UTCTime)
-&gt; InstanceM UTCTime -&gt; InstanceM (Result UTCTime)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-887"></span><span>    </span><span id="local-6989586621680184175"><span class="annot"><a href="#local-6989586621680184175"><span class="hs-identifier hs-var">wft</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(WorkflowInstance -&gt; IORef SystemTime)
-&gt; InstanceM (IORef SystemTime)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">WorkflowInstance -&gt; IORef SystemTime
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowTime"><span class="hs-identifier hs-var">workflowTime</span></a></span><span>
</span><span id="line-888"></span><span>    </span><span id="local-6989586621680184178"><span class="annot"><a href="#local-6989586621680184178"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621680184175"><span class="hs-identifier hs-type">wft</span></a></span><span>
</span><span id="line-889"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$!</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">systemToUTCTime</span></span><span> </span><span class="annot"><a href="#local-6989586621680184178"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-890"></span><span>
</span><span id="line-891"></span><span>
</span><span id="line-892"></span><span class="annot"><span class="hs-comment">{- | When using the &quot;Schedules&quot; feature of Temporal, this is the effective time that an instance was scheduled to run,
according to the @TemporalScheduledStartTime@ search attribute.

This is useful for backfilling or retrying a scheduled Workflow if you need the schedule to have a stable start time.
-}</span></span><span>
</span><span id="line-897"></span><span class="annot"><a href="Temporal.Workflow.html#scheduledTime"><span class="hs-identifier hs-type">scheduledTime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-898"></span><span id="scheduledTime"><span class="annot"><span class="annottext">scheduledTime :: Workflow (Maybe UTCTime)
</span><a href="Temporal.Workflow.html#scheduledTime"><span class="hs-identifier hs-var hs-var">scheduledTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-899"></span><span>  </span><span id="local-6989586621680184180"><span class="annot"><a href="#local-6989586621680184180"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Workflow Info
</span><a href="Temporal.Workflow.html#info"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-900"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.lookup</span></span><span> </span><span class="annot"><span class="hs-string">&quot;TemporalScheduledStartTime&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier">i</span></span><span class="hs-operator">.</span><span class="hs-identifier">searchAttributes</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-901"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.SearchAttributes.html#Datetime"><span class="hs-identifier hs-type">Datetime</span></a></span><span> </span><span id="local-6989586621680184182"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621680184182"><span class="hs-identifier hs-var">utcTime</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-902"></span><span>      </span><span class="hs-comment">-- The scheduled start time exists and is a datetime, so we can use it</span><span>
</span><span id="line-903"></span><span>      </span><span class="hs-comment">-- directly.</span><span>
</span><span id="line-904"></span><span>      </span><span class="annot"><span class="annottext">UTCTime -&gt; Maybe UTCTime
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621680184182"><span class="hs-identifier hs-var">utcTime</span></a></span><span>
</span><span id="line-905"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.SearchAttributes.html#KeywordOrText"><span class="hs-identifier hs-type">KeywordOrText</span></a></span><span> </span><span id="local-6989586621680184184"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680184184"><span class="hs-identifier hs-var">text</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-906"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680184185"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621680184185"><span class="hs-identifier hs-var">utcTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TimeLocale -&gt; String -&gt; String -&gt; Maybe UTCTime
forall (m :: * -&gt; *) t.
(MonadFail m, ParseTime t) =&gt;
Bool -&gt; TimeLocale -&gt; String -&gt; String -&gt; m t
</span><span class="hs-identifier hs-var">parseTimeM</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">TimeLocale
</span><span class="hs-identifier hs-var">defaultTimeLocale</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;%Y-%m-%dT%H:%M:%SZ&quot;</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Maybe UTCTime) -&gt; String -&gt; Maybe UTCTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680184184"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-907"></span><span>          </span><span class="hs-comment">-- The scheduled start time exists as a text value and can be parsed</span><span>
</span><span id="line-908"></span><span>          </span><span class="hs-comment">-- as a datetime, so we can use it.</span><span>
</span><span id="line-909"></span><span>          </span><span class="annot"><span class="annottext">UTCTime -&gt; Maybe UTCTime
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621680184185"><span class="hs-identifier hs-var">utcTime</span></a></span><span>
</span><span id="line-910"></span><span>    </span><span class="annot"><span class="annottext">Maybe SearchAttributeType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-911"></span><span>
</span><span id="line-912"></span><span>
</span><span id="line-913"></span><span class="annot"><span class="hs-comment">{- $versioning

Versioning (known as &quot;patching&quot; in the Haskell library) lets you update Workflow Definitions
without causing non-deterministic behavior in current long-running Workflows.

You may need to patch if:

- You want to change the remaining logic of a Workflow while it is still running
- If your new logic can result in a different execution path
-}</span></span><span>
</span><span id="line-923"></span><span>
</span><span id="line-924"></span><span>
</span><span id="line-925"></span><span class="annot"><a href="Temporal.Workflow.html#applyPatch"><span class="hs-identifier hs-type">applyPatch</span></a></span><span>
</span><span id="line-926"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span>
</span><span id="line-927"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Common.html#PatchId"><span class="hs-identifier hs-type">PatchId</span></a></span><span>
</span><span id="line-928"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-929"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ whether the patch is deprecated</span></span><span>
</span><span id="line-930"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-931"></span><span id="applyPatch"><span class="annot"><span class="annottext">applyPatch :: RequireCallStack =&gt; PatchId -&gt; Bool -&gt; Workflow Bool
</span><a href="Temporal.Workflow.html#applyPatch"><span class="hs-identifier hs-var hs-var">applyPatch</span></a></span></span><span> </span><span id="local-6989586621680184227"><span class="annot"><span class="annottext">PatchId
</span><a href="#local-6989586621680184227"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span id="local-6989586621680184228"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680184228"><span class="hs-identifier hs-var">deprecated</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstanceM Bool -&gt; Workflow Bool
forall a. RequireCallStack =&gt; InstanceM a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#ilift"><span class="hs-identifier hs-var">ilift</span></a></span><span> </span><span class="annot"><span class="annottext">(InstanceM Bool -&gt; Workflow Bool)
-&gt; InstanceM Bool -&gt; Workflow Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-932"></span><span>  </span><span class="annot"><span class="annottext">InstanceM ()
RequireCallStack =&gt; InstanceM ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStack"><span class="hs-identifier hs-var">updateCallStack</span></a></span><span>
</span><span id="line-933"></span><span>  </span><span id="local-6989586621680184229"><span class="annot"><a href="#local-6989586621680184229"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM WorkflowInstance
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-934"></span><span>  </span><span id="local-6989586621680184230"><span class="annot"><a href="#local-6989586621680184230"><span class="hs-identifier hs-var">memoized</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowMemoizedPatches</span><span>
</span><span id="line-935"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap.lookup</span></span><span> </span><span class="annot"><a href="#local-6989586621680184227"><span class="hs-identifier hs-type">pid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184230"><span class="hs-identifier hs-type">memoized</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-936"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680184232"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680184232"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; InstanceM Bool
forall a. a -&gt; InstanceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680184232"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-937"></span><span>    </span><span class="annot"><span class="annottext">Maybe Bool
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-938"></span><span>      </span><span id="local-6989586621680184233"><span class="annot"><a href="#local-6989586621680184233"><span class="hs-identifier hs-var">isReplaying</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef Bool -&gt; InstanceM Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; m a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">WorkflowInstance
</span><a href="#local-6989586621680184229"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">workflowIsReplaying</span><span>
</span><span id="line-939"></span><span>      </span><span id="local-6989586621680184234"><span class="annot"><a href="#local-6989586621680184234"><span class="hs-identifier hs-var">notifiedPatches</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowNotifiedPatches</span><span>
</span><span id="line-940"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680184235"><span class="annot"><a href="#local-6989586621680184235"><span class="hs-identifier hs-var hs-var">usePatch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680184233"><span class="hs-identifier hs-var">isReplaying</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">PatchId -&gt; Set PatchId -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">PatchId
</span><a href="#local-6989586621680184227"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">Set PatchId
</span><a href="#local-6989586621680184234"><span class="hs-identifier hs-var">notifiedPatches</span></a></span><span>
</span><span id="line-941"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">writeIORef</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowMemoizedPatches</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621680184227"><span class="hs-identifier hs-type">pid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184235"><span class="hs-identifier hs-type">usePatch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184230"><span class="hs-identifier hs-type">memoized</span></a></span><span>
</span><span id="line-942"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="annot"><a href="#local-6989586621680184235"><span class="hs-identifier hs-type">usePatch</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-943"></span><span>        </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#addCommand"><span class="hs-identifier hs-type">addCommand</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-944"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">defMessage</span></span><span>
</span><span id="line-945"></span><span>            </span><span class="annot"><span class="hs-operator hs-type">&amp;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Command.setPatchMarker</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">defMessage</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Command.patchId</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.~</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#rawPatchId"><span class="hs-identifier hs-var">rawPatchId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184227"><span class="hs-identifier hs-type">pid</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Command.deprecated</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.~</span></span><span> </span><span class="annot"><a href="#local-6989586621680184228"><span class="hs-identifier hs-type">deprecated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-946"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621680184235"><span class="hs-identifier hs-type">usePatch</span></a></span><span>
</span><span id="line-947"></span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span class="annot"><span class="hs-comment">{- | Patch or upgrade workflow code by checking or stating that this workflow has a certain patch.

See official Temporal docs page for info.

If the workflow is replaying an existing history, then this function returns true if that history
was produced by a worker which also had a patched call with the same patchId.

If the history was produced by a worker without such a call, then it will return false.

If the workflow is not currently replaying, then this call always returns true.

Your workflow code should run the &quot;new&quot; code if this returns true, if it returns false,
you should run the &quot;old&quot; code. By doing this, you can maintain determinism.
-}</span></span><span>
</span><span id="line-963"></span><span class="annot"><a href="Temporal.Workflow.html#patched"><span class="hs-identifier hs-type">patched</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Common.html#PatchId"><span class="hs-identifier hs-type">PatchId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-964"></span><span id="patched"><span class="annot"><span class="annottext">patched :: RequireCallStack =&gt; PatchId -&gt; Workflow Bool
</span><a href="Temporal.Workflow.html#patched"><span class="hs-identifier hs-var hs-var">patched</span></a></span></span><span> </span><span id="local-6989586621680184271"><span class="annot"><span class="annottext">PatchId
</span><a href="#local-6989586621680184271"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-965"></span><span>  </span><span class="annot"><span class="annottext">Workflow ()
RequireCallStack =&gt; Workflow ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStackW"><span class="hs-identifier hs-var">updateCallStackW</span></a></span><span>
</span><span id="line-966"></span><span>  </span><span class="annot"><span class="annottext">RequireCallStack =&gt; PatchId -&gt; Bool -&gt; Workflow Bool
PatchId -&gt; Bool -&gt; Workflow Bool
</span><a href="Temporal.Workflow.html#applyPatch"><span class="hs-identifier hs-var">applyPatch</span></a></span><span> </span><span class="annot"><span class="annottext">PatchId
</span><a href="#local-6989586621680184271"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-967"></span><span>
</span><span id="line-968"></span><span>
</span><span id="line-969"></span><span class="annot"><span class="hs-comment">{- | Indicate that a patch is being phased out.

See official Temporal docs page for info.

Workflows with this call may be deployed alongside workflows with a patched call, but they must not be deployed while any workers
still exist running old code without a patched call, or any runs with histories produced by such workers exist.
If either kind of worker encounters a history produced by the other, their behavior is undefined.

Once all live workflow runs have been produced by workers with this call, you can deploy workers which are free of either kind of
patch call for this ID. Workers with and without this call may coexist, as long as they are both running the &quot;new&quot; code.
-}</span></span><span>
</span><span id="line-980"></span><span class="annot"><a href="Temporal.Workflow.html#deprecatePatch"><span class="hs-identifier hs-type">deprecatePatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Common.html#PatchId"><span class="hs-identifier hs-type">PatchId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-981"></span><span id="deprecatePatch"><span class="annot"><span class="annottext">deprecatePatch :: RequireCallStack =&gt; PatchId -&gt; Workflow ()
</span><a href="Temporal.Workflow.html#deprecatePatch"><span class="hs-identifier hs-var hs-var">deprecatePatch</span></a></span></span><span> </span><span id="local-6989586621680184281"><span class="annot"><span class="annottext">PatchId
</span><a href="#local-6989586621680184281"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-982"></span><span>  </span><span class="annot"><span class="annottext">Workflow ()
RequireCallStack =&gt; Workflow ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStackW"><span class="hs-identifier hs-var">updateCallStackW</span></a></span><span>
</span><span id="line-983"></span><span>  </span><span class="annot"><span class="annottext">Workflow Bool -&gt; Workflow ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Workflow Bool -&gt; Workflow ()) -&gt; Workflow Bool -&gt; Workflow ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RequireCallStack =&gt; PatchId -&gt; Bool -&gt; Workflow Bool
PatchId -&gt; Bool -&gt; Workflow Bool
</span><a href="Temporal.Workflow.html#applyPatch"><span class="hs-identifier hs-var">applyPatch</span></a></span><span> </span><span class="annot"><span class="annottext">PatchId
</span><a href="#local-6989586621680184281"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-984"></span><span>
</span><span id="line-985"></span><span>
</span><span id="line-986"></span><span class="annot"><span class="hs-comment">{- $randomness

Workflow executions are deterministic, so you can't use the usual IO-based random number generation.

Instead, each workflow execution is given a seed from the Temporal platform to seed a PRNG. This
allows you to generate random values in a deterministic way.

The 'Workflow' monad provides a 'RandomGen' instance, so you can use the usual 'random' and 'randomR'
functions from the 'System.Random' and 'System.Random.Stateful' modules.
-}</span></span><span>
</span><span id="line-996"></span><span>
</span><span id="line-997"></span><span>
</span><span id="line-998"></span><span class="annot"><span class="hs-comment">-- | Get a mutable randomness generator for the workflow.</span></span><span>
</span><span id="line-999"></span><span class="annot"><a href="Temporal.Workflow.html#randomGen"><span class="hs-identifier hs-type">randomGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowGenM"><span class="hs-identifier hs-type">WorkflowGenM</span></a></span><span>
</span><span id="line-1000"></span><span id="randomGen"><span class="annot"><span class="annottext">randomGen :: Workflow WorkflowGenM
</span><a href="Temporal.Workflow.html#randomGen"><span class="hs-identifier hs-var hs-var">randomGen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkflowInstance -&gt; WorkflowGenM
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowRandomnessSeed"><span class="hs-identifier hs-var">workflowRandomnessSeed</span></a></span><span> </span><span class="annot"><span class="annottext">(WorkflowInstance -&gt; WorkflowGenM)
-&gt; Workflow WorkflowInstance -&gt; Workflow WorkflowGenM
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Workflow WorkflowInstance
</span><a href="Temporal.Workflow.Internal.Monad.html#askInstance"><span class="hs-identifier hs-var">askInstance</span></a></span><span>
</span><span id="line-1001"></span><span>
</span><span id="line-1002"></span><span>
</span><span id="line-1003"></span><span class="annot"><span class="hs-comment">{- | Generate an RFC compliant V4 uuid.

Uses the workflow's deterministic PRNG, making it safe for use within a workflow.

This function is cryptographically insecure.
-}</span></span><span>
</span><span id="line-1009"></span><span class="annot"><a href="Temporal.Workflow.html#uuid4"><span class="hs-identifier hs-type">uuid4</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UUID</span></span><span>
</span><span id="line-1010"></span><span id="uuid4"><span class="annot"><span class="annottext">uuid4 :: Workflow UUID
</span><a href="Temporal.Workflow.html#uuid4"><span class="hs-identifier hs-var hs-var">uuid4</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1011"></span><span>  </span><span id="local-6989586621680184287"><span class="annot"><a href="#local-6989586621680184287"><span class="hs-identifier hs-var">wft</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WorkflowInstance -&gt; WorkflowGenM
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowRandomnessSeed"><span class="hs-identifier hs-var">workflowRandomnessSeed</span></a></span><span> </span><span class="annot"><span class="annottext">(WorkflowInstance -&gt; WorkflowGenM)
-&gt; Workflow WorkflowInstance -&gt; Workflow WorkflowGenM
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Workflow WorkflowInstance
</span><a href="Temporal.Workflow.Internal.Monad.html#askInstance"><span class="hs-identifier hs-var">askInstance</span></a></span><span>
</span><span id="line-1012"></span><span>  </span><span id="local-6989586621680184288"><span class="annot"><a href="#local-6989586621680184288"><span class="hs-identifier hs-var">sbs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">uniformShortByteString</span></span><span> </span><span class="annot"><span class="hs-number">16</span></span><span> </span><span class="annot"><a href="#local-6989586621680184287"><span class="hs-identifier hs-type">wft</span></a></span><span>
</span><span id="line-1013"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1014"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">buildFromBytes</span></span><span>
</span><span id="line-1015"></span><span>      </span><span class="annot"><span class="hs-number">4</span></span><span>
</span><span id="line-1016"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184288"><span class="hs-identifier hs-type">sbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`SBS.index`</span></span><span> </span><span class="annot"><span class="hs-number">0x0</span></span><span class="hs-special">)</span><span>
</span><span id="line-1017"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184288"><span class="hs-identifier hs-type">sbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`SBS.index`</span></span><span> </span><span class="annot"><span class="hs-number">0x1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1018"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184288"><span class="hs-identifier hs-type">sbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`SBS.index`</span></span><span> </span><span class="annot"><span class="hs-number">0x2</span></span><span class="hs-special">)</span><span>
</span><span id="line-1019"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184288"><span class="hs-identifier hs-type">sbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`SBS.index`</span></span><span> </span><span class="annot"><span class="hs-number">0x3</span></span><span class="hs-special">)</span><span>
</span><span id="line-1020"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184288"><span class="hs-identifier hs-type">sbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`SBS.index`</span></span><span> </span><span class="annot"><span class="hs-number">0x4</span></span><span class="hs-special">)</span><span>
</span><span id="line-1021"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184288"><span class="hs-identifier hs-type">sbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`SBS.index`</span></span><span> </span><span class="annot"><span class="hs-number">0x5</span></span><span class="hs-special">)</span><span>
</span><span id="line-1022"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184288"><span class="hs-identifier hs-type">sbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`SBS.index`</span></span><span> </span><span class="annot"><span class="hs-number">0x6</span></span><span class="hs-special">)</span><span>
</span><span id="line-1023"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184288"><span class="hs-identifier hs-type">sbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`SBS.index`</span></span><span> </span><span class="annot"><span class="hs-number">0x7</span></span><span class="hs-special">)</span><span>
</span><span id="line-1024"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184288"><span class="hs-identifier hs-type">sbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`SBS.index`</span></span><span> </span><span class="annot"><span class="hs-number">0x8</span></span><span class="hs-special">)</span><span>
</span><span id="line-1025"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184288"><span class="hs-identifier hs-type">sbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`SBS.index`</span></span><span> </span><span class="annot"><span class="hs-number">0x9</span></span><span class="hs-special">)</span><span>
</span><span id="line-1026"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184288"><span class="hs-identifier hs-type">sbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`SBS.index`</span></span><span> </span><span class="annot"><span class="hs-number">0xA</span></span><span class="hs-special">)</span><span>
</span><span id="line-1027"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184288"><span class="hs-identifier hs-type">sbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`SBS.index`</span></span><span> </span><span class="annot"><span class="hs-number">0xB</span></span><span class="hs-special">)</span><span>
</span><span id="line-1028"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184288"><span class="hs-identifier hs-type">sbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`SBS.index`</span></span><span> </span><span class="annot"><span class="hs-number">0xC</span></span><span class="hs-special">)</span><span>
</span><span id="line-1029"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184288"><span class="hs-identifier hs-type">sbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`SBS.index`</span></span><span> </span><span class="annot"><span class="hs-number">0xD</span></span><span class="hs-special">)</span><span>
</span><span id="line-1030"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184288"><span class="hs-identifier hs-type">sbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`SBS.index`</span></span><span> </span><span class="annot"><span class="hs-number">0xE</span></span><span class="hs-special">)</span><span>
</span><span id="line-1031"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184288"><span class="hs-identifier hs-type">sbs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`SBS.index`</span></span><span> </span><span class="annot"><span class="hs-number">0xF</span></span><span class="hs-special">)</span><span>
</span><span id="line-1032"></span><span>
</span><span id="line-1033"></span><span>
</span><span id="line-1034"></span><span class="annot"><span class="hs-comment">{- | Generates a UUIDv7 using the current time (from 'time') and
random data (from 'workflowRandomnessSeed').
-}</span></span><span>
</span><span id="line-1037"></span><span class="annot"><a href="Temporal.Workflow.html#uuid7"><span class="hs-identifier hs-type">uuid7</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UUID</span></span><span>
</span><span id="line-1038"></span><span id="uuid7"><span class="annot"><span class="annottext">uuid7 :: RequireCallStack =&gt; Workflow UUID
</span><a href="Temporal.Workflow.html#uuid7"><span class="hs-identifier hs-var hs-var">uuid7</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1039"></span><span>  </span><span id="local-6989586621680184342"><span class="annot"><a href="#local-6989586621680184342"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Workflow SystemTime
RequireCallStack =&gt; Workflow SystemTime
</span><a href="Temporal.Workflow.html#time"><span class="hs-identifier hs-var">time</span></a></span><span>
</span><span id="line-1040"></span><span>  </span><span id="local-6989586621680184343"><span class="annot"><a href="#local-6989586621680184343"><span class="hs-identifier hs-var">wft</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#workflowRandomnessSeed"><span class="hs-identifier hs-var">workflowRandomnessSeed</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#askInstance"><span class="hs-identifier hs-type">askInstance</span></a></span><span>
</span><span id="line-1041"></span><span>  </span><span class="hs-comment">-- Note that we only need 74 bits (12 + 62) of randomness. That's a little</span><span>
</span><span id="line-1042"></span><span>  </span><span class="hs-comment">-- more than 9 bytes (72 bits), so we have to request 10 bytes (80 bits) of</span><span>
</span><span id="line-1043"></span><span>  </span><span class="hs-comment">-- entropy. The extra 6 bits are discarded.</span><span>
</span><span id="line-1044"></span><span>  </span><span id="local-6989586621680184344"><span class="annot"><a href="#local-6989586621680184344"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">uniformShortByteString</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><a href="#local-6989586621680184343"><span class="hs-identifier hs-type">wft</span></a></span><span>
</span><span id="line-1045"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1046"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680184348"><span class="annot"><a href="#local-6989586621680184348"><span class="hs-identifier hs-var hs-var">u8_u64</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-1047"></span><span>        </span><span id="local-6989586621680184349"><span class="annot"><a href="#local-6989586621680184349"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Int -&gt; Word64
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">Bits.shift</span></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Int -&gt; Word64)
-&gt; (Int -&gt; Word64) -&gt; Int -&gt; Int -&gt; Word64
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word64
</span><a href="#local-6989586621680184348"><span class="hs-identifier hs-var">u8_u64</span></a></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Word64) -&gt; (Int -&gt; Word8) -&gt; Int -&gt; Word64
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; ShortByteString -&gt; Int -&gt; Word8
ShortByteString -&gt; Int -&gt; Word8
</span><span class="hs-identifier hs-var">SBS.index</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680184344"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-1048"></span><span>        </span><span id="local-6989586621680184351"><span class="annot"><a href="#local-6989586621680184351"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Word64
</span><a href="#local-6989586621680184349"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Word64
</span><a href="#local-6989586621680184349"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span>
</span><span id="line-1049"></span><span>        </span><span id="local-6989586621680184353"><span class="annot"><a href="#local-6989586621680184353"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Word64
</span><a href="#local-6989586621680184349"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Word64
</span><a href="#local-6989586621680184349"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Word64
</span><a href="#local-6989586621680184349"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Word64
</span><a href="#local-6989586621680184349"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">24</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Word64
</span><a href="#local-6989586621680184349"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Word64
</span><a href="#local-6989586621680184349"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Word64
</span><a href="#local-6989586621680184349"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">48</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Word64
</span><a href="#local-6989586621680184349"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">9</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">56</span></span><span>
</span><span id="line-1050"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="#local-6989586621680184354"><span class="hs-identifier hs-type">buildV7</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184342"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184351"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184353"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-1051"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1052"></span><span>    </span><span class="annot"><a href="#local-6989586621680184354"><span class="hs-identifier hs-type">buildV7</span></a></span><span>
</span><span id="line-1053"></span><span>      </span><span class="hs-comment">-- Corresponds to the @unix_ts_ms@ field.</span><span>
</span><span id="line-1054"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SystemTime</span></span><span>
</span><span id="line-1055"></span><span>      </span><span class="hs-comment">-- Corresponds to the @rand_a@ field. Only the low 12 bits are used.</span><span>
</span><span id="line-1056"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-1057"></span><span>      </span><span class="hs-comment">-- Corresponds to the @rand_b@ field. Only the low 62 bits are used.</span><span>
</span><span id="line-1058"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-1059"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UUID.UUID</span></span><span>
</span><span id="line-1060"></span><span>    </span><span id="local-6989586621680184354"><span class="annot"><span class="annottext">buildV7 :: SystemTime -&gt; Word64 -&gt; Word64 -&gt; UUID
</span><a href="#local-6989586621680184354"><span class="hs-identifier hs-var hs-var">buildV7</span></a></span></span><span> </span><span id="local-6989586621680184355"><span class="annot"><span class="annottext">SystemTime
</span><a href="#local-6989586621680184355"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680184356"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680184356"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680184357"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680184357"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1061"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680184361"><span class="annot"><span class="annottext">i64_u64 :: Int64 -&gt; Word64
</span><a href="#local-6989586621680184361"><span class="hs-identifier hs-var hs-var">i64_u64</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-1062"></span><span>          </span><span id="local-6989586621680184364"><span class="annot"><span class="annottext">u32_u64 :: Word32 -&gt; Word64
</span><a href="#local-6989586621680184364"><span class="hs-identifier hs-var hs-var">u32_u64</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-1063"></span><span>          </span><span id="local-6989586621680184365"><span class="annot"><span class="annottext">unix_ts_ms :: Word64
</span><a href="#local-6989586621680184365"><span class="hs-identifier hs-var hs-var">unix_ts_ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1064"></span><span>            </span><span class="annot"><span class="annottext">Word64 -&gt; Int -&gt; Word64
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">Bits.shift</span></span><span>
</span><span id="line-1065"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; Word64
</span><a href="#local-6989586621680184361"><span class="hs-identifier hs-var">i64_u64</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SystemTime -&gt; Int64
</span><span class="hs-identifier hs-var">systemSeconds</span></span><span> </span><span class="annot"><span class="annottext">SystemTime
</span><a href="#local-6989586621680184355"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1000</span></span><span class="hs-special">)</span><span>
</span><span id="line-1066"></span><span>                  </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word64
</span><a href="#local-6989586621680184364"><span class="hs-identifier hs-var">u32_u64</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">div</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SystemTime -&gt; Word32
</span><span class="hs-identifier hs-var">systemNanoseconds</span></span><span> </span><span class="annot"><span class="annottext">SystemTime
</span><a href="#local-6989586621680184355"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">1000000</span></span><span class="hs-special">)</span><span>
</span><span id="line-1067"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-1068"></span><span>              </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span>
</span><span id="line-1069"></span><span>          </span><span id="local-6989586621680184372"><span class="annot"><span class="annottext">ver :: Word64
</span><a href="#local-6989586621680184372"><span class="hs-identifier hs-var hs-var">ver</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Int -&gt; Word64
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">Bits.shift</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0x7</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">12</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-1070"></span><span>          </span><span id="local-6989586621680184373"><span class="annot"><span class="annottext">rand_a :: Word64
</span><a href="#local-6989586621680184373"><span class="hs-identifier hs-var hs-var">rand_a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680184356"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">Bits..&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0x0fff</span></span><span>
</span><span id="line-1071"></span><span>          </span><span id="local-6989586621680184377"><span class="annot"><span class="annottext">var :: Word64
</span><a href="#local-6989586621680184377"><span class="hs-identifier hs-var hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Int -&gt; Word64
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">Bits.shift</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0x2</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">62</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-1072"></span><span>          </span><span id="local-6989586621680184378"><span class="annot"><span class="annottext">rand_b :: Word64
</span><a href="#local-6989586621680184378"><span class="hs-identifier hs-var hs-var">rand_b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680184357"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">Bits..&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0x3fffffffffffffff</span></span><span>
</span><span id="line-1073"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; UUID
</span><span class="hs-identifier hs-var">UUID.fromWords64</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680184365"><span class="hs-identifier hs-var">unix_ts_ms</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680184372"><span class="hs-identifier hs-var">ver</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680184373"><span class="hs-identifier hs-var">rand_a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680184377"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680184378"><span class="hs-identifier hs-var">rand_b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1074"></span><span>
</span><span id="line-1075"></span><span>
</span><span id="line-1076"></span><span class="annot"><span class="hs-comment">{- $queries

A Query is a synchronous operation that is used to get the state of a Workflow Execution.
The state of a running Workflow Execution is constantly changing.
You can use Queries to expose the internal Workflow Execution state to the external world.
Queries are available for running or completed Workflows Executions only if the Worker is
up and listening on the Task Queue.

Queries are strongly consistent and are guaranteed to return the most recent state.
This means that the data reflects the state of all confirmed Events that came in before
the Query was sent. An Event is considered confirmed if the call creating the Event returned
success. Events that are created while the Query is outstanding may or may not be reflected
in the Workflow state the Query result is based on.

A Query can carry arguments to specify the data it is requesting. And each Workflow can expose data to multiple types of Queries.

A Query cannot mutate the state of the Workflow Execution&#8212; that is, Queries are read-only and cannot contain any blocking code.
This means, for example, that Query handling logic cannot schedule Activity Executions.
-}</span></span><span>
</span><span id="line-1095"></span><span>
</span><span id="line-1096"></span><span>
</span><span id="line-1097"></span><span class="annot"><span class="hs-comment">{- | Register a query handler.

The handler will be called when a query with the given name is received.
-}</span></span><span>
</span><span id="line-1101"></span><span class="annot"><a href="Temporal.Workflow.html#setQueryHandler"><span class="hs-identifier hs-type">setQueryHandler</span></a></span><span>
</span><span id="line-1102"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680182331"><span class="annot"><a href="#local-6989586621680182331"><span class="hs-identifier hs-type">query</span></a></span></span><span> </span><span id="local-6989586621680182333"><span class="annot"><a href="#local-6989586621680182333"><span class="hs-identifier hs-type">f</span></a></span></span><span>
</span><span id="line-1103"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Temporal.Workflow.Query.html#QueryRef"><span class="hs-identifier hs-type">QueryRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182331"><span class="hs-identifier hs-type">query</span></a></span><span>
</span><span id="line-1104"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680182333"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Query.html#QueryArgs"><span class="hs-identifier hs-type">QueryArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182331"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#%3A-%3E%3A"><span class="hs-operator hs-type">:-&gt;:</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Query"><span class="hs-identifier hs-type">Query</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Query.html#QueryResult"><span class="hs-identifier hs-type">QueryResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182331"><span class="hs-identifier hs-type">query</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1105"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span>
</span><span id="line-1106"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-1107"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182331"><span class="hs-identifier hs-type">query</span></a></span><span>
</span><span id="line-1108"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182333"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-1109"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1110"></span><span id="setQueryHandler"><span class="annot"><span class="annottext">setQueryHandler :: forall query f.
(QueryRef query,
 f ~ (QueryArgs query :-&gt;: Query (QueryResult query)),
 RequireCallStack) =&gt;
query -&gt; f -&gt; Workflow ()
</span><a href="Temporal.Workflow.html#setQueryHandler"><span class="hs-identifier hs-var hs-var">setQueryHandler</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">query -&gt; KnownQuery (QueryArgs query) (QueryResult query)
forall query.
QueryRef query =&gt;
query -&gt; KnownQuery (QueryArgs query) (QueryResult query)
</span><a href="Temporal.Workflow.Query.html#queryRef"><span class="hs-identifier hs-var">queryRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Query.html#KnownQuery"><span class="hs-identifier hs-type">KnownQuery</span></a></span><span> </span><span id="local-6989586621680184427"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680184427"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680184428"><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680184428"><span class="hs-identifier hs-var">codec</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680184429"><span class="annot"><span class="annottext">f
</span><a href="#local-6989586621680184429"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstanceM () -&gt; Workflow ()
forall a. RequireCallStack =&gt; InstanceM a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#ilift"><span class="hs-identifier hs-var">ilift</span></a></span><span> </span><span class="annot"><span class="annottext">(InstanceM () -&gt; Workflow ()) -&gt; InstanceM () -&gt; Workflow ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1111"></span><span>  </span><span class="annot"><span class="annottext">InstanceM ()
RequireCallStack =&gt; InstanceM ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStack"><span class="hs-identifier hs-var">updateCallStack</span></a></span><span>
</span><span id="line-1112"></span><span>  </span><span id="local-6989586621680184430"><span class="annot"><a href="#local-6989586621680184430"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM WorkflowInstance
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1113"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">withRunInIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680184432"><span class="annot"><span class="annottext">forall a. InstanceM a -&gt; IO a
</span><a href="#local-6989586621680184432"><span class="hs-identifier hs-var">runInIO</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1114"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IORef
  (HashMap
     (Maybe Text)
     (QueryId
      -&gt; Vector Payload
      -&gt; Map Text Payload
      -&gt; IO (Either SomeException Payload)))
-&gt; (HashMap
      (Maybe Text)
      (QueryId
       -&gt; Vector Payload
       -&gt; Map Text Payload
       -&gt; IO (Either SomeException Payload))
    -&gt; HashMap
         (Maybe Text)
         (QueryId
          -&gt; Vector Payload
          -&gt; Map Text Payload
          -&gt; IO (Either SomeException Payload)))
-&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; (a -&gt; a) -&gt; m ()
</span><span class="hs-identifier hs-var">modifyIORef'</span></span><span> </span><span class="annot"><span class="annottext">WorkflowInstance
</span><a href="#local-6989586621680184430"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">workflowQueryHandlers</span><span> </span><span class="annot"><span class="annottext">((HashMap
    (Maybe Text)
    (QueryId
     -&gt; Vector Payload
     -&gt; Map Text Payload
     -&gt; IO (Either SomeException Payload))
  -&gt; HashMap
       (Maybe Text)
       (QueryId
        -&gt; Vector Payload
        -&gt; Map Text Payload
        -&gt; IO (Either SomeException Payload)))
 -&gt; IO ())
-&gt; (HashMap
      (Maybe Text)
      (QueryId
       -&gt; Vector Payload
       -&gt; Map Text Payload
       -&gt; IO (Either SomeException Payload))
    -&gt; HashMap
         (Maybe Text)
         (QueryId
          -&gt; Vector Payload
          -&gt; Map Text Payload
          -&gt; IO (Either SomeException Payload)))
-&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680184433"><span class="annot"><span class="annottext">HashMap
  (Maybe Text)
  (QueryId
   -&gt; Vector Payload
   -&gt; Map Text Payload
   -&gt; IO (Either SomeException Payload))
</span><a href="#local-6989586621680184433"><span class="hs-identifier hs-var">handles</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1115"></span><span>      </span><span class="annot"><span class="annottext">Maybe Text
-&gt; (QueryId
    -&gt; Vector Payload
    -&gt; Map Text Payload
    -&gt; IO (Either SomeException Payload))
-&gt; HashMap
     (Maybe Text)
     (QueryId
      -&gt; Vector Payload
      -&gt; Map Text Payload
      -&gt; IO (Either SomeException Payload))
-&gt; HashMap
     (Maybe Text)
     (QueryId
      -&gt; Vector Payload
      -&gt; Map Text Payload
      -&gt; IO (Either SomeException Payload))
forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HashMap.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680184427"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680184434"><span class="annot"><span class="annottext">QueryId
</span><a href="#local-6989586621680184434"><span class="hs-identifier hs-var">qId</span></a></span></span><span> </span><span id="local-6989586621680184435"><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680184435"><span class="hs-identifier hs-var">vec</span></a></span></span><span> </span><span id="local-6989586621680184436"><span class="annot"><span class="annottext">Map Text Payload
</span><a href="#local-6989586621680184436"><span class="hs-identifier hs-var">hdrs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InstanceM (Either SomeException Payload)
-&gt; IO (Either SomeException Payload)
forall a. InstanceM a -&gt; IO a
</span><a href="#local-6989586621680184432"><span class="hs-identifier hs-var">runInIO</span></a></span><span> </span><span class="annot"><span class="annottext">(InstanceM (Either SomeException Payload)
 -&gt; IO (Either SomeException Payload))
-&gt; InstanceM (Either SomeException Payload)
-&gt; IO (Either SomeException Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QueryId
-&gt; Vector Payload
-&gt; Map Text Payload
-&gt; InstanceM (Either SomeException Payload)
</span><a href="#local-6989586621680184437"><span class="hs-identifier hs-var">qHandler</span></a></span><span> </span><span class="annot"><span class="annottext">QueryId
</span><a href="#local-6989586621680184434"><span class="hs-identifier hs-var">qId</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680184435"><span class="hs-identifier hs-var">vec</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Payload
</span><a href="#local-6989586621680184436"><span class="hs-identifier hs-var">hdrs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap
  (Maybe Text)
  (QueryId
   -&gt; Vector Payload
   -&gt; Map Text Payload
   -&gt; IO (Either SomeException Payload))
</span><a href="#local-6989586621680184433"><span class="hs-identifier hs-var">handles</span></a></span><span>
</span><span id="line-1116"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1117"></span><span>    </span><span class="annot"><a href="#local-6989586621680184437"><span class="hs-identifier hs-type">qHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Common.html#QueryId"><span class="hs-identifier hs-type">QueryId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#InstanceM"><span class="hs-identifier hs-type">InstanceM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1118"></span><span>    </span><span id="local-6989586621680184437"><span class="annot"><span class="annottext">qHandler :: QueryId
-&gt; Vector Payload
-&gt; Map Text Payload
-&gt; InstanceM (Either SomeException Payload)
</span><a href="#local-6989586621680184437"><span class="hs-identifier hs-var hs-var">qHandler</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Common.html#QueryId"><span class="hs-identifier hs-type">QueryId</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680184439"><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680184439"><span class="hs-identifier hs-var">vec</span></a></span></span><span> </span><span class="annot"><span class="annottext">Map Text Payload
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1119"></span><span>      </span><span id="local-6989586621680184440"><span class="annot"><a href="#local-6989586621680184440"><span class="hs-identifier hs-var">eHandler</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1120"></span><span>        </span><span class="annot"><span class="annottext">IO (Either String (Query (QueryResult query)))
-&gt; InstanceM (Either String (Query (QueryResult query)))
forall a. IO a -&gt; InstanceM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either String (Query (QueryResult query)))
 -&gt; InstanceM (Either String (Query (QueryResult query))))
-&gt; IO (Either String (Query (QueryResult query)))
-&gt; InstanceM (Either String (Query (QueryResult query)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1121"></span><span>          </span><span class="annot"><span class="annottext">codec
-&gt; Proxy (QueryArgs query)
-&gt; Proxy (Query (QueryResult query))
-&gt; (QueryArgs query :-&gt;: Query (QueryResult query))
-&gt; Vector Payload
-&gt; IO (Either String (Query (QueryResult query)))
forall result.
codec
-&gt; Proxy (QueryArgs query)
-&gt; Proxy result
-&gt; (QueryArgs query :-&gt;: result)
-&gt; Vector Payload
-&gt; IO (Either String result)
forall codec (args :: [*]) result.
ApplyPayloads codec args =&gt;
codec
-&gt; Proxy args
-&gt; Proxy result
-&gt; (args :-&gt;: result)
-&gt; Vector Payload
-&gt; IO (Either String result)
</span><a href="Temporal.Payload.html#applyPayloads"><span class="hs-identifier hs-var">applyPayloads</span></a></span><span>
</span><span id="line-1122"></span><span>            </span><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680184428"><span class="hs-identifier hs-var">codec</span></a></span><span>
</span><span id="line-1123"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: [*]). Proxy t
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Query.html#QueryArgs"><span class="hs-identifier hs-type">QueryArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182331"><span class="hs-identifier hs-type">query</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1124"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall t. Proxy t
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Query"><span class="hs-identifier hs-type">Query</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Query.html#QueryResult"><span class="hs-identifier hs-type">QueryResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182331"><span class="hs-identifier hs-type">query</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1125"></span><span>            </span><span class="annot"><span class="annottext">f
QueryArgs query :-&gt;: Query (QueryResult query)
</span><a href="#local-6989586621680184429"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1126"></span><span>            </span><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680184439"><span class="hs-identifier hs-var">vec</span></a></span><span>
</span><span id="line-1127"></span><span>      </span><span class="hs-comment">-- TODO handle exceptions properly</span><span>
</span><span id="line-1128"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680184440"><span class="hs-identifier hs-type">eHandler</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1129"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680184443"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680184443"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either SomeException Payload
-&gt; InstanceM (Either SomeException Payload)
forall a. a -&gt; InstanceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either SomeException Payload
 -&gt; InstanceM (Either SomeException Payload))
-&gt; Either SomeException Payload
-&gt; InstanceM (Either SomeException Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Either SomeException Payload
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(SomeException -&gt; Either SomeException Payload)
-&gt; SomeException -&gt; Either SomeException Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ValueError -&gt; SomeException
forall e. Exception e =&gt; e -&gt; SomeException
</span><span class="hs-identifier hs-var">toException</span></span><span> </span><span class="annot"><span class="annottext">(ValueError -&gt; SomeException) -&gt; ValueError -&gt; SomeException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ValueError
</span><a href="Temporal.Payload.html#ValueError"><span class="hs-identifier hs-var">ValueError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680184443"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1130"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Query"><span class="hs-identifier hs-type">Query</span></a></span><span> </span><span id="local-6989586621680184445"><span class="annot"><span class="annottext">InstanceM (QueryResult query)
</span><a href="#local-6989586621680184445"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1131"></span><span>          </span><span id="local-6989586621680184446"><span class="annot"><a href="#local-6989586621680184446"><span class="hs-identifier hs-var">eResult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM (QueryResult query)
-&gt; InstanceM (Either SomeException (QueryResult query))
forall (m :: * -&gt; *) e a.
(MonadUnliftIO m, Exception e) =&gt;
m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">UnliftIO.try</span></span><span> </span><span class="annot"><span class="annottext">InstanceM (QueryResult query)
</span><a href="#local-6989586621680184445"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1132"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680184446"><span class="hs-identifier hs-type">eResult</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1133"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680184448"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680184448"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either SomeException Payload
-&gt; InstanceM (Either SomeException Payload)
forall a. a -&gt; InstanceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either SomeException Payload
 -&gt; InstanceM (Either SomeException Payload))
-&gt; Either SomeException Payload
-&gt; InstanceM (Either SomeException Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Either SomeException Payload
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680184448"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1134"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680184449"><span class="annot"><span class="annottext">QueryResult query
</span><a href="#local-6989586621680184449"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Either SomeException Payload)
-&gt; InstanceM (Either SomeException Payload)
forall a. IO a -&gt; InstanceM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either SomeException Payload)
 -&gt; InstanceM (Either SomeException Payload))
-&gt; IO (Either SomeException Payload)
-&gt; InstanceM (Either SomeException Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnencodedPayload -&gt; IO (Either SomeException Payload)
forall (m :: * -&gt; *) e a.
(MonadUnliftIO m, Exception e) =&gt;
m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">UnliftIO.try</span></span><span> </span><span class="annot"><span class="annottext">(UnencodedPayload -&gt; IO (Either SomeException Payload))
-&gt; UnencodedPayload -&gt; IO (Either SomeException Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">codec -&gt; QueryResult query -&gt; UnencodedPayload
forall fmt a. Codec fmt a =&gt; fmt -&gt; a -&gt; UnencodedPayload
</span><a href="Temporal.Payload.html#encode"><span class="hs-identifier hs-var">encode</span></a></span><span> </span><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680184428"><span class="hs-identifier hs-var">codec</span></a></span><span> </span><span class="annot"><span class="annottext">QueryResult query
</span><a href="#local-6989586621680184449"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-1135"></span><span>
</span><span id="line-1136"></span><span>
</span><span id="line-1137"></span><span class="hs-keyword">type</span><span> </span><span id="ValidSignalHandler"><span class="annot"><a href="Temporal.Workflow.html#ValidSignalHandler"><span class="hs-identifier hs-var">ValidSignalHandler</span></a></span></span><span> </span><span id="local-6989586621680184451"><span class="annot"><a href="#local-6989586621680184451"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1138"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Temporal.Payload.html#ResultOf"><span class="hs-identifier hs-type">ResultOf</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184451"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1139"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Payload.html#ArgsOf"><span class="hs-identifier hs-type">ArgsOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184451"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#%3A-%3E%3A"><span class="hs-operator hs-type">:-&gt;:</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="#local-6989586621680184451"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-1140"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-1141"></span><span>
</span><span id="line-1142"></span><span>
</span><span id="line-1143"></span><span class="annot"><a href="Temporal.Workflow.html#setSignalHandler"><span class="hs-identifier hs-type">setSignalHandler</span></a></span><span>
</span><span id="line-1144"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680182359"><span class="annot"><a href="#local-6989586621680182359"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680182361"><span class="annot"><a href="#local-6989586621680182361"><span class="hs-identifier hs-type">ref</span></a></span></span><span>
</span><span id="line-1145"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Temporal.Workflow.html#ValidSignalHandler"><span class="hs-identifier hs-type">ValidSignalHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182359"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-1146"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span>
</span><span id="line-1147"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Workflow.Signal.html#SignalRef"><span class="hs-identifier hs-type">SignalRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182361"><span class="hs-identifier hs-type">ref</span></a></span><span>
</span><span id="line-1148"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Payload.html#ArgsOf"><span class="hs-identifier hs-type">ArgsOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182359"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Signal.html#SignalArgs"><span class="hs-identifier hs-type">SignalArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182361"><span class="hs-identifier hs-type">ref</span></a></span><span>
</span><span id="line-1149"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-1150"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182361"><span class="hs-identifier hs-type">ref</span></a></span><span>
</span><span id="line-1151"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182359"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-1152"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1153"></span><span id="setSignalHandler"><span class="annot"><span class="annottext">setSignalHandler :: forall f ref.
(ValidSignalHandler f, RequireCallStack, SignalRef ref,
 ArgsOf f ~ SignalArgs ref) =&gt;
ref -&gt; f -&gt; Workflow ()
</span><a href="Temporal.Workflow.html#setSignalHandler"><span class="hs-identifier hs-var hs-var">setSignalHandler</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ref -&gt; KnownSignal (SignalArgs ref)
forall sig. SignalRef sig =&gt; sig -&gt; KnownSignal (SignalArgs sig)
</span><a href="Temporal.Workflow.Signal.html#signalRef"><span class="hs-identifier hs-var">signalRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Signal.html#KnownSignal"><span class="hs-identifier hs-type">KnownSignal</span></a></span><span> </span><span id="local-6989586621680184487"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680184487"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680184488"><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680184488"><span class="hs-identifier hs-var">codec</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680184489"><span class="annot"><span class="annottext">f
</span><a href="#local-6989586621680184489"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstanceM () -&gt; Workflow ()
forall a. RequireCallStack =&gt; InstanceM a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#ilift"><span class="hs-identifier hs-var">ilift</span></a></span><span> </span><span class="annot"><span class="annottext">(InstanceM () -&gt; Workflow ()) -&gt; InstanceM () -&gt; Workflow ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1154"></span><span>  </span><span class="annot"><span class="annottext">InstanceM ()
RequireCallStack =&gt; InstanceM ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStack"><span class="hs-identifier hs-var">updateCallStack</span></a></span><span>
</span><span id="line-1155"></span><span>  </span><span class="hs-comment">-- TODO ^ inner callstack?</span><span>
</span><span id="line-1156"></span><span>  </span><span id="local-6989586621680184490"><span class="annot"><a href="#local-6989586621680184490"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM WorkflowInstance
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1157"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">modifyIORef'</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowSignalHandlers</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680184491"><span class="annot"><span class="annottext">HashMap (Maybe Text) (Vector Payload -&gt; Workflow ())
</span><a href="#local-6989586621680184491"><span class="hs-identifier hs-var">handlers</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1158"></span><span>    </span><span class="annot"><span class="annottext">Maybe Text
-&gt; (Vector Payload -&gt; Workflow ())
-&gt; HashMap (Maybe Text) (Vector Payload -&gt; Workflow ())
-&gt; HashMap (Maybe Text) (Vector Payload -&gt; Workflow ())
forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HashMap.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680184487"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector Payload -&gt; Workflow ()
</span><a href="#local-6989586621680184492"><span class="hs-identifier hs-var">handle'</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Maybe Text) (Vector Payload -&gt; Workflow ())
</span><a href="#local-6989586621680184491"><span class="hs-identifier hs-var">handlers</span></a></span><span>
</span><span id="line-1159"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1160"></span><span>    </span><span class="annot"><a href="#local-6989586621680184492"><span class="hs-identifier hs-type">handle'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1161"></span><span>    </span><span id="local-6989586621680184492"><span class="annot"><span class="annottext">handle' :: Vector Payload -&gt; Workflow ()
</span><a href="#local-6989586621680184492"><span class="hs-identifier hs-var hs-var">handle'</span></a></span></span><span> </span><span id="local-6989586621680184493"><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680184493"><span class="hs-identifier hs-var">vec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1162"></span><span>      </span><span id="local-6989586621680184494"><span class="annot"><a href="#local-6989586621680184494"><span class="hs-identifier hs-var">eWorkflow</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv
 -&gt; InstanceM (Result (Either String (Workflow ()))))
-&gt; Workflow (Either String (Workflow ()))
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv
  -&gt; InstanceM (Result (Either String (Workflow ()))))
 -&gt; Workflow (Either String (Workflow ())))
-&gt; (ContinuationEnv
    -&gt; InstanceM (Result (Either String (Workflow ()))))
-&gt; Workflow (Either String (Workflow ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680184495"><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680184495"><span class="hs-identifier hs-var">_env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1163"></span><span>        </span><span class="annot"><span class="annottext">IO (Result (Either String (Workflow ())))
-&gt; InstanceM (Result (Either String (Workflow ())))
forall a. IO a -&gt; InstanceM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Result (Either String (Workflow ())))
 -&gt; InstanceM (Result (Either String (Workflow ()))))
-&gt; IO (Result (Either String (Workflow ())))
-&gt; InstanceM (Result (Either String (Workflow ())))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1164"></span><span>          </span><span class="annot"><span class="annottext">Either String (Workflow ()) -&gt; Result (Either String (Workflow ()))
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span>
</span><span id="line-1165"></span><span>            </span><span class="annot"><span class="annottext">(Either String (Workflow ())
 -&gt; Result (Either String (Workflow ())))
-&gt; IO (Either String (Workflow ()))
-&gt; IO (Result (Either String (Workflow ())))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">codec
-&gt; Proxy (SignalArgs ref)
-&gt; Proxy (Workflow ())
-&gt; (SignalArgs ref :-&gt;: Workflow ())
-&gt; Vector Payload
-&gt; IO (Either String (Workflow ()))
forall result.
codec
-&gt; Proxy (SignalArgs ref)
-&gt; Proxy result
-&gt; (SignalArgs ref :-&gt;: result)
-&gt; Vector Payload
-&gt; IO (Either String result)
forall codec (args :: [*]) result.
ApplyPayloads codec args =&gt;
codec
-&gt; Proxy args
-&gt; Proxy result
-&gt; (args :-&gt;: result)
-&gt; Vector Payload
-&gt; IO (Either String result)
</span><a href="Temporal.Payload.html#applyPayloads"><span class="hs-identifier hs-var">applyPayloads</span></a></span><span>
</span><span id="line-1166"></span><span>              </span><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680184488"><span class="hs-identifier hs-var">codec</span></a></span><span>
</span><span id="line-1167"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: [*]). Proxy t
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Payload.html#ArgsOf"><span class="hs-identifier hs-type">ArgsOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182359"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1168"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall t. Proxy t
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1169"></span><span>              </span><span class="annot"><span class="annottext">f
SignalArgs ref :-&gt;: Workflow ()
</span><a href="#local-6989586621680184489"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1170"></span><span>              </span><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680184493"><span class="hs-identifier hs-var">vec</span></a></span><span>
</span><span id="line-1171"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680184494"><span class="hs-identifier hs-type">eWorkflow</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1172"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680184496"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680184496"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ValueError -&gt; Workflow ()
forall e a. (HasCallStack, Exception e) =&gt; e -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#throw"><span class="hs-identifier hs-var">throw</span></a></span><span> </span><span class="annot"><span class="annottext">(ValueError -&gt; Workflow ()) -&gt; ValueError -&gt; Workflow ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ValueError
</span><a href="Temporal.Payload.html#ValueError"><span class="hs-identifier hs-var">ValueError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680184496"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1173"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680184497"><span class="annot"><span class="annottext">Workflow ()
</span><a href="#local-6989586621680184497"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Workflow ()
</span><a href="#local-6989586621680184497"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1174"></span><span>
</span><span id="line-1175"></span><span>
</span><span id="line-1176"></span><span class="annot"><span class="hs-comment">{- | Current time from the workflow perspective.

The value is relative to epoch time.
-}</span></span><span>
</span><span id="line-1180"></span><span class="annot"><a href="Temporal.Workflow.html#time"><span class="hs-identifier hs-type">time</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SystemTime</span></span><span>
</span><span id="line-1181"></span><span id="time"><span class="annot"><span class="annottext">time :: RequireCallStack =&gt; Workflow SystemTime
</span><a href="Temporal.Workflow.html#time"><span class="hs-identifier hs-var hs-var">time</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstanceM SystemTime -&gt; Workflow SystemTime
forall a. RequireCallStack =&gt; InstanceM a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#ilift"><span class="hs-identifier hs-var">ilift</span></a></span><span> </span><span class="annot"><span class="annottext">(InstanceM SystemTime -&gt; Workflow SystemTime)
-&gt; InstanceM SystemTime -&gt; Workflow SystemTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1182"></span><span>  </span><span class="annot"><span class="annottext">InstanceM ()
RequireCallStack =&gt; InstanceM ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStack"><span class="hs-identifier hs-var">updateCallStack</span></a></span><span>
</span><span id="line-1183"></span><span>  </span><span id="local-6989586621680184509"><span class="annot"><a href="#local-6989586621680184509"><span class="hs-identifier hs-var">wft</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(WorkflowInstance -&gt; IORef SystemTime)
-&gt; InstanceM (IORef SystemTime)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">WorkflowInstance -&gt; IORef SystemTime
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowTime"><span class="hs-identifier hs-var">workflowTime</span></a></span><span>
</span><span id="line-1184"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621680184509"><span class="hs-identifier hs-type">wft</span></a></span><span>
</span><span id="line-1185"></span><span>
</span><span id="line-1186"></span><span>
</span><span id="line-1187"></span><span class="hs-keyword">data</span><span> </span><span id="Timer"><span class="annot"><a href="Temporal.Workflow.html#Timer"><span class="hs-identifier hs-var">Timer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Timer"><span class="annot"><a href="Temporal.Workflow.html#Timer"><span class="hs-identifier hs-var">Timer</span></a></span></span><span>
</span><span id="line-1188"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="timerSequence"><span class="annot"><span class="annottext">Timer -&gt; Sequence
</span><a href="Temporal.Workflow.html#timerSequence"><span class="hs-identifier hs-var hs-var">timerSequence</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Common.html#Sequence"><span class="hs-identifier hs-type">Sequence</span></a></span><span>
</span><span id="line-1189"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="timerHandle"><span class="annot"><span class="annottext">Timer -&gt; IVar ()
</span><a href="Temporal.Workflow.html#timerHandle"><span class="hs-identifier hs-var hs-var">timerHandle</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1190"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-1191"></span><span>
</span><span id="line-1192"></span><span>
</span><span id="line-1193"></span><span class="annot"><span class="hs-comment">{- | Asynchronous sleep.

Creates a timer that fires after the specified duration.

The timer is not guaranteed to fire immediately after the duration expires,
but it is intended to fire as close to the expiration as possible.

Note that the timer is started when the command is received by the Temporal Platform,
not when the timer is created. The command is sent as soon as the workflow is blocked
by any operation, such as 'sleep', 'awaitCondition', 'awaitActivity', 'awaitWorkflow', etc.

If the duration is less than or equal to zero, the timer will not be created.
-}</span></span><span>
</span><span id="line-1206"></span><span class="annot"><a href="Temporal.Workflow.html#createTimer"><span class="hs-identifier hs-type">createTimer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Duration.html#Duration"><span class="hs-identifier hs-type">Duration</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.html#Timer"><span class="hs-identifier hs-type">Timer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1207"></span><span id="createTimer"><span class="annot"><span class="annottext">createTimer :: Duration -&gt; Workflow (Maybe Timer)
</span><a href="Temporal.Workflow.html#createTimer"><span class="hs-identifier hs-var hs-var">createTimer</span></a></span></span><span> </span><span id="local-6989586621680184513"><span class="annot"><span class="annottext">Duration
</span><a href="#local-6989586621680184513"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RequireCallStackImpl =&gt; Workflow (Maybe Timer))
-&gt; Workflow (Maybe Timer)
forall r. (RequireCallStackImpl =&gt; r) -&gt; r
</span><span class="hs-identifier hs-var">provideCallStack</span></span><span> </span><span class="annot"><span class="annottext">((RequireCallStackImpl =&gt; Workflow (Maybe Timer))
 -&gt; Workflow (Maybe Timer))
-&gt; (RequireCallStackImpl =&gt; Workflow (Maybe Timer))
-&gt; Workflow (Maybe Timer)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InstanceM (Maybe Timer) -&gt; Workflow (Maybe Timer)
forall a. RequireCallStack =&gt; InstanceM a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#ilift"><span class="hs-identifier hs-var">ilift</span></a></span><span> </span><span class="annot"><span class="annottext">(InstanceM (Maybe Timer) -&gt; Workflow (Maybe Timer))
-&gt; InstanceM (Maybe Timer) -&gt; Workflow (Maybe Timer)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1208"></span><span>  </span><span id="local-6989586621680184547"><span class="annot"><a href="#local-6989586621680184547"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM WorkflowInstance
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1209"></span><span>  </span><span id="local-6989586621680184548"><span class="annot"><a href="#local-6989586621680184548"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Common.html#Sequence"><span class="hs-identifier hs-type">Sequence</span></a></span><span> </span><span id="local-6989586621680184549"><span class="annot"><a href="#local-6989586621680184549"><span class="hs-identifier hs-var">seqId</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Instance.html#nextTimerSequence"><span class="hs-identifier hs-type">nextTimerSequence</span></a></span><span>
</span><span id="line-1210"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621680184513"><span class="hs-identifier hs-type">ts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span>
</span><span id="line-1211"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-1212"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1213"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680184552"><span class="annot"><a href="#local-6989586621680184552"><span class="hs-identifier hs-var hs-var">ts'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Duration
</span><a href="#local-6989586621680184513"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Duration -&gt; Duration -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Duration
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Duration
</span><a href="Temporal.Duration.html#nanoseconds"><span class="hs-identifier hs-var">nanoseconds</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Duration
</span><a href="#local-6989586621680184513"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-1214"></span><span>          </span><span id="local-6989586621680184553"><span class="annot"><a href="#local-6989586621680184553"><span class="hs-identifier hs-var hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1215"></span><span>            </span><span class="annot"><span class="annottext">WorkflowCommand
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-1216"></span><span>              </span><span class="annot"><span class="annottext">WorkflowCommand
-&gt; (WorkflowCommand -&gt; WorkflowCommand) -&gt; WorkflowCommand
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f WorkflowCommand StartTimer
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f WorkflowCommand StartTimer
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;startTimer&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.startTimer</span></span><span>
</span><span id="line-1217"></span><span>                </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f WorkflowCommand StartTimer)
-&gt; StartTimer -&gt; WorkflowCommand -&gt; WorkflowCommand
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">StartTimer
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-1218"></span><span>                      </span><span class="annot"><span class="annottext">StartTimer -&gt; (StartTimer -&gt; StartTimer) -&gt; StartTimer
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f StartTimer Word32
forall {f :: * -&gt; *}. Identical f =&gt; LensLike' f StartTimer Word32
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;seq&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.seq</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f StartTimer Word32)
-&gt; Word32 -&gt; StartTimer -&gt; StartTimer
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621680184549"><span class="hs-identifier hs-var">seqId</span></a></span><span>
</span><span id="line-1219"></span><span>                      </span><span class="annot"><span class="annottext">StartTimer -&gt; (StartTimer -&gt; StartTimer) -&gt; StartTimer
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f StartTimer Duration
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f StartTimer Duration
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;startToFireTimeout&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.startToFireTimeout</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f StartTimer Duration)
-&gt; Duration -&gt; StartTimer -&gt; StartTimer
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Duration -&gt; Duration
</span><a href="Temporal.Duration.html#durationToProto"><span class="hs-identifier hs-var">durationToProto</span></a></span><span> </span><span class="annot"><span class="annottext">Duration
</span><a href="#local-6989586621680184552"><span class="hs-identifier hs-var">ts'</span></a></span><span>
</span><span id="line-1220"></span><span>                   </span><span class="hs-special">)</span><span>
</span><span id="line-1221"></span><span>      </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">logDebug</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-string">&quot;Add command: sleep&quot;</span></span><span>
</span><span id="line-1222"></span><span>      </span><span id="local-6989586621680184576"><span class="annot"><a href="#local-6989586621680184576"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#newIVar"><span class="hs-identifier hs-type">newIVar</span></a></span><span>
</span><span id="line-1223"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">atomically</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">modifyTVar'</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowSequenceMaps</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680184577"><span class="annot"><span class="annottext">SequenceMaps
</span><a href="#local-6989586621680184577"><span class="hs-identifier hs-var">seqMaps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1224"></span><span>        </span><span class="annot"><span class="annottext">SequenceMaps
</span><a href="#local-6989586621680184577"><span class="hs-identifier hs-var">seqMaps</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#timers"><span class="hs-identifier hs-var">timers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621680184548"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184576"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="annot"><span class="hs-identifier">seqMaps</span></span><span class="hs-operator">.</span><span class="hs-identifier">timers</span><span class="hs-special">}</span><span>
</span><span id="line-1225"></span><span>      </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#addCommand"><span class="hs-identifier hs-type">addCommand</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184553"><span class="hs-identifier hs-type">cmd</span></a></span><span>
</span><span id="line-1226"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.html#Timer"><span class="hs-identifier hs-type">Timer</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Workflow.html#timerSequence"><span class="hs-identifier hs-var">timerSequence</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680184548"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Workflow.html#timerHandle"><span class="hs-identifier hs-var">timerHandle</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680184576"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-1227"></span><span>
</span><span id="line-1228"></span><span>
</span><span id="line-1229"></span><span class="annot"><a href="Temporal.Workflow.html#sleep"><span class="hs-identifier hs-type">sleep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Duration.html#Duration"><span class="hs-identifier hs-type">Duration</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1230"></span><span id="sleep"><span class="annot"><span class="annottext">sleep :: RequireCallStack =&gt; Duration -&gt; Workflow ()
</span><a href="Temporal.Workflow.html#sleep"><span class="hs-identifier hs-var hs-var">sleep</span></a></span></span><span> </span><span id="local-6989586621680184593"><span class="annot"><span class="annottext">Duration
</span><a href="#local-6989586621680184593"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1231"></span><span>  </span><span class="annot"><span class="annottext">Workflow ()
RequireCallStack =&gt; Workflow ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStackW"><span class="hs-identifier hs-var">updateCallStackW</span></a></span><span>
</span><span id="line-1232"></span><span>  </span><span id="local-6989586621680184594"><span class="annot"><a href="#local-6989586621680184594"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Duration -&gt; Workflow (Maybe Timer)
</span><a href="Temporal.Workflow.html#createTimer"><span class="hs-identifier hs-var">createTimer</span></a></span><span> </span><span class="annot"><span class="annottext">Duration
</span><a href="#local-6989586621680184593"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-1233"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Unsafe.Handle.html#wait"><span class="hs-identifier hs-type">Temporal.Workflow.Unsafe.Handle.wait</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184594"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1234"></span><span>
</span><span id="line-1235"></span><span>
</span><span id="line-1236"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Temporal.Workflow.Unsafe.Handle.html#Wait"><span class="hs-identifier hs-type">Wait</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.html#Timer"><span class="hs-identifier hs-type">Timer</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1237"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="WaitResult"><span class="annot"><a href="Temporal.Workflow.Unsafe.Handle.html#WaitResult"><span class="hs-identifier hs-var">WaitResult</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Workflow.html#Timer"><span class="hs-identifier hs-type">Timer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1238"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Unsafe.Handle.html#wait"><span class="hs-identifier hs-type">wait</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.html#Timer"><span class="hs-identifier hs-type">Timer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Unsafe.Handle.html#WaitResult"><span class="hs-identifier hs-type">WaitResult</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.html#Timer"><span class="hs-identifier hs-type">Timer</span></a></span><span>
</span><span id="line-1239"></span><span>  </span><span id="local-6989586621680184611"><span class="annot"><span class="annottext">wait :: RequireCallStack =&gt; Timer -&gt; WaitResult Timer
</span><a href="Temporal.Workflow.Unsafe.Handle.html#wait"><span class="hs-identifier hs-var hs-var hs-var">wait</span></a></span></span><span> </span><span id="local-6989586621680184612"><span class="annot"><span class="annottext">Timer
</span><a href="#local-6989586621680184612"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1240"></span><span>    </span><span class="annot"><span class="annottext">Workflow ()
RequireCallStack =&gt; Workflow ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStackW"><span class="hs-identifier hs-var">updateCallStackW</span></a></span><span>
</span><span id="line-1241"></span><span>    </span><span class="annot"><span class="annottext">IVar () -&gt; Workflow ()
forall a. IVar a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#getIVar"><span class="hs-identifier hs-var">getIVar</span></a></span><span> </span><span class="annot"><span class="annottext">(IVar () -&gt; Workflow ()) -&gt; IVar () -&gt; Workflow ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Timer -&gt; IVar ()
</span><a href="Temporal.Workflow.html#timerHandle"><span class="hs-identifier hs-var">timerHandle</span></a></span><span> </span><span class="annot"><span class="annottext">Timer
</span><a href="#local-6989586621680184612"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1242"></span><span>
</span><span id="line-1243"></span><span>
</span><span id="line-1244"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Temporal.Workflow.Unsafe.Handle.html#Cancel"><span class="hs-identifier hs-type">Cancel</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.html#Timer"><span class="hs-identifier hs-type">Timer</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1245"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="CancelResult"><span class="annot"><a href="Temporal.Workflow.Unsafe.Handle.html#CancelResult"><span class="hs-identifier hs-var">CancelResult</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Workflow.html#Timer"><span class="hs-identifier hs-type">Timer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1246"></span><span>
</span><span id="line-1247"></span><span>
</span><span id="line-1248"></span><span>  </span><span id="local-6989586621680184649"><span class="annot"><span class="annottext">cancel :: RequireCallStack =&gt; Timer -&gt; CancelResult Timer
</span><a href="#local-6989586621680184649"><span class="hs-identifier hs-var hs-var hs-var">cancel</span></a></span></span><span> </span><span id="local-6989586621680184651"><span class="annot"><span class="annottext">Timer
</span><a href="#local-6989586621680184651"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result ())) -&gt; Workflow ()
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result ())) -&gt; Workflow ())
-&gt; (ContinuationEnv -&gt; InstanceM (Result ())) -&gt; Workflow ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1249"></span><span>    </span><span class="annot"><span class="annottext">InstanceM ()
RequireCallStack =&gt; InstanceM ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStack"><span class="hs-identifier hs-var">updateCallStack</span></a></span><span>
</span><span id="line-1250"></span><span>    </span><span id="local-6989586621680184652"><span class="annot"><a href="#local-6989586621680184652"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM WorkflowInstance
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1251"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680184653"><span class="annot"><a href="#local-6989586621680184653"><span class="hs-identifier hs-var hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1252"></span><span>          </span><span class="annot"><span class="annottext">WorkflowCommand
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-1253"></span><span>            </span><span class="annot"><span class="annottext">WorkflowCommand
-&gt; (WorkflowCommand -&gt; WorkflowCommand) -&gt; WorkflowCommand
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f WorkflowCommand CancelTimer
forall {f :: * -&gt; *}.
Identical f =&gt;
LensLike' f WorkflowCommand CancelTimer
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;cancelTimer&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.cancelTimer</span></span><span>
</span><span id="line-1254"></span><span>              </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f WorkflowCommand CancelTimer)
-&gt; CancelTimer -&gt; WorkflowCommand -&gt; WorkflowCommand
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">CancelTimer
forall msg. Message msg =&gt; msg
</span><span class="hs-identifier hs-var">defMessage</span></span><span>
</span><span id="line-1255"></span><span>                    </span><span class="annot"><span class="annottext">CancelTimer -&gt; (CancelTimer -&gt; CancelTimer) -&gt; CancelTimer
forall s t. s -&gt; (s -&gt; t) -&gt; t
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f CancelTimer Word32
forall {f :: * -&gt; *}. Identical f =&gt; LensLike' f CancelTimer Word32
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;seq&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Command.seq</span></span><span> </span><span class="annot"><span class="annottext">(forall {f :: * -&gt; *}.
 Identical f =&gt;
 LensLike' f CancelTimer Word32)
-&gt; Word32 -&gt; CancelTimer -&gt; CancelTimer
forall s t a b. Setter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Sequence -&gt; Word32
</span><a href="Temporal.Common.html#rawSequence"><span class="hs-identifier hs-var">rawSequence</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Timer -&gt; Sequence
</span><a href="Temporal.Workflow.html#timerSequence"><span class="hs-identifier hs-var">timerSequence</span></a></span><span> </span><span class="annot"><span class="annottext">Timer
</span><a href="#local-6989586621680184651"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1256"></span><span>                 </span><span class="hs-special">)</span><span>
</span><span id="line-1257"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#addCommand"><span class="hs-identifier hs-type">addCommand</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184653"><span class="hs-identifier hs-type">cmd</span></a></span><span>
</span><span id="line-1258"></span><span>    </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">logDebug</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-string">&quot;about to putIVar: cancelTimer&quot;</span></span><span>
</span><span id="line-1259"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1260"></span><span>      </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#putIVar"><span class="hs-identifier hs-type">putIVar</span></a></span><span>
</span><span id="line-1261"></span><span>        </span><span class="annot"><span class="hs-identifier">t</span></span><span class="hs-operator">.</span><span class="hs-identifier">timerHandle</span><span>
</span><span id="line-1262"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Ok"><span class="hs-identifier hs-type">Ok</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1263"></span><span>        </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowInstanceContinuationEnv</span><span>
</span><span id="line-1264"></span><span>
</span><span id="line-1265"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">atomically</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">modifyTVar'</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowSequenceMaps</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680184669"><span class="annot"><span class="annottext">SequenceMaps
</span><a href="#local-6989586621680184669"><span class="hs-identifier hs-var">seqMaps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1266"></span><span>      </span><span class="annot"><span class="annottext">SequenceMaps
</span><a href="#local-6989586621680184669"><span class="hs-identifier hs-var">seqMaps</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#timers"><span class="hs-identifier hs-var">timers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap.delete</span></span><span> </span><span class="annot"><span class="hs-identifier">t</span></span><span class="hs-operator">.</span><span class="hs-identifier">timerSequence</span><span> </span><span class="annot"><span class="hs-identifier">seqMaps</span></span><span class="hs-operator">.</span><span class="hs-identifier">timers</span><span class="hs-special">}</span><span>
</span><span id="line-1267"></span><span>
</span><span id="line-1268"></span><span>    </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">logDebug</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-string">&quot;finished putIVar: cancelTimer&quot;</span></span><span>
</span><span id="line-1269"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1270"></span><span>
</span><span id="line-1271"></span><span>
</span><span id="line-1272"></span><span class="annot"><span class="hs-comment">{- | Continue-As-New is a mechanism by which the latest relevant state is passed to a new Workflow Execution, with a fresh Event History.

As a precautionary measure, the Temporal Platform limits the total Event History to 51,200 Events or 50 MB, and will warn you after
10,240 Events or 10 MB. To prevent a Workflow Execution Event History from exceeding this limit and failing,
use Continue-As-New to start a new Workflow Execution with a fresh Event History.

All values passed to a Workflow Execution through parameters or returned through a result value are recorded into the Event History.
A Temporal Cluster stores the full Event History of a Workflow Execution for the duration of a Namespace's retention period.
A Workflow Execution that periodically executes many Activities has the potential of hitting the size limit.

A very large Event History can adversely affect the performance of a Workflow Execution. For example, in the case of a Workflow Worker failure,
the full Event History must be pulled from the Temporal Cluster and given to another Worker via a Workflow Task.
If the Event history is very large, it may take some time to load it.

The Continue-As-New feature enables developers to complete the current Workflow Execution and start a new one atomically.

The new Workflow Execution has the same Workflow Id, but a different Run Id, and has its own Event History.
TODO, don't make this an exception, make it a return value
-}</span></span><span>
</span><span id="line-1291"></span><span class="annot"><a href="Temporal.Workflow.html#continueAsNew"><span class="hs-identifier hs-type">continueAsNew</span></a></span><span>
</span><span id="line-1292"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680182398"><span class="annot"><a href="#local-6989586621680182398"><span class="hs-identifier hs-type">wf</span></a></span></span><span>
</span><span id="line-1293"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowRef"><span class="hs-identifier hs-type">WorkflowRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182398"><span class="hs-identifier hs-type">wf</span></a></span><span>
</span><span id="line-1294"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182398"><span class="hs-identifier hs-type">wf</span></a></span><span>
</span><span id="line-1295"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The workflow to continue as new. It doesn't have to be the same as the current workflow.</span></span><span>
</span><span id="line-1296"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#ContinueAsNewOptions"><span class="hs-identifier hs-type">ContinueAsNewOptions</span></a></span><span>
</span><span id="line-1297"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowArgs"><span class="hs-identifier hs-type">WorkflowArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182398"><span class="hs-identifier hs-type">wf</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#%3A-%3E%3A"><span class="hs-operator hs-type">:-&gt;:</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowResult"><span class="hs-identifier hs-type">WorkflowResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182398"><span class="hs-identifier hs-type">wf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1298"></span><span id="continueAsNew"><span class="annot"><span class="annottext">continueAsNew :: forall wf.
WorkflowRef wf =&gt;
wf
-&gt; ContinueAsNewOptions
-&gt; WorkflowArgs wf :-&gt;: Workflow (WorkflowResult wf)
</span><a href="Temporal.Workflow.html#continueAsNew"><span class="hs-identifier hs-var hs-var">continueAsNew</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">wf -&gt; KnownWorkflow (WorkflowArgs wf) (WorkflowResult wf)
forall f.
WorkflowRef f =&gt;
f -&gt; KnownWorkflow (WorkflowArgs f) (WorkflowResult f)
</span><a href="Temporal.Workflow.Definition.html#workflowRef"><span class="hs-identifier hs-var">workflowRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621680184673"><span class="annot"><span class="annottext">k :: KnownWorkflow (WorkflowArgs wf) (WorkflowResult wf)
</span><a href="#local-6989586621680184673"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#KnownWorkflow"><span class="hs-identifier hs-type">KnownWorkflow</span></a></span><span> </span><span id="local-6989586621680184689"><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680184689"><span class="hs-identifier hs-var">codec</span></a></span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680184690"><span class="annot"><span class="annottext">ContinueAsNewOptions
</span><a href="#local-6989586621680184690"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (args :: [*]) result codec.
(VarArgs args, AllArgs (Codec codec) args) =&gt;
codec
-&gt; (Vector Payload -&gt; Workflow result) -&gt; args :-&gt;: Workflow result
</span><a href="Temporal.Workflow.html#withWorkflowArgs"><span class="hs-identifier hs-var">withWorkflowArgs</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowArgs"><span class="hs-identifier hs-type">WorkflowArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182398"><span class="hs-identifier hs-type">wf</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowResult"><span class="hs-identifier hs-type">WorkflowResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182398"><span class="hs-identifier hs-type">wf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">codec
</span><a href="#local-6989586621680184689"><span class="hs-identifier hs-var">codec</span></a></span><span> </span><span class="annot"><span class="annottext">((Vector Payload -&gt; Workflow (WorkflowResult wf))
 -&gt; WorkflowArgs wf :-&gt;: Workflow (WorkflowResult wf))
-&gt; (Vector Payload -&gt; Workflow (WorkflowResult wf))
-&gt; WorkflowArgs wf :-&gt;: Workflow (WorkflowResult wf)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680184691"><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680184691"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1299"></span><span>  </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result (WorkflowResult wf)))
-&gt; Workflow (WorkflowResult wf)
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result (WorkflowResult wf)))
 -&gt; Workflow (WorkflowResult wf))
-&gt; (ContinuationEnv -&gt; InstanceM (Result (WorkflowResult wf)))
-&gt; Workflow (WorkflowResult wf)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1300"></span><span>    </span><span id="local-6989586621680184692"><span class="annot"><a href="#local-6989586621680184692"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM WorkflowInstance
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1301"></span><span>    </span><span id="local-6989586621680184693"><span class="annot"><a href="#local-6989586621680184693"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#continueAsNew"><span class="hs-identifier hs-var">Temporal.Workflow.Internal.Monad.continueAsNew</span></a></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">outboundInterceptor</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#knownWorkflowName"><span class="hs-identifier hs-var">knownWorkflowName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184673"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680184690"><span class="hs-identifier hs-type">opts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680184695"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680184695"><span class="hs-identifier hs-var">wfName</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680184696"><span class="annot"><span class="annottext">ContinueAsNewOptions
</span><a href="#local-6989586621680184696"><span class="hs-identifier hs-var">opts'</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#ContinueAsNewOptions"><span class="hs-identifier hs-type">ContinueAsNewOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1302"></span><span>      </span><span class="hs-comment">-- searchAttrs &lt;- searchAttributesToProto</span><span>
</span><span id="line-1303"></span><span>      </span><span class="hs-comment">--     (if opts'.searchAttributes == mempty</span><span>
</span><span id="line-1304"></span><span>      </span><span class="hs-comment">--       then i.searchAttributes</span><span>
</span><span id="line-1305"></span><span>      </span><span class="hs-comment">--       else opts'.searchAttributes)</span><span>
</span><span id="line-1306"></span><span>      </span><span class="annot"><span class="annottext">ContinueAsNewException -&gt; IO (WorkflowResult wf)
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(ContinueAsNewException -&gt; IO (WorkflowResult wf))
-&gt; ContinueAsNewException -&gt; IO (WorkflowResult wf)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WorkflowType
-&gt; Vector Payload -&gt; ContinueAsNewOptions -&gt; ContinueAsNewException
</span><a href="Temporal.Exception.html#ContinueAsNewException"><span class="hs-identifier hs-var">ContinueAsNewException</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; WorkflowType
</span><a href="Temporal.Common.html#WorkflowType"><span class="hs-identifier hs-var">WorkflowType</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680184695"><span class="hs-identifier hs-var">wfName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector Payload
</span><a href="#local-6989586621680184691"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">ContinueAsNewOptions
</span><a href="#local-6989586621680184696"><span class="hs-identifier hs-var">opts'</span></a></span><span>
</span><span id="line-1307"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184693"><span class="hs-identifier hs-type">res</span></a></span><span>
</span><span id="line-1308"></span><span>
</span><span id="line-1309"></span><span>
</span><span id="line-1310"></span><span class="annot"><span class="hs-comment">-- | Returns a client-side handle that can be used to signal and cancel an existing Workflow execution. It takes a Workflow ID and optional run ID.</span></span><span>
</span><span id="line-1311"></span><span id="local-6989586621680182404"><span class="annot"><a href="Temporal.Workflow.html#getExternalWorkflowHandle"><span class="hs-identifier hs-type">getExternalWorkflowHandle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Common.html#WorkflowId"><span class="hs-identifier hs-type">WorkflowId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#RunId"><span class="hs-identifier hs-type">RunId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ExternalWorkflowHandle"><span class="hs-identifier hs-type">ExternalWorkflowHandle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182404"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1312"></span><span id="getExternalWorkflowHandle"><span class="annot"><span class="annottext">getExternalWorkflowHandle :: forall result.
RequireCallStack =&gt;
WorkflowId
-&gt; Maybe RunId -&gt; Workflow (ExternalWorkflowHandle result)
</span><a href="Temporal.Workflow.html#getExternalWorkflowHandle"><span class="hs-identifier hs-var hs-var">getExternalWorkflowHandle</span></a></span></span><span> </span><span id="local-6989586621680184707"><span class="annot"><span class="annottext">WorkflowId
</span><a href="#local-6989586621680184707"><span class="hs-identifier hs-var">wfId</span></a></span></span><span> </span><span id="local-6989586621680184708"><span class="annot"><span class="annottext">Maybe RunId
</span><a href="#local-6989586621680184708"><span class="hs-identifier hs-var">mrId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1313"></span><span>  </span><span class="annot"><span class="annottext">Workflow ()
RequireCallStack =&gt; Workflow ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStackW"><span class="hs-identifier hs-var">updateCallStackW</span></a></span><span>
</span><span id="line-1314"></span><span>  </span><span class="annot"><span class="annottext">ExternalWorkflowHandle result
-&gt; Workflow (ExternalWorkflowHandle result)
forall a. a -&gt; Workflow a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ExternalWorkflowHandle result
 -&gt; Workflow (ExternalWorkflowHandle result))
-&gt; ExternalWorkflowHandle result
-&gt; Workflow (ExternalWorkflowHandle result)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1315"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ExternalWorkflowHandle"><span class="hs-identifier hs-type">ExternalWorkflowHandle</span></a></span><span>
</span><span id="line-1316"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">externalWorkflowWorkflowId :: WorkflowId
</span><a href="#local-6989586621680184710"><span class="hs-identifier hs-var">externalWorkflowWorkflowId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkflowId
</span><a href="#local-6989586621680184707"><span class="hs-identifier hs-var">wfId</span></a></span><span>
</span><span id="line-1317"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">externalWorkflowRunId :: Maybe RunId
</span><a href="#local-6989586621680184711"><span class="hs-identifier hs-var">externalWorkflowRunId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe RunId
</span><a href="#local-6989586621680184708"><span class="hs-identifier hs-var">mrId</span></a></span><span>
</span><span id="line-1318"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-1319"></span><span>
</span><span id="line-1320"></span><span>
</span><span id="line-1321"></span><span class="annot"><span class="hs-comment">{- | Wait on a condition to become true before continuing.

This must be used with signals, steps executed concurrently via the Applicative instance,
or with the `race` command, as those are the only way for
state to change in a workflow while a portion of the workflow itself is
in this blocking condition.

N.B. this should be used with care, as it can lead to the workflow
suspending indefinitely if the condition is never met.
(e.g. if there is no signal handler that changes the state appropriately)
-}</span></span><span>
</span><span id="line-1332"></span><span class="annot"><a href="Temporal.Workflow.html#waitCondition"><span class="hs-identifier hs-type">waitCondition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Condition"><span class="hs-identifier hs-type">Condition</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1333"></span><span id="waitCondition"><span class="annot"><span class="annottext">waitCondition :: RequireCallStack =&gt; Condition Bool -&gt; Workflow ()
</span><a href="Temporal.Workflow.html#waitCondition"><span class="hs-identifier hs-var hs-var">waitCondition</span></a></span></span><span> </span><span id="local-6989586621680184748"><span class="annot"><span class="annottext">c :: Condition Bool
</span><a href="#local-6989586621680184748"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Condition"><span class="hs-identifier hs-type">Condition</span></a></span><span> </span><span id="local-6989586621680184750"><span class="annot"><span class="annottext">ReaderT (IORef (Set Sequence)) InstanceM Bool
</span><a href="#local-6989586621680184750"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1334"></span><span>  </span><span class="annot"><span class="annottext">Workflow ()
RequireCallStack =&gt; Workflow ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStackW"><span class="hs-identifier hs-var">updateCallStackW</span></a></span><span>
</span><span id="line-1335"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680184751"><span class="annot"><a href="#local-6989586621680184751"><span class="hs-identifier hs-var">conditionSatisfied</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680184752"><span class="annot"><a href="#local-6989586621680184752"><span class="hs-identifier hs-var">touchedVars</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM (Bool, Set Sequence) -&gt; Workflow (Bool, Set Sequence)
forall a. RequireCallStack =&gt; InstanceM a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#ilift"><span class="hs-identifier hs-var">ilift</span></a></span><span> </span><span class="annot"><span class="annottext">(InstanceM (Bool, Set Sequence) -&gt; Workflow (Bool, Set Sequence))
-&gt; InstanceM (Bool, Set Sequence) -&gt; Workflow (Bool, Set Sequence)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1336"></span><span>    </span><span id="local-6989586621680184753"><span class="annot"><a href="#local-6989586621680184753"><span class="hs-identifier hs-var">sRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set Sequence -&gt; InstanceM (IORef (Set Sequence))
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">Set Sequence
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1337"></span><span>    </span><span id="local-6989586621680184755"><span class="annot"><a href="#local-6989586621680184755"><span class="hs-identifier hs-var">sat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621680184750"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184753"><span class="hs-identifier hs-type">sRef</span></a></span><span>
</span><span id="line-1338"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680184755"><span class="hs-identifier hs-type">sat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621680184753"><span class="hs-identifier hs-type">sRef</span></a></span><span>
</span><span id="line-1339"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621680184751"><span class="hs-identifier hs-type">conditionSatisfied</span></a></span><span>
</span><span id="line-1340"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1341"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="#local-6989586621680184757"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184752"><span class="hs-identifier hs-type">touchedVars</span></a></span><span>
</span><span id="line-1342"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1343"></span><span>    </span><span class="hs-comment">-- When blocked, the condition needs to be rechecked every time a signal is received</span><span>
</span><span id="line-1344"></span><span>    </span><span class="hs-comment">-- or a new resolutions are received from a workflow activation.</span><span>
</span><span id="line-1345"></span><span>    </span><span id="local-6989586621680184757"><span class="annot"><span class="annottext">go :: Set Sequence -&gt; Workflow ()
</span><a href="#local-6989586621680184757"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680184758"><span class="annot"><span class="annottext">Set Sequence
</span><a href="#local-6989586621680184758"><span class="hs-identifier hs-var">touchedVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1346"></span><span>      </span><span id="local-6989586621680184759"><span class="annot"><a href="#local-6989586621680184759"><span class="hs-identifier hs-var">blockedVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM (IVar ()) -&gt; Workflow (IVar ())
forall a. RequireCallStack =&gt; InstanceM a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#ilift"><span class="hs-identifier hs-var">ilift</span></a></span><span> </span><span class="annot"><span class="annottext">(InstanceM (IVar ()) -&gt; Workflow (IVar ()))
-&gt; InstanceM (IVar ()) -&gt; Workflow (IVar ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1347"></span><span>        </span><span id="local-6989586621680184760"><span class="annot"><a href="#local-6989586621680184760"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM WorkflowInstance
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1348"></span><span>        </span><span id="local-6989586621680184761"><span class="annot"><a href="#local-6989586621680184761"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#newIVar"><span class="hs-identifier hs-type">newIVar</span></a></span><span>
</span><span id="line-1349"></span><span>        </span><span id="local-6989586621680184762"><span class="annot"><a href="#local-6989586621680184762"><span class="hs-identifier hs-var">conditionSeq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Instance.html#nextConditionSequence"><span class="hs-identifier hs-type">nextConditionSequence</span></a></span><span>
</span><span id="line-1350"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">atomically</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">modifyTVar'</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowSequenceMaps</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680184764"><span class="annot"><span class="annottext">SequenceMaps
</span><a href="#local-6989586621680184764"><span class="hs-identifier hs-var">seqMaps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1351"></span><span>          </span><span class="annot"><span class="annottext">SequenceMaps
</span><a href="#local-6989586621680184764"><span class="hs-identifier hs-var">seqMaps</span></a></span><span>
</span><span id="line-1352"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#conditionsAwaitingSignal"><span class="hs-identifier hs-var">conditionsAwaitingSignal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621680184762"><span class="hs-identifier hs-type">conditionSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184761"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680184758"><span class="hs-identifier hs-type">touchedVars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier">seqMaps</span></span><span class="hs-operator">.</span><span class="hs-identifier">conditionsAwaitingSignal</span><span>
</span><span id="line-1353"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-1354"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621680184761"><span class="hs-identifier hs-type">res</span></a></span><span>
</span><span id="line-1355"></span><span>      </span><span class="hs-comment">-- Wait for the condition to be signaled. Once signalled, we just try again.</span><span>
</span><span id="line-1356"></span><span>      </span><span class="hs-comment">-- writeStateVar and friends are in charge of filling the ivar and clearing out the seqmaps between rechecks</span><span>
</span><span id="line-1357"></span><span>      </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#getIVar"><span class="hs-identifier hs-type">getIVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184759"><span class="hs-identifier hs-type">blockedVar</span></a></span><span>
</span><span id="line-1358"></span><span>      </span><span class="annot"><a href="Temporal.Workflow.html#waitCondition"><span class="hs-identifier hs-type">waitCondition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184748"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-1359"></span><span>
</span><span id="line-1360"></span><span>
</span><span id="line-1361"></span><span class="annot"><span class="hs-comment">{- | While workflows are deterministic, there are categories of operational concerns (metrics, logging, tracing, etc.) that require
access to IO operations like the network or filesystem. The 'IO' monad is not generally available in the 'Workflow' monad, but you
can use 'sink' to run an 'IO' action in a workflow. In order to maintain determinism, the operation will be executed asynchronously
and does not return a value. Be sure that the sink operation terminates, or else you will leak memory and/or threads.

Do not use 'sink' for any Workflow logic, or else you will violate determinism.
-}</span></span><span>
</span><span id="line-1368"></span><span class="annot"><a href="Temporal.Workflow.html#unsafeAsyncEffectSink"><span class="hs-identifier hs-type">unsafeAsyncEffectSink</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1369"></span><span id="unsafeAsyncEffectSink"><span class="annot"><span class="annottext">unsafeAsyncEffectSink :: RequireCallStack =&gt; IO () -&gt; Workflow ()
</span><a href="Temporal.Workflow.html#unsafeAsyncEffectSink"><span class="hs-identifier hs-var hs-var">unsafeAsyncEffectSink</span></a></span></span><span> </span><span id="local-6989586621680184776"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621680184776"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1370"></span><span>  </span><span class="annot"><span class="annottext">Workflow ()
RequireCallStack =&gt; Workflow ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStackW"><span class="hs-identifier hs-var">updateCallStackW</span></a></span><span>
</span><span id="line-1371"></span><span>  </span><span class="annot"><span class="annottext">InstanceM () -&gt; Workflow ()
forall a. RequireCallStack =&gt; InstanceM a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#ilift"><span class="hs-identifier hs-var">ilift</span></a></span><span> </span><span class="annot"><span class="annottext">(InstanceM () -&gt; Workflow ()) -&gt; InstanceM () -&gt; Workflow ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; InstanceM ()
forall a. IO a -&gt; InstanceM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; InstanceM ()) -&gt; IO () -&gt; InstanceM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO ThreadId -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(IO ThreadId -&gt; IO ()) -&gt; IO ThreadId -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO ThreadId
</span><span class="hs-identifier hs-var">forkIO</span></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621680184776"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1372"></span><span>
</span><span id="line-1373"></span><span>
</span><span id="line-1374"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1375"></span><span class="hs-comment">-- Parallel operations</span><span>
</span><span id="line-1376"></span><span>
</span><span id="line-1377"></span><span class="hs-comment">{-
If either workflow completes with a Left a result, the computation will short-circuit and immediately return @Left a@.
This means that if one branch produces a 'Left' result, the other branch's computation will be aborted if it hasn't already completed.

If both workflows complete with Right results, the function will return @Right (b, c)@.
In this case, both branches will be fully evaluated.
-}</span><span>
</span><span id="line-1384"></span><span id="local-6989586621680182414"><span id="local-6989586621680182415"><span id="local-6989586621680182416"><span class="annot"><a href="Temporal.Workflow.html#biselect"><span class="hs-identifier hs-type">biselect</span></a></span><span>
</span><span id="line-1385"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span>
</span><span id="line-1386"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621680182414"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182415"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1387"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621680182414"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182416"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1388"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621680182414"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680182415"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680182416"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1389"></span><span id="biselect"><span class="annot"><span class="annottext">biselect :: forall a b c.
RequireCallStack =&gt;
Workflow (Either a b)
-&gt; Workflow (Either a c) -&gt; Workflow (Either a (b, c))
</span><a href="Temporal.Workflow.html#biselect"><span class="hs-identifier hs-var hs-var">biselect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Either a b -&gt; Either a b)
-&gt; (Either a c -&gt; Either a c)
-&gt; (a -&gt; Either a (b, c))
-&gt; ((b, c) -&gt; Either a (b, c))
-&gt; Workflow (Either a b)
-&gt; Workflow (Either a c)
-&gt; Workflow (Either a (b, c))
forall l a b r c t.
RequireCallStack =&gt;
(l -&gt; Either a b)
-&gt; (r -&gt; Either a c)
-&gt; (a -&gt; t)
-&gt; ((b, c) -&gt; t)
-&gt; Workflow l
-&gt; Workflow r
-&gt; Workflow t
</span><a href="Temporal.Workflow.html#biselectOpt"><span class="hs-identifier hs-var">biselectOpt</span></a></span><span> </span><span class="annot"><span class="annottext">Either a b -&gt; Either a b
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Either a c -&gt; Either a c
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Either a (b, c)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(b, c) -&gt; Either a (b, c)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span>
</span><span id="line-1390"></span><span>
</span><span id="line-1391"></span><span>
</span><span id="line-1392"></span><span class="annot"><span class="hs-comment">{- | The 'biselectOpt' function combines two workflows and applies optimized selection logic.

This function is inspired by the 'Haxl' library's Haxl.Core.Parallel functions. It takes two workflows
and combines them, applying discrimination functions to their results to determine the final outcome.
The function works as follows:

1. It explores both workflows concurrently.

2. If the left workflow completes first:
   - If the first argument returns 'Left', the result is immediately returned using the third function.
   - If the first argument returns 'Right', it waits for the right workflow to complete.

3. If the right workflow completes first:
   - If the second argument returns 'Left', the result is immediately returned using the third function.
   - If the second argument returns 'Right', it waits for the left workflow to complete.

4. If both workflows complete:
   - The results are combined using the fourth function if both discriminators return 'Right'.

5. If either workflow throws an exception, the exception is propagated.

6. If either workflow is blocked, the function manages the blocking and resumption of computation.

This function optimizes the execution by short-circuiting when possible and managing concurrency
efficiently. Be cautious when using this function, as exceptions and evaluation order can be
unpredictable depending on the discriminator functions provided.
-}</span></span><span>
</span><span id="line-1419"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Temporal.Workflow.html#biselectOpt"><span class="hs-pragma hs-type">biselectOpt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1420"></span><span id="local-6989586621680182420"><span id="local-6989586621680182421"><span id="local-6989586621680182422"><span id="local-6989586621680182423"><span id="local-6989586621680182424"><span id="local-6989586621680182425"><span class="annot"><a href="Temporal.Workflow.html#biselectOpt"><span class="hs-identifier hs-type">biselectOpt</span></a></span><span>
</span><span id="line-1421"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span>
</span><span id="line-1422"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680182420"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621680182421"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182422"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1423"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680182423"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621680182421"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182424"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1424"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680182421"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182425"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1425"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680182422"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680182424"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182425"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1426"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182420"><span class="hs-identifier hs-type">l</span></a></span><span>
</span><span id="line-1427"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182423"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-1428"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182425"><span class="hs-identifier hs-type">t</span></a></span></span></span></span></span></span></span><span>
</span><span id="line-1429"></span><span id="biselectOpt"><span class="annot"><span class="annottext">biselectOpt :: forall l a b r c t.
RequireCallStack =&gt;
(l -&gt; Either a b)
-&gt; (r -&gt; Either a c)
-&gt; (a -&gt; t)
-&gt; ((b, c) -&gt; t)
-&gt; Workflow l
-&gt; Workflow r
-&gt; Workflow t
</span><a href="Temporal.Workflow.html#biselectOpt"><span class="hs-identifier hs-var hs-var">biselectOpt</span></a></span></span><span> </span><span id="local-6989586621680184795"><span class="annot"><span class="annottext">l -&gt; Either a b
</span><a href="#local-6989586621680184795"><span class="hs-identifier hs-var">discrimA</span></a></span></span><span> </span><span id="local-6989586621680184796"><span class="annot"><span class="annottext">r -&gt; Either a c
</span><a href="#local-6989586621680184796"><span class="hs-identifier hs-var">discrimB</span></a></span></span><span> </span><span id="local-6989586621680184797"><span class="annot"><span class="annottext">a -&gt; t
</span><a href="#local-6989586621680184797"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span id="local-6989586621680184798"><span class="annot"><span class="annottext">(b, c) -&gt; t
</span><a href="#local-6989586621680184798"><span class="hs-identifier hs-var">right</span></a></span></span><span> </span><span id="local-6989586621680184799"><span class="annot"><span class="annottext">Workflow l
</span><a href="#local-6989586621680184799"><span class="hs-identifier hs-var">wfL</span></a></span></span><span> </span><span id="local-6989586621680184800"><span class="annot"><span class="annottext">Workflow r
</span><a href="#local-6989586621680184800"><span class="hs-identifier hs-var">wfR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1430"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680184801"><span class="annot"><span class="annottext">go :: Workflow l -&gt; Workflow r -&gt; Workflow t
</span><a href="#local-6989586621680184801"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span id="local-6989586621680184802"><span class="annot"><span class="annottext">ContinuationEnv -&gt; InstanceM (Result l)
</span><a href="#local-6989586621680184802"><span class="hs-identifier hs-var">wfA</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span id="local-6989586621680184803"><span class="annot"><span class="annottext">ContinuationEnv -&gt; InstanceM (Result r)
</span><a href="#local-6989586621680184803"><span class="hs-identifier hs-var">wfB</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result t)) -&gt; Workflow t
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result t)) -&gt; Workflow t)
-&gt; (ContinuationEnv -&gt; InstanceM (Result t)) -&gt; Workflow t
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680184804"><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680184804"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1431"></span><span>        </span><span id="local-6989586621680184805"><span class="annot"><a href="#local-6989586621680184805"><span class="hs-identifier hs-var">ra</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContinuationEnv -&gt; InstanceM (Result l)
</span><a href="#local-6989586621680184802"><span class="hs-identifier hs-var">wfA</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680184804"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1432"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680184805"><span class="hs-identifier hs-type">ra</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1433"></span><span>          </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span id="local-6989586621680184806"><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621680184806"><span class="hs-identifier hs-var">ea</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1434"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">l -&gt; Either a b
</span><a href="#local-6989586621680184795"><span class="hs-identifier hs-var">discrimA</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621680184806"><span class="hs-identifier hs-var">ea</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1435"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680184807"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680184807"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result t -&gt; InstanceM (Result t)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; Result t
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; t
</span><a href="#local-6989586621680184797"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680184807"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1436"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680184808"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680184808"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1437"></span><span>                </span><span id="local-6989586621680184809"><span class="annot"><a href="#local-6989586621680184809"><span class="hs-identifier hs-var">rb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContinuationEnv -&gt; InstanceM (Result r)
</span><a href="#local-6989586621680184803"><span class="hs-identifier hs-var">wfB</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680184804"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1438"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680184809"><span class="hs-identifier hs-type">rb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1439"></span><span>                  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span id="local-6989586621680184810"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680184810"><span class="hs-identifier hs-var">eb</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1440"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">r -&gt; Either a c
</span><a href="#local-6989586621680184796"><span class="hs-identifier hs-var">discrimB</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680184810"><span class="hs-identifier hs-var">eb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1441"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680184811"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680184811"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result t -&gt; InstanceM (Result t)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; Result t
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; t
</span><a href="#local-6989586621680184797"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680184811"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1442"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680184812"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680184812"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result t -&gt; InstanceM (Result t)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; Result t
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(b, c) -&gt; t
</span><a href="#local-6989586621680184798"><span class="hs-identifier hs-var">right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680184808"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680184812"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1443"></span><span>                  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-type">Throw</span></a></span><span> </span><span id="local-6989586621680184813"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680184813"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result t -&gt; InstanceM (Result t)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException -&gt; Result t
forall a. SomeException -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-var">Throw</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680184813"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1444"></span><span>                  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span id="local-6989586621680184816"><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680184816"><span class="hs-identifier hs-var">ib</span></a></span></span><span> </span><span id="local-6989586621680184817"><span class="annot"><span class="annottext">Cont r
</span><a href="#local-6989586621680184817"><span class="hs-identifier hs-var">wfB'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1445"></span><span>                    </span><span class="annot"><span class="annottext">Result t -&gt; InstanceM (Result t)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-1446"></span><span>                      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">IVar b -&gt; Cont t -&gt; Result t
forall a b. IVar b -&gt; Cont a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-var">Blocked</span></a></span><span>
</span><span id="line-1447"></span><span>                          </span><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680184816"><span class="hs-identifier hs-var">ib</span></a></span><span>
</span><span id="line-1448"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cont r
</span><a href="#local-6989586621680184817"><span class="hs-identifier hs-var">wfB'</span></a></span><span> </span><span class="annot"><span class="annottext">Cont r -&gt; (r -&gt; Workflow t) -&gt; Cont t
forall a b. Cont b -&gt; (b -&gt; Workflow a) -&gt; Cont a
</span><a href="Temporal.Workflow.Internal.Monad.html#%3A%3E%3E%3D"><span class="hs-operator hs-var">:&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680184819"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680184819"><span class="hs-identifier hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; r -&gt; Workflow t
</span><a href="#local-6989586621680184820"><span class="hs-identifier hs-var">goRight</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680184808"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680184819"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1449"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-1450"></span><span>          </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-type">Throw</span></a></span><span> </span><span id="local-6989586621680184821"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680184821"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result t -&gt; InstanceM (Result t)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException -&gt; Result t
forall a. SomeException -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-var">Throw</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680184821"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1451"></span><span>          </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span id="local-6989586621680184826"><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680184826"><span class="hs-identifier hs-var">ia</span></a></span></span><span> </span><span id="local-6989586621680184827"><span class="annot"><span class="annottext">Cont l
</span><a href="#local-6989586621680184827"><span class="hs-identifier hs-var">wfA'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1452"></span><span>            </span><span id="local-6989586621680184828"><span class="annot"><a href="#local-6989586621680184828"><span class="hs-identifier hs-var">rb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContinuationEnv -&gt; InstanceM (Result r)
</span><a href="#local-6989586621680184803"><span class="hs-identifier hs-var">wfB</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680184804"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1453"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680184828"><span class="hs-identifier hs-type">rb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1454"></span><span>              </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span id="local-6989586621680184829"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680184829"><span class="hs-identifier hs-var">eb</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1455"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">r -&gt; Either a c
</span><a href="#local-6989586621680184796"><span class="hs-identifier hs-var">discrimB</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680184829"><span class="hs-identifier hs-var">eb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1456"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680184830"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680184830"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result t -&gt; InstanceM (Result t)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; Result t
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; t
</span><a href="#local-6989586621680184797"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680184830"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1457"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680184831"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680184831"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1458"></span><span>                    </span><span class="annot"><span class="annottext">Result t -&gt; InstanceM (Result t)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IVar b -&gt; Cont t -&gt; Result t
forall a b. IVar b -&gt; Cont a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-var">Blocked</span></a></span><span> </span><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680184826"><span class="hs-identifier hs-var">ia</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cont l
</span><a href="#local-6989586621680184827"><span class="hs-identifier hs-var">wfA'</span></a></span><span> </span><span class="annot"><span class="annottext">Cont l -&gt; (l -&gt; Workflow t) -&gt; Cont t
forall a b. Cont b -&gt; (b -&gt; Workflow a) -&gt; Cont a
</span><a href="Temporal.Workflow.Internal.Monad.html#%3A%3E%3E%3D"><span class="hs-operator hs-var">:&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680184832"><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621680184832"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">l -&gt; c -&gt; Workflow t
</span><a href="#local-6989586621680184833"><span class="hs-identifier hs-var">goLeft</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621680184832"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680184831"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1459"></span><span>              </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-type">Throw</span></a></span><span> </span><span id="local-6989586621680184834"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680184834"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result t -&gt; InstanceM (Result t)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException -&gt; Result t
forall a. SomeException -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-var">Throw</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680184834"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1460"></span><span>              </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span id="local-6989586621680184842"><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680184842"><span class="hs-identifier hs-var">ib</span></a></span></span><span> </span><span id="local-6989586621680184843"><span class="annot"><span class="annottext">Cont r
</span><a href="#local-6989586621680184843"><span class="hs-identifier hs-var">wfB'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1461"></span><span>                </span><span id="local-6989586621680184844"><span class="annot"><a href="#local-6989586621680184844"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM (IVar ())
forall (m :: * -&gt; *) a. MonadIO m =&gt; m (IVar a)
</span><a href="Temporal.Workflow.Internal.Monad.html#newIVar"><span class="hs-identifier hs-var">newIVar</span></a></span><span>
</span><span id="line-1462"></span><span>                </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#addJob"><span class="hs-identifier hs-type">addJob</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184804"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680184844"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184826"><span class="hs-identifier hs-type">ia</span></a></span><span>
</span><span id="line-1463"></span><span>                </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#addJob"><span class="hs-identifier hs-type">addJob</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184804"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680184844"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184842"><span class="hs-identifier hs-type">ib</span></a></span><span>
</span><span id="line-1464"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184844"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Cont"><span class="hs-identifier hs-type">Cont</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184801"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#toWf"><span class="hs-identifier hs-type">toWf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184827"><span class="hs-identifier hs-type">wfA'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#toWf"><span class="hs-identifier hs-type">toWf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184843"><span class="hs-identifier hs-type">wfB'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1465"></span><span>      </span><span class="hs-comment">-- The code above makes sure that the computation</span><span>
</span><span id="line-1466"></span><span>      </span><span class="hs-comment">-- wakes up whenever either 'ia' or 'ib' is filled.</span><span>
</span><span id="line-1467"></span><span>      </span><span class="hs-comment">-- The ivar 'i' is used as a synchronisation point</span><span>
</span><span id="line-1468"></span><span>      </span><span class="hs-comment">-- for the whole computation, and we make sure that</span><span>
</span><span id="line-1469"></span><span>      </span><span class="hs-comment">-- whenever 'ia' or 'ib' are filled in then 'i' will</span><span>
</span><span id="line-1470"></span><span>      </span><span class="hs-comment">-- also be filled.</span><span>
</span><span id="line-1471"></span><span>
</span><span id="line-1472"></span><span>      </span><span id="local-6989586621680184820"><span class="annot"><span class="annottext">goRight :: b -&gt; r -&gt; Workflow t
</span><a href="#local-6989586621680184820"><span class="hs-identifier hs-var hs-var">goRight</span></a></span></span><span> </span><span id="local-6989586621680184848"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680184848"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680184849"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680184849"><span class="hs-identifier hs-var">eb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1473"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">r -&gt; Either a c
</span><a href="#local-6989586621680184796"><span class="hs-identifier hs-var">discrimB</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680184849"><span class="hs-identifier hs-var">eb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1474"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680184850"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680184850"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t -&gt; Workflow t
forall a. a -&gt; Workflow a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; t
</span><a href="#local-6989586621680184797"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680184850"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1475"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680184851"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680184851"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t -&gt; Workflow t
forall a. a -&gt; Workflow a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(b, c) -&gt; t
</span><a href="#local-6989586621680184798"><span class="hs-identifier hs-var">right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680184848"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680184851"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1476"></span><span>      </span><span id="local-6989586621680184833"><span class="annot"><span class="annottext">goLeft :: l -&gt; c -&gt; Workflow t
</span><a href="#local-6989586621680184833"><span class="hs-identifier hs-var hs-var">goLeft</span></a></span></span><span> </span><span id="local-6989586621680184852"><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621680184852"><span class="hs-identifier hs-var">ea</span></a></span></span><span> </span><span id="local-6989586621680184853"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680184853"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1477"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">l -&gt; Either a b
</span><a href="#local-6989586621680184795"><span class="hs-identifier hs-var">discrimA</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621680184852"><span class="hs-identifier hs-var">ea</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1478"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680184854"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680184854"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t -&gt; Workflow t
forall a. a -&gt; Workflow a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; t
</span><a href="#local-6989586621680184797"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680184854"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1479"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680184855"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680184855"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t -&gt; Workflow t
forall a. a -&gt; Workflow a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(b, c) -&gt; t
</span><a href="#local-6989586621680184798"><span class="hs-identifier hs-var">right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680184855"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680184853"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1480"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Workflow l -&gt; Workflow r -&gt; Workflow t
</span><a href="#local-6989586621680184801"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow l
</span><a href="#local-6989586621680184799"><span class="hs-identifier hs-var">wfL</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow r
</span><a href="#local-6989586621680184800"><span class="hs-identifier hs-var">wfR</span></a></span><span>
</span><span id="line-1481"></span><span>
</span><span id="line-1482"></span><span>
</span><span id="line-1483"></span><span class="annot"><span class="hs-comment">{- | This function takes two Workflow computations as input, and returns the
output of whichever computation finished first. The evaluation of the remaining
computation is discontinued.

Note: This function doesn't have a way to explicitly signal to the
incomplete other computation that it will no longer be evaluated,
so you should be careful about ensuring that incomplete
computations are not problematic for your problem domain.
-}</span></span><span>
</span><span id="line-1492"></span><span id="local-6989586621680182442"><span id="local-6989586621680182443"><span class="annot"><a href="Temporal.Workflow.html#race"><span class="hs-identifier hs-type">race</span></a></span><span>
</span><span id="line-1493"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span>
</span><span id="line-1494"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182442"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1495"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182443"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-1496"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621680182442"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182443"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1497"></span><span id="race"><span class="annot"><span class="annottext">race :: forall a b.
RequireCallStack =&gt;
Workflow a -&gt; Workflow b -&gt; Workflow (Either a b)
</span><a href="Temporal.Workflow.html#race"><span class="hs-identifier hs-var hs-var">race</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Either (Either a b) ())
-&gt; (b -&gt; Either (Either a b) ())
-&gt; (Either a b -&gt; Either a b)
-&gt; (((), ()) -&gt; Either a b)
-&gt; Workflow a
-&gt; Workflow b
-&gt; Workflow (Either a b)
forall l a b r c t.
RequireCallStack =&gt;
(l -&gt; Either a b)
-&gt; (r -&gt; Either a c)
-&gt; (a -&gt; t)
-&gt; ((b, c) -&gt; t)
-&gt; Workflow l
-&gt; Workflow r
-&gt; Workflow t
</span><a href="Temporal.Workflow.html#biselectOpt"><span class="hs-identifier hs-var">biselectOpt</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Either (Either a b) ()
forall a b. a -&gt; Either (Either a b) ()
</span><a href="#local-6989586621680184862"><span class="hs-identifier hs-var">discrimX</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; Either (Either a b) ()
forall b a. b -&gt; Either (Either a b) ()
</span><a href="#local-6989586621680184863"><span class="hs-identifier hs-var">discrimY</span></a></span><span> </span><span class="annot"><span class="annottext">Either a b -&gt; Either a b
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">((), ()) -&gt; Either a b
forall {p} {a}. p -&gt; a
</span><a href="#local-6989586621680184864"><span class="hs-identifier hs-var">right</span></a></span><span>
</span><span id="line-1498"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1499"></span><span>    </span><span id="local-6989586621680182446"><span id="local-6989586621680182447"><span class="annot"><a href="#local-6989586621680184862"><span class="hs-identifier hs-type">discrimX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680182446"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621680182446"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182447"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1500"></span><span>    </span><span id="local-6989586621680184862"><span class="annot"><span class="annottext">discrimX :: forall a b. a -&gt; Either (Either a b) ()
</span><a href="#local-6989586621680184862"><span class="hs-identifier hs-var hs-var">discrimX</span></a></span></span><span> </span><span id="local-6989586621680184865"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680184865"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either a b -&gt; Either (Either a b) ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Either a b
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680184865"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1501"></span><span>
</span><span id="line-1502"></span><span>    </span><span id="local-6989586621680182448"><span id="local-6989586621680182449"><span class="annot"><a href="#local-6989586621680184863"><span class="hs-identifier hs-type">discrimY</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680182448"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621680182449"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182448"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1503"></span><span>    </span><span id="local-6989586621680184863"><span class="annot"><span class="annottext">discrimY :: forall b a. b -&gt; Either (Either a b) ()
</span><a href="#local-6989586621680184863"><span class="hs-identifier hs-var hs-var">discrimY</span></a></span></span><span> </span><span id="local-6989586621680184866"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680184866"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either a b -&gt; Either (Either a b) ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; Either a b
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680184866"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1504"></span><span>
</span><span id="line-1505"></span><span>    </span><span id="local-6989586621680184864"><span class="annot"><span class="annottext">right :: p -&gt; a
</span><a href="#local-6989586621680184864"><span class="hs-identifier hs-var hs-var">right</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;race: We should never have a 'Right ()'&quot;</span></span><span>
</span><span id="line-1506"></span><span>
</span><span id="line-1507"></span><span>
</span><span id="line-1508"></span><span class="annot"><span class="hs-comment">{- | Run two Workflow actions concurrently, and return the first to finish.

Unlike 'Control.Concurrent.Async.race, this function doesn't explicitly cancel
the other computation. If you want to cancel the other computation,
you should return sufficient context to do so manually
-}</span></span><span>
</span><span id="line-1514"></span><span id="local-6989586621680182456"><span id="local-6989586621680182457"><span class="annot"><a href="Temporal.Workflow.html#race_"><span class="hs-identifier hs-type">race_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182456"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182457"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1515"></span><span id="race_"><span class="annot"><span class="annottext">race_ :: forall a b.
RequireCallStack =&gt;
Workflow a -&gt; Workflow b -&gt; Workflow ()
</span><a href="Temporal.Workflow.html#race_"><span class="hs-identifier hs-var hs-var">race_</span></a></span></span><span> </span><span id="local-6989586621680184876"><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680184876"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621680184877"><span class="annot"><span class="annottext">Workflow b
</span><a href="#local-6989586621680184877"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Workflow (Either a b) -&gt; Workflow ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Workflow (Either a b) -&gt; Workflow ())
-&gt; Workflow (Either a b) -&gt; Workflow ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Workflow a -&gt; Workflow b -&gt; Workflow (Either a b)
forall a b.
RequireCallStack =&gt;
Workflow a -&gt; Workflow b -&gt; Workflow (Either a b)
</span><a href="Temporal.Workflow.html#race"><span class="hs-identifier hs-var">Temporal.Workflow.race</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680184876"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow b
</span><a href="#local-6989586621680184877"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1516"></span><span>
</span><span id="line-1517"></span><span>
</span><span id="line-1518"></span><span class="annot"><span class="hs-comment">{- | Run two Workflow actions concurrently, and return both results. If either action throws an exception at any time, the other action will run to completion
as long as the exception is caught and handled.
-}</span></span><span>
</span><span id="line-1521"></span><span id="local-6989586621680182460"><span id="local-6989586621680182461"><span class="annot"><a href="Temporal.Workflow.html#concurrently"><span class="hs-identifier hs-type">concurrently</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182460"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182461"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680182460"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680182461"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1522"></span><span id="concurrently"><span class="annot"><span class="annottext">concurrently :: forall a b. Workflow a -&gt; Workflow b -&gt; Workflow (a, b)
</span><a href="Temporal.Workflow.html#concurrently"><span class="hs-identifier hs-var hs-var">concurrently</span></a></span></span><span> </span><span id="local-6989586621680184882"><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680184882"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621680184883"><span class="annot"><span class="annottext">Workflow b
</span><a href="#local-6989586621680184883"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConcurrentWorkflow (a, b) -&gt; Workflow (a, b)
forall a. ConcurrentWorkflow a -&gt; Workflow a
</span><a href="Temporal.Workflow.html#runConcurrentWorkflowActions"><span class="hs-identifier hs-var">runConcurrentWorkflowActions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a -&gt; b -&gt; (a, b))
-&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow (b -&gt; (a, b))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Workflow a -&gt; ConcurrentWorkflow a
forall a. Workflow a -&gt; ConcurrentWorkflow a
</span><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier hs-var">ConcurrentWorkflow</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680184882"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">ConcurrentWorkflow (b -&gt; (a, b))
-&gt; ConcurrentWorkflow b -&gt; ConcurrentWorkflow (a, b)
forall a b.
ConcurrentWorkflow (a -&gt; b)
-&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Workflow b -&gt; ConcurrentWorkflow b
forall a. Workflow a -&gt; ConcurrentWorkflow a
</span><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier hs-var">ConcurrentWorkflow</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow b
</span><a href="#local-6989586621680184883"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1523"></span><span>
</span><span id="line-1524"></span><span>
</span><span id="line-1525"></span><span class="annot"><span class="hs-comment">-- | Like 'concurrently', but ignore the result values.</span></span><span>
</span><span id="line-1526"></span><span id="local-6989586621680182466"><span id="local-6989586621680182467"><span class="annot"><a href="Temporal.Workflow.html#concurrently_"><span class="hs-identifier hs-type">concurrently_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182466"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182467"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1527"></span><span id="concurrently_"><span class="annot"><span class="annottext">concurrently_ :: forall a b. Workflow a -&gt; Workflow b -&gt; Workflow ()
</span><a href="Temporal.Workflow.html#concurrently_"><span class="hs-identifier hs-var hs-var">concurrently_</span></a></span></span><span> </span><span id="local-6989586621680184888"><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680184888"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621680184889"><span class="annot"><span class="annottext">Workflow b
</span><a href="#local-6989586621680184889"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Workflow (a, b) -&gt; Workflow ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Workflow (a, b) -&gt; Workflow ()) -&gt; Workflow (a, b) -&gt; Workflow ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Workflow a -&gt; Workflow b -&gt; Workflow (a, b)
forall a b. Workflow a -&gt; Workflow b -&gt; Workflow (a, b)
</span><a href="Temporal.Workflow.html#concurrently"><span class="hs-identifier hs-var">Temporal.Workflow.concurrently</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680184888"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow b
</span><a href="#local-6989586621680184889"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1528"></span><span>
</span><span id="line-1529"></span><span>
</span><span id="line-1530"></span><span class="annot"><span class="hs-comment">{- | Map an effect-performing function over over any 'Traversable' data type, performing each action concurrently,
returning the original data structure with the arguments replaced with the results.

This is actually a bit of a misnomer, since it's really 'traverseConcurrently', but this is copied to mimic the 'async' package's naming
to slightly ease adoption.
-}</span></span><span>
</span><span id="line-1536"></span><span id="local-6989586621680182470"><span id="local-6989586621680182471"><span id="local-6989586621680182472"><span class="annot"><a href="Temporal.Workflow.html#mapConcurrently"><span class="hs-identifier hs-type">mapConcurrently</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Traversable</span></span><span> </span><span class="annot"><a href="#local-6989586621680182470"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680182471"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182472"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182470"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182471"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680182470"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182472"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1537"></span><span id="mapConcurrently"><span class="annot"><span class="annottext">mapConcurrently :: forall (t :: * -&gt; *) a b.
Traversable t =&gt;
(a -&gt; Workflow b) -&gt; t a -&gt; Workflow (t b)
</span><a href="Temporal.Workflow.html#mapConcurrently"><span class="hs-identifier hs-var hs-var">mapConcurrently</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Workflow b) -&gt; t a -&gt; Workflow (t b)
forall (t :: * -&gt; *) a b.
Traversable t =&gt;
(a -&gt; Workflow b) -&gt; t a -&gt; Workflow (t b)
</span><a href="Temporal.Workflow.html#traverseConcurrently"><span class="hs-identifier hs-var">traverseConcurrently</span></a></span><span>
</span><span id="line-1538"></span><span>
</span><span id="line-1539"></span><span>
</span><span id="line-1540"></span><span class="annot"><span class="hs-comment">-- | Alias for 'traverseConcurrently_'</span></span><span>
</span><span id="line-1541"></span><span id="local-6989586621680182476"><span id="local-6989586621680182477"><span id="local-6989586621680182478"><span class="annot"><a href="Temporal.Workflow.html#mapConcurrently_"><span class="hs-identifier hs-type">mapConcurrently_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621680182476"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680182477"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182478"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182476"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182477"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1542"></span><span id="mapConcurrently_"><span class="annot"><span class="annottext">mapConcurrently_ :: forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; Workflow b) -&gt; t a -&gt; Workflow ()
</span><a href="Temporal.Workflow.html#mapConcurrently_"><span class="hs-identifier hs-var hs-var">mapConcurrently_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Workflow b) -&gt; t a -&gt; Workflow ()
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; Workflow b) -&gt; t a -&gt; Workflow ()
</span><a href="Temporal.Workflow.html#traverseConcurrently_"><span class="hs-identifier hs-var">traverseConcurrently_</span></a></span><span>
</span><span id="line-1543"></span><span>
</span><span id="line-1544"></span><span>
</span><span id="line-1545"></span><span class="annot"><span class="hs-comment">-- | Perform the action in the given number of evaluation branches.</span></span><span>
</span><span id="line-1546"></span><span id="local-6989586621680182482"><span class="annot"><a href="Temporal.Workflow.html#replicateConcurrently"><span class="hs-identifier hs-type">replicateConcurrently</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182482"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680182482"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-1547"></span><span id="replicateConcurrently"><span class="annot"><span class="annottext">replicateConcurrently :: forall a. Int -&gt; Workflow a -&gt; Workflow [a]
</span><a href="Temporal.Workflow.html#replicateConcurrently"><span class="hs-identifier hs-var hs-var">replicateConcurrently</span></a></span></span><span> </span><span id="local-6989586621680184898"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680184898"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConcurrentWorkflow [a] -&gt; Workflow [a]
forall a. ConcurrentWorkflow a -&gt; Workflow a
</span><a href="Temporal.Workflow.html#runConcurrentWorkflowActions"><span class="hs-identifier hs-var">runConcurrentWorkflowActions</span></a></span><span> </span><span class="annot"><span class="annottext">(ConcurrentWorkflow [a] -&gt; Workflow [a])
-&gt; (Workflow a -&gt; ConcurrentWorkflow [a])
-&gt; Workflow a
-&gt; Workflow [a]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[ConcurrentWorkflow a] -&gt; ConcurrentWorkflow [a]
forall (t :: * -&gt; *) (f :: * -&gt; *) a.
(Traversable t, Applicative f) =&gt;
t (f a) -&gt; f (t a)
forall (f :: * -&gt; *) a. Applicative f =&gt; [f a] -&gt; f [a]
</span><span class="hs-identifier hs-var">sequenceA</span></span><span> </span><span class="annot"><span class="annottext">([ConcurrentWorkflow a] -&gt; ConcurrentWorkflow [a])
-&gt; (Workflow a -&gt; [ConcurrentWorkflow a])
-&gt; Workflow a
-&gt; ConcurrentWorkflow [a]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ConcurrentWorkflow a -&gt; [ConcurrentWorkflow a]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680184898"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(ConcurrentWorkflow a -&gt; [ConcurrentWorkflow a])
-&gt; (Workflow a -&gt; ConcurrentWorkflow a)
-&gt; Workflow a
-&gt; [ConcurrentWorkflow a]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Workflow a -&gt; ConcurrentWorkflow a
forall a. Workflow a -&gt; ConcurrentWorkflow a
</span><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier hs-var">ConcurrentWorkflow</span></a></span><span>
</span><span id="line-1548"></span><span>
</span><span id="line-1549"></span><span>
</span><span id="line-1550"></span><span class="annot"><span class="hs-comment">-- | Perform the action in the given number of evaluation branches, discarding the results</span></span><span>
</span><span id="line-1551"></span><span id="local-6989586621680182487"><span class="annot"><a href="Temporal.Workflow.html#replicateConcurrently_"><span class="hs-identifier hs-type">replicateConcurrently_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182487"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1552"></span><span id="replicateConcurrently_"><span class="annot"><span class="annottext">replicateConcurrently_ :: forall a. Int -&gt; Workflow a -&gt; Workflow ()
</span><a href="Temporal.Workflow.html#replicateConcurrently_"><span class="hs-identifier hs-var hs-var">replicateConcurrently_</span></a></span></span><span> </span><span id="local-6989586621680184908"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680184908"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConcurrentWorkflow () -&gt; Workflow ()
forall a. ConcurrentWorkflow a -&gt; Workflow a
</span><a href="Temporal.Workflow.html#runConcurrentWorkflowActions"><span class="hs-identifier hs-var">runConcurrentWorkflowActions</span></a></span><span> </span><span class="annot"><span class="annottext">(ConcurrentWorkflow () -&gt; Workflow ())
-&gt; (Workflow a -&gt; ConcurrentWorkflow ())
-&gt; Workflow a
-&gt; Workflow ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[ConcurrentWorkflow ()] -&gt; ConcurrentWorkflow ()
forall m. Monoid m =&gt; [m] -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="annot"><span class="annottext">([ConcurrentWorkflow ()] -&gt; ConcurrentWorkflow ())
-&gt; (Workflow a -&gt; [ConcurrentWorkflow ()])
-&gt; Workflow a
-&gt; ConcurrentWorkflow ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ConcurrentWorkflow () -&gt; [ConcurrentWorkflow ()]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680184908"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(ConcurrentWorkflow () -&gt; [ConcurrentWorkflow ()])
-&gt; (Workflow a -&gt; ConcurrentWorkflow ())
-&gt; Workflow a
-&gt; [ConcurrentWorkflow ()]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Workflow () -&gt; ConcurrentWorkflow ()
forall a. Workflow a -&gt; ConcurrentWorkflow a
</span><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier hs-var">ConcurrentWorkflow</span></a></span><span> </span><span class="annot"><span class="annottext">(Workflow () -&gt; ConcurrentWorkflow ())
-&gt; (Workflow a -&gt; Workflow ())
-&gt; Workflow a
-&gt; ConcurrentWorkflow ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Workflow a -&gt; Workflow ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span>
</span><span id="line-1553"></span><span>
</span><span id="line-1554"></span><span>
</span><span id="line-1555"></span><span class="annot"><span class="hs-comment">-- | Evaluate the action in the given number of evaluation branches, accumulating the results</span></span><span>
</span><span id="line-1556"></span><span id="local-6989586621680184910"><span id="local-6989586621680184911"><span id="local-6989586621680184912"><span class="annot"><a href="Temporal.Workflow.html#traverseConcurrently"><span class="hs-identifier hs-type">traverseConcurrently</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Traversable</span></span><span> </span><span class="annot"><a href="#local-6989586621680184910"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184911"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184912"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680184910"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184911"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184910"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184912"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1557"></span><span id="traverseConcurrently"><span class="annot"><span class="annottext">traverseConcurrently :: forall (t :: * -&gt; *) a b.
Traversable t =&gt;
(a -&gt; Workflow b) -&gt; t a -&gt; Workflow (t b)
</span><a href="Temporal.Workflow.html#traverseConcurrently"><span class="hs-identifier hs-var hs-var">traverseConcurrently</span></a></span></span><span> </span><span id="local-6989586621680184916"><span class="annot"><span class="annottext">a -&gt; Workflow b
</span><a href="#local-6989586621680184916"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680184917"><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621680184917"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConcurrentWorkflow (t b) -&gt; Workflow (t b)
forall a. ConcurrentWorkflow a -&gt; Workflow a
</span><a href="Temporal.Workflow.html#runConcurrentWorkflowActions"><span class="hs-identifier hs-var">runConcurrentWorkflowActions</span></a></span><span> </span><span class="annot"><span class="annottext">(ConcurrentWorkflow (t b) -&gt; Workflow (t b))
-&gt; ConcurrentWorkflow (t b) -&gt; Workflow (t b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; ConcurrentWorkflow b) -&gt; t a -&gt; ConcurrentWorkflow (t b)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Workflow b -&gt; ConcurrentWorkflow b
forall a. Workflow a -&gt; ConcurrentWorkflow a
</span><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier hs-var">ConcurrentWorkflow</span></a></span><span> </span><span class="annot"><span class="annottext">(Workflow b -&gt; ConcurrentWorkflow b)
-&gt; (a -&gt; Workflow b) -&gt; a -&gt; ConcurrentWorkflow b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Workflow b
</span><a href="#local-6989586621680184916"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621680184917"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1558"></span><span>
</span><span id="line-1559"></span><span>
</span><span id="line-1560"></span><span id="local-6989586621680184919"><span id="local-6989586621680184920"><span id="local-6989586621680184921"><span class="annot"><a href="Temporal.Workflow.html#traverseConcurrently_"><span class="hs-identifier hs-type">traverseConcurrently_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621680184919"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184920"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184921"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680184919"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184920"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1561"></span><span id="traverseConcurrently_"><span class="annot"><span class="annottext">traverseConcurrently_ :: forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; Workflow b) -&gt; t a -&gt; Workflow ()
</span><a href="Temporal.Workflow.html#traverseConcurrently_"><span class="hs-identifier hs-var hs-var">traverseConcurrently_</span></a></span></span><span> </span><span id="local-6989586621680184925"><span class="annot"><span class="annottext">a -&gt; Workflow b
</span><a href="#local-6989586621680184925"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680184926"><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621680184926"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConcurrentWorkflow () -&gt; Workflow ()
forall a. ConcurrentWorkflow a -&gt; Workflow a
</span><a href="Temporal.Workflow.html#runConcurrentWorkflowActions"><span class="hs-identifier hs-var">runConcurrentWorkflowActions</span></a></span><span> </span><span class="annot"><span class="annottext">(ConcurrentWorkflow () -&gt; Workflow ())
-&gt; ConcurrentWorkflow () -&gt; Workflow ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; ConcurrentWorkflow b) -&gt; t a -&gt; ConcurrentWorkflow ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Workflow b -&gt; ConcurrentWorkflow b
forall a. Workflow a -&gt; ConcurrentWorkflow a
</span><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier hs-var">ConcurrentWorkflow</span></a></span><span> </span><span class="annot"><span class="annottext">(Workflow b -&gt; ConcurrentWorkflow b)
-&gt; (a -&gt; Workflow b) -&gt; a -&gt; ConcurrentWorkflow b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Workflow b
</span><a href="#local-6989586621680184925"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621680184926"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1562"></span><span>
</span><span id="line-1563"></span><span>
</span><span id="line-1564"></span><span class="annot"><span class="hs-comment">-- | Evaluate each Workflow action in the structure concurrently, and collect the results.</span></span><span>
</span><span id="line-1565"></span><span id="local-6989586621680182505"><span id="local-6989586621680182506"><span class="annot"><a href="Temporal.Workflow.html#sequenceConcurrently"><span class="hs-identifier hs-type">sequenceConcurrently</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Traversable</span></span><span> </span><span class="annot"><a href="#local-6989586621680182505"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182505"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182506"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680182505"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182506"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1566"></span><span id="sequenceConcurrently"><span class="annot"><span class="annottext">sequenceConcurrently :: forall (t :: * -&gt; *) a.
Traversable t =&gt;
t (Workflow a) -&gt; Workflow (t a)
</span><a href="Temporal.Workflow.html#sequenceConcurrently"><span class="hs-identifier hs-var hs-var">sequenceConcurrently</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConcurrentWorkflow (t a) -&gt; Workflow (t a)
forall a. ConcurrentWorkflow a -&gt; Workflow a
</span><a href="Temporal.Workflow.html#runConcurrentWorkflowActions"><span class="hs-identifier hs-var">runConcurrentWorkflowActions</span></a></span><span> </span><span class="annot"><span class="annottext">(ConcurrentWorkflow (t a) -&gt; Workflow (t a))
-&gt; (t (Workflow a) -&gt; ConcurrentWorkflow (t a))
-&gt; t (Workflow a)
-&gt; Workflow (t a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Workflow a -&gt; ConcurrentWorkflow a)
-&gt; t (Workflow a) -&gt; ConcurrentWorkflow (t a)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">Workflow a -&gt; ConcurrentWorkflow a
forall a. Workflow a -&gt; ConcurrentWorkflow a
</span><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier hs-var">ConcurrentWorkflow</span></a></span><span>
</span><span id="line-1567"></span><span>
</span><span id="line-1568"></span><span>
</span><span id="line-1569"></span><span class="annot"><span class="hs-comment">-- | Evaluate each Workflow action in the structure concurrently, and ignore the results.</span></span><span>
</span><span id="line-1570"></span><span id="local-6989586621680182509"><span id="local-6989586621680182510"><span class="annot"><a href="Temporal.Workflow.html#sequenceConcurrently_"><span class="hs-identifier hs-type">sequenceConcurrently_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621680182509"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182509"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182510"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1571"></span><span id="sequenceConcurrently_"><span class="annot"><span class="annottext">sequenceConcurrently_ :: forall (t :: * -&gt; *) a. Foldable t =&gt; t (Workflow a) -&gt; Workflow ()
</span><a href="Temporal.Workflow.html#sequenceConcurrently_"><span class="hs-identifier hs-var hs-var">sequenceConcurrently_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConcurrentWorkflow () -&gt; Workflow ()
forall a. ConcurrentWorkflow a -&gt; Workflow a
</span><a href="Temporal.Workflow.html#runConcurrentWorkflowActions"><span class="hs-identifier hs-var">runConcurrentWorkflowActions</span></a></span><span> </span><span class="annot"><span class="annottext">(ConcurrentWorkflow () -&gt; Workflow ())
-&gt; (t (Workflow a) -&gt; ConcurrentWorkflow ())
-&gt; t (Workflow a)
-&gt; Workflow ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Workflow a -&gt; ConcurrentWorkflow a)
-&gt; t (Workflow a) -&gt; ConcurrentWorkflow ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="annot"><span class="annottext">Workflow a -&gt; ConcurrentWorkflow a
forall a. Workflow a -&gt; ConcurrentWorkflow a
</span><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier hs-var">ConcurrentWorkflow</span></a></span><span>
</span><span id="line-1572"></span><span>
</span><span id="line-1573"></span><span>
</span><span id="line-1574"></span><span class="annot"><span class="hs-comment">-- | 'traverseConcurrently' with the arguments flipped.</span></span><span>
</span><span id="line-1575"></span><span id="local-6989586621680182513"><span id="local-6989586621680182514"><span id="local-6989586621680182515"><span class="annot"><a href="Temporal.Workflow.html#forConcurrently"><span class="hs-identifier hs-type">forConcurrently</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Traversable</span></span><span> </span><span class="annot"><a href="#local-6989586621680182513"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182513"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182514"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680182514"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182515"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680182513"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182515"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1576"></span><span id="forConcurrently"><span class="annot"><span class="annottext">forConcurrently :: forall (t :: * -&gt; *) a b.
Traversable t =&gt;
t a -&gt; (a -&gt; Workflow b) -&gt; Workflow (t b)
</span><a href="Temporal.Workflow.html#forConcurrently"><span class="hs-identifier hs-var hs-var">forConcurrently</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a -&gt; Workflow b) -&gt; t a -&gt; Workflow (t b))
-&gt; t a -&gt; (a -&gt; Workflow b) -&gt; Workflow (t b)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Workflow b) -&gt; t a -&gt; Workflow (t b)
forall (t :: * -&gt; *) a b.
Traversable t =&gt;
(a -&gt; Workflow b) -&gt; t a -&gt; Workflow (t b)
</span><a href="Temporal.Workflow.html#traverseConcurrently"><span class="hs-identifier hs-var">traverseConcurrently</span></a></span><span>
</span><span id="line-1577"></span><span>
</span><span id="line-1578"></span><span>
</span><span id="line-1579"></span><span class="annot"><span class="hs-comment">-- | 'traverseConcurrently_' with the arguments flipped.</span></span><span>
</span><span id="line-1580"></span><span id="local-6989586621680182522"><span id="local-6989586621680182523"><span id="local-6989586621680182524"><span class="annot"><a href="Temporal.Workflow.html#forConcurrently_"><span class="hs-identifier hs-type">forConcurrently_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621680182522"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680182522"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182523"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680182523"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182524"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1581"></span><span id="forConcurrently_"><span class="annot"><span class="annottext">forConcurrently_ :: forall (t :: * -&gt; *) a b.
Foldable t =&gt;
t a -&gt; (a -&gt; Workflow b) -&gt; Workflow ()
</span><a href="Temporal.Workflow.html#forConcurrently_"><span class="hs-identifier hs-var hs-var">forConcurrently_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a -&gt; Workflow b) -&gt; t a -&gt; Workflow ())
-&gt; t a -&gt; (a -&gt; Workflow b) -&gt; Workflow ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Workflow b) -&gt; t a -&gt; Workflow ()
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; Workflow b) -&gt; t a -&gt; Workflow ()
</span><a href="Temporal.Workflow.html#traverseConcurrently_"><span class="hs-identifier hs-var">traverseConcurrently_</span></a></span><span>
</span><span id="line-1582"></span><span>
</span><span id="line-1583"></span><span>
</span><span id="line-1584"></span><span class="hs-comment">{- Similar to 'concurrently', but don't let the failure of one computation affect the other. -}</span><span>
</span><span id="line-1585"></span><span id="local-6989586621680184938"><span id="local-6989586621680184939"><span class="annot"><a href="Temporal.Workflow.html#independently"><span class="hs-identifier hs-type">independently</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184938"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680184939"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680184938"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680184939"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1586"></span><span id="independently"><span class="annot"><span class="annottext">independently :: forall a b. Workflow a -&gt; Workflow b -&gt; Workflow (a, b)
</span><a href="Temporal.Workflow.html#independently"><span class="hs-identifier hs-var hs-var">independently</span></a></span></span><span> </span><span id="local-6989586621680184960"><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680184960"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621680184961"><span class="annot"><span class="annottext">Workflow b
</span><a href="#local-6989586621680184961"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1587"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680184962"><span class="annot"><a href="#local-6989586621680184962"><span class="hs-identifier hs-var">el</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680184963"><span class="annot"><a href="#local-6989586621680184963"><span class="hs-identifier hs-var">er</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Workflow (Either SomeException a)
-&gt; Workflow (Either SomeException b)
-&gt; Workflow (Either SomeException a, Either SomeException b)
forall a b. Workflow a -&gt; Workflow b -&gt; Workflow (a, b)
</span><a href="Temporal.Workflow.html#concurrently"><span class="hs-identifier hs-var">Temporal.Workflow.concurrently</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Workflow a -&gt; Workflow (Either SomeException a)
forall (m :: * -&gt; *) e a.
(HasCallStack, MonadCatch m, Exception e) =&gt;
m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">Control.Monad.Catch.try</span></span><span> </span><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680184960"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Workflow b -&gt; Workflow (Either SomeException b)
forall (m :: * -&gt; *) e a.
(HasCallStack, MonadCatch m, Exception e) =&gt;
m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">Control.Monad.Catch.try</span></span><span> </span><span class="annot"><span class="annottext">Workflow b
</span><a href="#local-6989586621680184961"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1588"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680184965"><span class="annot"><a href="#local-6989586621680184965"><span class="hs-identifier hs-var hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a -&gt; b -&gt; (a, b))
-&gt; Either SomeException a -&gt; Either SomeException (b -&gt; (a, b))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Either SomeException a
</span><a href="#local-6989586621680184962"><span class="hs-identifier hs-var">el</span></a></span><span> </span><span class="annot"><span class="annottext">Either SomeException (b -&gt; (a, b))
-&gt; Either SomeException b -&gt; Either SomeException (a, b)
forall a b.
Either SomeException (a -&gt; b)
-&gt; Either SomeException a -&gt; Either SomeException b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Either SomeException b
</span><a href="#local-6989586621680184963"><span class="hs-identifier hs-var">er</span></a></span><span>
</span><span id="line-1589"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680184965"><span class="hs-identifier hs-type">results</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1590"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680184966"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680184966"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Workflow (a, b)
forall (m :: * -&gt; *) e a.
(HasCallStack, MonadThrow m, Exception e) =&gt;
e -&gt; m a
</span><span class="hs-identifier hs-var">throwWithCallStack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680184966"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span class="hs-special">)</span><span>
</span><span id="line-1591"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680184967"><span class="annot"><span class="annottext">(a, b)
</span><a href="#local-6989586621680184967"><span class="hs-identifier hs-var">ok</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a, b) -&gt; Workflow (a, b)
forall a. a -&gt; Workflow a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(a, b)
</span><a href="#local-6989586621680184967"><span class="hs-identifier hs-var">ok</span></a></span><span>
</span><span id="line-1592"></span><span>
</span><span id="line-1593"></span><span>
</span><span id="line-1594"></span><span class="hs-comment">{-
=== state vars ===

Since state vars await cause Conditions to await, we need a way to track whether they have
been updated since the condition suspended. We give each statevar a unique identifier for
lookups, and a sequence number that updates for each write to the IORef.
-}</span><span>
</span><span id="line-1601"></span><span>
</span><span id="line-1602"></span><span class="annot"><span class="hs-comment">{- | 'Workflow's may be sent a cancellation request from the Temporal Platform,
but Workflow code is not required to respond to the cancellation request.

In order to opt in to cancellation handling, you can call 'isCancelRequested'
periodically within your workflow code to check whether a cancellation request
has been received.
-}</span></span><span>
</span><span id="line-1609"></span><span class="annot"><a href="Temporal.Workflow.html#isCancelRequested"><span class="hs-identifier hs-type">isCancelRequested</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1610"></span><span id="isCancelRequested"><span class="annot"><span class="annottext">isCancelRequested :: RequireCallStack =&gt; Workflow Bool
</span><a href="Temporal.Workflow.html#isCancelRequested"><span class="hs-identifier hs-var hs-var">isCancelRequested</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1611"></span><span>  </span><span class="annot"><span class="annottext">Workflow ()
RequireCallStack =&gt; Workflow ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStackW"><span class="hs-identifier hs-var">updateCallStackW</span></a></span><span>
</span><span id="line-1612"></span><span>  </span><span id="local-6989586621680184980"><span class="annot"><a href="#local-6989586621680184980"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Workflow WorkflowInstance
</span><a href="Temporal.Workflow.Internal.Monad.html#askInstance"><span class="hs-identifier hs-var">askInstance</span></a></span><span>
</span><span id="line-1613"></span><span>  </span><span id="local-6989586621680184981"><span class="annot"><a href="#local-6989586621680184981"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#tryReadIVar"><span class="hs-identifier hs-type">tryReadIVar</span></a></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowCancellationVar</span><span>
</span><span id="line-1614"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680184981"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1615"></span><span>    </span><span class="annot"><span class="annottext">Maybe ()
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Workflow Bool
forall a. a -&gt; Workflow a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1616"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Workflow Bool
forall a. a -&gt; Workflow a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1617"></span><span>
</span><span id="line-1618"></span><span>
</span><span id="line-1619"></span><span class="annot"><span class="hs-comment">{- | Block the current workflow's main execution thread until the workflow is cancelled.

The workflow can still respond to signals and queries while waiting for cancellation.

Upon cancellation, the workflow will throw a 'WorkflowCancelRequested' exception.

This function is useful for actor-style workflows that perform work in response to signals
and/or respond to queries, but otherwise need to remain idle on their main codepath.

N.B. It is likely not safe to call this in a signal handler.
-}</span></span><span>
</span><span id="line-1630"></span><span class="annot"><a href="Temporal.Workflow.html#waitCancellation"><span class="hs-identifier hs-type">waitCancellation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1631"></span><span id="waitCancellation"><span class="annot"><span class="annottext">waitCancellation :: RequireCallStack =&gt; Workflow ()
</span><a href="Temporal.Workflow.html#waitCancellation"><span class="hs-identifier hs-var hs-var">waitCancellation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1632"></span><span>  </span><span class="annot"><span class="annottext">Workflow ()
RequireCallStack =&gt; Workflow ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStackW"><span class="hs-identifier hs-var">updateCallStackW</span></a></span><span>
</span><span id="line-1633"></span><span>  </span><span id="local-6989586621680184998"><span class="annot"><a href="#local-6989586621680184998"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Workflow WorkflowInstance
</span><a href="Temporal.Workflow.Internal.Monad.html#askInstance"><span class="hs-identifier hs-var">askInstance</span></a></span><span>
</span><span id="line-1634"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#getIVar"><span class="hs-identifier hs-type">getIVar</span></a></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowCancellationVar</span><span>
</span><span id="line-1635"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#throw"><span class="hs-identifier hs-type">throw</span></a></span><span> </span><span class="annot"><a href="Temporal.Exception.html#WorkflowCancelRequested"><span class="hs-identifier hs-type">WorkflowCancelRequested</span></a></span><span>
</span><span id="line-1636"></span><span>
</span><span id="line-1637"></span><span>
</span><span id="line-1638"></span><span class="annot"><a href="Temporal.Workflow.html#defaultRetryPolicy"><span class="hs-identifier hs-type">defaultRetryPolicy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Common.html#RetryPolicy"><span class="hs-identifier hs-type">RetryPolicy</span></a></span><span>
</span><span id="line-1639"></span><span id="defaultRetryPolicy"><span class="annot"><span class="annottext">defaultRetryPolicy :: RetryPolicy
</span><a href="Temporal.Workflow.html#defaultRetryPolicy"><span class="hs-identifier hs-var hs-var">defaultRetryPolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1640"></span><span>  </span><span class="annot"><a href="Temporal.Common.html#RetryPolicy"><span class="hs-identifier hs-type">RetryPolicy</span></a></span><span>
</span><span id="line-1641"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">initialInterval :: Duration
</span><a href="Temporal.Common.html#initialInterval"><span class="hs-identifier hs-var">initialInterval</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Duration
</span><a href="Temporal.Duration.html#seconds"><span class="hs-identifier hs-var">seconds</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1642"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">backoffCoefficient :: Double
</span><a href="Temporal.Common.html#backoffCoefficient"><span class="hs-identifier hs-var">backoffCoefficient</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span>
</span><span id="line-1643"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">maximumInterval :: Maybe Duration
</span><a href="Temporal.Common.html#maximumInterval"><span class="hs-identifier hs-var">maximumInterval</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Duration
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1644"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">maximumAttempts :: Int32
</span><a href="Temporal.Common.html#maximumAttempts"><span class="hs-identifier hs-var">maximumAttempts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int32
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1645"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nonRetryableErrorTypes :: Vector Text
</span><a href="Temporal.Common.html#nonRetryableErrorTypes"><span class="hs-identifier hs-var">nonRetryableErrorTypes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Text
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1646"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-1647"></span><span>
</span><span id="line-1648"></span><span>
</span><span id="line-1649"></span><span class="annot"><span class="hs-comment">{- | A value of type 'ConcurrentWorkflow' a is a 'Workflow' operation that can be composed with other ConcurrentWorkflow values, using the Applicative and Alternative instances.

'ConcurrentWorkflow' effectively operates as a computation DAG. It's evaluated by exploring the expression across all of the branches of computation until every branch becomes blocked
waiting on results from Temporal.

Once that happens, it submits all commands that it has accumulated to the Temporal orchestrator and waits to be reactivated with commands from the orchestrator that unblock
computation on one or more branches. This is repeated until the computation completes. When 'Applicative' is used, that means that each computation branch doesn't depend on the
result of the others, so they can all explore as far as possible and get blocked. If we use 'Monad', then that means that the result of the previous computation has to become
unblocked in order to provide the result to the subsequent computation.
-}</span></span><span>
</span><span id="line-1659"></span><span class="hs-keyword">newtype</span><span> </span><span id="ConcurrentWorkflow"><span class="annot"><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier hs-var">ConcurrentWorkflow</span></a></span></span><span> </span><span id="local-6989586621680182465"><span class="annot"><a href="#local-6989586621680182465"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ConcurrentWorkflow"><span class="annot"><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier hs-var">ConcurrentWorkflow</span></a></span></span><span> </span><span class="hs-special">{</span><span id="runConcurrentWorkflowActions"><span class="annot"><span class="annottext">forall a. ConcurrentWorkflow a -&gt; Workflow a
</span><a href="Temporal.Workflow.html#runConcurrentWorkflowActions"><span class="hs-identifier hs-var hs-var">runConcurrentWorkflowActions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680182465"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-1660"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680185006"><span id="local-6989586621680185010"><span class="annot"><span class="annottext">(forall a b.
 (a -&gt; b) -&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow b)
-&gt; (forall a b. a -&gt; ConcurrentWorkflow b -&gt; ConcurrentWorkflow a)
-&gt; Functor ConcurrentWorkflow
forall a b. a -&gt; ConcurrentWorkflow b -&gt; ConcurrentWorkflow a
forall a b.
(a -&gt; b) -&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b.
(a -&gt; b) -&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow b
fmap :: forall a b.
(a -&gt; b) -&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow b
$c&lt;$ :: forall a b. a -&gt; ConcurrentWorkflow b -&gt; ConcurrentWorkflow a
&lt;$ :: forall a b. a -&gt; ConcurrentWorkflow b -&gt; ConcurrentWorkflow a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680185019"><span class="annot"><span class="annottext">Monad ConcurrentWorkflow
Monad ConcurrentWorkflow =&gt;
(forall msg.
 ToLogStr msg =&gt;
 Loc -&gt; Text -&gt; LogLevel -&gt; msg -&gt; ConcurrentWorkflow ())
-&gt; MonadLogger ConcurrentWorkflow
forall msg.
ToLogStr msg =&gt;
Loc -&gt; Text -&gt; LogLevel -&gt; msg -&gt; ConcurrentWorkflow ()
forall (m :: * -&gt; *).
Monad m =&gt;
(forall msg.
 ToLogStr msg =&gt;
 Loc -&gt; Text -&gt; LogLevel -&gt; msg -&gt; m ())
-&gt; MonadLogger m
$cmonadLoggerLog :: forall msg.
ToLogStr msg =&gt;
Loc -&gt; Text -&gt; LogLevel -&gt; msg -&gt; ConcurrentWorkflow ()
monadLoggerLog :: forall msg.
ToLogStr msg =&gt;
Loc -&gt; Text -&gt; LogLevel -&gt; msg -&gt; ConcurrentWorkflow ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadLogger</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680185028"><span id="local-6989586621680185033"><span id="local-6989586621680185039"><span class="annot"><span class="annottext">NonEmpty (ConcurrentWorkflow a) -&gt; ConcurrentWorkflow a
ConcurrentWorkflow a
-&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow a
(ConcurrentWorkflow a
 -&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow a)
-&gt; (NonEmpty (ConcurrentWorkflow a) -&gt; ConcurrentWorkflow a)
-&gt; (forall b.
    Integral b =&gt;
    b -&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow a)
-&gt; Semigroup (ConcurrentWorkflow a)
forall b.
Integral b =&gt;
b -&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow a
forall a.
Semigroup a =&gt;
NonEmpty (ConcurrentWorkflow a) -&gt; ConcurrentWorkflow a
forall a.
Semigroup a =&gt;
ConcurrentWorkflow a
-&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow a
forall a b.
(Semigroup a, Integral b) =&gt;
b -&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow a
forall a.
(a -&gt; a -&gt; a)
-&gt; (NonEmpty a -&gt; a)
-&gt; (forall b. Integral b =&gt; b -&gt; a -&gt; a)
-&gt; Semigroup a
$c&lt;&gt; :: forall a.
Semigroup a =&gt;
ConcurrentWorkflow a
-&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow a
&lt;&gt; :: ConcurrentWorkflow a
-&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow a
$csconcat :: forall a.
Semigroup a =&gt;
NonEmpty (ConcurrentWorkflow a) -&gt; ConcurrentWorkflow a
sconcat :: NonEmpty (ConcurrentWorkflow a) -&gt; ConcurrentWorkflow a
$cstimes :: forall a b.
(Semigroup a, Integral b) =&gt;
b -&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow a
stimes :: forall b.
Integral b =&gt;
b -&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Semigroup</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680185053"><span id="local-6989586621680185058"><span id="local-6989586621680185062"><span class="annot"><span class="annottext">Semigroup (ConcurrentWorkflow a)
ConcurrentWorkflow a
Semigroup (ConcurrentWorkflow a) =&gt;
ConcurrentWorkflow a
-&gt; (ConcurrentWorkflow a
    -&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow a)
-&gt; ([ConcurrentWorkflow a] -&gt; ConcurrentWorkflow a)
-&gt; Monoid (ConcurrentWorkflow a)
[ConcurrentWorkflow a] -&gt; ConcurrentWorkflow a
ConcurrentWorkflow a
-&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow a
forall a.
Semigroup a =&gt;
a -&gt; (a -&gt; a -&gt; a) -&gt; ([a] -&gt; a) -&gt; Monoid a
forall a. Monoid a =&gt; Semigroup (ConcurrentWorkflow a)
forall a. Monoid a =&gt; ConcurrentWorkflow a
forall a.
Monoid a =&gt;
[ConcurrentWorkflow a] -&gt; ConcurrentWorkflow a
forall a.
Monoid a =&gt;
ConcurrentWorkflow a
-&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow a
$cmempty :: forall a. Monoid a =&gt; ConcurrentWorkflow a
mempty :: ConcurrentWorkflow a
$cmappend :: forall a.
Monoid a =&gt;
ConcurrentWorkflow a
-&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow a
mappend :: ConcurrentWorkflow a
-&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow a
$cmconcat :: forall a.
Monoid a =&gt;
[ConcurrentWorkflow a] -&gt; ConcurrentWorkflow a
mconcat :: [ConcurrentWorkflow a] -&gt; ConcurrentWorkflow a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monoid</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680185070"><span id="local-6989586621680185075"><span id="local-6989586621680185079"><span id="local-6989586621680185083"><span class="annot"><span class="annottext">Applicative ConcurrentWorkflow
Applicative ConcurrentWorkflow =&gt;
(forall a. ConcurrentWorkflow a)
-&gt; (forall a.
    ConcurrentWorkflow a
    -&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow a)
-&gt; (forall a. ConcurrentWorkflow a -&gt; ConcurrentWorkflow [a])
-&gt; (forall a. ConcurrentWorkflow a -&gt; ConcurrentWorkflow [a])
-&gt; Alternative ConcurrentWorkflow
forall a. ConcurrentWorkflow a
forall a. ConcurrentWorkflow a -&gt; ConcurrentWorkflow [a]
forall a.
ConcurrentWorkflow a
-&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow a
forall (f :: * -&gt; *).
Applicative f =&gt;
(forall a. f a)
-&gt; (forall a. f a -&gt; f a -&gt; f a)
-&gt; (forall a. f a -&gt; f [a])
-&gt; (forall a. f a -&gt; f [a])
-&gt; Alternative f
$cempty :: forall a. ConcurrentWorkflow a
empty :: forall a. ConcurrentWorkflow a
$c&lt;|&gt; :: forall a.
ConcurrentWorkflow a
-&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow a
&lt;|&gt; :: forall a.
ConcurrentWorkflow a
-&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow a
$csome :: forall a. ConcurrentWorkflow a -&gt; ConcurrentWorkflow [a]
some :: forall a. ConcurrentWorkflow a -&gt; ConcurrentWorkflow [a]
$cmany :: forall a. ConcurrentWorkflow a -&gt; ConcurrentWorkflow [a]
many :: forall a. ConcurrentWorkflow a -&gt; ConcurrentWorkflow [a]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Alternative</span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680185101"><span class="annot"><span class="annottext">MonadThrow ConcurrentWorkflow
MonadThrow ConcurrentWorkflow =&gt;
(forall e a.
 (HasCallStack, Exception e) =&gt;
 ConcurrentWorkflow a
 -&gt; (e -&gt; ConcurrentWorkflow a) -&gt; ConcurrentWorkflow a)
-&gt; MonadCatch ConcurrentWorkflow
forall e a.
(HasCallStack, Exception e) =&gt;
ConcurrentWorkflow a
-&gt; (e -&gt; ConcurrentWorkflow a) -&gt; ConcurrentWorkflow a
forall (m :: * -&gt; *).
MonadThrow m =&gt;
(forall e a.
 (HasCallStack, Exception e) =&gt;
 m a -&gt; (e -&gt; m a) -&gt; m a)
-&gt; MonadCatch m
$ccatch :: forall e a.
(HasCallStack, Exception e) =&gt;
ConcurrentWorkflow a
-&gt; (e -&gt; ConcurrentWorkflow a) -&gt; ConcurrentWorkflow a
catch :: forall e a.
(HasCallStack, Exception e) =&gt;
ConcurrentWorkflow a
-&gt; (e -&gt; ConcurrentWorkflow a) -&gt; ConcurrentWorkflow a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadCatch</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680185120"><span class="annot"><span class="annottext">Monad ConcurrentWorkflow
Monad ConcurrentWorkflow =&gt;
(forall e a.
 (HasCallStack, Exception e) =&gt;
 e -&gt; ConcurrentWorkflow a)
-&gt; MonadThrow ConcurrentWorkflow
forall e a.
(HasCallStack, Exception e) =&gt;
e -&gt; ConcurrentWorkflow a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall e a. (HasCallStack, Exception e) =&gt; e -&gt; m a)
-&gt; MonadThrow m
$cthrowM :: forall e a.
(HasCallStack, Exception e) =&gt;
e -&gt; ConcurrentWorkflow a
throwM :: forall e a.
(HasCallStack, Exception e) =&gt;
e -&gt; ConcurrentWorkflow a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadThrow</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-1661"></span><span>
</span><span id="line-1662"></span><span>
</span><span id="line-1663"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680185135"><span id="local-6989586621680185138"><span id="local-6989586621680185141"><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier hs-type">ConcurrentWorkflow</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1664"></span><span>  </span><span id="local-6989586621680185144"><span class="annot"><span class="annottext">pure :: forall a. a -&gt; ConcurrentWorkflow a
</span><span class="hs-identifier hs-var hs-var hs-var">pure</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Workflow a -&gt; ConcurrentWorkflow a
forall a. Workflow a -&gt; ConcurrentWorkflow a
</span><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier hs-var">ConcurrentWorkflow</span></a></span><span> </span><span class="annot"><span class="annottext">(Workflow a -&gt; ConcurrentWorkflow a)
-&gt; (a -&gt; Workflow a) -&gt; a -&gt; ConcurrentWorkflow a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Workflow a
forall a. a -&gt; Workflow a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-1665"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier hs-type">ConcurrentWorkflow</span></a></span><span> </span><span id="local-6989586621680185145"><span class="annot"><span class="annottext">Workflow (a -&gt; b)
</span><a href="#local-6989586621680185145"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680185146"><span class="annot"><span class="annottext">&lt;*&gt; :: forall a b.
ConcurrentWorkflow (a -&gt; b)
-&gt; ConcurrentWorkflow a -&gt; ConcurrentWorkflow b
</span><span class="hs-operator hs-var hs-var hs-var">&lt;*&gt;</span></span></span><span> </span><span class="annot"><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier hs-type">ConcurrentWorkflow</span></a></span><span> </span><span id="local-6989586621680185147"><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680185147"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Workflow b -&gt; ConcurrentWorkflow b
forall a. Workflow a -&gt; ConcurrentWorkflow a
</span><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier hs-var">ConcurrentWorkflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Workflow (a -&gt; b) -&gt; Workflow a -&gt; Workflow b
forall a b. Workflow (a -&gt; b) -&gt; Workflow a -&gt; Workflow b
</span><a href="Temporal.Workflow.Internal.Monad.html#parallelAp"><span class="hs-identifier hs-var">parallelAp</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow (a -&gt; b)
</span><a href="#local-6989586621680185145"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680185147"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1666"></span><span>
</span><span id="line-1667"></span><span>
</span><span id="line-1668"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680185153"><span id="local-6989586621680185156"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier hs-type">ConcurrentWorkflow</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1669"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier hs-type">ConcurrentWorkflow</span></a></span><span> </span><span id="local-6989586621680185159"><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680185159"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621680185160"><span class="annot"><span class="annottext">&gt;&gt;= :: forall a b.
ConcurrentWorkflow a
-&gt; (a -&gt; ConcurrentWorkflow b) -&gt; ConcurrentWorkflow b
</span><span class="hs-operator hs-var hs-var hs-var">&gt;&gt;=</span></span></span><span> </span><span id="local-6989586621680185161"><span class="annot"><span class="annottext">a -&gt; ConcurrentWorkflow b
</span><a href="#local-6989586621680185161"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Workflow b -&gt; ConcurrentWorkflow b
forall a. Workflow a -&gt; ConcurrentWorkflow a
</span><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier hs-var">ConcurrentWorkflow</span></a></span><span> </span><span class="annot"><span class="annottext">(Workflow b -&gt; ConcurrentWorkflow b)
-&gt; Workflow b -&gt; ConcurrentWorkflow b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1670"></span><span>    </span><span id="local-6989586621680185162"><span class="annot"><a href="#local-6989586621680185162"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680185159"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1671"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Temporal.Workflow.html#ConcurrentWorkflow"><span class="hs-identifier hs-type">ConcurrentWorkflow</span></a></span><span> </span><span id="local-6989586621680185163"><span class="annot"><a href="#local-6989586621680185163"><span class="hs-identifier hs-var">m'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680185161"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680185162"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-1672"></span><span>    </span><span class="annot"><a href="#local-6989586621680185163"><span class="hs-identifier hs-type">m'</span></a></span><span>
</span><span id="line-1673"></span></pre></body></html>