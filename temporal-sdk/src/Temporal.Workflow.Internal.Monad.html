<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_GHC -Wno-unrecognised-pragmas #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html"><span class="hs-identifier">Temporal.Workflow.Internal.Monad</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Async</span></span><span>
</span><span id="line-7"></span><span class="hs-comment">-- import Debug.Trace</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Catch</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Catch</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Logger</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HashMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HashMap</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time.Clock.System</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SystemTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Vector</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Word32</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Stack</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TypeLits</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Proto.Temporal.Sdk.Core.WorkflowActivation.WorkflowActivation</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Proto.Temporal.Sdk.Core.WorkflowCommands.WorkflowCommands</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">WorkflowCommand</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">RequireCallStack</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Random</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><span class="hs-identifier">genShortByteString</span></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><span class="hs-identifier">genWord16</span></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><span class="hs-identifier">genWord32</span></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><span class="hs-identifier">genWord32R</span></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><span class="hs-identifier">genWord64</span></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><span class="hs-identifier">genWord64R</span></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><span class="hs-identifier">genWord8</span></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Random.Stateful</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">FrozenGen</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">RandomGenM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">StatefulGen</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">StdGen</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Common.html"><span class="hs-identifier">Temporal.Common</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Temporal.Core.Worker</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Core</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Exception.html"><span class="hs-identifier">Temporal.Exception</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Payload.html"><span class="hs-identifier">Temporal.Payload</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html"><span class="hs-identifier">Temporal.Workflow.Types</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Printf</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO</span></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="annot"><span class="hs-comment">{- | The Workflow monad is a constrained execution environment that helps
developers write code that can be executed deterministically and reliably.

If a Workflow execution is interrupted, for example due to a server failure,
or otherwise fails to complete, the Temporal service will automatically
replay the Workflow execution up to the point of interruption with the same
inputs at each step in the function.

The 'st' state may be used to store information that is needed to respond to
any queries or signals that are received by the Workflow execution.

Workflow code must be deterministic. This means:

- no threading
- no randomness
- no external calls to processes
- no network I/O
- no global state mutation
- no system date or time

This might seem like a lot of restrictions, but Temporal provides a number of
functions that allow you to use similar functionality in a deterministic way.

A critical aspect of developing Workflow Definitions is ensuring they exhibit certain deterministic traits &#8211;
that is, making sure that the same Commands are emitted in the same sequence,
whenever a corresponding Workflow Function Execution (instance of the Function Definition) is re-executed.
-}</span></span><span>
</span><span id="line-73"></span><span class="hs-keyword">newtype</span><span> </span><span id="Workflow"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span></span><span> </span><span id="local-6989586621680170702"><span class="annot"><a href="#local-6989586621680170702"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Workflow"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span></span><span> </span><span class="hs-special">{</span><span id="unWorkflow"><span class="annot"><span class="annottext">forall a. Workflow a -&gt; ContinuationEnv -&gt; InstanceM (Result a)
</span><a href="Temporal.Workflow.Internal.Monad.html#unWorkflow"><span class="hs-identifier hs-var hs-var">unWorkflow</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ContinuationEnv"><span class="hs-identifier hs-type">ContinuationEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#InstanceM"><span class="hs-identifier hs-type">InstanceM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170702"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span id="local-6989586621680170708"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ilift"><span class="hs-identifier hs-type">ilift</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#InstanceM"><span class="hs-identifier hs-type">InstanceM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170708"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170708"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-77"></span><span id="ilift"><span class="annot"><span class="annottext">ilift :: forall a. RequireCallStack =&gt; InstanceM a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#ilift"><span class="hs-identifier hs-var hs-var">ilift</span></a></span></span><span> </span><span id="local-6989586621680171242"><span class="annot"><span class="annottext">InstanceM a
</span><a href="#local-6989586621680171242"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a)
-&gt; (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Result a
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Result a) -&gt; InstanceM a -&gt; InstanceM (Result a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">InstanceM a
</span><a href="#local-6989586621680171242"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#askInstance"><span class="hs-identifier hs-type">askInstance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowInstance"><span class="hs-identifier hs-type">WorkflowInstance</span></a></span><span>
</span><span id="line-81"></span><span id="askInstance"><span class="annot"><span class="annottext">askInstance :: Workflow WorkflowInstance
</span><a href="Temporal.Workflow.Internal.Monad.html#askInstance"><span class="hs-identifier hs-var hs-var">askInstance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result WorkflowInstance))
-&gt; Workflow WorkflowInstance
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result WorkflowInstance))
 -&gt; Workflow WorkflowInstance)
-&gt; (ContinuationEnv -&gt; InstanceM (Result WorkflowInstance))
-&gt; Workflow WorkflowInstance
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(WorkflowInstance -&gt; Result WorkflowInstance)
-&gt; InstanceM (Result WorkflowInstance)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">WorkflowInstance -&gt; Result WorkflowInstance
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#addCommand"><span class="hs-identifier hs-type">addCommand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WorkflowCommand</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#InstanceM"><span class="hs-identifier hs-type">InstanceM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span id="addCommand"><span class="annot"><span class="annottext">addCommand :: WorkflowCommand -&gt; InstanceM ()
</span><a href="Temporal.Workflow.Internal.Monad.html#addCommand"><span class="hs-identifier hs-var hs-var">addCommand</span></a></span></span><span> </span><span id="local-6989586621680171248"><span class="annot"><span class="annottext">WorkflowCommand
</span><a href="#local-6989586621680171248"><span class="hs-identifier hs-var">command</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-86"></span><span>  </span><span id="local-6989586621680171249"><span class="annot"><a href="#local-6989586621680171249"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM WorkflowInstance
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">atomically</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">modifyTVar'</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowCommands</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680171253"><span class="annot"><span class="annottext">Reversed WorkflowCommand
</span><a href="#local-6989586621680171253"><span class="hs-identifier hs-var">cmds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkflowCommand
-&gt; Reversed WorkflowCommand -&gt; Reversed WorkflowCommand
forall a. a -&gt; Reversed a -&gt; Reversed a
</span><a href="Temporal.Workflow.Internal.Monad.html#push"><span class="hs-identifier hs-var">push</span></a></span><span> </span><span class="annot"><span class="annottext">WorkflowCommand
</span><a href="#local-6989586621680171248"><span class="hs-identifier hs-var">command</span></a></span><span> </span><span class="annot"><span class="annottext">Reversed WorkflowCommand
</span><a href="#local-6989586621680171253"><span class="hs-identifier hs-var">cmds</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="annot"><span class="hs-comment">{- | This function can be used to trace a bunch of lines to stdout when
debugging core.
-}</span></span><span>
</span><span id="line-94"></span><span id="local-6989586621680170728"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#trace_"><span class="hs-identifier hs-type">trace_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680170728"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680170728"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-95"></span><span id="trace_"><span class="annot"><span class="annottext">trace_ :: forall a. String -&gt; a -&gt; a
</span><a href="Temporal.Workflow.Internal.Monad.html#trace_"><span class="hs-identifier hs-var hs-var">trace_</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">-- trace_ = Debug.Trace.trace</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-keyword">data</span><span> </span><span id="ContinuationEnv"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ContinuationEnv"><span class="hs-identifier hs-var">ContinuationEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ContinuationEnv"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ContinuationEnv"><span class="hs-identifier hs-var">ContinuationEnv</span></a></span></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="runQueueRef"><span class="annot"><span class="annottext">ContinuationEnv -&gt; IORef JobList
</span><a href="Temporal.Workflow.Internal.Monad.html#runQueueRef"><span class="hs-identifier hs-var hs-var">runQueueRef</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#JobList"><span class="hs-identifier hs-type">JobList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-comment">-- ^ runnable computations. Things get added to here when we wake up</span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-comment">-- a computation that was waiting for something.  When the list is</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-comment">-- empty, either we're finished, or we're waiting for some data fetch</span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-comment">-- to return.</span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680171261"><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-110"></span><span>  </span><span id="local-6989586621680171268"><span class="annot"><span class="annottext">fmap :: forall a b. (a -&gt; b) -&gt; Workflow a -&gt; Workflow b
</span><span class="hs-identifier hs-var hs-var hs-var">fmap</span></span></span><span> </span><span id="local-6989586621680171269"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680171269"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span id="local-6989586621680171270"><span class="annot"><span class="annottext">ContinuationEnv -&gt; InstanceM (Result a)
</span><a href="#local-6989586621680171270"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result b)) -&gt; Workflow b
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result b)) -&gt; Workflow b)
-&gt; (ContinuationEnv -&gt; InstanceM (Result b)) -&gt; Workflow b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680171271"><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171271"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-111"></span><span>    </span><span id="local-6989586621680171272"><span class="annot"><a href="#local-6989586621680171272"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContinuationEnv -&gt; InstanceM (Result a)
</span><a href="#local-6989586621680171270"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171271"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680171272"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span id="local-6989586621680171273"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171273"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result b -&gt; InstanceM (Result b)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; Result b
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680171269"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171273"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>      </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-type">Throw</span></a></span><span> </span><span id="local-6989586621680171275"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171275"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result b -&gt; InstanceM (Result b)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException -&gt; Result b
forall a. SomeException -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-var">Throw</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171275"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>      </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span id="local-6989586621680171278"><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171278"><span class="hs-identifier hs-var">ivar</span></a></span></span><span> </span><span id="local-6989586621680171279"><span class="annot"><span class="annottext">Cont a
</span><a href="#local-6989586621680171279"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-116"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; InstanceM (Result b) -&gt; InstanceM (Result b)
forall a. String -&gt; a -&gt; a
</span><a href="Temporal.Workflow.Internal.Monad.html#trace_"><span class="hs-identifier hs-var">trace_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fmap Blocked&quot;</span></span><span> </span><span class="annot"><span class="annottext">(InstanceM (Result b) -&gt; InstanceM (Result b))
-&gt; InstanceM (Result b) -&gt; InstanceM (Result b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-117"></span><span>          </span><span class="annot"><span class="annottext">Result b -&gt; InstanceM (Result b)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IVar b -&gt; Cont b -&gt; Result b
forall a b. IVar b -&gt; Cont a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-var">Blocked</span></a></span><span> </span><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171278"><span class="hs-identifier hs-var">ivar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680171269"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Cont a -&gt; Cont b
forall a b. (b -&gt; a) -&gt; Cont b -&gt; Cont a
</span><a href="Temporal.Workflow.Internal.Monad.html#%3A%3C%24%3E"><span class="hs-operator hs-var">:&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Cont a
</span><a href="#local-6989586621680171279"><span class="hs-identifier hs-var">cont</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680171286"><span id="local-6989586621680171290"><span id="local-6989586621680171293"><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-121"></span><span>  </span><span id="local-6989586621680171297"><span class="annot"><span class="annottext">pure :: forall a. a -&gt; Workflow a
</span><span class="hs-identifier hs-var hs-var hs-var">pure</span></span></span><span> </span><span id="local-6989586621680171298"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171298"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a)
-&gt; (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680171299"><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171299"><span class="hs-identifier hs-var">_env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result a -&gt; InstanceM (Result a)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Result a
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171298"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-comment">-- TODO: Don't use parallelAp here, because people get too</span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-comment">-- confused about what's going on.</span><span>
</span><span id="line-126"></span><span>  </span><span id="local-6989586621680171304"><span class="annot"><span class="annottext">Workflow (a -&gt; b)
</span><a href="#local-6989586621680171304"><span class="hs-identifier hs-var">ff</span></a></span></span><span> </span><span id="local-6989586621680171305"><span class="annot"><span class="annottext">&lt;*&gt; :: forall a b. Workflow (a -&gt; b) -&gt; Workflow a -&gt; Workflow b
</span><span class="hs-operator hs-var hs-var hs-var">&lt;*&gt;</span></span></span><span> </span><span id="local-6989586621680171306"><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680171306"><span class="hs-identifier hs-var">aa</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Workflow (a -&gt; b)
</span><a href="#local-6989586621680171304"><span class="hs-identifier hs-var">ff</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow (a -&gt; b) -&gt; ((a -&gt; b) -&gt; Workflow b) -&gt; Workflow b
forall a b. Workflow a -&gt; (a -&gt; Workflow b) -&gt; Workflow b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680171307"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680171307"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680171306"><span class="hs-identifier hs-var">aa</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow a -&gt; (a -&gt; Workflow b) -&gt; Workflow b
forall a b. Workflow a -&gt; (a -&gt; Workflow b) -&gt; Workflow b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680171308"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171308"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; Workflow b
forall a. a -&gt; Workflow a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680171307"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171308"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-comment">-- (&lt;*&gt;) = parallelAp</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span id="local-6989586621680171309"><span id="local-6989586621680171310"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#parallelAp"><span class="hs-identifier hs-type">parallelAp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680171309"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680171310"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171309"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171310"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-132"></span><span id="parallelAp"><span class="annot"><span class="annottext">parallelAp :: forall a b. Workflow (a -&gt; b) -&gt; Workflow a -&gt; Workflow b
</span><a href="Temporal.Workflow.Internal.Monad.html#parallelAp"><span class="hs-identifier hs-var hs-var">parallelAp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span id="local-6989586621680171317"><span class="annot"><span class="annottext">ContinuationEnv -&gt; InstanceM (Result (a -&gt; b))
</span><a href="#local-6989586621680171317"><span class="hs-identifier hs-var">ff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span id="local-6989586621680171318"><span class="annot"><span class="annottext">ContinuationEnv -&gt; InstanceM (Result a)
</span><a href="#local-6989586621680171318"><span class="hs-identifier hs-var">aa</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result b)) -&gt; Workflow b
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result b)) -&gt; Workflow b)
-&gt; (ContinuationEnv -&gt; InstanceM (Result b)) -&gt; Workflow b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680171319"><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171319"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-133"></span><span>  </span><span id="local-6989586621680171320"><span class="annot"><a href="#local-6989586621680171320"><span class="hs-identifier hs-var">rf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContinuationEnv -&gt; InstanceM (Result (a -&gt; b))
</span><a href="#local-6989586621680171317"><span class="hs-identifier hs-var">ff</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171319"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680171320"><span class="hs-identifier hs-type">rf</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span id="local-6989586621680171321"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680171321"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-136"></span><span>      </span><span id="local-6989586621680171322"><span class="annot"><a href="#local-6989586621680171322"><span class="hs-identifier hs-var">ra</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContinuationEnv -&gt; InstanceM (Result a)
</span><a href="#local-6989586621680171318"><span class="hs-identifier hs-var">aa</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171319"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-137"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680171322"><span class="hs-identifier hs-type">ra</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-138"></span><span>        </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span id="local-6989586621680171323"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171323"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; InstanceM (Result b) -&gt; InstanceM (Result b)
forall a. String -&gt; a -&gt; a
</span><a href="Temporal.Workflow.Internal.Monad.html#trace_"><span class="hs-identifier hs-var">trace_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Done/Done&quot;</span></span><span> </span><span class="annot"><span class="annottext">(InstanceM (Result b) -&gt; InstanceM (Result b))
-&gt; InstanceM (Result b) -&gt; InstanceM (Result b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Result b -&gt; InstanceM (Result b)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; Result b
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680171321"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171323"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>        </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-type">Throw</span></a></span><span> </span><span id="local-6989586621680171324"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171324"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; InstanceM (Result b) -&gt; InstanceM (Result b)
forall a. String -&gt; a -&gt; a
</span><a href="Temporal.Workflow.Internal.Monad.html#trace_"><span class="hs-identifier hs-var">trace_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Done/Throw&quot;</span></span><span> </span><span class="annot"><span class="annottext">(InstanceM (Result b) -&gt; InstanceM (Result b))
-&gt; InstanceM (Result b) -&gt; InstanceM (Result b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Result b -&gt; InstanceM (Result b)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException -&gt; Result b
forall a. SomeException -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-var">Throw</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171324"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>        </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span id="local-6989586621680171326"><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171326"><span class="hs-identifier hs-var">ivar</span></a></span></span><span> </span><span id="local-6989586621680171327"><span class="annot"><span class="annottext">Cont a
</span><a href="#local-6989586621680171327"><span class="hs-identifier hs-var">fcont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-141"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; InstanceM (Result b) -&gt; InstanceM (Result b)
forall a. String -&gt; a -&gt; a
</span><a href="Temporal.Workflow.Internal.Monad.html#trace_"><span class="hs-identifier hs-var">trace_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Done/Blocked&quot;</span></span><span> </span><span class="annot"><span class="annottext">(InstanceM (Result b) -&gt; InstanceM (Result b))
-&gt; InstanceM (Result b) -&gt; InstanceM (Result b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-142"></span><span>            </span><span class="annot"><span class="annottext">Result b -&gt; InstanceM (Result b)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IVar b -&gt; Cont b -&gt; Result b
forall a b. IVar b -&gt; Cont a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-var">Blocked</span></a></span><span> </span><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171326"><span class="hs-identifier hs-var">ivar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680171321"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Cont a -&gt; Cont b
forall a b. (b -&gt; a) -&gt; Cont b -&gt; Cont a
</span><a href="Temporal.Workflow.Internal.Monad.html#%3A%3C%24%3E"><span class="hs-operator hs-var">:&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Cont a
</span><a href="#local-6989586621680171327"><span class="hs-identifier hs-var">fcont</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-type">Throw</span></a></span><span> </span><span id="local-6989586621680171328"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171328"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; InstanceM (Result b) -&gt; InstanceM (Result b)
forall a. String -&gt; a -&gt; a
</span><a href="Temporal.Workflow.Internal.Monad.html#trace_"><span class="hs-identifier hs-var">trace_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Throw&quot;</span></span><span> </span><span class="annot"><span class="annottext">(InstanceM (Result b) -&gt; InstanceM (Result b))
-&gt; InstanceM (Result b) -&gt; InstanceM (Result b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Result b -&gt; InstanceM (Result b)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException -&gt; Result b
forall a. SomeException -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-var">Throw</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171328"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span id="local-6989586621680171336"><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171336"><span class="hs-identifier hs-var">ivar1</span></a></span></span><span> </span><span id="local-6989586621680171337"><span class="annot"><span class="annottext">Cont (a -&gt; b)
</span><a href="#local-6989586621680171337"><span class="hs-identifier hs-var">fcont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-145"></span><span>      </span><span id="local-6989586621680171338"><span class="annot"><a href="#local-6989586621680171338"><span class="hs-identifier hs-var">ra</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContinuationEnv -&gt; InstanceM (Result a)
</span><a href="#local-6989586621680171318"><span class="hs-identifier hs-var">aa</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171319"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-146"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680171338"><span class="hs-identifier hs-type">ra</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-147"></span><span>        </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span id="local-6989586621680171339"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171339"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-148"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; InstanceM (Result b) -&gt; InstanceM (Result b)
forall a. String -&gt; a -&gt; a
</span><a href="Temporal.Workflow.Internal.Monad.html#trace_"><span class="hs-identifier hs-var">trace_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Blocked/Done&quot;</span></span><span> </span><span class="annot"><span class="annottext">(InstanceM (Result b) -&gt; InstanceM (Result b))
-&gt; InstanceM (Result b) -&gt; InstanceM (Result b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-149"></span><span>            </span><span class="annot"><span class="annottext">Result b -&gt; InstanceM (Result b)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IVar b -&gt; Cont b -&gt; Result b
forall a b. IVar b -&gt; Cont a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-var">Blocked</span></a></span><span> </span><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171336"><span class="hs-identifier hs-var">ivar1</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; a -&gt; b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171339"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((a -&gt; b) -&gt; b) -&gt; Cont (a -&gt; b) -&gt; Cont b
forall a b. (b -&gt; a) -&gt; Cont b -&gt; Cont a
</span><a href="Temporal.Workflow.Internal.Monad.html#%3A%3C%24%3E"><span class="hs-operator hs-var">:&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Cont (a -&gt; b)
</span><a href="#local-6989586621680171337"><span class="hs-identifier hs-var">fcont</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>        </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-type">Throw</span></a></span><span> </span><span id="local-6989586621680171340"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171340"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-151"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; InstanceM (Result b) -&gt; InstanceM (Result b)
forall a. String -&gt; a -&gt; a
</span><a href="Temporal.Workflow.Internal.Monad.html#trace_"><span class="hs-identifier hs-var">trace_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Blocked/Throw&quot;</span></span><span> </span><span class="annot"><span class="annottext">(InstanceM (Result b) -&gt; InstanceM (Result b))
-&gt; InstanceM (Result b) -&gt; InstanceM (Result b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-152"></span><span>            </span><span class="annot"><span class="annottext">Result b -&gt; InstanceM (Result b)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IVar b -&gt; Cont b -&gt; Result b
forall a b. IVar b -&gt; Cont a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-var">Blocked</span></a></span><span> </span><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171336"><span class="hs-identifier hs-var">ivar1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cont (a -&gt; b)
</span><a href="#local-6989586621680171337"><span class="hs-identifier hs-var">fcont</span></a></span><span> </span><span class="annot"><span class="annottext">Cont (a -&gt; b) -&gt; ((a -&gt; b) -&gt; Workflow b) -&gt; Cont b
forall a b. Cont b -&gt; (b -&gt; Workflow a) -&gt; Cont a
</span><a href="Temporal.Workflow.Internal.Monad.html#%3A%3E%3E%3D"><span class="hs-operator hs-var">:&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">a -&gt; b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Workflow b
forall e a. (HasCallStack, Exception e) =&gt; e -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#throw"><span class="hs-identifier hs-var">throw</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171340"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>        </span><span class="hs-comment">-- Note [Blocked/Blocked]</span><span>
</span><span id="line-154"></span><span>        </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span id="local-6989586621680171343"><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171343"><span class="hs-identifier hs-var">ivar2</span></a></span></span><span> </span><span id="local-6989586621680171344"><span class="annot"><span class="annottext">Cont a
</span><a href="#local-6989586621680171344"><span class="hs-identifier hs-var">acont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-155"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; InstanceM (Result b) -&gt; InstanceM (Result b)
forall a. String -&gt; a -&gt; a
</span><a href="Temporal.Workflow.Internal.Monad.html#trace_"><span class="hs-identifier hs-var">trace_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Blocked/Blocked&quot;</span></span><span> </span><span class="annot"><span class="annottext">(InstanceM (Result b) -&gt; InstanceM (Result b))
-&gt; InstanceM (Result b) -&gt; InstanceM (Result b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-156"></span><span>            </span><span class="annot"><span class="annottext">ContinuationEnv
-&gt; IVar b
-&gt; Cont (a -&gt; b)
-&gt; IVar b
-&gt; Cont a
-&gt; InstanceM (Result b)
forall c a b d.
ContinuationEnv
-&gt; IVar c
-&gt; Cont (a -&gt; b)
-&gt; IVar d
-&gt; Cont a
-&gt; InstanceM (Result b)
</span><a href="Temporal.Workflow.Internal.Monad.html#blockedBlocked"><span class="hs-identifier hs-var">blockedBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171319"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171336"><span class="hs-identifier hs-var">ivar1</span></a></span><span> </span><span class="annot"><span class="annottext">Cont (a -&gt; b)
</span><a href="#local-6989586621680171337"><span class="hs-identifier hs-var">fcont</span></a></span><span> </span><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171343"><span class="hs-identifier hs-var">ivar2</span></a></span><span> </span><span class="annot"><span class="annottext">Cont a
</span><a href="#local-6989586621680171344"><span class="hs-identifier hs-var">acont</span></a></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span id="local-6989586621680170774"><span id="local-6989586621680170775"><span id="local-6989586621680170776"><span id="local-6989586621680170777"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#blockedBlocked"><span class="hs-identifier hs-type">blockedBlocked</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ContinuationEnv"><span class="hs-identifier hs-type">ContinuationEnv</span></a></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170774"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Cont"><span class="hs-identifier hs-type">Cont</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680170775"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680170776"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170777"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Cont"><span class="hs-identifier hs-type">Cont</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170775"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#InstanceM"><span class="hs-identifier hs-type">InstanceM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170776"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-166"></span><span id="blockedBlocked"><span class="annot"><span class="annottext">blockedBlocked :: forall c a b d.
ContinuationEnv
-&gt; IVar c
-&gt; Cont (a -&gt; b)
-&gt; IVar d
-&gt; Cont a
-&gt; InstanceM (Result b)
</span><a href="Temporal.Workflow.Internal.Monad.html#blockedBlocked"><span class="hs-identifier hs-var hs-var">blockedBlocked</span></a></span></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IVar c
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621680171352"><span class="annot"><span class="annottext">IVar (a -&gt; b)
</span><a href="#local-6989586621680171352"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680171353"><span class="annot"><span class="annottext">IVar d
</span><a href="#local-6989586621680171353"><span class="hs-identifier hs-var">ivar2</span></a></span></span><span> </span><span id="local-6989586621680171354"><span class="annot"><span class="annottext">Cont a
</span><a href="#local-6989586621680171354"><span class="hs-identifier hs-var">acont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-167"></span><span>  </span><span class="annot"><span class="annottext">Result b -&gt; InstanceM (Result b)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IVar d -&gt; Cont b -&gt; Result b
forall a b. IVar b -&gt; Cont a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-var">Blocked</span></a></span><span> </span><span class="annot"><span class="annottext">IVar d
</span><a href="#local-6989586621680171353"><span class="hs-identifier hs-var">ivar2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cont a
</span><a href="#local-6989586621680171354"><span class="hs-identifier hs-var">acont</span></a></span><span> </span><span class="annot"><span class="annottext">Cont a -&gt; (a -&gt; Workflow b) -&gt; Cont b
forall a b. Cont b -&gt; (b -&gt; Workflow a) -&gt; Cont a
</span><a href="Temporal.Workflow.Internal.Monad.html#%3A%3E%3E%3D"><span class="hs-operator hs-var">:&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">IVar (a -&gt; b) -&gt; a -&gt; Workflow b
forall a b. IVar (a -&gt; b) -&gt; a -&gt; Workflow b
</span><a href="Temporal.Workflow.Internal.Monad.html#getIVarApply"><span class="hs-identifier hs-var">getIVarApply</span></a></span><span> </span><span class="annot"><span class="annottext">IVar (a -&gt; b)
</span><a href="#local-6989586621680171352"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#blockedBlocked"><span class="hs-identifier hs-var">blockedBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IVar c
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680171358"><span class="annot"><span class="annottext">b -&gt; a -&gt; b
</span><a href="#local-6989586621680171358"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#%3A%3C%24%3E"><span class="hs-operator hs-type">:&lt;$&gt;</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621680171359"><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171359"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680171360"><span class="annot"><span class="annottext">IVar d
</span><a href="#local-6989586621680171360"><span class="hs-identifier hs-var">ivar2</span></a></span></span><span> </span><span id="local-6989586621680171361"><span class="annot"><span class="annottext">Cont a
</span><a href="#local-6989586621680171361"><span class="hs-identifier hs-var">acont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-169"></span><span>  </span><span class="annot"><span class="annottext">Result b -&gt; InstanceM (Result b)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IVar d -&gt; Cont b -&gt; Result b
forall a b. IVar b -&gt; Cont a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-var">Blocked</span></a></span><span> </span><span class="annot"><span class="annottext">IVar d
</span><a href="#local-6989586621680171360"><span class="hs-identifier hs-var">ivar2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cont a
</span><a href="#local-6989586621680171361"><span class="hs-identifier hs-var">acont</span></a></span><span> </span><span class="annot"><span class="annottext">Cont a -&gt; (a -&gt; Workflow b) -&gt; Cont b
forall a b. Cont b -&gt; (b -&gt; Workflow a) -&gt; Cont a
</span><a href="Temporal.Workflow.Internal.Monad.html#%3A%3E%3E%3D"><span class="hs-operator hs-var">:&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680171362"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171362"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; a -&gt; b
</span><a href="#local-6989586621680171358"><span class="hs-operator hs-var">`g`</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171362"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(b -&gt; b) -&gt; Workflow b -&gt; Workflow b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IVar b -&gt; Workflow b
forall a. IVar a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#getIVar"><span class="hs-identifier hs-var">getIVar</span></a></span><span> </span><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171359"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#blockedBlocked"><span class="hs-identifier hs-var">blockedBlocked</span></a></span><span> </span><span id="local-6989586621680171364"><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171364"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680171365"><span class="annot"><span class="annottext">IVar c
</span><a href="#local-6989586621680171365"><span class="hs-identifier hs-var">ivar1</span></a></span></span><span> </span><span id="local-6989586621680171366"><span class="annot"><span class="annottext">Cont (a -&gt; b)
</span><a href="#local-6989586621680171366"><span class="hs-identifier hs-var">fcont</span></a></span></span><span> </span><span id="local-6989586621680171367"><span class="annot"><span class="annottext">IVar d
</span><a href="#local-6989586621680171367"><span class="hs-identifier hs-var">ivar2</span></a></span></span><span> </span><span id="local-6989586621680171368"><span class="annot"><span class="annottext">Cont a
</span><a href="#local-6989586621680171368"><span class="hs-identifier hs-var">acont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-171"></span><span>  </span><span id="local-6989586621680171369"><span class="annot"><a href="#local-6989586621680171369"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM (IVar (a -&gt; b))
forall (m :: * -&gt; *) a. MonadIO m =&gt; m (IVar a)
</span><a href="Temporal.Workflow.Internal.Monad.html#newIVar"><span class="hs-identifier hs-var">newIVar</span></a></span><span>
</span><span id="line-172"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#addJob"><span class="hs-identifier hs-type">addJob</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171364"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#toWf"><span class="hs-identifier hs-type">toWf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171366"><span class="hs-identifier hs-type">fcont</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680171369"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171365"><span class="hs-identifier hs-type">ivar1</span></a></span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680171373"><span class="annot"><a href="#local-6989586621680171373"><span class="hs-identifier hs-var hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cont a
</span><a href="#local-6989586621680171368"><span class="hs-identifier hs-var">acont</span></a></span><span> </span><span class="annot"><span class="annottext">Cont a -&gt; (a -&gt; Workflow b) -&gt; Cont b
forall a b. Cont b -&gt; (b -&gt; Workflow a) -&gt; Cont a
</span><a href="Temporal.Workflow.Internal.Monad.html#%3A%3E%3E%3D"><span class="hs-operator hs-var">:&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680171374"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171374"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IVar (a -&gt; b) -&gt; a -&gt; Workflow b
forall a b. IVar (a -&gt; b) -&gt; a -&gt; Workflow b
</span><a href="Temporal.Workflow.Internal.Monad.html#getIVarApply"><span class="hs-identifier hs-var">getIVarApply</span></a></span><span> </span><span class="annot"><span class="annottext">IVar (a -&gt; b)
</span><a href="#local-6989586621680171369"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171374"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-174"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171367"><span class="hs-identifier hs-type">ivar2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171373"><span class="hs-identifier hs-type">cont</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-comment">-- Note [Blocked/Blocked]</span><span>
</span><span id="line-178"></span><span class="hs-comment">--</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- This is the tricky case: we're blocked on both sides of the &lt;*&gt;.</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- We need to divide the computation into two pieces that may continue</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- independently when the resources they are blocked on become</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- available.  Moreover, the computation as a whole depends on the two</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- pieces.  It works like this:</span><span>
</span><span id="line-184"></span><span class="hs-comment">--</span><span>
</span><span id="line-185"></span><span class="hs-comment">--   ff &lt;*&gt; aa</span><span>
</span><span id="line-186"></span><span class="hs-comment">--</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- becomes</span><span>
</span><span id="line-188"></span><span class="hs-comment">--</span><span>
</span><span id="line-189"></span><span class="hs-comment">--   (ff &gt;&gt;= putIVar i) &lt;*&gt; (a &lt;- aa; f &lt;- getIVar i; return (f a)</span><span>
</span><span id="line-190"></span><span class="hs-comment">--</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- where the IVar i is a new synchronisation point.  If the right side</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- gets to the `getIVar` first, it will block until the left side has</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- called 'putIVar'.</span><span>
</span><span id="line-194"></span><span class="hs-comment">--</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- We can also do it the other way around:</span><span>
</span><span id="line-196"></span><span class="hs-comment">--</span><span>
</span><span id="line-197"></span><span class="hs-comment">--   (do ff &lt;- f; getIVar i; return (ff a)) &lt;*&gt; (a &gt;&gt;= putIVar i)</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680171379"><span id="local-6989586621680171382"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-200"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span id="local-6989586621680171387"><span class="annot"><span class="annottext">ContinuationEnv -&gt; InstanceM (Result a)
</span><a href="#local-6989586621680171387"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621680171388"><span class="annot"><span class="annottext">&gt;&gt;= :: forall a b. Workflow a -&gt; (a -&gt; Workflow b) -&gt; Workflow b
</span><span class="hs-operator hs-var hs-var hs-var">&gt;&gt;=</span></span></span><span> </span><span id="local-6989586621680171389"><span class="annot"><span class="annottext">a -&gt; Workflow b
</span><a href="#local-6989586621680171389"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result b)) -&gt; Workflow b
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result b)) -&gt; Workflow b)
-&gt; (ContinuationEnv -&gt; InstanceM (Result b)) -&gt; Workflow b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680171390"><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171390"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-201"></span><span>    </span><span id="local-6989586621680171391"><span class="annot"><a href="#local-6989586621680171391"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContinuationEnv -&gt; InstanceM (Result a)
</span><a href="#local-6989586621680171387"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171390"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680171391"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-203"></span><span>      </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span id="local-6989586621680171392"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171392"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Workflow b -&gt; ContinuationEnv -&gt; InstanceM (Result b)
forall a. Workflow a -&gt; ContinuationEnv -&gt; InstanceM (Result a)
</span><a href="Temporal.Workflow.Internal.Monad.html#unWorkflow"><span class="hs-identifier hs-var">unWorkflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Workflow b
</span><a href="#local-6989586621680171389"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171392"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171390"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-204"></span><span>      </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-type">Throw</span></a></span><span> </span><span id="local-6989586621680171393"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171393"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result b -&gt; InstanceM (Result b)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException -&gt; Result b
forall a. SomeException -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-var">Throw</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171393"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>      </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span id="local-6989586621680171395"><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171395"><span class="hs-identifier hs-var">ivar</span></a></span></span><span> </span><span id="local-6989586621680171396"><span class="annot"><span class="annottext">Cont a
</span><a href="#local-6989586621680171396"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-206"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; InstanceM (Result b) -&gt; InstanceM (Result b)
forall a. String -&gt; a -&gt; a
</span><a href="Temporal.Workflow.Internal.Monad.html#trace_"><span class="hs-identifier hs-var">trace_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&gt;&gt;= Blocked&quot;</span></span><span> </span><span class="annot"><span class="annottext">(InstanceM (Result b) -&gt; InstanceM (Result b))
-&gt; InstanceM (Result b) -&gt; InstanceM (Result b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-207"></span><span>          </span><span class="annot"><span class="annottext">Result b -&gt; InstanceM (Result b)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IVar b -&gt; Cont b -&gt; Result b
forall a b. IVar b -&gt; Cont a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-var">Blocked</span></a></span><span> </span><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171395"><span class="hs-identifier hs-var">ivar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cont a
</span><a href="#local-6989586621680171396"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">Cont a -&gt; (a -&gt; Workflow b) -&gt; Cont b
forall a b. Cont b -&gt; (b -&gt; Workflow a) -&gt; Cont a
</span><a href="Temporal.Workflow.Internal.Monad.html#%3A%3E%3E%3D"><span class="hs-operator hs-var">:&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Workflow b
</span><a href="#local-6989586621680171389"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-comment">-- A note on (&gt;&gt;):</span><span>
</span><span id="line-211"></span><span class="hs-comment">--</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- Unlike Haxl, we can't use the the Applicative version here, because</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- it prevents us from sleeping between two actions. We can use (*&gt;) ourselves</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- to opt into the Applicative version when we want to.</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="hs-comment">-- TODO If the first computation throws a value that implements 'SomeWorkflowException',</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- try the second one.</span><span>
</span><span id="line-218"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680171402"><span id="local-6989586621680171406"><span class="annot"><span class="hs-identifier hs-type">Alternative</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-219"></span><span>  </span><span id="local-6989586621680171413"><span class="annot"><span class="annottext">empty :: forall a. Workflow a
</span><a href="#local-6989586621680171413"><span class="hs-identifier hs-var hs-var hs-var">empty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AlternativeInstanceFailure -&gt; Workflow a
forall e a. (HasCallStack, Exception e) =&gt; e -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#throw"><span class="hs-identifier hs-var">throw</span></a></span><span> </span><span class="annot"><span class="annottext">AlternativeInstanceFailure
</span><a href="Temporal.Exception.html#AlternativeInstanceFailure"><span class="hs-identifier hs-var">AlternativeInstanceFailure</span></a></span><span>
</span><span id="line-220"></span><span>  </span><span id="local-6989586621680171417"><span class="annot"><span class="annottext">&lt;|&gt; :: forall a. Workflow a -&gt; Workflow a -&gt; Workflow a
</span><a href="#local-6989586621680171417"><span class="hs-operator hs-var hs-var hs-var">(&lt;|&gt;)</span></a></span></span><span> </span><span id="local-6989586621680171419"><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680171419"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621680171420"><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680171420"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680171419"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow a -&gt; (SomeException -&gt; Workflow a) -&gt; Workflow a
forall e a.
Exception e =&gt;
Workflow a -&gt; (e -&gt; Workflow a) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#catch"><span class="hs-operator hs-var">`Temporal.Workflow.Internal.Monad.catch`</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680171420"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeError</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;A workflow definition cannot directly perform IO. Use executeActivity or executeLocalActivity instead.&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-224"></span><span>  </span><span id="local-6989586621680171433"><span class="annot"><span class="annottext">liftIO :: forall a. IO a -&gt; Workflow a
</span><a href="#local-6989586621680171433"><span class="hs-identifier hs-var hs-var hs-var">liftIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO a -&gt; Workflow a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unreachable&quot;</span></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeError</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;A workflow definition cannot directly perform IO. Use executeActivity or executeLocalActivity instead.&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-228"></span><span>  </span><span id="local-6989586621680171445"><span class="annot"><span class="annottext">withRunInIO :: forall b. ((forall a. Workflow a -&gt; IO a) -&gt; IO b) -&gt; Workflow b
</span><a href="#local-6989586621680171445"><span class="hs-identifier hs-var hs-var hs-var">withRunInIO</span></a></span></span><span> </span><span class="annot"><span class="annottext">(forall a. Workflow a -&gt; IO a) -&gt; IO b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Workflow b
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unreachable&quot;</span></span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPPABLE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadLogger</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-232"></span><span>  </span><span id="local-6989586621680171458"><span class="annot"><span class="annottext">monadLoggerLog :: forall msg.
ToLogStr msg =&gt;
Loc -&gt; LogSource -&gt; LogLevel -&gt; msg -&gt; Workflow ()
</span><a href="#local-6989586621680171458"><span class="hs-identifier hs-var hs-var hs-var">monadLoggerLog</span></a></span></span><span> </span><span id="local-6989586621680171460"><span class="annot"><span class="annottext">Loc
</span><a href="#local-6989586621680171460"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680171461"><span class="annot"><span class="annottext">LogSource
</span><a href="#local-6989586621680171461"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621680171462"><span class="annot"><span class="annottext">LogLevel
</span><a href="#local-6989586621680171462"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span id="local-6989586621680171463"><span class="annot"><span class="annottext">msg
</span><a href="#local-6989586621680171463"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result ())) -&gt; Workflow ()
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result ())) -&gt; Workflow ())
-&gt; (ContinuationEnv -&gt; InstanceM (Result ())) -&gt; Workflow ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621680171464"><span class="annot"><a href="#local-6989586621680171464"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(WorkflowInstance
 -&gt; Loc -&gt; LogSource -&gt; LogLevel -&gt; LogStr -&gt; IO ())
-&gt; InstanceM (Loc -&gt; LogSource -&gt; LogLevel -&gt; LogStr -&gt; IO ())
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">WorkflowInstance -&gt; Loc -&gt; LogSource -&gt; LogLevel -&gt; LogStr -&gt; IO ()
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowInstanceLogger"><span class="hs-identifier hs-var">workflowInstanceLogger</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621680171464"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171460"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171461"><span class="hs-identifier hs-type">src</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171462"><span class="hs-identifier hs-type">lvl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">toLogStr</span></span><span> </span><span class="annot"><a href="#local-6989586621680171463"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680170832"><span id="local-6989586621680171470"><span id="local-6989586621680171474"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="#local-6989586621680170832"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170832"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-238"></span><span>  </span><span id="local-6989586621680171481"><span class="annot"><span class="annottext">&lt;&gt; :: Workflow a -&gt; Workflow a -&gt; Workflow a
</span><span class="hs-operator hs-var hs-var hs-var">(&lt;&gt;)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a) -&gt; Workflow a -&gt; Workflow a -&gt; Workflow a
forall a b c.
(a -&gt; b -&gt; c) -&gt; Workflow a -&gt; Workflow b -&gt; Workflow c
forall (f :: * -&gt; *) a b c.
Applicative f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><span class="hs-identifier hs-var">liftA2</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680170835"><span id="local-6989586621680171489"><span id="local-6989586621680171493"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621680170835"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170835"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-242"></span><span>  </span><span id="local-6989586621680171499"><span class="annot"><span class="annottext">mempty :: Workflow a
</span><span class="hs-identifier hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Workflow a
forall a. a -&gt; Workflow a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-246"></span><span class="hs-comment">-- Exceptions</span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="annot"><span class="hs-comment">-- | Throw an exception in the Workflow monad</span></span><span>
</span><span id="line-249"></span><span id="local-6989586621680170771"><span id="local-6989586621680170772"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#throw"><span class="hs-identifier hs-type">throw</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="#local-6989586621680170771"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680170771"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170772"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-250"></span><span id="throw"><span class="annot"><span class="annottext">throw :: forall e a. (HasCallStack, Exception e) =&gt; e -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#throw"><span class="hs-identifier hs-var hs-var">throw</span></a></span></span><span> </span><span id="local-6989586621680171504"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621680171504"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a)
-&gt; (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680171505"><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171505"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Result a) -&gt; InstanceM (Result a)
forall a. IO a -&gt; InstanceM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Result a) -&gt; InstanceM (Result a))
-&gt; IO (Result a) -&gt; InstanceM (Result a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv -&gt; e -&gt; IO (Result a)
forall e a. Exception e =&gt; ContinuationEnv -&gt; e -&gt; IO (Result a)
</span><a href="Temporal.Workflow.Internal.Monad.html#raise"><span class="hs-identifier hs-var">raise</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171505"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621680171504"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#raiseImpl"><span class="hs-pragma hs-type">raiseImpl</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-254"></span><span id="local-6989586621680170840"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#raiseImpl"><span class="hs-identifier hs-type">raiseImpl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ContinuationEnv"><span class="hs-identifier hs-type">ContinuationEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170840"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-255"></span><span id="raiseImpl"><span class="annot"><span class="annottext">raiseImpl :: forall b. ContinuationEnv -&gt; SomeException -&gt; IO (Result b)
</span><a href="Temporal.Workflow.Internal.Monad.html#raiseImpl"><span class="hs-identifier hs-var hs-var">raiseImpl</span></a></span></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680171510"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171510"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Result b -&gt; IO (Result b)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Result b -&gt; IO (Result b)) -&gt; Result b -&gt; IO (Result b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Result b
forall a. SomeException -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-var">Throw</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171510"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span id="local-6989586621680170838"><span id="local-6989586621680170839"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#raise"><span class="hs-identifier hs-type">raise</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="#local-6989586621680170838"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ContinuationEnv"><span class="hs-identifier hs-type">ContinuationEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680170838"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170839"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-259"></span><span id="raise"><span class="annot"><span class="annottext">raise :: forall e a. Exception e =&gt; ContinuationEnv -&gt; e -&gt; IO (Result a)
</span><a href="Temporal.Workflow.Internal.Monad.html#raise"><span class="hs-identifier hs-var hs-var">raise</span></a></span></span><span> </span><span id="local-6989586621680171513"><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171513"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680171514"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621680171514"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContinuationEnv -&gt; SomeException -&gt; IO (Result a)
forall b. ContinuationEnv -&gt; SomeException -&gt; IO (Result b)
</span><a href="Temporal.Workflow.Internal.Monad.html#raiseImpl"><span class="hs-identifier hs-var">raiseImpl</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171513"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e -&gt; SomeException
forall e. Exception e =&gt; e -&gt; SomeException
</span><span class="hs-identifier hs-var">toException</span></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621680171514"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="annot"><span class="hs-comment">-- | Catch an exception in the Workflow monad</span></span><span>
</span><span id="line-263"></span><span id="local-6989586621680170804"><span id="local-6989586621680170805"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#catch"><span class="hs-identifier hs-type">catch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="#local-6989586621680170804"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170805"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680170804"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170805"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170805"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-264"></span><span id="catch"><span class="annot"><span class="annottext">catch :: forall e a.
Exception e =&gt;
Workflow a -&gt; (e -&gt; Workflow a) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#catch"><span class="hs-identifier hs-var hs-var">catch</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span id="local-6989586621680171523"><span class="annot"><span class="annottext">ContinuationEnv -&gt; InstanceM (Result a)
</span><a href="#local-6989586621680171523"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680171524"><span class="annot"><span class="annottext">e -&gt; Workflow a
</span><a href="#local-6989586621680171524"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a)
-&gt; (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680171525"><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171525"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-265"></span><span>  </span><span id="local-6989586621680171526"><span class="annot"><a href="#local-6989586621680171526"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContinuationEnv -&gt; InstanceM (Result a)
</span><a href="#local-6989586621680171523"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171525"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680171526"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span id="local-6989586621680171527"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171527"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result a -&gt; InstanceM (Result a)
forall a. a -&gt; InstanceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Result a -&gt; InstanceM (Result a))
-&gt; Result a -&gt; InstanceM (Result a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Result a
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171527"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-268"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-type">Throw</span></a></span><span> </span><span id="local-6989586621680171528"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171528"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-269"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680171529"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621680171529"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe e
forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><span class="hs-identifier hs-var">fromException</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171528"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Workflow a -&gt; ContinuationEnv -&gt; InstanceM (Result a)
forall a. Workflow a -&gt; ContinuationEnv -&gt; InstanceM (Result a)
</span><a href="Temporal.Workflow.Internal.Monad.html#unWorkflow"><span class="hs-identifier hs-var">unWorkflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e -&gt; Workflow a
</span><a href="#local-6989586621680171524"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621680171529"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171525"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-270"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Result a) -&gt; InstanceM (Result a)
forall a. IO a -&gt; InstanceM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Result a) -&gt; InstanceM (Result a))
-&gt; IO (Result a) -&gt; InstanceM (Result a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv -&gt; SomeException -&gt; IO (Result a)
forall e a. Exception e =&gt; ContinuationEnv -&gt; e -&gt; IO (Result a)
</span><a href="Temporal.Workflow.Internal.Monad.html#raise"><span class="hs-identifier hs-var">raise</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171525"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171528"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-271"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span id="local-6989586621680171533"><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171533"><span class="hs-identifier hs-var">ivar</span></a></span></span><span> </span><span id="local-6989586621680171534"><span class="annot"><span class="annottext">Cont a
</span><a href="#local-6989586621680171534"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result a -&gt; InstanceM (Result a)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Result a -&gt; InstanceM (Result a))
-&gt; Result a -&gt; InstanceM (Result a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IVar b -&gt; Cont a -&gt; Result a
forall a b. IVar b -&gt; Cont a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-var">Blocked</span></a></span><span> </span><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171533"><span class="hs-identifier hs-var">ivar</span></a></span><span> </span><span class="annot"><span class="annottext">(Cont a -&gt; Result a) -&gt; Cont a -&gt; Result a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Workflow a -&gt; Cont a
forall a. Workflow a -&gt; Cont a
</span><a href="Temporal.Workflow.Internal.Monad.html#Cont"><span class="hs-identifier hs-var">Cont</span></a></span><span> </span><span class="annot"><span class="annottext">(Workflow a -&gt; Cont a) -&gt; Workflow a -&gt; Cont a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Workflow a -&gt; (e -&gt; Workflow a) -&gt; Workflow a
forall e a.
Exception e =&gt;
Workflow a -&gt; (e -&gt; Workflow a) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#catch"><span class="hs-identifier hs-var">Temporal.Workflow.Internal.Monad.catch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cont a -&gt; Workflow a
forall a. Cont a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#toWf"><span class="hs-identifier hs-var">toWf</span></a></span><span> </span><span class="annot"><span class="annottext">Cont a
</span><a href="#local-6989586621680171534"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">e -&gt; Workflow a
</span><a href="#local-6989586621680171524"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="annot"><span class="hs-comment">-- | Catch exceptions that satisfy a predicate</span></span><span>
</span><span id="line-275"></span><span id="local-6989586621680170848"><span id="local-6989586621680170849"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#catchIf"><span class="hs-identifier hs-type">catchIf</span></a></span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="#local-6989586621680170848"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680170848"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170849"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680170848"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170849"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170849"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-281"></span><span id="catchIf"><span class="annot"><span class="annottext">catchIf :: forall e a.
Exception e =&gt;
(e -&gt; Bool) -&gt; Workflow a -&gt; (e -&gt; Workflow a) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#catchIf"><span class="hs-identifier hs-var hs-var">catchIf</span></a></span></span><span> </span><span id="local-6989586621680171542"><span class="annot"><span class="annottext">e -&gt; Bool
</span><a href="#local-6989586621680171542"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span id="local-6989586621680171543"><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680171543"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621680171544"><span class="annot"><span class="annottext">e -&gt; Workflow a
</span><a href="#local-6989586621680171544"><span class="hs-identifier hs-var">handler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-282"></span><span>  </span><span class="annot"><span class="annottext">Workflow a -&gt; (e -&gt; Workflow a) -&gt; Workflow a
forall e a.
Exception e =&gt;
Workflow a -&gt; (e -&gt; Workflow a) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#catch"><span class="hs-identifier hs-var">Temporal.Workflow.Internal.Monad.catch</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680171543"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">((e -&gt; Workflow a) -&gt; Workflow a)
-&gt; (e -&gt; Workflow a) -&gt; Workflow a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680171545"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621680171545"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">e -&gt; Bool
</span><a href="#local-6989586621680171542"><span class="hs-identifier hs-var">cond</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621680171545"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">e -&gt; Workflow a
</span><a href="#local-6989586621680171544"><span class="hs-identifier hs-var">handler</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621680171545"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">e -&gt; Workflow a
forall e a. (HasCallStack, Exception e) =&gt; e -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#throw"><span class="hs-identifier hs-var">throw</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621680171545"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span class="annot"><span class="hs-comment">{- | Returns @'Left' e@ if the computation throws an exception @e@, or
@'Right' a@ if it returns a result @a@.
-}</span></span><span>
</span><span id="line-288"></span><span id="local-6989586621680170852"><span id="local-6989586621680170853"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#try"><span class="hs-identifier hs-type">try</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="#local-6989586621680170852"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170853"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621680170852"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170853"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-289"></span><span id="try"><span class="annot"><span class="annottext">try :: forall e a. Exception e =&gt; Workflow a -&gt; Workflow (Either e a)
</span><a href="Temporal.Workflow.Internal.Monad.html#try"><span class="hs-identifier hs-var hs-var">try</span></a></span></span><span> </span><span id="local-6989586621680171551"><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680171551"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Either e a
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Either e a) -&gt; Workflow a -&gt; Workflow (Either e a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680171551"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Workflow (Either e a)
-&gt; (e -&gt; Workflow (Either e a)) -&gt; Workflow (Either e a)
forall e a.
Exception e =&gt;
Workflow a -&gt; (e -&gt; Workflow a) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#catch"><span class="hs-operator hs-var">`Temporal.Workflow.Internal.Monad.catch`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either e a -&gt; Workflow (Either e a)
forall a. a -&gt; Workflow a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either e a -&gt; Workflow (Either e a))
-&gt; (e -&gt; Either e a) -&gt; e -&gt; Workflow (Either e a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">e -&gt; Either e a
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Catch.MonadThrow</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680171563"><span class="annot"><span class="annottext">throwM :: forall e a. (HasCallStack, Exception e) =&gt; e -&gt; Workflow a
</span><a href="#local-6989586621680171563"><span class="hs-identifier hs-var hs-var hs-var">throwM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">e -&gt; Workflow a
forall e a. (HasCallStack, Exception e) =&gt; e -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#throw"><span class="hs-identifier hs-var">Temporal.Workflow.Internal.Monad.throw</span></a></span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Catch.MonadCatch</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680171573"><span class="annot"><span class="annottext">catch :: forall e a.
(HasCallStack, Exception e) =&gt;
Workflow a -&gt; (e -&gt; Workflow a) -&gt; Workflow a
</span><a href="#local-6989586621680171573"><span class="hs-identifier hs-var hs-var hs-var">catch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Workflow a -&gt; (e -&gt; Workflow a) -&gt; Workflow a
forall e a.
Exception e =&gt;
Workflow a -&gt; (e -&gt; Workflow a) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#catch"><span class="hs-identifier hs-var">Temporal.Workflow.Internal.Monad.catch</span></a></span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span class="hs-keyword">newtype</span><span> </span><span id="WorkflowGenM"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowGenM"><span class="hs-identifier hs-var">WorkflowGenM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WorkflowGenM"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowGenM"><span class="hs-identifier hs-var">WorkflowGenM</span></a></span></span><span> </span><span class="hs-special">{</span><span id="unWorkflowGenM"><span class="annot"><span class="annottext">WorkflowGenM -&gt; IORef StdGen
</span><a href="Temporal.Workflow.Internal.Monad.html#unWorkflowGenM"><span class="hs-identifier hs-var hs-var">unWorkflowGenM</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdGen</span></span><span class="hs-special">}</span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowGenM"><span class="hs-identifier hs-type">WorkflowGenM</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-302"></span><span>  </span><span id="local-6989586621680171590"><span class="annot"><span class="annottext">uniformWord32R :: Word32 -&gt; WorkflowGenM -&gt; Workflow Word32
</span><a href="#local-6989586621680171590"><span class="hs-identifier hs-var hs-var hs-var">uniformWord32R</span></a></span></span><span> </span><span id="local-6989586621680171592"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621680171592"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StdGen -&gt; (Word32, StdGen)) -&gt; WorkflowGenM -&gt; Workflow Word32
forall a. (StdGen -&gt; (a, StdGen)) -&gt; WorkflowGenM -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#applyWorkflowGen"><span class="hs-identifier hs-var">applyWorkflowGen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; StdGen -&gt; (Word32, StdGen)
forall g. RandomGen g =&gt; Word32 -&gt; g -&gt; (Word32, g)
</span><span class="hs-identifier hs-var">genWord32R</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621680171592"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">uniformWord32R</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-304"></span><span>  </span><span id="local-6989586621680171595"><span class="annot"><span class="annottext">uniformWord64R :: Word64 -&gt; WorkflowGenM -&gt; Workflow Word64
</span><a href="#local-6989586621680171595"><span class="hs-identifier hs-var hs-var hs-var">uniformWord64R</span></a></span></span><span> </span><span id="local-6989586621680171597"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680171597"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StdGen -&gt; (Word64, StdGen)) -&gt; WorkflowGenM -&gt; Workflow Word64
forall a. (StdGen -&gt; (a, StdGen)) -&gt; WorkflowGenM -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#applyWorkflowGen"><span class="hs-identifier hs-var">applyWorkflowGen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; StdGen -&gt; (Word64, StdGen)
forall g. RandomGen g =&gt; Word64 -&gt; g -&gt; (Word64, g)
</span><span class="hs-identifier hs-var">genWord64R</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680171597"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">uniformWord64R</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-306"></span><span>  </span><span id="local-6989586621680171599"><span class="annot"><span class="annottext">uniformWord8 :: WorkflowGenM -&gt; Workflow Word8
</span><a href="#local-6989586621680171599"><span class="hs-identifier hs-var hs-var hs-var">uniformWord8</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StdGen -&gt; (Word8, StdGen)) -&gt; WorkflowGenM -&gt; Workflow Word8
forall a. (StdGen -&gt; (a, StdGen)) -&gt; WorkflowGenM -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#applyWorkflowGen"><span class="hs-identifier hs-var">applyWorkflowGen</span></a></span><span> </span><span class="annot"><span class="annottext">StdGen -&gt; (Word8, StdGen)
forall g. RandomGen g =&gt; g -&gt; (Word8, g)
</span><span class="hs-identifier hs-var">genWord8</span></span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">uniformWord8</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-308"></span><span>  </span><span id="local-6989586621680171602"><span class="annot"><span class="annottext">uniformWord16 :: WorkflowGenM -&gt; Workflow Word16
</span><a href="#local-6989586621680171602"><span class="hs-identifier hs-var hs-var hs-var">uniformWord16</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StdGen -&gt; (Word16, StdGen)) -&gt; WorkflowGenM -&gt; Workflow Word16
forall a. (StdGen -&gt; (a, StdGen)) -&gt; WorkflowGenM -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#applyWorkflowGen"><span class="hs-identifier hs-var">applyWorkflowGen</span></a></span><span> </span><span class="annot"><span class="annottext">StdGen -&gt; (Word16, StdGen)
forall g. RandomGen g =&gt; g -&gt; (Word16, g)
</span><span class="hs-identifier hs-var">genWord16</span></span><span>
</span><span id="line-309"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">uniformWord16</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-310"></span><span>  </span><span id="local-6989586621680171605"><span class="annot"><span class="annottext">uniformWord32 :: WorkflowGenM -&gt; Workflow Word32
</span><a href="#local-6989586621680171605"><span class="hs-identifier hs-var hs-var hs-var">uniformWord32</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StdGen -&gt; (Word32, StdGen)) -&gt; WorkflowGenM -&gt; Workflow Word32
forall a. (StdGen -&gt; (a, StdGen)) -&gt; WorkflowGenM -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#applyWorkflowGen"><span class="hs-identifier hs-var">applyWorkflowGen</span></a></span><span> </span><span class="annot"><span class="annottext">StdGen -&gt; (Word32, StdGen)
forall g. RandomGen g =&gt; g -&gt; (Word32, g)
</span><span class="hs-identifier hs-var">genWord32</span></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">uniformWord32</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-312"></span><span>  </span><span id="local-6989586621680171608"><span class="annot"><span class="annottext">uniformWord64 :: WorkflowGenM -&gt; Workflow Word64
</span><a href="#local-6989586621680171608"><span class="hs-identifier hs-var hs-var hs-var">uniformWord64</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StdGen -&gt; (Word64, StdGen)) -&gt; WorkflowGenM -&gt; Workflow Word64
forall a. (StdGen -&gt; (a, StdGen)) -&gt; WorkflowGenM -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#applyWorkflowGen"><span class="hs-identifier hs-var">applyWorkflowGen</span></a></span><span> </span><span class="annot"><span class="annottext">StdGen -&gt; (Word64, StdGen)
forall g. RandomGen g =&gt; g -&gt; (Word64, g)
</span><span class="hs-identifier hs-var">genWord64</span></span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">uniformWord64</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-314"></span><span>  </span><span id="local-6989586621680171611"><span class="annot"><span class="annottext">uniformShortByteString :: Int -&gt; WorkflowGenM -&gt; Workflow ShortByteString
</span><a href="#local-6989586621680171611"><span class="hs-identifier hs-var hs-var hs-var">uniformShortByteString</span></a></span></span><span> </span><span id="local-6989586621680171613"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680171613"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StdGen -&gt; (ShortByteString, StdGen))
-&gt; WorkflowGenM -&gt; Workflow ShortByteString
forall a. (StdGen -&gt; (a, StdGen)) -&gt; WorkflowGenM -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#applyWorkflowGen"><span class="hs-identifier hs-var">applyWorkflowGen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; StdGen -&gt; (ShortByteString, StdGen)
forall g. RandomGen g =&gt; Int -&gt; g -&gt; (ShortByteString, g)
</span><span class="hs-identifier hs-var">genShortByteString</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680171613"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span id="local-6989586621680170880"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#applyWorkflowGen"><span class="hs-identifier hs-type">applyWorkflowGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StdGen</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680170880"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdGen</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowGenM"><span class="hs-identifier hs-type">WorkflowGenM</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170880"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-318"></span><span id="applyWorkflowGen"><span class="annot"><span class="annottext">applyWorkflowGen :: forall a. (StdGen -&gt; (a, StdGen)) -&gt; WorkflowGenM -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#applyWorkflowGen"><span class="hs-identifier hs-var hs-var">applyWorkflowGen</span></a></span></span><span> </span><span id="local-6989586621680171618"><span class="annot"><span class="annottext">StdGen -&gt; (a, StdGen)
</span><a href="#local-6989586621680171618"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowGenM"><span class="hs-identifier hs-type">WorkflowGenM</span></a></span><span> </span><span id="local-6989586621680171619"><span class="annot"><span class="annottext">IORef StdGen
</span><a href="#local-6989586621680171619"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a)
-&gt; (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-319"></span><span>  </span><span id="local-6989586621680171620"><span class="annot"><a href="#local-6989586621680171620"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef StdGen -&gt; InstanceM StdGen
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; m a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef StdGen
</span><a href="#local-6989586621680171619"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680171618"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171620"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621680171622"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171622"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621680171623"><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621680171623"><span class="hs-identifier hs-var">g'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Result a
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171622"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Result a -&gt; InstanceM () -&gt; InstanceM (Result a)
forall a b. a -&gt; InstanceM b -&gt; InstanceM a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">IORef StdGen -&gt; StdGen -&gt; InstanceM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">writeIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef StdGen
</span><a href="#local-6989586621680171619"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621680171623"><span class="hs-identifier hs-var">g'</span></a></span><span>
</span><span id="line-322"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#applyWorkflowGen"><span class="hs-pragma hs-type">applyWorkflowGen</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#newWorkflowGenM"><span class="hs-identifier hs-type">newWorkflowGenM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdGen</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowGenM"><span class="hs-identifier hs-type">WorkflowGenM</span></a></span><span>
</span><span id="line-326"></span><span id="newWorkflowGenM"><span class="annot"><span class="annottext">newWorkflowGenM :: StdGen -&gt; Workflow WorkflowGenM
</span><a href="Temporal.Workflow.Internal.Monad.html#newWorkflowGenM"><span class="hs-identifier hs-var hs-var">newWorkflowGenM</span></a></span></span><span> </span><span id="local-6989586621680171627"><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621680171627"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result WorkflowGenM))
-&gt; Workflow WorkflowGenM
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result WorkflowGenM))
 -&gt; Workflow WorkflowGenM)
-&gt; (ContinuationEnv -&gt; InstanceM (Result WorkflowGenM))
-&gt; Workflow WorkflowGenM
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkflowGenM -&gt; Result WorkflowGenM
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">(WorkflowGenM -&gt; Result WorkflowGenM)
-&gt; (IORef StdGen -&gt; WorkflowGenM)
-&gt; IORef StdGen
-&gt; Result WorkflowGenM
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IORef StdGen -&gt; WorkflowGenM
</span><a href="Temporal.Workflow.Internal.Monad.html#WorkflowGenM"><span class="hs-identifier hs-var">WorkflowGenM</span></a></span><span> </span><span class="annot"><span class="annottext">(IORef StdGen -&gt; Result WorkflowGenM)
-&gt; InstanceM (IORef StdGen) -&gt; InstanceM (Result WorkflowGenM)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StdGen -&gt; InstanceM (IORef StdGen)
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621680171627"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-327"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#newWorkflowGenM"><span class="hs-pragma hs-type">newWorkflowGenM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RandomGenM</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowGenM"><span class="hs-identifier hs-type">WorkflowGenM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdGen</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-331"></span><span>  </span><span id="local-6989586621680171636"><span class="annot"><span class="annottext">applyRandomGenM :: forall a. (StdGen -&gt; (a, StdGen)) -&gt; WorkflowGenM -&gt; Workflow a
</span><a href="#local-6989586621680171636"><span class="hs-identifier hs-var hs-var hs-var">applyRandomGenM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StdGen -&gt; (a, StdGen)) -&gt; WorkflowGenM -&gt; Workflow a
forall a. (StdGen -&gt; (a, StdGen)) -&gt; WorkflowGenM -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#applyWorkflowGen"><span class="hs-identifier hs-var">applyWorkflowGen</span></a></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FrozenGen</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdGen</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="MutableGen"><span class="annot"><span class="hs-identifier hs-var">MutableGen</span></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdGen</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowGenM"><span class="hs-identifier hs-type">WorkflowGenM</span></a></span><span>
</span><span id="line-336"></span><span>  </span><span id="local-6989586621680171647"><span class="annot"><span class="annottext">freezeGen :: MutableGen StdGen Workflow -&gt; Workflow StdGen
</span><a href="#local-6989586621680171647"><span class="hs-identifier hs-var hs-var hs-var">freezeGen</span></a></span></span><span> </span><span id="local-6989586621680171649"><span class="annot"><span class="annottext">MutableGen StdGen Workflow
</span><a href="#local-6989586621680171649"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result StdGen)) -&gt; Workflow StdGen
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result StdGen)) -&gt; Workflow StdGen)
-&gt; (ContinuationEnv -&gt; InstanceM (Result StdGen))
-&gt; Workflow StdGen
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StdGen -&gt; Result StdGen
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">(StdGen -&gt; Result StdGen)
-&gt; InstanceM StdGen -&gt; InstanceM (Result StdGen)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IORef StdGen -&gt; InstanceM StdGen
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; m a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorkflowGenM -&gt; IORef StdGen
</span><a href="Temporal.Workflow.Internal.Monad.html#unWorkflowGenM"><span class="hs-identifier hs-var">unWorkflowGenM</span></a></span><span> </span><span class="annot"><span class="annottext">MutableGen StdGen Workflow
WorkflowGenM
</span><a href="#local-6989586621680171649"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>  </span><span id="local-6989586621680171650"><span class="annot"><span class="annottext">thawGen :: StdGen -&gt; Workflow (MutableGen StdGen Workflow)
</span><a href="#local-6989586621680171650"><span class="hs-identifier hs-var hs-var hs-var">thawGen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StdGen -&gt; Workflow (MutableGen StdGen Workflow)
StdGen -&gt; Workflow WorkflowGenM
</span><a href="Temporal.Workflow.Internal.Monad.html#newWorkflowGenM"><span class="hs-identifier hs-var">newWorkflowGenM</span></a></span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#addJob"><span class="hs-pragma hs-type">addJob</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-341"></span><span id="local-6989586621680170788"><span id="local-6989586621680170789"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#addJob"><span class="hs-identifier hs-type">addJob</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ContinuationEnv"><span class="hs-identifier hs-type">ContinuationEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170788"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170788"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170789"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#InstanceM"><span class="hs-identifier hs-type">InstanceM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-342"></span><span id="addJob"><span class="annot"><span class="annottext">addJob :: forall b a.
ContinuationEnv -&gt; Workflow b -&gt; IVar b -&gt; IVar a -&gt; InstanceM ()
</span><a href="Temporal.Workflow.Internal.Monad.html#addJob"><span class="hs-identifier hs-var hs-var">addJob</span></a></span></span><span> </span><span id="local-6989586621680171657"><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171657"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621680171658"><span class="annot"><span class="annottext">Workflow b
</span><a href="#local-6989586621680171658"><span class="hs-identifier hs-var">wf</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621680171659"><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171659"><span class="hs-identifier hs-var">resultIVar</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">ivarRef :: forall a. IVar a -&gt; IORef (IVarContents a)
</span><a href="Temporal.Workflow.Internal.Monad.html#ivarRef"><span class="hs-identifier hs-var">ivarRef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621680171662"><span class="annot"><span class="annottext">IORef (IVarContents a)
</span><a href="#local-6989586621680171662"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-343"></span><span>  </span><span class="annot"><span class="annottext">InstanceM (InstanceM ()) -&gt; InstanceM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">(InstanceM (InstanceM ()) -&gt; InstanceM ())
-&gt; InstanceM (InstanceM ()) -&gt; InstanceM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IORef (IVarContents a)
-&gt; (IVarContents a -&gt; (IVarContents a, InstanceM ()))
-&gt; InstanceM (InstanceM ())
forall (m :: * -&gt; *) a b.
MonadIO m =&gt;
IORef a -&gt; (a -&gt; (a, b)) -&gt; m b
</span><span class="hs-identifier hs-var">atomicModifyIORef'</span></span><span> </span><span class="annot"><span class="annottext">IORef (IVarContents a)
</span><a href="#local-6989586621680171662"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">((IVarContents a -&gt; (IVarContents a, InstanceM ()))
 -&gt; InstanceM (InstanceM ()))
-&gt; (IVarContents a -&gt; (IVarContents a, InstanceM ()))
-&gt; InstanceM (InstanceM ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-344"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVarEmpty"><span class="hs-identifier hs-type">IVarEmpty</span></a></span><span> </span><span id="local-6989586621680171665"><span class="annot"><span class="annottext">JobList
</span><a href="#local-6989586621680171665"><span class="hs-identifier hs-var">list</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JobList -&gt; IVarContents a
forall a. JobList -&gt; IVarContents a
</span><a href="Temporal.Workflow.Internal.Monad.html#IVarEmpty"><span class="hs-identifier hs-var">IVarEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ContinuationEnv -&gt; Workflow b -&gt; IVar b -&gt; JobList -&gt; JobList
forall a.
ContinuationEnv -&gt; Workflow a -&gt; IVar a -&gt; JobList -&gt; JobList
</span><a href="Temporal.Workflow.Internal.Monad.html#JobCons"><span class="hs-identifier hs-var">JobCons</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171657"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow b
</span><a href="#local-6989586621680171658"><span class="hs-identifier hs-var">wf</span></a></span><span> </span><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171659"><span class="hs-identifier hs-var">resultIVar</span></a></span><span> </span><span class="annot"><span class="annottext">JobList
</span><a href="#local-6989586621680171665"><span class="hs-identifier hs-var">list</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">() -&gt; InstanceM ()
forall a. a -&gt; InstanceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>    </span><span id="local-6989586621680171667"><span class="annot"><span class="annottext">IVarContents a
</span><a href="#local-6989586621680171667"><span class="hs-identifier hs-var">full</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IVarContents a
</span><a href="#local-6989586621680171667"><span class="hs-identifier hs-var">full</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IORef JobList -&gt; (JobList -&gt; JobList) -&gt; InstanceM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; (a -&gt; a) -&gt; m ()
</span><span class="hs-identifier hs-var">modifyIORef'</span></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171657"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">runQueueRef</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ContinuationEnv -&gt; Workflow b -&gt; IVar b -&gt; JobList -&gt; JobList
forall a.
ContinuationEnv -&gt; Workflow a -&gt; IVar a -&gt; JobList -&gt; JobList
</span><a href="Temporal.Workflow.Internal.Monad.html#JobCons"><span class="hs-identifier hs-var">JobCons</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171657"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow b
</span><a href="#local-6989586621680171658"><span class="hs-identifier hs-var">wf</span></a></span><span> </span><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171659"><span class="hs-identifier hs-var">resultIVar</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#addJobPanic"><span class="hs-identifier hs-type">addJobPanic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680170912"><span class="annot"><a href="#local-6989586621680170912"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680170912"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-349"></span><span id="addJobPanic"><span class="annot"><span class="annottext">addJobPanic :: forall a. a
</span><a href="Temporal.Workflow.Internal.Monad.html#addJobPanic"><span class="hs-identifier hs-var hs-var">addJobPanic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;addJob: not empty&quot;</span></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-353"></span><span class="hs-comment">-- Cont</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span class="annot"><span class="hs-comment">{- | A data representation of a Workflow continuation.  This is to avoid
repeatedly traversing a left-biased tree in a continuation, leading
O(n^2) complexity for some pathalogical cases.

See &quot;A Smart View on Datatypes&quot;, Jaskelioff/Rivas, ICFP'15
-}</span></span><span>
</span><span id="line-361"></span><span class="hs-keyword">data</span><span> </span><span id="Cont"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Cont"><span class="hs-identifier hs-var">Cont</span></a></span></span><span> </span><span id="local-6989586621680170747"><span class="annot"><a href="#local-6989586621680170747"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-362"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Cont"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Cont"><span class="hs-identifier hs-var">Cont</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170747"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680171672"><span class="annot"><a href="#local-6989586621680171672"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Cont"><span class="hs-identifier hs-type">Cont</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171672"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span id="%3A%3E%3E%3D"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#%3A%3E%3E%3D"><span class="hs-operator hs-var">:&gt;&gt;=</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680171672"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170747"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680171673"><span class="annot"><a href="#local-6989586621680171673"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680171673"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680170747"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span id="%3A%3C%24%3E"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#%3A%3C%24%3E"><span class="hs-operator hs-var">:&lt;$&gt;</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Cont"><span class="hs-identifier hs-type">Cont</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171673"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Return"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Return"><span class="hs-identifier hs-var">Return</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170747"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span id="local-6989586621680170790"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#toWf"><span class="hs-identifier hs-type">toWf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Cont"><span class="hs-identifier hs-type">Cont</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170790"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170790"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-369"></span><span id="toWf"><span class="annot"><span class="annottext">toWf :: forall a. Cont a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#toWf"><span class="hs-identifier hs-var hs-var">toWf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Cont"><span class="hs-identifier hs-type">Cont</span></a></span><span> </span><span id="local-6989586621680171674"><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680171674"><span class="hs-identifier hs-var">wf</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680171674"><span class="hs-identifier hs-var">wf</span></a></span><span>
</span><span id="line-370"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#toWf"><span class="hs-identifier hs-var">toWf</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680171675"><span class="annot"><span class="annottext">Cont b
</span><a href="#local-6989586621680171675"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#%3A%3E%3E%3D"><span class="hs-operator hs-type">:&gt;&gt;=</span></a></span><span> </span><span id="local-6989586621680171676"><span class="annot"><span class="annottext">b -&gt; Workflow a
</span><a href="#local-6989586621680171676"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cont b -&gt; (b -&gt; Workflow a) -&gt; Workflow a
forall b a. Cont b -&gt; (b -&gt; Workflow a) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#toWfBind"><span class="hs-identifier hs-var">toWfBind</span></a></span><span> </span><span class="annot"><span class="annottext">Cont b
</span><a href="#local-6989586621680171675"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; Workflow a
</span><a href="#local-6989586621680171676"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-371"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#toWf"><span class="hs-identifier hs-var">toWf</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680171678"><span class="annot"><span class="annottext">b -&gt; a
</span><a href="#local-6989586621680171678"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#%3A%3C%24%3E"><span class="hs-operator hs-type">:&lt;$&gt;</span></a></span><span> </span><span id="local-6989586621680171679"><span class="annot"><span class="annottext">Cont b
</span><a href="#local-6989586621680171679"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; a) -&gt; Cont b -&gt; Workflow a
forall a b. (a -&gt; b) -&gt; Cont a -&gt; Workflow b
</span><a href="Temporal.Workflow.Internal.Monad.html#toWfFmap"><span class="hs-identifier hs-var">toWfFmap</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; a
</span><a href="#local-6989586621680171678"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Cont b
</span><a href="#local-6989586621680171679"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-372"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#toWf"><span class="hs-identifier hs-var">toWf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621680171681"><span class="annot"><span class="annottext">IVar a
</span><a href="#local-6989586621680171681"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IVar a -&gt; Workflow a
forall a. IVar a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#getIVar"><span class="hs-identifier hs-var">getIVar</span></a></span><span> </span><span class="annot"><span class="annottext">IVar a
</span><a href="#local-6989586621680171681"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span id="local-6989586621680170916"><span id="local-6989586621680170917"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#toWfBind"><span class="hs-identifier hs-type">toWfBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Cont"><span class="hs-identifier hs-type">Cont</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170916"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680170916"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170917"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170917"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-376"></span><span id="toWfBind"><span class="annot"><span class="annottext">toWfBind :: forall b a. Cont b -&gt; (b -&gt; Workflow a) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#toWfBind"><span class="hs-identifier hs-var hs-var">toWfBind</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680171685"><span class="annot"><span class="annottext">Cont b
</span><a href="#local-6989586621680171685"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#%3A%3E%3E%3D"><span class="hs-operator hs-type">:&gt;&gt;=</span></a></span><span> </span><span id="local-6989586621680171686"><span class="annot"><span class="annottext">b -&gt; Workflow b
</span><a href="#local-6989586621680171686"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680171687"><span class="annot"><span class="annottext">b -&gt; Workflow a
</span><a href="#local-6989586621680171687"><span class="hs-identifier hs-var">k2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cont b -&gt; (b -&gt; Workflow a) -&gt; Workflow a
forall b a. Cont b -&gt; (b -&gt; Workflow a) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#toWfBind"><span class="hs-identifier hs-var">toWfBind</span></a></span><span> </span><span class="annot"><span class="annottext">Cont b
</span><a href="#local-6989586621680171685"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; Workflow b
</span><a href="#local-6989586621680171686"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">(b -&gt; Workflow b) -&gt; (b -&gt; Workflow a) -&gt; b -&gt; Workflow a
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Workflow a
</span><a href="#local-6989586621680171687"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#toWfBind"><span class="hs-identifier hs-var">toWfBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Cont"><span class="hs-identifier hs-type">Cont</span></a></span><span> </span><span id="local-6989586621680171689"><span class="annot"><span class="annottext">Workflow b
</span><a href="#local-6989586621680171689"><span class="hs-identifier hs-var">wf</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680171690"><span class="annot"><span class="annottext">b -&gt; Workflow a
</span><a href="#local-6989586621680171690"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Workflow b
</span><a href="#local-6989586621680171689"><span class="hs-identifier hs-var">wf</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow b -&gt; (b -&gt; Workflow a) -&gt; Workflow a
forall a b. Workflow a -&gt; (a -&gt; Workflow b) -&gt; Workflow b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Workflow a
</span><a href="#local-6989586621680171690"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-378"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#toWfBind"><span class="hs-identifier hs-var">toWfBind</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680171691"><span class="annot"><span class="annottext">b -&gt; b
</span><a href="#local-6989586621680171691"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#%3A%3C%24%3E"><span class="hs-operator hs-type">:&lt;$&gt;</span></a></span><span> </span><span id="local-6989586621680171692"><span class="annot"><span class="annottext">Cont b
</span><a href="#local-6989586621680171692"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680171693"><span class="annot"><span class="annottext">b -&gt; Workflow a
</span><a href="#local-6989586621680171693"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cont b -&gt; (b -&gt; Workflow a) -&gt; Workflow a
forall b a. Cont b -&gt; (b -&gt; Workflow a) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#toWfBind"><span class="hs-identifier hs-var">toWfBind</span></a></span><span> </span><span class="annot"><span class="annottext">Cont b
</span><a href="#local-6989586621680171692"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; Workflow a
</span><a href="#local-6989586621680171693"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">(b -&gt; Workflow a) -&gt; (b -&gt; b) -&gt; b -&gt; Workflow a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; b
</span><a href="#local-6989586621680171691"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#toWfBind"><span class="hs-identifier hs-var">toWfBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621680171694"><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171694"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680171695"><span class="annot"><span class="annottext">b -&gt; Workflow a
</span><a href="#local-6989586621680171695"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IVar b -&gt; Workflow b
forall a. IVar a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#getIVar"><span class="hs-identifier hs-var">getIVar</span></a></span><span> </span><span class="annot"><span class="annottext">IVar b
</span><a href="#local-6989586621680171694"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow b -&gt; (b -&gt; Workflow a) -&gt; Workflow a
forall a b. Workflow a -&gt; (a -&gt; Workflow b) -&gt; Workflow b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Workflow a
</span><a href="#local-6989586621680171695"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span id="local-6989586621680170919"><span id="local-6989586621680170920"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#toWfFmap"><span class="hs-identifier hs-type">toWfFmap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680170919"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680170920"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Cont"><span class="hs-identifier hs-type">Cont</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170919"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170920"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-383"></span><span id="toWfFmap"><span class="annot"><span class="annottext">toWfFmap :: forall a b. (a -&gt; b) -&gt; Cont a -&gt; Workflow b
</span><a href="Temporal.Workflow.Internal.Monad.html#toWfFmap"><span class="hs-identifier hs-var hs-var">toWfFmap</span></a></span></span><span> </span><span id="local-6989586621680171698"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680171698"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680171701"><span class="annot"><span class="annottext">Cont b
</span><a href="#local-6989586621680171701"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#%3A%3E%3E%3D"><span class="hs-operator hs-type">:&gt;&gt;=</span></a></span><span> </span><span id="local-6989586621680171702"><span class="annot"><span class="annottext">b -&gt; Workflow a
</span><a href="#local-6989586621680171702"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cont b -&gt; (b -&gt; Workflow b) -&gt; Workflow b
forall b a. Cont b -&gt; (b -&gt; Workflow a) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#toWfBind"><span class="hs-identifier hs-var">toWfBind</span></a></span><span> </span><span class="annot"><span class="annottext">Cont b
</span><a href="#local-6989586621680171701"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; Workflow a
</span><a href="#local-6989586621680171702"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">(b -&gt; Workflow a) -&gt; (a -&gt; Workflow b) -&gt; b -&gt; Workflow b
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Workflow b
forall a. a -&gt; Workflow a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(b -&gt; Workflow b) -&gt; (a -&gt; b) -&gt; a -&gt; Workflow b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680171698"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#toWfFmap"><span class="hs-identifier hs-var">toWfFmap</span></a></span><span> </span><span id="local-6989586621680171703"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680171703"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Cont"><span class="hs-identifier hs-type">Cont</span></a></span><span> </span><span id="local-6989586621680171704"><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680171704"><span class="hs-identifier hs-var">wf</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680171703"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Workflow a -&gt; Workflow b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680171704"><span class="hs-identifier hs-var">wf</span></a></span><span>
</span><span id="line-385"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#toWfFmap"><span class="hs-identifier hs-var">toWfFmap</span></a></span><span> </span><span id="local-6989586621680171705"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680171705"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680171706"><span class="annot"><span class="annottext">b -&gt; a
</span><a href="#local-6989586621680171706"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#%3A%3C%24%3E"><span class="hs-operator hs-type">:&lt;$&gt;</span></a></span><span> </span><span id="local-6989586621680171707"><span class="annot"><span class="annottext">Cont b
</span><a href="#local-6989586621680171707"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; b) -&gt; Cont b -&gt; Workflow b
forall a b. (a -&gt; b) -&gt; Cont a -&gt; Workflow b
</span><a href="Temporal.Workflow.Internal.Monad.html#toWfFmap"><span class="hs-identifier hs-var">toWfFmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680171705"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; (b -&gt; a) -&gt; b -&gt; b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; a
</span><a href="#local-6989586621680171706"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cont b
</span><a href="#local-6989586621680171707"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-386"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#toWfFmap"><span class="hs-identifier hs-var">toWfFmap</span></a></span><span> </span><span id="local-6989586621680171708"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680171708"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621680171709"><span class="annot"><span class="annottext">IVar a
</span><a href="#local-6989586621680171709"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680171708"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Workflow a -&gt; Workflow b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IVar a -&gt; Workflow a
forall a. IVar a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#getIVar"><span class="hs-identifier hs-var">getIVar</span></a></span><span> </span><span class="annot"><span class="annottext">IVar a
</span><a href="#local-6989586621680171709"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-390"></span><span class="hs-comment">-- Result</span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span class="annot"><span class="hs-comment">{- | The result of a computation is either 'Done' with a value, 'Throw'
with an exception, or 'Blocked' on the result of a data fetch with
a continuation.
-}</span></span><span>
</span><span id="line-396"></span><span class="hs-keyword">data</span><span> </span><span id="Result"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Result"><span class="hs-identifier hs-var">Result</span></a></span></span><span> </span><span id="local-6989586621680170714"><span class="annot"><a href="#local-6989586621680170714"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-397"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Done"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621680170714"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-398"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Throw"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-var">Throw</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | The 'IVar' is what we are blocked on; 'Cont' is the</span><span>
</span><span id="line-400"></span><span>    </span><span class="hs-comment">-- continuation.  This might be wrapped further if we're</span><span>
</span><span id="line-401"></span><span>    </span><span class="hs-comment">-- nested inside multiple '&gt;&gt;=', before finally being added</span><span>
</span><span id="line-402"></span><span>    </span><span class="hs-comment">-- to the 'IVar'.</span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680171710"><span class="annot"><a href="#local-6989586621680171710"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-404"></span><span>    </span><span id="Blocked"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-var">Blocked</span></a></span></span><span>
</span><span id="line-405"></span><span>      </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171710"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Cont"><span class="hs-identifier hs-type">Cont</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170714"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span class="annot"><span class="hs-comment">{- | A list of computations together with the IVar into which they
should put their result.

This could be an ordinary list, but the optimised representation
saves space and time.
-}</span></span><span>
</span><span id="line-415"></span><span class="hs-keyword">data</span><span> </span><span id="JobList"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#JobList"><span class="hs-identifier hs-var">JobList</span></a></span></span><span>
</span><span id="line-416"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="JobNil"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#JobNil"><span class="hs-identifier hs-var">JobNil</span></a></span></span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680171712"><span class="annot"><a href="#local-6989586621680171712"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-418"></span><span>    </span><span id="JobCons"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#JobCons"><span class="hs-identifier hs-var">JobCons</span></a></span></span><span>
</span><span id="line-419"></span><span>      </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ContinuationEnv"><span class="hs-identifier hs-type">ContinuationEnv</span></a></span><span>
</span><span id="line-420"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171712"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>      </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171712"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>      </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#JobList"><span class="hs-identifier hs-type">JobList</span></a></span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#appendJobList"><span class="hs-identifier hs-type">appendJobList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#JobList"><span class="hs-identifier hs-type">JobList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#JobList"><span class="hs-identifier hs-type">JobList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#JobList"><span class="hs-identifier hs-type">JobList</span></a></span><span>
</span><span id="line-426"></span><span id="appendJobList"><span class="annot"><span class="annottext">appendJobList :: JobList -&gt; JobList -&gt; JobList
</span><a href="Temporal.Workflow.Internal.Monad.html#appendJobList"><span class="hs-identifier hs-var hs-var">appendJobList</span></a></span></span><span> </span><span class="annot"><span class="annottext">JobList
</span><a href="Temporal.Workflow.Internal.Monad.html#JobNil"><span class="hs-identifier hs-var">JobNil</span></a></span><span> </span><span id="local-6989586621680171714"><span class="annot"><span class="annottext">JobList
</span><a href="#local-6989586621680171714"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JobList
</span><a href="#local-6989586621680171714"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-427"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#appendJobList"><span class="hs-identifier hs-var">appendJobList</span></a></span><span> </span><span id="local-6989586621680171715"><span class="annot"><span class="annottext">JobList
</span><a href="#local-6989586621680171715"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">JobList
</span><a href="Temporal.Workflow.Internal.Monad.html#JobNil"><span class="hs-identifier hs-var">JobNil</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JobList
</span><a href="#local-6989586621680171715"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-428"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#appendJobList"><span class="hs-identifier hs-var">appendJobList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#JobCons"><span class="hs-identifier hs-type">JobCons</span></a></span><span> </span><span id="local-6989586621680171716"><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171716"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680171717"><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680171717"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680171718"><span class="annot"><span class="annottext">IVar a
</span><a href="#local-6989586621680171718"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680171719"><span class="annot"><span class="annottext">JobList
</span><a href="#local-6989586621680171719"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680171720"><span class="annot"><span class="annottext">JobList
</span><a href="#local-6989586621680171720"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContinuationEnv -&gt; Workflow a -&gt; IVar a -&gt; JobList -&gt; JobList
forall a.
ContinuationEnv -&gt; Workflow a -&gt; IVar a -&gt; JobList -&gt; JobList
</span><a href="Temporal.Workflow.Internal.Monad.html#JobCons"><span class="hs-identifier hs-var">JobCons</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171716"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680171717"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">IVar a
</span><a href="#local-6989586621680171718"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(JobList -&gt; JobList) -&gt; JobList -&gt; JobList
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">JobList -&gt; JobList -&gt; JobList
</span><a href="Temporal.Workflow.Internal.Monad.html#appendJobList"><span class="hs-identifier hs-var">appendJobList</span></a></span><span> </span><span class="annot"><span class="annottext">JobList
</span><a href="#local-6989586621680171719"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">JobList
</span><a href="#local-6989586621680171720"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#lengthJobList"><span class="hs-identifier hs-type">lengthJobList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#JobList"><span class="hs-identifier hs-type">JobList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-432"></span><span id="lengthJobList"><span class="annot"><span class="annottext">lengthJobList :: JobList -&gt; Int
</span><a href="Temporal.Workflow.Internal.Monad.html#lengthJobList"><span class="hs-identifier hs-var hs-var">lengthJobList</span></a></span></span><span> </span><span class="annot"><span class="annottext">JobList
</span><a href="Temporal.Workflow.Internal.Monad.html#JobNil"><span class="hs-identifier hs-var">JobNil</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-433"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#lengthJobList"><span class="hs-identifier hs-var">lengthJobList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#JobCons"><span class="hs-identifier hs-type">JobCons</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Workflow a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IVar a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680171726"><span class="annot"><span class="annottext">JobList
</span><a href="#local-6989586621680171726"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">JobList -&gt; Int
</span><a href="Temporal.Workflow.Internal.Monad.html#lengthJobList"><span class="hs-identifier hs-var">lengthJobList</span></a></span><span> </span><span class="annot"><span class="annottext">JobList
</span><a href="#local-6989586621680171726"><span class="hs-identifier hs-var">j</span></a></span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680170942"><span id="local-6989586621680171730"><span id="local-6989586621680171735"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680170942"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170942"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-437"></span><span>  </span><span id="local-6989586621680171750"><span class="annot"><span class="annottext">show :: Result a -&gt; String
</span><a href="#local-6989586621680171750"><span class="hs-identifier hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span id="local-6989586621680171752"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171752"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall r. PrintfType r =&gt; String -&gt; r
</span><span class="hs-identifier hs-var">printf</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Done(%s)&quot;</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171752"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-438"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Throw"><span class="hs-identifier hs-type">Throw</span></a></span><span> </span><span id="local-6989586621680171754"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171754"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall r. PrintfType r =&gt; String -&gt; r
</span><span class="hs-identifier hs-var">printf</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Throw(%s)&quot;</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171754"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-439"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Blocked&quot;</span></span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span class="hs-keyword">data</span><span> </span><span id="IVarContents"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVarContents"><span class="hs-identifier hs-var">IVarContents</span></a></span></span><span> </span><span id="local-6989586621680170908"><span class="annot"><a href="#local-6989586621680170908"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="IVarFull"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVarFull"><span class="hs-identifier hs-var">IVarFull</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ResultVal"><span class="hs-identifier hs-type">ResultVal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170908"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="IVarEmpty"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVarEmpty"><span class="hs-identifier hs-var">IVarEmpty</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#JobList"><span class="hs-identifier hs-type">JobList</span></a></span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span class="annot"><span class="hs-comment">-- | A synchronisation point. It either contains a value, or a list of computations waiting for the value.</span></span><span>
</span><span id="line-448"></span><span class="hs-keyword">newtype</span><span> </span><span id="IVar"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-var">IVar</span></a></span></span><span> </span><span id="local-6989586621680170901"><span class="annot"><a href="#local-6989586621680170901"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="IVar"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-var">IVar</span></a></span></span><span> </span><span class="hs-special">{</span><span id="ivarRef"><span class="annot"><span class="annottext">forall a. IVar a -&gt; IORef (IVarContents a)
</span><a href="Temporal.Workflow.Internal.Monad.html#ivarRef"><span class="hs-identifier hs-var hs-var">ivarRef</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVarContents"><span class="hs-identifier hs-type">IVarContents</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170901"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span>
</span><span id="line-451"></span><span class="annot"><span class="hs-comment">{- | The contents of a full IVar.  We have to distinguish exceptions
thrown by the machinery of the library from those thrown in the
Workflow, so -- that when the result is fetched using getIVar,
we can handle the exception in the right way.
-}</span></span><span>
</span><span id="line-456"></span><span class="hs-keyword">data</span><span> </span><span id="ResultVal"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ResultVal"><span class="hs-identifier hs-var">ResultVal</span></a></span></span><span> </span><span id="local-6989586621680171029"><span class="annot"><a href="#local-6989586621680171029"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-457"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Ok"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Ok"><span class="hs-identifier hs-var">Ok</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621680171029"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- Unrecoverable error in the temporal library that should crash the worker</span><span>
</span><span id="line-459"></span><span>    </span><span id="ThrowInternal"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ThrowInternal"><span class="hs-identifier hs-var">ThrowInternal</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span>
</span><span id="line-460"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- Error in the workflow that should be returned to the caller</span><span>
</span><span id="line-461"></span><span>    </span><span id="ThrowWorkflow"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ThrowWorkflow"><span class="hs-identifier hs-var">ThrowWorkflow</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span id="local-6989586621680170786"><span id="local-6989586621680170787"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#newIVar"><span class="hs-identifier hs-type">newIVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621680170786"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680170786"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170787"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-465"></span><span id="newIVar"><span class="annot"><span class="annottext">newIVar :: forall (m :: * -&gt; *) a. MonadIO m =&gt; m (IVar a)
</span><a href="Temporal.Workflow.Internal.Monad.html#newIVar"><span class="hs-identifier hs-var hs-var">newIVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-466"></span><span>  </span><span id="local-6989586621680171767"><span class="annot"><a href="#local-6989586621680171767"><span class="hs-identifier hs-var">ivarRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IVarContents a -&gt; m (IORef (IVarContents a))
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">(IVarContents a -&gt; m (IORef (IVarContents a)))
-&gt; IVarContents a -&gt; m (IORef (IVarContents a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JobList -&gt; IVarContents a
forall a. JobList -&gt; IVarContents a
</span><a href="Temporal.Workflow.Internal.Monad.html#IVarEmpty"><span class="hs-identifier hs-var">IVarEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">JobList
</span><a href="Temporal.Workflow.Internal.Monad.html#JobNil"><span class="hs-identifier hs-var">JobNil</span></a></span><span>
</span><span id="line-467"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ivarRef"><span class="hs-glyph hs-var hs-type">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span id="local-6989586621680170785"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#getIVar"><span class="hs-identifier hs-type">getIVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170785"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170785"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-471"></span><span id="getIVar"><span class="annot"><span class="annottext">getIVar :: forall a. IVar a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#getIVar"><span class="hs-identifier hs-var hs-var">getIVar</span></a></span></span><span> </span><span id="local-6989586621680171776"><span class="annot"><span class="annottext">i :: IVar a
</span><a href="#local-6989586621680171776"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">ivarRef :: forall a. IVar a -&gt; IORef (IVarContents a)
</span><a href="Temporal.Workflow.Internal.Monad.html#ivarRef"><span class="hs-identifier hs-var">ivarRef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621680171777"><span class="annot"><span class="annottext">IORef (IVarContents a)
</span><a href="#local-6989586621680171777"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a)
-&gt; (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680171778"><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171778"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-472"></span><span>  </span><span id="local-6989586621680171779"><span class="annot"><a href="#local-6989586621680171779"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef (IVarContents a) -&gt; InstanceM (IVarContents a)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; m a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (IVarContents a)
</span><a href="#local-6989586621680171777"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-473"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680171779"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-474"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVarFull"><span class="hs-identifier hs-type">IVarFull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Ok"><span class="hs-identifier hs-type">Ok</span></a></span><span> </span><span id="local-6989586621680171780"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171780"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result a -&gt; InstanceM (Result a)
forall a. a -&gt; InstanceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Result a -&gt; InstanceM (Result a))
-&gt; Result a -&gt; InstanceM (Result a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Result a
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171780"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-475"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVarFull"><span class="hs-identifier hs-type">IVarFull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ThrowWorkflow"><span class="hs-identifier hs-type">ThrowWorkflow</span></a></span><span> </span><span id="local-6989586621680171781"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171781"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Result a) -&gt; InstanceM (Result a)
forall a. IO a -&gt; InstanceM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Result a) -&gt; InstanceM (Result a))
-&gt; IO (Result a) -&gt; InstanceM (Result a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv -&gt; IVar a -&gt; SomeException -&gt; IO (Result a)
forall e a b.
Exception e =&gt;
ContinuationEnv -&gt; IVar a -&gt; e -&gt; IO (Result b)
</span><a href="Temporal.Workflow.Internal.Monad.html#raiseFromIVar"><span class="hs-identifier hs-var">raiseFromIVar</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171778"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">IVar a
</span><a href="#local-6989586621680171776"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171781"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-476"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVarFull"><span class="hs-identifier hs-type">IVarFull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ThrowInternal"><span class="hs-identifier hs-type">ThrowInternal</span></a></span><span> </span><span id="local-6989586621680171783"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171783"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; InstanceM (Result a)
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171783"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-477"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVarEmpty"><span class="hs-identifier hs-type">IVarEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">JobList
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result a -&gt; InstanceM (Result a)
forall a. a -&gt; InstanceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Result a -&gt; InstanceM (Result a))
-&gt; Result a -&gt; InstanceM (Result a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IVar a -&gt; Cont a -&gt; Result a
forall a b. IVar b -&gt; Cont a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-var">Blocked</span></a></span><span> </span><span class="annot"><span class="annottext">IVar a
</span><a href="#local-6989586621680171776"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IVar a -&gt; Cont a
forall a. IVar a -&gt; Cont a
</span><a href="Temporal.Workflow.Internal.Monad.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">IVar a
</span><a href="#local-6989586621680171776"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span>
</span><span id="line-480"></span><span class="hs-comment">-- Just a specialised version of getIVar, for efficiency in &lt;*&gt;</span><span>
</span><span id="line-481"></span><span id="local-6989586621680170782"><span id="local-6989586621680170783"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#getIVarApply"><span class="hs-identifier hs-type">getIVarApply</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680170782"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680170783"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680170782"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170783"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-482"></span><span id="getIVarApply"><span class="annot"><span class="annottext">getIVarApply :: forall a b. IVar (a -&gt; b) -&gt; a -&gt; Workflow b
</span><a href="Temporal.Workflow.Internal.Monad.html#getIVarApply"><span class="hs-identifier hs-var hs-var">getIVarApply</span></a></span></span><span> </span><span id="local-6989586621680171793"><span class="annot"><span class="annottext">i :: IVar (a -&gt; b)
</span><a href="#local-6989586621680171793"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">ivarRef :: forall a. IVar a -&gt; IORef (IVarContents a)
</span><a href="Temporal.Workflow.Internal.Monad.html#ivarRef"><span class="hs-identifier hs-var">ivarRef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621680171794"><span class="annot"><span class="annottext">IORef (IVarContents (a -&gt; b))
</span><a href="#local-6989586621680171794"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680171795"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171795"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result b)) -&gt; Workflow b
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result b)) -&gt; Workflow b)
-&gt; (ContinuationEnv -&gt; InstanceM (Result b)) -&gt; Workflow b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680171796"><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171796"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-483"></span><span>  </span><span id="local-6989586621680171797"><span class="annot"><a href="#local-6989586621680171797"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef (IVarContents (a -&gt; b)) -&gt; InstanceM (IVarContents (a -&gt; b))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; m a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (IVarContents (a -&gt; b))
</span><a href="#local-6989586621680171794"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-484"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680171797"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-485"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVarFull"><span class="hs-identifier hs-type">IVarFull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Ok"><span class="hs-identifier hs-type">Ok</span></a></span><span> </span><span id="local-6989586621680171798"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680171798"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result b -&gt; InstanceM (Result b)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; Result b
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680171798"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171795"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVarFull"><span class="hs-identifier hs-type">IVarFull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ThrowWorkflow"><span class="hs-identifier hs-type">ThrowWorkflow</span></a></span><span> </span><span id="local-6989586621680171799"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171799"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Result b) -&gt; InstanceM (Result b)
forall a. IO a -&gt; InstanceM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Result b) -&gt; InstanceM (Result b))
-&gt; IO (Result b) -&gt; InstanceM (Result b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv -&gt; IVar (a -&gt; b) -&gt; SomeException -&gt; IO (Result b)
forall e a b.
Exception e =&gt;
ContinuationEnv -&gt; IVar a -&gt; e -&gt; IO (Result b)
</span><a href="Temporal.Workflow.Internal.Monad.html#raiseFromIVar"><span class="hs-identifier hs-var">raiseFromIVar</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171796"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">IVar (a -&gt; b)
</span><a href="#local-6989586621680171793"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171799"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-487"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVarFull"><span class="hs-identifier hs-type">IVarFull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ThrowInternal"><span class="hs-identifier hs-type">ThrowInternal</span></a></span><span> </span><span id="local-6989586621680171800"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171800"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; InstanceM (Result b)
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171800"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-488"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVarEmpty"><span class="hs-identifier hs-type">IVarEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">JobList
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-489"></span><span>      </span><span class="annot"><span class="annottext">Result b -&gt; InstanceM (Result b)
forall a. a -&gt; InstanceM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IVar (a -&gt; b) -&gt; Cont b -&gt; Result b
forall a b. IVar b -&gt; Cont a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Blocked"><span class="hs-identifier hs-var">Blocked</span></a></span><span> </span><span class="annot"><span class="annottext">IVar (a -&gt; b)
</span><a href="#local-6989586621680171793"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Workflow b -&gt; Cont b
forall a. Workflow a -&gt; Cont a
</span><a href="Temporal.Workflow.Internal.Monad.html#Cont"><span class="hs-identifier hs-var">Cont</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IVar (a -&gt; b) -&gt; a -&gt; Workflow b
forall a b. IVar (a -&gt; b) -&gt; a -&gt; Workflow b
</span><a href="Temporal.Workflow.Internal.Monad.html#getIVarApply"><span class="hs-identifier hs-var">getIVarApply</span></a></span><span> </span><span class="annot"><span class="annottext">IVar (a -&gt; b)
</span><a href="#local-6989586621680171793"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171795"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span id="local-6989586621680170964"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#putIVar"><span class="hs-identifier hs-type">putIVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170964"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ResultVal"><span class="hs-identifier hs-type">ResultVal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170964"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ContinuationEnv"><span class="hs-identifier hs-type">ContinuationEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-493"></span><span id="putIVar"><span class="annot"><span class="annottext">putIVar :: forall a. IVar a -&gt; ResultVal a -&gt; ContinuationEnv -&gt; IO ()
</span><a href="Temporal.Workflow.Internal.Monad.html#putIVar"><span class="hs-identifier hs-var hs-var">putIVar</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">ivarRef :: forall a. IVar a -&gt; IORef (IVarContents a)
</span><a href="Temporal.Workflow.Internal.Monad.html#ivarRef"><span class="hs-identifier hs-var">ivarRef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621680171809"><span class="annot"><span class="annottext">IORef (IVarContents a)
</span><a href="#local-6989586621680171809"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680171810"><span class="annot"><span class="annottext">ResultVal a
</span><a href="#local-6989586621680171810"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ContinuationEnv"><span class="hs-identifier hs-type">ContinuationEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680171811"><span class="annot"><span class="annottext">IORef JobList
runQueueRef :: ContinuationEnv -&gt; IORef JobList
runQueueRef :: IORef JobList
</span><a href="Temporal.Workflow.Internal.Monad.html#runQueueRef"><span class="hs-glyph hs-var hs-var">..</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-494"></span><span>  </span><span id="local-6989586621680171812"><span class="annot"><a href="#local-6989586621680171812"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef (IVarContents a) -&gt; IO (IVarContents a)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; m a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (IVarContents a)
</span><a href="#local-6989586621680171809"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680171812"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-496"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVarEmpty"><span class="hs-identifier hs-type">IVarEmpty</span></a></span><span> </span><span id="local-6989586621680171813"><span class="annot"><span class="annottext">JobList
</span><a href="#local-6989586621680171813"><span class="hs-identifier hs-var">jobs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; IO ()
forall a. String -&gt; a -&gt; a
</span><a href="Temporal.Workflow.Internal.Monad.html#trace_"><span class="hs-identifier hs-var">trace_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;putIVar/Empty&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-497"></span><span>      </span><span class="annot"><span class="annottext">IORef (IVarContents a) -&gt; IVarContents a -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">writeIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (IVarContents a)
</span><a href="#local-6989586621680171809"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResultVal a -&gt; IVarContents a
forall a. ResultVal a -&gt; IVarContents a
</span><a href="Temporal.Workflow.Internal.Monad.html#IVarFull"><span class="hs-identifier hs-var">IVarFull</span></a></span><span> </span><span class="annot"><span class="annottext">ResultVal a
</span><a href="#local-6989586621680171810"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span>      </span><span class="annot"><span class="annottext">IORef JobList -&gt; (JobList -&gt; JobList) -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; (a -&gt; a) -&gt; m ()
</span><span class="hs-identifier hs-var">modifyIORef'</span></span><span> </span><span class="annot"><span class="annottext">IORef JobList
</span><a href="#local-6989586621680171811"><span class="hs-identifier hs-var">runQueueRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JobList -&gt; JobList -&gt; JobList
</span><a href="Temporal.Workflow.Internal.Monad.html#appendJobList"><span class="hs-identifier hs-var">appendJobList</span></a></span><span> </span><span class="annot"><span class="annottext">JobList
</span><a href="#local-6989586621680171813"><span class="hs-identifier hs-var">jobs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-499"></span><span>    </span><span class="hs-comment">-- An IVar is typically only meant to be written to once</span><span>
</span><span id="line-500"></span><span>    </span><span class="hs-comment">-- so it would make sense to throw an error here. But there</span><span>
</span><span id="line-501"></span><span>    </span><span class="hs-comment">-- are legitimate use-cases for writing several times.</span><span>
</span><span id="line-502"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVarFull"><span class="hs-identifier hs-type">IVarFull</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; (() -&gt; IO ()) -&gt; () -&gt; IO ()
forall a. String -&gt; a -&gt; a
</span><a href="Temporal.Workflow.Internal.Monad.html#trace_"><span class="hs-identifier hs-var">trace_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;putIVar/Full&quot;</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span id="local-6989586621680170966"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#tryReadIVar"><span class="hs-identifier hs-type">tryReadIVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170966"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621680170966"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-506"></span><span id="tryReadIVar"><span class="annot"><span class="annottext">tryReadIVar :: forall a. IVar a -&gt; Workflow (Maybe a)
</span><a href="Temporal.Workflow.Internal.Monad.html#tryReadIVar"><span class="hs-identifier hs-var hs-var">tryReadIVar</span></a></span></span><span> </span><span id="local-6989586621680171823"><span class="annot"><span class="annottext">i :: IVar a
</span><a href="#local-6989586621680171823"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">ivarRef :: forall a. IVar a -&gt; IORef (IVarContents a)
</span><a href="Temporal.Workflow.Internal.Monad.html#ivarRef"><span class="hs-identifier hs-var">ivarRef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621680171824"><span class="annot"><span class="annottext">IORef (IVarContents a)
</span><a href="#local-6989586621680171824"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result (Maybe a)))
-&gt; Workflow (Maybe a)
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result (Maybe a)))
 -&gt; Workflow (Maybe a))
-&gt; (ContinuationEnv -&gt; InstanceM (Result (Maybe a)))
-&gt; Workflow (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680171825"><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171825"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-507"></span><span>  </span><span id="local-6989586621680171826"><span class="annot"><a href="#local-6989586621680171826"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef (IVarContents a) -&gt; InstanceM (IVarContents a)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; m a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (IVarContents a)
</span><a href="#local-6989586621680171824"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-508"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680171826"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-509"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVarFull"><span class="hs-identifier hs-type">IVarFull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Ok"><span class="hs-identifier hs-type">Ok</span></a></span><span> </span><span id="local-6989586621680171827"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171827"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result (Maybe a) -&gt; InstanceM (Result (Maybe a))
forall a. a -&gt; InstanceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Result (Maybe a) -&gt; InstanceM (Result (Maybe a)))
-&gt; Result (Maybe a) -&gt; InstanceM (Result (Maybe a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; Result (Maybe a)
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171827"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVarFull"><span class="hs-identifier hs-type">IVarFull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ThrowWorkflow"><span class="hs-identifier hs-type">ThrowWorkflow</span></a></span><span> </span><span id="local-6989586621680171828"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171828"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Result (Maybe a)) -&gt; InstanceM (Result (Maybe a))
forall a. IO a -&gt; InstanceM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Result (Maybe a)) -&gt; InstanceM (Result (Maybe a)))
-&gt; IO (Result (Maybe a)) -&gt; InstanceM (Result (Maybe a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv -&gt; IVar a -&gt; SomeException -&gt; IO (Result (Maybe a))
forall e a b.
Exception e =&gt;
ContinuationEnv -&gt; IVar a -&gt; e -&gt; IO (Result b)
</span><a href="Temporal.Workflow.Internal.Monad.html#raiseFromIVar"><span class="hs-identifier hs-var">raiseFromIVar</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171825"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">IVar a
</span><a href="#local-6989586621680171823"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171828"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-511"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVarFull"><span class="hs-identifier hs-type">IVarFull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ThrowInternal"><span class="hs-identifier hs-type">ThrowInternal</span></a></span><span> </span><span id="local-6989586621680171829"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171829"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; InstanceM (Result (Maybe a))
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680171829"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-512"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVarEmpty"><span class="hs-identifier hs-type">IVarEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">JobList
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Result (Maybe a) -&gt; InstanceM (Result (Maybe a))
forall a. a -&gt; InstanceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Result (Maybe a) -&gt; InstanceM (Result (Maybe a)))
-&gt; Result (Maybe a) -&gt; InstanceM (Result (Maybe a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; Result (Maybe a)
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span id="local-6989586621680170956"><span id="local-6989586621680170957"><span id="local-6989586621680170958"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#raiseFromIVar"><span class="hs-identifier hs-type">raiseFromIVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="#local-6989586621680170956"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ContinuationEnv"><span class="hs-identifier hs-type">ContinuationEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170957"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680170956"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170958"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-516"></span><span id="raiseFromIVar"><span class="annot"><span class="annottext">raiseFromIVar :: forall e a b.
Exception e =&gt;
ContinuationEnv -&gt; IVar a -&gt; e -&gt; IO (Result b)
</span><a href="Temporal.Workflow.Internal.Monad.html#raiseFromIVar"><span class="hs-identifier hs-var hs-var">raiseFromIVar</span></a></span></span><span> </span><span id="local-6989586621680171832"><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171832"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680171833"><span class="annot"><span class="annottext">IVar a
</span><a href="#local-6989586621680171833"><span class="hs-identifier hs-var">_ivar</span></a></span></span><span> </span><span id="local-6989586621680171834"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621680171834"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContinuationEnv -&gt; SomeException -&gt; IO (Result b)
forall b. ContinuationEnv -&gt; SomeException -&gt; IO (Result b)
</span><a href="Temporal.Workflow.Internal.Monad.html#raiseImpl"><span class="hs-identifier hs-var">raiseImpl</span></a></span><span> </span><span class="annot"><span class="annottext">ContinuationEnv
</span><a href="#local-6989586621680171832"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e -&gt; SomeException
forall e. Exception e =&gt; e -&gt; SomeException
</span><span class="hs-identifier hs-var">toException</span></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621680171834"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span class="annot"><span class="hs-comment">{- | A very restricted Monad that allows for reading 'StateVar' values. This Monad
keeps track of which 'StateVar' values are read so that it can block and retry
the computation if any of the values change.
-}</span></span><span>
</span><span id="line-523"></span><span class="hs-keyword">newtype</span><span> </span><span id="Condition"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Condition"><span class="hs-identifier hs-var">Condition</span></a></span></span><span> </span><span id="local-6989586621680170972"><span class="annot"><a href="#local-6989586621680170972"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Condition"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Condition"><span class="hs-identifier hs-var">Condition</span></a></span></span><span>
</span><span id="line-524"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="unCondition"><span class="annot"><span class="annottext">forall a. Condition a -&gt; ReaderT (IORef (Set Sequence)) InstanceM a
</span><a href="Temporal.Workflow.Internal.Monad.html#unCondition"><span class="hs-identifier hs-var hs-var">unCondition</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#Sequence"><span class="hs-identifier hs-type">Sequence</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#InstanceM"><span class="hs-identifier hs-type">InstanceM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170972"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-525"></span><span>  </span><span class="hs-comment">-- ^ We track the sequence number of each accessed StateVar so that we can</span><span>
</span><span id="line-526"></span><span>  </span><span class="hs-comment">-- block and retry the condition evaluation if the state changes.</span><span>
</span><span id="line-527"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-528"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680171839"><span id="local-6989586621680171844"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; Condition a -&gt; Condition b)
-&gt; (forall a b. a -&gt; Condition b -&gt; Condition a)
-&gt; Functor Condition
forall a b. a -&gt; Condition b -&gt; Condition a
forall a b. (a -&gt; b) -&gt; Condition a -&gt; Condition b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; Condition a -&gt; Condition b
fmap :: forall a b. (a -&gt; b) -&gt; Condition a -&gt; Condition b
$c&lt;$ :: forall a b. a -&gt; Condition b -&gt; Condition a
&lt;$ :: forall a b. a -&gt; Condition b -&gt; Condition a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680171851"><span id="local-6989586621680171857"><span id="local-6989586621680171862"><span id="local-6989586621680171867"><span id="local-6989586621680171872"><span class="annot"><span class="annottext">Functor Condition
Functor Condition =&gt;
(forall a. a -&gt; Condition a)
-&gt; (forall a b. Condition (a -&gt; b) -&gt; Condition a -&gt; Condition b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c) -&gt; Condition a -&gt; Condition b -&gt; Condition c)
-&gt; (forall a b. Condition a -&gt; Condition b -&gt; Condition b)
-&gt; (forall a b. Condition a -&gt; Condition b -&gt; Condition a)
-&gt; Applicative Condition
forall a. a -&gt; Condition a
forall a b. Condition a -&gt; Condition b -&gt; Condition a
forall a b. Condition a -&gt; Condition b -&gt; Condition b
forall a b. Condition (a -&gt; b) -&gt; Condition a -&gt; Condition b
forall a b c.
(a -&gt; b -&gt; c) -&gt; Condition a -&gt; Condition b -&gt; Condition c
forall (f :: * -&gt; *).
Functor f =&gt;
(forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
$cpure :: forall a. a -&gt; Condition a
pure :: forall a. a -&gt; Condition a
$c&lt;*&gt; :: forall a b. Condition (a -&gt; b) -&gt; Condition a -&gt; Condition b
&lt;*&gt; :: forall a b. Condition (a -&gt; b) -&gt; Condition a -&gt; Condition b
$cliftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; Condition a -&gt; Condition b -&gt; Condition c
liftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; Condition a -&gt; Condition b -&gt; Condition c
$c*&gt; :: forall a b. Condition a -&gt; Condition b -&gt; Condition b
*&gt; :: forall a b. Condition a -&gt; Condition b -&gt; Condition b
$c&lt;* :: forall a b. Condition a -&gt; Condition b -&gt; Condition a
&lt;* :: forall a b. Condition a -&gt; Condition b -&gt; Condition a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680171881"><span id="local-6989586621680171886"><span id="local-6989586621680171890"><span class="annot"><span class="annottext">Applicative Condition
Applicative Condition =&gt;
(forall a b. Condition a -&gt; (a -&gt; Condition b) -&gt; Condition b)
-&gt; (forall a b. Condition a -&gt; Condition b -&gt; Condition b)
-&gt; (forall a. a -&gt; Condition a)
-&gt; Monad Condition
forall a. a -&gt; Condition a
forall a b. Condition a -&gt; Condition b -&gt; Condition b
forall a b. Condition a -&gt; (a -&gt; Condition b) -&gt; Condition b
forall (m :: * -&gt; *).
Applicative m =&gt;
(forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall a b. Condition a -&gt; (a -&gt; Condition b) -&gt; Condition b
&gt;&gt;= :: forall a b. Condition a -&gt; (a -&gt; Condition b) -&gt; Condition b
$c&gt;&gt; :: forall a b. Condition a -&gt; Condition b -&gt; Condition b
&gt;&gt; :: forall a b. Condition a -&gt; Condition b -&gt; Condition b
$creturn :: forall a. a -&gt; Condition a
return :: forall a. a -&gt; Condition a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span>
</span><span id="line-531"></span><span class="annot"><span class="hs-comment">{- | 'StateVar' values are mutable variables scoped to a Workflow run.

'Workflow's are deterministic, so you may not use normal IORefs, since the IORef
could have been created outside of the workflow and cause nondeterminism.

However, it is totally safe to mutate state variables as long as they are scoped
to a workflow and derive their state transitions from the workflow's deterministic
execution.

StateVar values may also be read from within a query and mutated within signal handlers.
-}</span></span><span>
</span><span id="line-542"></span><span class="hs-keyword">data</span><span> </span><span id="StateVar"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#StateVar"><span class="hs-identifier hs-var">StateVar</span></a></span></span><span> </span><span id="local-6989586621680171005"><span class="annot"><a href="#local-6989586621680171005"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="StateVar"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#StateVar"><span class="hs-identifier hs-var">StateVar</span></a></span></span><span>
</span><span id="line-543"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="stateVarId"><span class="annot"><span class="annottext">forall a. StateVar a -&gt; Sequence
</span><a href="Temporal.Workflow.Internal.Monad.html#stateVarId"><span class="hs-identifier hs-var hs-var">stateVarId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Temporal.Common.html#Sequence"><span class="hs-identifier hs-type">Sequence</span></a></span><span>
</span><span id="line-544"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="stateVarRef"><span class="annot"><span class="annottext">forall a. StateVar a -&gt; IORef a
</span><a href="Temporal.Workflow.Internal.Monad.html#stateVarRef"><span class="hs-identifier hs-var hs-var">stateVarRef</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><a href="#local-6989586621680171005"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680171011"><span id="local-6989586621680171898"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#StateVar"><span class="hs-identifier hs-type">StateVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171011"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-549"></span><span>  </span><span id="local-6989586621680171904"><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680171904"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680171905"><span class="annot"><span class="annottext">== :: StateVar a -&gt; StateVar a -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var">==</span></span></span><span> </span><span id="local-6989586621680171906"><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680171906"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateVar a -&gt; Sequence
forall a. StateVar a -&gt; Sequence
</span><a href="Temporal.Workflow.Internal.Monad.html#stateVarId"><span class="hs-identifier hs-var">stateVarId</span></a></span><span> </span><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680171904"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Sequence -&gt; Sequence -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">StateVar a -&gt; Sequence
forall a. StateVar a -&gt; Sequence
</span><a href="Temporal.Workflow.Internal.Monad.html#stateVarId"><span class="hs-identifier hs-var">stateVarId</span></a></span><span> </span><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680171906"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680171014"><span id="local-6989586621680171911"><span id="local-6989586621680171915"><span id="local-6989586621680171918"><span id="local-6989586621680171921"><span id="local-6989586621680171924"><span id="local-6989586621680171927"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#StateVar"><span class="hs-identifier hs-type">StateVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171014"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-553"></span><span>  </span><span id="local-6989586621680171932"><span class="annot"><span class="annottext">compare :: StateVar a -&gt; StateVar a -&gt; Ordering
</span><a href="#local-6989586621680171932"><span class="hs-identifier hs-var hs-var hs-var">compare</span></a></span></span><span> </span><span id="local-6989586621680171934"><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680171934"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680171935"><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680171935"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sequence -&gt; Sequence -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateVar a -&gt; Sequence
forall a. StateVar a -&gt; Sequence
</span><a href="Temporal.Workflow.Internal.Monad.html#stateVarId"><span class="hs-identifier hs-var">stateVarId</span></a></span><span> </span><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680171934"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateVar a -&gt; Sequence
forall a. StateVar a -&gt; Sequence
</span><a href="Temporal.Workflow.Internal.Monad.html#stateVarId"><span class="hs-identifier hs-var">stateVarId</span></a></span><span> </span><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680171935"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span id="local-6989586621680171015"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#newStateVar"><span class="hs-identifier hs-type">newStateVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680171015"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#StateVar"><span class="hs-identifier hs-type">StateVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171015"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-557"></span><span id="newStateVar"><span class="annot"><span class="annottext">newStateVar :: forall a. a -&gt; Workflow (StateVar a)
</span><a href="Temporal.Workflow.Internal.Monad.html#newStateVar"><span class="hs-identifier hs-var hs-var">newStateVar</span></a></span></span><span> </span><span id="local-6989586621680171941"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171941"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result (StateVar a)))
-&gt; Workflow (StateVar a)
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result (StateVar a)))
 -&gt; Workflow (StateVar a))
-&gt; (ContinuationEnv -&gt; InstanceM (Result (StateVar a)))
-&gt; Workflow (StateVar a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-558"></span><span>  </span><span class="annot"><span class="annottext">StateVar a -&gt; Result (StateVar a)
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">(StateVar a -&gt; Result (StateVar a))
-&gt; InstanceM (StateVar a) -&gt; InstanceM (Result (StateVar a))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sequence -&gt; IORef a -&gt; StateVar a
forall a. Sequence -&gt; IORef a -&gt; StateVar a
</span><a href="Temporal.Workflow.Internal.Monad.html#StateVar"><span class="hs-identifier hs-var">StateVar</span></a></span><span> </span><span class="annot"><span class="annottext">(Sequence -&gt; IORef a -&gt; StateVar a)
-&gt; InstanceM Sequence -&gt; InstanceM (IORef a -&gt; StateVar a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">InstanceM Sequence
</span><a href="Temporal.Workflow.Internal.Monad.html#nextVarIdSequence"><span class="hs-identifier hs-var">nextVarIdSequence</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceM (IORef a -&gt; StateVar a)
-&gt; InstanceM (IORef a) -&gt; InstanceM (StateVar a)
forall a b. InstanceM (a -&gt; b) -&gt; InstanceM a -&gt; InstanceM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; InstanceM (IORef a)
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680171941"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-559"></span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span id="local-6989586621680171017"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#reevaluateDependentConditions"><span class="hs-identifier hs-type">reevaluateDependentConditions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#StateVar"><span class="hs-identifier hs-type">StateVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171017"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#InstanceM"><span class="hs-identifier hs-type">InstanceM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-562"></span><span id="reevaluateDependentConditions"><span class="annot"><span class="annottext">reevaluateDependentConditions :: forall a. StateVar a -&gt; InstanceM ()
</span><a href="Temporal.Workflow.Internal.Monad.html#reevaluateDependentConditions"><span class="hs-identifier hs-var hs-var">reevaluateDependentConditions</span></a></span></span><span> </span><span id="local-6989586621680171967"><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680171967"><span class="hs-identifier hs-var">cref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-563"></span><span>  </span><span id="local-6989586621680171968"><span class="annot"><a href="#local-6989586621680171968"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM WorkflowInstance
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-564"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">join</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">atomically</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-565"></span><span>    </span><span id="local-6989586621680171969"><span class="annot"><a href="#local-6989586621680171969"><span class="hs-identifier hs-var">seqMaps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">readTVar</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowSequenceMaps</span><span>
</span><span id="line-566"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680171971"><span class="annot"><a href="#local-6989586621680171971"><span class="hs-identifier hs-var hs-var">pendingConds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SequenceMaps
</span><a href="#local-6989586621680171969"><span class="hs-identifier hs-var">seqMaps</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">conditionsAwaitingSignal</span><span>
</span><span id="line-567"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621680171972"><span class="annot"><a href="#local-6989586621680171972"><span class="hs-identifier hs-var">reactivateConds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680171973"><span class="annot"><a href="#local-6989586621680171973"><span class="hs-identifier hs-var">unactivatedConds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-568"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">HashMap.foldlWithKey'</span></span><span>
</span><span id="line-569"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680171975"><span class="annot"><span class="annottext">InstanceM ()
</span><a href="#local-6989586621680171975"><span class="hs-identifier hs-var">reactivateConds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680171976"><span class="annot"><span class="annottext">HashMap Sequence (IVar (), Set Sequence)
</span><a href="#local-6989586621680171976"><span class="hs-identifier hs-var">unactivatedConds'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680171977"><span class="annot"><span class="annottext">Sequence
</span><a href="#local-6989586621680171977"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680171978"><span class="annot"><span class="annottext">v :: (IVar (), Set Sequence)
</span><a href="#local-6989586621680171978"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621680171979"><span class="annot"><span class="annottext">IVar ()
</span><a href="#local-6989586621680171979"><span class="hs-identifier hs-var">ivar</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680171980"><span class="annot"><span class="annottext">Set Sequence
</span><a href="#local-6989586621680171980"><span class="hs-identifier hs-var">varDependencies</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-570"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680171967"><span class="hs-identifier hs-var">cref</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">stateVarId</span><span> </span><span class="annot"><span class="annottext">Sequence -&gt; Set Sequence -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="annot"><span class="annottext">Set Sequence
</span><a href="#local-6989586621680171980"><span class="hs-identifier hs-var">varDependencies</span></a></span><span>
</span><span id="line-571"></span><span>                  </span><span class="hs-keyword">then</span><span>
</span><span id="line-572"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">InstanceM ()
</span><a href="#local-6989586621680171975"><span class="hs-identifier hs-var">reactivateConds'</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceM () -&gt; InstanceM () -&gt; InstanceM ()
forall a b. InstanceM a -&gt; InstanceM b -&gt; InstanceM b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; InstanceM ()
forall a. IO a -&gt; InstanceM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IVar () -&gt; ResultVal () -&gt; ContinuationEnv -&gt; IO ()
forall a. IVar a -&gt; ResultVal a -&gt; ContinuationEnv -&gt; IO ()
</span><a href="Temporal.Workflow.Internal.Monad.html#putIVar"><span class="hs-identifier hs-var">putIVar</span></a></span><span> </span><span class="annot"><span class="annottext">IVar ()
</span><a href="#local-6989586621680171979"><span class="hs-identifier hs-var">ivar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; ResultVal ()
forall a. a -&gt; ResultVal a
</span><a href="Temporal.Workflow.Internal.Monad.html#Ok"><span class="hs-identifier hs-var">Ok</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WorkflowInstance
</span><a href="#local-6989586621680171968"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">workflowInstanceContinuationEnv</span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashMap Sequence (IVar (), Set Sequence)
</span><a href="#local-6989586621680171976"><span class="hs-identifier hs-var">unactivatedConds'</span></a></span><span>
</span><span id="line-574"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>                  </span><span class="hs-keyword">else</span><span>
</span><span id="line-576"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">InstanceM ()
</span><a href="#local-6989586621680171975"><span class="hs-identifier hs-var">reactivateConds'</span></a></span><span>
</span><span id="line-577"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Sequence
-&gt; (IVar (), Set Sequence)
-&gt; HashMap Sequence (IVar (), Set Sequence)
-&gt; HashMap Sequence (IVar (), Set Sequence)
forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HashMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Sequence
</span><a href="#local-6989586621680171977"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">(IVar (), Set Sequence)
</span><a href="#local-6989586621680171978"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Sequence (IVar (), Set Sequence)
</span><a href="#local-6989586621680171976"><span class="hs-identifier hs-var">unactivatedConds'</span></a></span><span>
</span><span id="line-578"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-580"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span>            </span><span class="annot"><a href="#local-6989586621680171971"><span class="hs-identifier hs-type">pendingConds</span></a></span><span>
</span><span id="line-582"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">writeTVar</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowSequenceMaps</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680171969"><span class="hs-identifier hs-type">seqMaps</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#conditionsAwaitingSignal"><span class="hs-identifier hs-var">conditionsAwaitingSignal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680171973"><span class="hs-identifier hs-type">unactivatedConds</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-583"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621680171972"><span class="hs-identifier hs-type">reactivateConds</span></a></span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span>
</span><span id="line-586"></span><span class="hs-keyword">class</span><span> </span><span id="MonadReadStateVar"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#MonadReadStateVar"><span class="hs-identifier hs-var">MonadReadStateVar</span></a></span></span><span> </span><span id="local-6989586621680171035"><span class="annot"><a href="#local-6989586621680171035"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-587"></span><span>  </span><span id="readStateVar"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#readStateVar"><span class="hs-identifier hs-type">readStateVar</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621680171033"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#StateVar"><span class="hs-identifier hs-type">StateVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171033"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680171035"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171033"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span>
</span><span id="line-590"></span><span class="hs-keyword">class</span><span> </span><span id="MonadWriteStateVar"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#MonadWriteStateVar"><span class="hs-identifier hs-var">MonadWriteStateVar</span></a></span></span><span> </span><span id="local-6989586621680171046"><span class="annot"><a href="#local-6989586621680171046"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-591"></span><span>  </span><span id="writeStateVar"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#writeStateVar"><span class="hs-identifier hs-type">writeStateVar</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621680171043"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#StateVar"><span class="hs-identifier hs-type">StateVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171043"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680171043"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680171046"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-592"></span><span>  </span><span id="modifyStateVar"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#modifyStateVar"><span class="hs-identifier hs-type">modifyStateVar</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621680171044"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#StateVar"><span class="hs-identifier hs-type">StateVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171044"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680171044"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680171044"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680171046"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-593"></span><span>
</span><span id="line-594"></span><span>
</span><span id="line-595"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#MonadReadStateVar"><span class="hs-identifier hs-type">MonadReadStateVar</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Condition"><span class="hs-identifier hs-type">Condition</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-596"></span><span>  </span><span id="local-6989586621680172001"><span class="annot"><span class="annottext">readStateVar :: forall a. StateVar a -&gt; Condition a
</span><a href="Temporal.Workflow.Internal.Monad.html#readStateVar"><span class="hs-identifier hs-var hs-var hs-var">readStateVar</span></a></span></span><span> </span><span id="local-6989586621680172002"><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680172002"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT (IORef (Set Sequence)) InstanceM a -&gt; Condition a
forall a. ReaderT (IORef (Set Sequence)) InstanceM a -&gt; Condition a
</span><a href="Temporal.Workflow.Internal.Monad.html#Condition"><span class="hs-identifier hs-var">Condition</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT (IORef (Set Sequence)) InstanceM a -&gt; Condition a)
-&gt; ReaderT (IORef (Set Sequence)) InstanceM a -&gt; Condition a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-597"></span><span>    </span><span id="local-6989586621680172003"><span class="annot"><a href="#local-6989586621680172003"><span class="hs-identifier hs-var">touchedVars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT (IORef (Set Sequence)) InstanceM (IORef (Set Sequence))
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-598"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">modifyIORef'</span></span><span> </span><span class="annot"><a href="#local-6989586621680172003"><span class="hs-identifier hs-type">touchedVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set.insert</span></span><span> </span><span class="annot"><span class="hs-identifier">var</span></span><span class="hs-operator">.</span><span class="hs-identifier">stateVarId</span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="annot"><span class="hs-identifier">var</span></span><span class="hs-operator">.</span><span class="hs-identifier">stateVarRef</span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#MonadReadStateVar"><span class="hs-identifier hs-type">MonadReadStateVar</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-603"></span><span>  </span><span id="local-6989586621680172010"><span class="annot"><span class="annottext">readStateVar :: forall a. StateVar a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#readStateVar"><span class="hs-identifier hs-var hs-var hs-var">readStateVar</span></a></span></span><span> </span><span id="local-6989586621680172011"><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680172011"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a)
-&gt; (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Result a
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Result a) -&gt; InstanceM a -&gt; InstanceM (Result a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IORef a -&gt; InstanceM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; m a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680172011"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">stateVarRef</span><span>
</span><span id="line-604"></span><span>
</span><span id="line-605"></span><span>
</span><span id="line-606"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#MonadWriteStateVar"><span class="hs-identifier hs-type">MonadWriteStateVar</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-607"></span><span>  </span><span id="local-6989586621680172021"><span class="annot"><span class="annottext">writeStateVar :: forall a. StateVar a -&gt; a -&gt; Workflow ()
</span><a href="Temporal.Workflow.Internal.Monad.html#writeStateVar"><span class="hs-identifier hs-var hs-var hs-var">writeStateVar</span></a></span></span><span> </span><span id="local-6989586621680172022"><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680172022"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621680172023"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680172023"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result ())) -&gt; Workflow ()
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result ())) -&gt; Workflow ())
-&gt; (ContinuationEnv -&gt; InstanceM (Result ())) -&gt; Workflow ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-608"></span><span>    </span><span class="annot"><span class="annottext">IORef a -&gt; a -&gt; InstanceM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">writeIORef</span></span><span> </span><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680172022"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">stateVarRef</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680172023"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-609"></span><span>    </span><span class="annot"><span class="annottext">StateVar a -&gt; InstanceM ()
forall a. StateVar a -&gt; InstanceM ()
</span><a href="Temporal.Workflow.Internal.Monad.html#reevaluateDependentConditions"><span class="hs-identifier hs-var">reevaluateDependentConditions</span></a></span><span> </span><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680172022"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-610"></span><span>    </span><span class="annot"><span class="annottext">Result () -&gt; InstanceM (Result ())
forall a. a -&gt; InstanceM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Result () -&gt; InstanceM (Result ()))
-&gt; Result () -&gt; InstanceM (Result ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Result ()
forall a. a -&gt; Result a
</span><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-611"></span><span>  </span><span id="local-6989586621680172029"><span class="annot"><span class="annottext">modifyStateVar :: forall a. StateVar a -&gt; (a -&gt; a) -&gt; Workflow ()
</span><a href="Temporal.Workflow.Internal.Monad.html#modifyStateVar"><span class="hs-identifier hs-var hs-var hs-var">modifyStateVar</span></a></span></span><span> </span><span id="local-6989586621680172030"><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680172030"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621680172031"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621680172031"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result ())) -&gt; Workflow ()
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result ())) -&gt; Workflow ())
-&gt; (ContinuationEnv -&gt; InstanceM (Result ())) -&gt; Workflow ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-612"></span><span>    </span><span id="local-6989586621680172032"><span class="annot"><a href="#local-6989586621680172032"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef a -&gt; (a -&gt; a) -&gt; InstanceM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; (a -&gt; a) -&gt; m ()
</span><span class="hs-identifier hs-var">modifyIORef'</span></span><span> </span><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680172030"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">stateVarRef</span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621680172031"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-613"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#reevaluateDependentConditions"><span class="hs-identifier hs-type">reevaluateDependentConditions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680172030"><span class="hs-identifier hs-type">var</span></a></span><span>
</span><span id="line-614"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680172032"><span class="hs-identifier hs-type">res</span></a></span><span>
</span><span id="line-615"></span><span>
</span><span id="line-616"></span><span>
</span><span id="line-617"></span><span class="annot"><span class="hs-comment">{- | The Query monad is a very constrained version of the Workflow monad. It can
only read state variables and return values. It is used to define query handlers.
-}</span></span><span>
</span><span id="line-620"></span><span class="hs-keyword">newtype</span><span> </span><span id="Query"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Query"><span class="hs-identifier hs-var">Query</span></a></span></span><span> </span><span id="local-6989586621680171070"><span class="annot"><a href="#local-6989586621680171070"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Query"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Query"><span class="hs-identifier hs-var">Query</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#InstanceM"><span class="hs-identifier hs-type">InstanceM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171070"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680172035"><span id="local-6989586621680172039"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; Query a -&gt; Query b)
-&gt; (forall a b. a -&gt; Query b -&gt; Query a) -&gt; Functor Query
forall a b. a -&gt; Query b -&gt; Query a
forall a b. (a -&gt; b) -&gt; Query a -&gt; Query b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; Query a -&gt; Query b
fmap :: forall a b. (a -&gt; b) -&gt; Query a -&gt; Query b
$c&lt;$ :: forall a b. a -&gt; Query b -&gt; Query a
&lt;$ :: forall a b. a -&gt; Query b -&gt; Query a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680172046"><span id="local-6989586621680172050"><span id="local-6989586621680172054"><span id="local-6989586621680172058"><span id="local-6989586621680172062"><span class="annot"><span class="annottext">Functor Query
Functor Query =&gt;
(forall a. a -&gt; Query a)
-&gt; (forall a b. Query (a -&gt; b) -&gt; Query a -&gt; Query b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; Query a -&gt; Query b -&gt; Query c)
-&gt; (forall a b. Query a -&gt; Query b -&gt; Query b)
-&gt; (forall a b. Query a -&gt; Query b -&gt; Query a)
-&gt; Applicative Query
forall a. a -&gt; Query a
forall a b. Query a -&gt; Query b -&gt; Query a
forall a b. Query a -&gt; Query b -&gt; Query b
forall a b. Query (a -&gt; b) -&gt; Query a -&gt; Query b
forall a b c. (a -&gt; b -&gt; c) -&gt; Query a -&gt; Query b -&gt; Query c
forall (f :: * -&gt; *).
Functor f =&gt;
(forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
$cpure :: forall a. a -&gt; Query a
pure :: forall a. a -&gt; Query a
$c&lt;*&gt; :: forall a b. Query (a -&gt; b) -&gt; Query a -&gt; Query b
&lt;*&gt; :: forall a b. Query (a -&gt; b) -&gt; Query a -&gt; Query b
$cliftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; Query a -&gt; Query b -&gt; Query c
liftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; Query a -&gt; Query b -&gt; Query c
$c*&gt; :: forall a b. Query a -&gt; Query b -&gt; Query b
*&gt; :: forall a b. Query a -&gt; Query b -&gt; Query b
$c&lt;* :: forall a b. Query a -&gt; Query b -&gt; Query a
&lt;* :: forall a b. Query a -&gt; Query b -&gt; Query a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680172069"><span id="local-6989586621680172073"><span id="local-6989586621680172077"><span class="annot"><span class="annottext">Applicative Query
Applicative Query =&gt;
(forall a b. Query a -&gt; (a -&gt; Query b) -&gt; Query b)
-&gt; (forall a b. Query a -&gt; Query b -&gt; Query b)
-&gt; (forall a. a -&gt; Query a)
-&gt; Monad Query
forall a. a -&gt; Query a
forall a b. Query a -&gt; Query b -&gt; Query b
forall a b. Query a -&gt; (a -&gt; Query b) -&gt; Query b
forall (m :: * -&gt; *).
Applicative m =&gt;
(forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall a b. Query a -&gt; (a -&gt; Query b) -&gt; Query b
&gt;&gt;= :: forall a b. Query a -&gt; (a -&gt; Query b) -&gt; Query b
$c&gt;&gt; :: forall a b. Query a -&gt; Query b -&gt; Query b
&gt;&gt; :: forall a b. Query a -&gt; Query b -&gt; Query b
$creturn :: forall a. a -&gt; Query a
return :: forall a. a -&gt; Query a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#MonadReadStateVar"><span class="hs-identifier hs-type">MonadReadStateVar</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Query"><span class="hs-identifier hs-type">Query</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-625"></span><span>  </span><span id="local-6989586621680172085"><span class="annot"><span class="annottext">readStateVar :: forall a. StateVar a -&gt; Query a
</span><a href="Temporal.Workflow.Internal.Monad.html#readStateVar"><span class="hs-identifier hs-var hs-var hs-var">readStateVar</span></a></span></span><span> </span><span id="local-6989586621680172086"><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680172086"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstanceM a -&gt; Query a
forall a. InstanceM a -&gt; Query a
</span><a href="Temporal.Workflow.Internal.Monad.html#Query"><span class="hs-identifier hs-var">Query</span></a></span><span> </span><span class="annot"><span class="annottext">(InstanceM a -&gt; Query a) -&gt; InstanceM a -&gt; Query a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IORef a -&gt; InstanceM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; m a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">StateVar a
</span><a href="#local-6989586621680172086"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">stateVarRef</span><span>
</span><span id="line-626"></span><span>
</span><span id="line-627"></span><span>
</span><span id="line-628"></span><span class="hs-keyword">newtype</span><span> </span><span id="InstanceM"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#InstanceM"><span class="hs-identifier hs-var">InstanceM</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680171071"><span class="annot"><a href="#local-6989586621680171071"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="InstanceM"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#InstanceM"><span class="hs-identifier hs-var">InstanceM</span></a></span></span><span> </span><span class="hs-special">{</span><span id="unInstanceM"><span class="annot"><span class="annottext">forall a. InstanceM a -&gt; ReaderT WorkflowInstance IO a
</span><a href="Temporal.Workflow.Internal.Monad.html#unInstanceM"><span class="hs-identifier hs-var hs-var">unInstanceM</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowInstance"><span class="hs-identifier hs-type">WorkflowInstance</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680171071"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-629"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span>
</span><span id="line-630"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621680172090"><span id="local-6989586621680172095"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; InstanceM a -&gt; InstanceM b)
-&gt; (forall a b. a -&gt; InstanceM b -&gt; InstanceM a)
-&gt; Functor InstanceM
forall a b. a -&gt; InstanceM b -&gt; InstanceM a
forall a b. (a -&gt; b) -&gt; InstanceM a -&gt; InstanceM b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; InstanceM a -&gt; InstanceM b
fmap :: forall a b. (a -&gt; b) -&gt; InstanceM a -&gt; InstanceM b
$c&lt;$ :: forall a b. a -&gt; InstanceM b -&gt; InstanceM a
&lt;$ :: forall a b. a -&gt; InstanceM b -&gt; InstanceM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span>
</span><span id="line-631"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680172103"><span id="local-6989586621680172108"><span id="local-6989586621680172113"><span id="local-6989586621680172118"><span id="local-6989586621680172123"><span class="annot"><span class="annottext">Functor InstanceM
Functor InstanceM =&gt;
(forall a. a -&gt; InstanceM a)
-&gt; (forall a b. InstanceM (a -&gt; b) -&gt; InstanceM a -&gt; InstanceM b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c) -&gt; InstanceM a -&gt; InstanceM b -&gt; InstanceM c)
-&gt; (forall a b. InstanceM a -&gt; InstanceM b -&gt; InstanceM b)
-&gt; (forall a b. InstanceM a -&gt; InstanceM b -&gt; InstanceM a)
-&gt; Applicative InstanceM
forall a. a -&gt; InstanceM a
forall a b. InstanceM a -&gt; InstanceM b -&gt; InstanceM a
forall a b. InstanceM a -&gt; InstanceM b -&gt; InstanceM b
forall a b. InstanceM (a -&gt; b) -&gt; InstanceM a -&gt; InstanceM b
forall a b c.
(a -&gt; b -&gt; c) -&gt; InstanceM a -&gt; InstanceM b -&gt; InstanceM c
forall (f :: * -&gt; *).
Functor f =&gt;
(forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
$cpure :: forall a. a -&gt; InstanceM a
pure :: forall a. a -&gt; InstanceM a
$c&lt;*&gt; :: forall a b. InstanceM (a -&gt; b) -&gt; InstanceM a -&gt; InstanceM b
&lt;*&gt; :: forall a b. InstanceM (a -&gt; b) -&gt; InstanceM a -&gt; InstanceM b
$cliftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; InstanceM a -&gt; InstanceM b -&gt; InstanceM c
liftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; InstanceM a -&gt; InstanceM b -&gt; InstanceM c
$c*&gt; :: forall a b. InstanceM a -&gt; InstanceM b -&gt; InstanceM b
*&gt; :: forall a b. InstanceM a -&gt; InstanceM b -&gt; InstanceM b
$c&lt;* :: forall a b. InstanceM a -&gt; InstanceM b -&gt; InstanceM a
&lt;* :: forall a b. InstanceM a -&gt; InstanceM b -&gt; InstanceM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span>
</span><span id="line-632"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680172131"><span id="local-6989586621680172136"><span id="local-6989586621680172141"><span class="annot"><span class="annottext">Applicative InstanceM
Applicative InstanceM =&gt;
(forall a b. InstanceM a -&gt; (a -&gt; InstanceM b) -&gt; InstanceM b)
-&gt; (forall a b. InstanceM a -&gt; InstanceM b -&gt; InstanceM b)
-&gt; (forall a. a -&gt; InstanceM a)
-&gt; Monad InstanceM
forall a. a -&gt; InstanceM a
forall a b. InstanceM a -&gt; InstanceM b -&gt; InstanceM b
forall a b. InstanceM a -&gt; (a -&gt; InstanceM b) -&gt; InstanceM b
forall (m :: * -&gt; *).
Applicative m =&gt;
(forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall a b. InstanceM a -&gt; (a -&gt; InstanceM b) -&gt; InstanceM b
&gt;&gt;= :: forall a b. InstanceM a -&gt; (a -&gt; InstanceM b) -&gt; InstanceM b
$c&gt;&gt; :: forall a b. InstanceM a -&gt; InstanceM b -&gt; InstanceM b
&gt;&gt; :: forall a b. InstanceM a -&gt; InstanceM b -&gt; InstanceM b
$creturn :: forall a. a -&gt; InstanceM a
return :: forall a. a -&gt; InstanceM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span>
</span><span id="line-633"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680172148"><span class="annot"><span class="annottext">Monad InstanceM
Monad InstanceM =&gt;
(forall a. IO a -&gt; InstanceM a) -&gt; MonadIO InstanceM
forall a. IO a -&gt; InstanceM a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall a. IO a -&gt; m a) -&gt; MonadIO m
$cliftIO :: forall a. IO a -&gt; InstanceM a
liftIO :: forall a. IO a -&gt; InstanceM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></span></span><span>
</span><span id="line-634"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680172155"><span id="local-6989586621680172160"><span id="local-6989586621680172165"><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowInstance"><span class="hs-identifier hs-type">WorkflowInstance</span></a></span></span></span></span><span>
</span><span id="line-635"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680172175"><span class="annot"><span class="annottext">MonadIO InstanceM
MonadIO InstanceM =&gt;
(forall b.
 ((forall a. InstanceM a -&gt; IO a) -&gt; IO b) -&gt; InstanceM b)
-&gt; MonadUnliftIO InstanceM
forall b. ((forall a. InstanceM a -&gt; IO a) -&gt; IO b) -&gt; InstanceM b
forall (m :: * -&gt; *).
MonadIO m =&gt;
(forall b. ((forall a. m a -&gt; IO a) -&gt; IO b) -&gt; m b)
-&gt; MonadUnliftIO m
$cwithRunInIO :: forall b. ((forall a. InstanceM a -&gt; IO a) -&gt; IO b) -&gt; InstanceM b
withRunInIO :: forall b. ((forall a. InstanceM a -&gt; IO a) -&gt; IO b) -&gt; InstanceM b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadUnliftIO</span></span></span><span>
</span><span id="line-636"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680172190"><span class="annot"><span class="annottext">Monad InstanceM
Monad InstanceM =&gt;
(forall e a. (HasCallStack, Exception e) =&gt; e -&gt; InstanceM a)
-&gt; MonadThrow InstanceM
forall e a. (HasCallStack, Exception e) =&gt; e -&gt; InstanceM a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall e a. (HasCallStack, Exception e) =&gt; e -&gt; m a)
-&gt; MonadThrow m
$cthrowM :: forall e a. (HasCallStack, Exception e) =&gt; e -&gt; InstanceM a
throwM :: forall e a. (HasCallStack, Exception e) =&gt; e -&gt; InstanceM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">Catch.MonadThrow</span></span></span><span>
</span><span id="line-637"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680172210"><span class="annot"><span class="annottext">MonadThrow InstanceM
MonadThrow InstanceM =&gt;
(forall e a.
 (HasCallStack, Exception e) =&gt;
 InstanceM a -&gt; (e -&gt; InstanceM a) -&gt; InstanceM a)
-&gt; MonadCatch InstanceM
forall e a.
(HasCallStack, Exception e) =&gt;
InstanceM a -&gt; (e -&gt; InstanceM a) -&gt; InstanceM a
forall (m :: * -&gt; *).
MonadThrow m =&gt;
(forall e a.
 (HasCallStack, Exception e) =&gt;
 m a -&gt; (e -&gt; m a) -&gt; m a)
-&gt; MonadCatch m
$ccatch :: forall e a.
(HasCallStack, Exception e) =&gt;
InstanceM a -&gt; (e -&gt; InstanceM a) -&gt; InstanceM a
catch :: forall e a.
(HasCallStack, Exception e) =&gt;
InstanceM a -&gt; (e -&gt; InstanceM a) -&gt; InstanceM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">Catch.MonadCatch</span></span></span><span>
</span><span id="line-638"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680172228"><span id="local-6989586621680172240"><span id="local-6989586621680172251"><span class="annot"><span class="annottext">MonadCatch InstanceM
MonadCatch InstanceM =&gt;
(forall b.
 HasCallStack =&gt;
 ((forall a. InstanceM a -&gt; InstanceM a) -&gt; InstanceM b)
 -&gt; InstanceM b)
-&gt; (forall b.
    HasCallStack =&gt;
    ((forall a. InstanceM a -&gt; InstanceM a) -&gt; InstanceM b)
    -&gt; InstanceM b)
-&gt; (forall a b c.
    HasCallStack =&gt;
    InstanceM a
    -&gt; (a -&gt; ExitCase b -&gt; InstanceM c)
    -&gt; (a -&gt; InstanceM b)
    -&gt; InstanceM (b, c))
-&gt; MonadMask InstanceM
forall b.
HasCallStack =&gt;
((forall a. InstanceM a -&gt; InstanceM a) -&gt; InstanceM b)
-&gt; InstanceM b
forall a b c.
HasCallStack =&gt;
InstanceM a
-&gt; (a -&gt; ExitCase b -&gt; InstanceM c)
-&gt; (a -&gt; InstanceM b)
-&gt; InstanceM (b, c)
forall (m :: * -&gt; *).
MonadCatch m =&gt;
(forall b. HasCallStack =&gt; ((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b)
-&gt; (forall b.
    HasCallStack =&gt;
    ((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b)
-&gt; (forall a b c.
    HasCallStack =&gt;
    m a -&gt; (a -&gt; ExitCase b -&gt; m c) -&gt; (a -&gt; m b) -&gt; m (b, c))
-&gt; MonadMask m
$cmask :: forall b.
HasCallStack =&gt;
((forall a. InstanceM a -&gt; InstanceM a) -&gt; InstanceM b)
-&gt; InstanceM b
mask :: forall b.
HasCallStack =&gt;
((forall a. InstanceM a -&gt; InstanceM a) -&gt; InstanceM b)
-&gt; InstanceM b
$cuninterruptibleMask :: forall b.
HasCallStack =&gt;
((forall a. InstanceM a -&gt; InstanceM a) -&gt; InstanceM b)
-&gt; InstanceM b
uninterruptibleMask :: forall b.
HasCallStack =&gt;
((forall a. InstanceM a -&gt; InstanceM a) -&gt; InstanceM b)
-&gt; InstanceM b
$cgeneralBracket :: forall a b c.
HasCallStack =&gt;
InstanceM a
-&gt; (a -&gt; ExitCase b -&gt; InstanceM c)
-&gt; (a -&gt; InstanceM b)
-&gt; InstanceM (b, c)
generalBracket :: forall a b c.
HasCallStack =&gt;
InstanceM a
-&gt; (a -&gt; ExitCase b -&gt; InstanceM c)
-&gt; (a -&gt; InstanceM b)
-&gt; InstanceM (b, c)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Catch.MonadMask</span></span></span></span></span><span>
</span><span id="line-639"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-640"></span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadLogger</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#InstanceM"><span class="hs-identifier hs-type">InstanceM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-643"></span><span>  </span><span id="local-6989586621680172273"><span class="annot"><span class="annottext">monadLoggerLog :: forall msg.
ToLogStr msg =&gt;
Loc -&gt; LogSource -&gt; LogLevel -&gt; msg -&gt; InstanceM ()
</span><span class="hs-identifier hs-var hs-var hs-var">monadLoggerLog</span></span></span><span> </span><span id="local-6989586621680172274"><span class="annot"><span class="annottext">Loc
</span><a href="#local-6989586621680172274"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680172275"><span class="annot"><span class="annottext">LogSource
</span><a href="#local-6989586621680172275"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621680172276"><span class="annot"><span class="annottext">LogLevel
</span><a href="#local-6989586621680172276"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span id="local-6989586621680172277"><span class="annot"><span class="annottext">msg
</span><a href="#local-6989586621680172277"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-644"></span><span>    </span><span id="local-6989586621680172278"><span class="annot"><a href="#local-6989586621680172278"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(WorkflowInstance
 -&gt; Loc -&gt; LogSource -&gt; LogLevel -&gt; LogStr -&gt; IO ())
-&gt; InstanceM (Loc -&gt; LogSource -&gt; LogLevel -&gt; LogStr -&gt; IO ())
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">WorkflowInstance -&gt; Loc -&gt; LogSource -&gt; LogLevel -&gt; LogStr -&gt; IO ()
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowInstanceLogger"><span class="hs-identifier hs-var">workflowInstanceLogger</span></a></span><span>
</span><span id="line-645"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621680172278"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680172274"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680172275"><span class="hs-identifier hs-type">src</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680172276"><span class="hs-identifier hs-type">lvl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">toLogStr</span></span><span> </span><span class="annot"><a href="#local-6989586621680172277"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>
</span><span id="line-647"></span><span>
</span><span id="line-648"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadLoggerIO</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#InstanceM"><span class="hs-identifier hs-type">InstanceM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-649"></span><span>  </span><span id="local-6989586621680172287"><span class="annot"><span class="annottext">askLoggerIO :: InstanceM (Loc -&gt; LogSource -&gt; LogLevel -&gt; LogStr -&gt; IO ())
</span><a href="#local-6989586621680172287"><span class="hs-identifier hs-var hs-var hs-var">askLoggerIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkflowInstance
 -&gt; Loc -&gt; LogSource -&gt; LogLevel -&gt; LogStr -&gt; IO ())
-&gt; InstanceM (Loc -&gt; LogSource -&gt; LogLevel -&gt; LogStr -&gt; IO ())
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">WorkflowInstance -&gt; Loc -&gt; LogSource -&gt; LogLevel -&gt; LogStr -&gt; IO ()
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowInstanceLogger"><span class="hs-identifier hs-var">workflowInstanceLogger</span></a></span><span>
</span><span id="line-650"></span><span>
</span><span id="line-651"></span><span>
</span><span id="line-652"></span><span class="hs-comment">-- Bit of a hack. This needs to be called for each workflow activity in the official SDK</span><span>
</span><span id="line-653"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#updateCallStack"><span class="hs-identifier hs-type">updateCallStack</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#InstanceM"><span class="hs-identifier hs-type">InstanceM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span id="updateCallStack"><span class="annot"><span class="annottext">updateCallStack :: RequireCallStack =&gt; InstanceM ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStack"><span class="hs-identifier hs-var hs-var">updateCallStack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-655"></span><span>  </span><span id="local-6989586621680172298"><span class="annot"><a href="#local-6989586621680172298"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM WorkflowInstance
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-656"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">writeIORef</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowCallStack</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">popCallStack</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">callStack</span></span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span>
</span><span id="line-659"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#updateCallStackW"><span class="hs-identifier hs-type">updateCallStackW</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RequireCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-660"></span><span id="updateCallStackW"><span class="annot"><span class="annottext">updateCallStackW :: RequireCallStack =&gt; Workflow ()
</span><a href="Temporal.Workflow.Internal.Monad.html#updateCallStackW"><span class="hs-identifier hs-var hs-var">updateCallStackW</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContinuationEnv -&gt; InstanceM (Result ())) -&gt; Workflow ()
forall a. (ContinuationEnv -&gt; InstanceM (Result a)) -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-var">Workflow</span></a></span><span> </span><span class="annot"><span class="annottext">((ContinuationEnv -&gt; InstanceM (Result ())) -&gt; Workflow ())
-&gt; (ContinuationEnv -&gt; InstanceM (Result ())) -&gt; Workflow ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ContinuationEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-661"></span><span>  </span><span id="local-6989586621680172312"><span class="annot"><a href="#local-6989586621680172312"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM WorkflowInstance
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-662"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">writeIORef</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowCallStack</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">popCallStack</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">callStack</span></span><span>
</span><span id="line-663"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span>
</span><span id="line-666"></span><span class="hs-keyword">data</span><span> </span><span id="WorkflowInstance"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowInstance"><span class="hs-identifier hs-var">WorkflowInstance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WorkflowInstance"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowInstance"><span class="hs-identifier hs-var">WorkflowInstance</span></a></span></span><span>
</span><span id="line-667"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="workflowInstanceInfo"><span class="annot"><span class="annottext">WorkflowInstance -&gt; IORef Info
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowInstanceInfo"><span class="hs-identifier hs-var hs-var">workflowInstanceInfo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-668"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workflowInstanceLogger"><span class="annot"><span class="annottext">WorkflowInstance -&gt; Loc -&gt; LogSource -&gt; LogLevel -&gt; LogStr -&gt; IO ()
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowInstanceLogger"><span class="hs-identifier hs-var hs-var">workflowInstanceLogger</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Loc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogSource</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogLevel</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogStr</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workflowRandomnessSeed"><span class="annot"><span class="annottext">WorkflowInstance -&gt; WorkflowGenM
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowRandomnessSeed"><span class="hs-identifier hs-var hs-var">workflowRandomnessSeed</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowGenM"><span class="hs-identifier hs-type">WorkflowGenM</span></a></span><span>
</span><span id="line-670"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workflowNotifiedPatches"><span class="annot"><span class="annottext">WorkflowInstance -&gt; IORef (Set PatchId)
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowNotifiedPatches"><span class="hs-identifier hs-var hs-var">workflowNotifiedPatches</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#PatchId"><span class="hs-identifier hs-type">PatchId</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-671"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workflowMemoizedPatches"><span class="annot"><span class="annottext">WorkflowInstance -&gt; IORef (HashMap PatchId Bool)
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowMemoizedPatches"><span class="hs-identifier hs-var hs-var">workflowMemoizedPatches</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#PatchId"><span class="hs-identifier hs-type">PatchId</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-672"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workflowSequences"><span class="annot"><span class="annottext">WorkflowInstance -&gt; IORef Sequences
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowSequences"><span class="hs-identifier hs-var hs-var">workflowSequences</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Sequences"><span class="hs-identifier hs-type">Sequences</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-673"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workflowTime"><span class="annot"><span class="annottext">WorkflowInstance -&gt; IORef SystemTime
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowTime"><span class="hs-identifier hs-var hs-var">workflowTime</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SystemTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workflowIsReplaying"><span class="annot"><span class="annottext">WorkflowInstance -&gt; IORef Bool
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowIsReplaying"><span class="hs-identifier hs-var hs-var">workflowIsReplaying</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-675"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workflowCommands"><span class="annot"><span class="annottext">WorkflowInstance -&gt; TVar (Reversed WorkflowCommand)
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowCommands"><span class="hs-identifier hs-var hs-var">workflowCommands</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Reversed"><span class="hs-identifier hs-type">Reversed</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">WorkflowCommand</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workflowSequenceMaps"><span class="annot"><span class="annottext">WorkflowInstance -&gt; TVar SequenceMaps
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowSequenceMaps"><span class="hs-identifier hs-var hs-var">workflowSequenceMaps</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#SequenceMaps"><span class="hs-identifier hs-type">SequenceMaps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workflowSignalHandlers"><span class="annot"><span class="annottext">WorkflowInstance
-&gt; IORef
     (HashMap (Maybe LogSource) (Vector Payload -&gt; Workflow ()))
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowSignalHandlers"><span class="hs-identifier hs-var hs-var">workflowSignalHandlers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-678"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workflowQueryHandlers"><span class="annot"><span class="annottext">WorkflowInstance
-&gt; IORef
     (HashMap
        (Maybe LogSource)
        (QueryId
         -&gt; Vector Payload
         -&gt; Map LogSource Payload
         -&gt; IO (Either SomeException Payload)))
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowQueryHandlers"><span class="hs-identifier hs-var hs-var">workflowQueryHandlers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Common.html#QueryId"><span class="hs-identifier hs-type">QueryId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workflowCallStack"><span class="annot"><span class="annottext">WorkflowInstance -&gt; IORef CallStack
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowCallStack"><span class="hs-identifier hs-var hs-var">workflowCallStack</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CallStack</span></span><span class="hs-special">)</span><span>
</span><span id="line-680"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workflowCompleteActivation"><span class="annot"><span class="annottext">WorkflowInstance
-&gt; WorkflowActivationCompletion -&gt; IO (Either WorkerError ())
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowCompleteActivation"><span class="hs-identifier hs-var hs-var">workflowCompleteActivation</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Core.WorkflowActivationCompletion</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Core.WorkerError</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workflowInstanceContinuationEnv"><span class="annot"><span class="annottext">WorkflowInstance -&gt; ContinuationEnv
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowInstanceContinuationEnv"><span class="hs-identifier hs-var hs-var">workflowInstanceContinuationEnv</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ContinuationEnv"><span class="hs-identifier hs-type">ContinuationEnv</span></a></span><span>
</span><span id="line-682"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workflowCancellationVar"><span class="annot"><span class="annottext">WorkflowInstance -&gt; IVar ()
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowCancellationVar"><span class="hs-identifier hs-var hs-var">workflowCancellationVar</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-683"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workflowDeadlockTimeout"><span class="annot"><span class="annottext">WorkflowInstance -&gt; Maybe Int
</span><a href="Temporal.Workflow.Internal.Monad.html#workflowDeadlockTimeout"><span class="hs-identifier hs-var hs-var">workflowDeadlockTimeout</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-684"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- These are how the instance gets its work done</span><span>
</span><span id="line-685"></span><span>    </span><span id="activationChannel"><span class="annot"><span class="annottext">WorkflowInstance -&gt; TQueue WorkflowActivation
</span><a href="Temporal.Workflow.Internal.Monad.html#activationChannel"><span class="hs-identifier hs-var hs-var">activationChannel</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TQueue</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Core.WorkflowActivation</span></span><span class="hs-special">)</span><span>
</span><span id="line-686"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="executionThread"><span class="annot"><span class="annottext">WorkflowInstance -&gt; IORef (Async ())
</span><a href="Temporal.Workflow.Internal.Monad.html#executionThread"><span class="hs-identifier hs-var hs-var">executionThread</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Async</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-687"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="inboundInterceptor"><span class="annot"><span class="annottext">WorkflowInstance -&gt; WorkflowInboundInterceptor
</span><a href="Temporal.Workflow.Internal.Monad.html#inboundInterceptor"><span class="hs-identifier hs-var hs-var">inboundInterceptor</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowInboundInterceptor"><span class="hs-identifier hs-type">WorkflowInboundInterceptor</span></a></span><span>
</span><span id="line-688"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="outboundInterceptor"><span class="annot"><span class="annottext">WorkflowInstance -&gt; WorkflowOutboundInterceptor
</span><a href="Temporal.Workflow.Internal.Monad.html#outboundInterceptor"><span class="hs-identifier hs-var hs-var">outboundInterceptor</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowOutboundInterceptor"><span class="hs-identifier hs-type">WorkflowOutboundInterceptor</span></a></span><span>
</span><span id="line-689"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Improves error reporting</span><span>
</span><span id="line-690"></span><span>    </span><span id="errorConverters"><span class="annot"><span class="annottext">WorkflowInstance -&gt; [ApplicationFailureHandler]
</span><a href="Temporal.Workflow.Internal.Monad.html#errorConverters"><span class="hs-identifier hs-var hs-var">errorConverters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Temporal.Exception.html#ApplicationFailureHandler"><span class="hs-identifier hs-type">ApplicationFailureHandler</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-691"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="payloadProcessor"><span class="annot"><span class="annottext">WorkflowInstance -&gt; PayloadProcessor
</span><a href="Temporal.Workflow.Internal.Monad.html#payloadProcessor"><span class="hs-identifier hs-var hs-var">payloadProcessor</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Temporal.Payload.html#PayloadProcessor"><span class="hs-identifier hs-type">PayloadProcessor</span></a></span><span>
</span><span id="line-692"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-693"></span><span>
</span><span id="line-694"></span><span>
</span><span id="line-695"></span><span class="hs-keyword">data</span><span> </span><span id="SomeChildWorkflowHandle"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#SomeChildWorkflowHandle"><span class="hs-identifier hs-var">SomeChildWorkflowHandle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680172336"><span class="annot"><a href="#local-6989586621680172336"><span class="hs-identifier hs-type">result</span></a></span></span><span class="hs-operator">.</span><span> </span><span id="SomeChildWorkflowHandle"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#SomeChildWorkflowHandle"><span class="hs-identifier hs-var">SomeChildWorkflowHandle</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ChildWorkflowHandle"><span class="hs-identifier hs-type">ChildWorkflowHandle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680172336"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-696"></span><span>
</span><span id="line-697"></span><span>
</span><span id="line-698"></span><span class="hs-keyword">type</span><span> </span><span id="SequenceMap"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#SequenceMap"><span class="hs-identifier hs-var">SequenceMap</span></a></span></span><span> </span><span id="local-6989586621680172338"><span class="annot"><a href="#local-6989586621680172338"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#Sequence"><span class="hs-identifier hs-type">Sequence</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680172338"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span class="hs-keyword">data</span><span> </span><span id="Sequences"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Sequences"><span class="hs-identifier hs-var">Sequences</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Sequences"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Sequences"><span class="hs-identifier hs-var">Sequences</span></a></span></span><span>
</span><span id="line-702"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="externalCancel"><span class="annot"><span class="annottext">Sequences -&gt; Word32
</span><a href="Temporal.Workflow.Internal.Monad.html#externalCancel"><span class="hs-identifier hs-var hs-var">externalCancel</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span>
</span><span id="line-703"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="childWorkflow"><span class="annot"><span class="annottext">Sequences -&gt; Word32
</span><a href="Temporal.Workflow.Internal.Monad.html#childWorkflow"><span class="hs-identifier hs-var hs-var">childWorkflow</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span>
</span><span id="line-704"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="externalSignal"><span class="annot"><span class="annottext">Sequences -&gt; Word32
</span><a href="Temporal.Workflow.Internal.Monad.html#externalSignal"><span class="hs-identifier hs-var hs-var">externalSignal</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span>
</span><span id="line-705"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="timer"><span class="annot"><span class="annottext">Sequences -&gt; Word32
</span><a href="Temporal.Workflow.Internal.Monad.html#timer"><span class="hs-identifier hs-var hs-var">timer</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span>
</span><span id="line-706"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="activity"><span class="annot"><span class="annottext">Sequences -&gt; Word32
</span><a href="Temporal.Workflow.Internal.Monad.html#activity"><span class="hs-identifier hs-var hs-var">activity</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span>
</span><span id="line-707"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="condition"><span class="annot"><span class="annottext">Sequences -&gt; Word32
</span><a href="Temporal.Workflow.Internal.Monad.html#condition"><span class="hs-identifier hs-var hs-var">condition</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span>
</span><span id="line-708"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="varId"><span class="annot"><span class="annottext">Sequences -&gt; Word32
</span><a href="Temporal.Workflow.Internal.Monad.html#varId"><span class="hs-identifier hs-var hs-var">varId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span>
</span><span id="line-709"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-710"></span><span>
</span><span id="line-711"></span><span>
</span><span id="line-712"></span><span class="hs-comment">-- Newtyped because the list is reversed</span><span>
</span><span id="line-713"></span><span class="hs-keyword">newtype</span><span> </span><span id="Reversed"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Reversed"><span class="hs-identifier hs-var">Reversed</span></a></span></span><span> </span><span id="local-6989586621680171158"><span class="annot"><a href="#local-6989586621680171158"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Reversed"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Reversed"><span class="hs-identifier hs-var">Reversed</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680171158"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-714"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680172349"><span id="local-6989586621680172354"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; Reversed a -&gt; Reversed b)
-&gt; (forall a b. a -&gt; Reversed b -&gt; Reversed a) -&gt; Functor Reversed
forall a b. a -&gt; Reversed b -&gt; Reversed a
forall a b. (a -&gt; b) -&gt; Reversed a -&gt; Reversed b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; Reversed a -&gt; Reversed b
fmap :: forall a b. (a -&gt; b) -&gt; Reversed a -&gt; Reversed b
$c&lt;$ :: forall a b. a -&gt; Reversed b -&gt; Reversed a
&lt;$ :: forall a b. a -&gt; Reversed b -&gt; Reversed a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680172360"><span id="local-6989586621680172365"><span id="local-6989586621680172369"><span class="annot"><span class="annottext">Int -&gt; Reversed a -&gt; ShowS
[Reversed a] -&gt; ShowS
Reversed a -&gt; String
(Int -&gt; Reversed a -&gt; ShowS)
-&gt; (Reversed a -&gt; String)
-&gt; ([Reversed a] -&gt; ShowS)
-&gt; Show (Reversed a)
forall a. Show a =&gt; Int -&gt; Reversed a -&gt; ShowS
forall a. Show a =&gt; [Reversed a] -&gt; ShowS
forall a. Show a =&gt; Reversed a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; Reversed a -&gt; ShowS
showsPrec :: Int -&gt; Reversed a -&gt; ShowS
$cshow :: forall a. Show a =&gt; Reversed a -&gt; String
show :: Reversed a -&gt; String
$cshowList :: forall a. Show a =&gt; [Reversed a] -&gt; ShowS
showList :: [Reversed a] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680172377"><span id="local-6989586621680172382"><span class="annot"><span class="annottext">Reversed a -&gt; Reversed a -&gt; Bool
(Reversed a -&gt; Reversed a -&gt; Bool)
-&gt; (Reversed a -&gt; Reversed a -&gt; Bool) -&gt; Eq (Reversed a)
forall a. Eq a =&gt; Reversed a -&gt; Reversed a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall a. Eq a =&gt; Reversed a -&gt; Reversed a -&gt; Bool
== :: Reversed a -&gt; Reversed a -&gt; Bool
$c/= :: forall a. Eq a =&gt; Reversed a -&gt; Reversed a -&gt; Bool
/= :: Reversed a -&gt; Reversed a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span>
</span><span id="line-717"></span><span id="local-6989586621680171154"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#fromReversed"><span class="hs-identifier hs-type">fromReversed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Reversed"><span class="hs-identifier hs-type">Reversed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171154"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680171154"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-718"></span><span id="fromReversed"><span class="annot"><span class="annottext">fromReversed :: forall a. Reversed a -&gt; [a]
</span><a href="Temporal.Workflow.Internal.Monad.html#fromReversed"><span class="hs-identifier hs-var hs-var">fromReversed</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Reversed"><span class="hs-identifier hs-type">Reversed</span></a></span><span> </span><span id="local-6989586621680172388"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680172388"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680172388"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span>
</span><span id="line-721"></span><span id="local-6989586621680170727"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#push"><span class="hs-identifier hs-type">push</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680170727"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Reversed"><span class="hs-identifier hs-type">Reversed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170727"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Reversed"><span class="hs-identifier hs-type">Reversed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680170727"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-722"></span><span id="push"><span class="annot"><span class="annottext">push :: forall a. a -&gt; Reversed a -&gt; Reversed a
</span><a href="Temporal.Workflow.Internal.Monad.html#push"><span class="hs-identifier hs-var hs-var">push</span></a></span></span><span> </span><span id="local-6989586621680172390"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680172390"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Reversed"><span class="hs-identifier hs-type">Reversed</span></a></span><span> </span><span id="local-6989586621680172391"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680172391"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Reversed a
forall a. [a] -&gt; Reversed a
</span><a href="Temporal.Workflow.Internal.Monad.html#Reversed"><span class="hs-identifier hs-var">Reversed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680172390"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680172391"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-723"></span><span>
</span><span id="line-724"></span><span>
</span><span id="line-725"></span><span class="hs-keyword">data</span><span> </span><span id="SequenceMaps"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#SequenceMaps"><span class="hs-identifier hs-var">SequenceMaps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SequenceMaps"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#SequenceMaps"><span class="hs-identifier hs-var">SequenceMaps</span></a></span></span><span>
</span><span id="line-726"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="timers"><span class="annot"><span class="annottext">SequenceMaps -&gt; SequenceMap (IVar ())
</span><a href="Temporal.Workflow.Internal.Monad.html#timers"><span class="hs-identifier hs-var hs-var">timers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#SequenceMap"><span class="hs-identifier hs-type">SequenceMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-727"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="activities"><span class="annot"><span class="annottext">SequenceMaps -&gt; SequenceMap (IVar ResolveActivity)
</span><a href="Temporal.Workflow.Internal.Monad.html#activities"><span class="hs-identifier hs-var hs-var">activities</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#SequenceMap"><span class="hs-identifier hs-type">SequenceMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ResolveActivity</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-728"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="childWorkflows"><span class="annot"><span class="annottext">SequenceMaps -&gt; SequenceMap SomeChildWorkflowHandle
</span><a href="Temporal.Workflow.Internal.Monad.html#childWorkflows"><span class="hs-identifier hs-var hs-var">childWorkflows</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#SequenceMap"><span class="hs-identifier hs-type">SequenceMap</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#SomeChildWorkflowHandle"><span class="hs-identifier hs-type">SomeChildWorkflowHandle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-729"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="externalSignals"><span class="annot"><span class="annottext">SequenceMaps -&gt; SequenceMap (IVar ResolveSignalExternalWorkflow)
</span><a href="Temporal.Workflow.Internal.Monad.html#externalSignals"><span class="hs-identifier hs-var hs-var">externalSignals</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#SequenceMap"><span class="hs-identifier hs-type">SequenceMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ResolveSignalExternalWorkflow</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-730"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="externalCancels"><span class="annot"><span class="annottext">SequenceMaps
-&gt; SequenceMap (IVar ResolveRequestCancelExternalWorkflow)
</span><a href="Temporal.Workflow.Internal.Monad.html#externalCancels"><span class="hs-identifier hs-var hs-var">externalCancels</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#SequenceMap"><span class="hs-identifier hs-type">SequenceMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ResolveRequestCancelExternalWorkflow</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-731"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="conditionsAwaitingSignal"><span class="annot"><span class="annottext">SequenceMaps -&gt; HashMap Sequence (IVar (), Set Sequence)
</span><a href="Temporal.Workflow.Internal.Monad.html#conditionsAwaitingSignal"><span class="hs-identifier hs-var hs-var">conditionsAwaitingSignal</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#SequenceMap"><span class="hs-identifier hs-type">SequenceMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#Sequence"><span class="hs-identifier hs-type">Sequence</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-732"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span>
</span><span id="line-735"></span><span class="annot"><span class="hs-comment">-- | An async action handle that can be awaited or cancelled.</span></span><span>
</span><span id="line-736"></span><span class="hs-keyword">data</span><span> </span><span id="Task"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-var">Task</span></a></span></span><span> </span><span id="local-6989586621680171164"><span class="annot"><a href="#local-6989586621680171164"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Task"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-var">Task</span></a></span></span><span>
</span><span id="line-737"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="waitAction"><span class="annot"><span class="annottext">forall a. Task a -&gt; Workflow a
</span><a href="Temporal.Workflow.Internal.Monad.html#waitAction"><span class="hs-identifier hs-var hs-var">waitAction</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171164"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-738"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="cancelAction"><span class="annot"><span class="annottext">forall a. Task a -&gt; Workflow ()
</span><a href="Temporal.Workflow.Internal.Monad.html#cancelAction"><span class="hs-identifier hs-var hs-var">cancelAction</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-739"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-740"></span><span>
</span><span id="line-741"></span><span>
</span><span id="line-742"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680172403"><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-743"></span><span>  </span><span id="local-6989586621680172407"><span class="annot"><span class="annottext">fmap :: forall a b. (a -&gt; b) -&gt; Task a -&gt; Task b
</span><span class="hs-identifier hs-var hs-var hs-var">fmap</span></span></span><span> </span><span id="local-6989586621680172408"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680172408"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span id="local-6989586621680172409"><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680172409"><span class="hs-identifier hs-var">wait'</span></a></span></span><span> </span><span id="local-6989586621680172410"><span class="annot"><span class="annottext">Workflow ()
</span><a href="#local-6989586621680172410"><span class="hs-identifier hs-var">cancel'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Workflow b -&gt; Workflow () -&gt; Task b
forall a. Workflow a -&gt; Workflow () -&gt; Task a
</span><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-var">Task</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Workflow a -&gt; Workflow b
forall a b. (a -&gt; b) -&gt; Workflow a -&gt; Workflow b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680172408"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680172409"><span class="hs-identifier hs-var">wait'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Workflow ()
</span><a href="#local-6989586621680172410"><span class="hs-identifier hs-var">cancel'</span></a></span><span>
</span><span id="line-744"></span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680172416"><span id="local-6989586621680172420"><span id="local-6989586621680172423"><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-747"></span><span>  </span><span id="local-6989586621680172427"><span class="annot"><span class="annottext">pure :: forall a. a -&gt; Task a
</span><span class="hs-identifier hs-var hs-var hs-var">pure</span></span></span><span> </span><span id="local-6989586621680172428"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680172428"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Workflow a -&gt; Workflow () -&gt; Task a
forall a. Workflow a -&gt; Workflow () -&gt; Task a
</span><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-var">Task</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Workflow a
forall a. a -&gt; Workflow a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680172428"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; Workflow ()
forall a. a -&gt; Workflow a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-748"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span id="local-6989586621680172431"><span class="annot"><span class="annottext">Workflow (a -&gt; b)
</span><a href="#local-6989586621680172431"><span class="hs-identifier hs-var">waitL</span></a></span></span><span> </span><span id="local-6989586621680172432"><span class="annot"><span class="annottext">Workflow ()
</span><a href="#local-6989586621680172432"><span class="hs-identifier hs-var">cancelL</span></a></span></span><span> </span><span id="local-6989586621680172433"><span class="annot"><span class="annottext">&lt;*&gt; :: forall a b. Task (a -&gt; b) -&gt; Task a -&gt; Task b
</span><span class="hs-operator hs-var hs-var hs-var">&lt;*&gt;</span></span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span id="local-6989586621680172434"><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680172434"><span class="hs-identifier hs-var">waitR</span></a></span></span><span> </span><span id="local-6989586621680172435"><span class="annot"><span class="annottext">Workflow ()
</span><a href="#local-6989586621680172435"><span class="hs-identifier hs-var">cancelR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Workflow b -&gt; Workflow () -&gt; Task b
forall a. Workflow a -&gt; Workflow () -&gt; Task a
</span><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-var">Task</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Workflow (a -&gt; b)
</span><a href="#local-6989586621680172431"><span class="hs-identifier hs-var">waitL</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow (a -&gt; b) -&gt; Workflow a -&gt; Workflow b
forall a b. Workflow (a -&gt; b) -&gt; Workflow a -&gt; Workflow b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680172434"><span class="hs-identifier hs-var">waitR</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Workflow ()
</span><a href="#local-6989586621680172432"><span class="hs-identifier hs-var">cancelL</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow () -&gt; Workflow () -&gt; Workflow ()
forall a b. Workflow a -&gt; Workflow b -&gt; Workflow b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Workflow ()
</span><a href="#local-6989586621680172435"><span class="hs-identifier hs-var">cancelR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-749"></span><span>
</span><span id="line-750"></span><span>
</span><span id="line-751"></span><span class="annot"><span class="hs-comment">{- | Sometimes you want to alter the result of a task, but you 'Task' doesn't work as
a monad due to the 'cancel' action. This function lets you alter the result of a task
in the workflow monad.
-}</span></span><span>
</span><span id="line-755"></span><span id="local-6989586621680171173"><span id="local-6989586621680171174"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#bindTask"><span class="hs-identifier hs-type">bindTask</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171173"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680171173"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Workflow"><span class="hs-identifier hs-type">Workflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171174"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171174"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-756"></span><span id="bindTask"><span class="annot"><span class="annottext">bindTask :: forall a b. Task a -&gt; (a -&gt; Workflow b) -&gt; Task b
</span><a href="Temporal.Workflow.Internal.Monad.html#bindTask"><span class="hs-identifier hs-var hs-var">bindTask</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span id="local-6989586621680172440"><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680172440"><span class="hs-identifier hs-var">wait'</span></a></span></span><span> </span><span id="local-6989586621680172441"><span class="annot"><span class="annottext">Workflow ()
</span><a href="#local-6989586621680172441"><span class="hs-identifier hs-var">cancel'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680172442"><span class="annot"><span class="annottext">a -&gt; Workflow b
</span><a href="#local-6989586621680172442"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Workflow b -&gt; Workflow () -&gt; Task b
forall a. Workflow a -&gt; Workflow () -&gt; Task a
</span><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-var">Task</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Workflow a
</span><a href="#local-6989586621680172440"><span class="hs-identifier hs-var">wait'</span></a></span><span> </span><span class="annot"><span class="annottext">Workflow a -&gt; (a -&gt; Workflow b) -&gt; Workflow b
forall a b. Workflow a -&gt; (a -&gt; Workflow b) -&gt; Workflow b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Workflow b
</span><a href="#local-6989586621680172442"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Workflow ()
</span><a href="#local-6989586621680172441"><span class="hs-identifier hs-var">cancel'</span></a></span><span>
</span><span id="line-757"></span><span>
</span><span id="line-758"></span><span>
</span><span id="line-759"></span><span class="annot"><span class="hs-comment">{- | Handle representing an external Workflow Execution.

This handle can only be cancelled and signalled.

To call other methods, like query and result, use a WorkflowClient.getHandle inside an Activity.
-}</span></span><span>
</span><span id="line-765"></span><span class="hs-keyword">data</span><span> </span><span id="ExternalWorkflowHandle"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ExternalWorkflowHandle"><span class="hs-identifier hs-var">ExternalWorkflowHandle</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680171177"><span class="annot"><a href="#local-6989586621680171177"><span class="hs-identifier hs-type">result</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ExternalWorkflowHandle"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ExternalWorkflowHandle"><span class="hs-identifier hs-var">ExternalWorkflowHandle</span></a></span></span><span>
</span><span id="line-766"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="externalWorkflowWorkflowId"><span class="annot"><span class="annottext">forall result. ExternalWorkflowHandle result -&gt; WorkflowId
</span><a href="Temporal.Workflow.Internal.Monad.html#externalWorkflowWorkflowId"><span class="hs-identifier hs-var hs-var">externalWorkflowWorkflowId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Common.html#WorkflowId"><span class="hs-identifier hs-type">WorkflowId</span></a></span><span>
</span><span id="line-767"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="externalWorkflowRunId"><span class="annot"><span class="annottext">forall result. ExternalWorkflowHandle result -&gt; Maybe RunId
</span><a href="Temporal.Workflow.Internal.Monad.html#externalWorkflowRunId"><span class="hs-identifier hs-var hs-var">externalWorkflowRunId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Temporal.Common.html#RunId"><span class="hs-identifier hs-type">RunId</span></a></span><span>
</span><span id="line-768"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-769"></span><span>
</span><span id="line-770"></span><span>
</span><span id="line-771"></span><span class="annot"><span class="hs-comment">{- | A client side handle to a single child Workflow instance.

It can be used to signal, wait for completion, and cancel the workflow.
-}</span></span><span>
</span><span id="line-775"></span><span class="hs-keyword">data</span><span> </span><span id="ChildWorkflowHandle"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ChildWorkflowHandle"><span class="hs-identifier hs-var">ChildWorkflowHandle</span></a></span></span><span> </span><span id="local-6989586621680171183"><span class="annot"><a href="#local-6989586621680171183"><span class="hs-identifier hs-type">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ChildWorkflowHandle"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ChildWorkflowHandle"><span class="hs-identifier hs-var">ChildWorkflowHandle</span></a></span></span><span>
</span><span id="line-776"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="childWorkflowSequence"><span class="annot"><span class="annottext">forall result. ChildWorkflowHandle result -&gt; Sequence
</span><a href="Temporal.Workflow.Internal.Monad.html#childWorkflowSequence"><span class="hs-identifier hs-var hs-var">childWorkflowSequence</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Common.html#Sequence"><span class="hs-identifier hs-type">Sequence</span></a></span><span>
</span><span id="line-777"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="startHandle"><span class="annot"><span class="annottext">forall result. ChildWorkflowHandle result -&gt; IVar ()
</span><a href="Temporal.Workflow.Internal.Monad.html#startHandle"><span class="hs-identifier hs-var hs-var">startHandle</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-778"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resultHandle"><span class="annot"><span class="annottext">forall result.
ChildWorkflowHandle result -&gt; IVar ResolveChildWorkflowExecution
</span><a href="Temporal.Workflow.Internal.Monad.html#resultHandle"><span class="hs-identifier hs-var hs-var">resultHandle</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ResolveChildWorkflowExecution</span></span><span>
</span><span id="line-779"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="childWorkflowResultConverter"><span class="annot"><span class="annottext">forall result. ChildWorkflowHandle result -&gt; Payload -&gt; IO result
</span><a href="Temporal.Workflow.Internal.Monad.html#childWorkflowResultConverter"><span class="hs-identifier hs-var hs-var">childWorkflowResultConverter</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680171183"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-780"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="childWorkflowId"><span class="annot"><span class="annottext">forall result. ChildWorkflowHandle result -&gt; WorkflowId
</span><a href="Temporal.Workflow.Internal.Monad.html#childWorkflowId"><span class="hs-identifier hs-var hs-var">childWorkflowId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Common.html#WorkflowId"><span class="hs-identifier hs-type">WorkflowId</span></a></span><span>
</span><span id="line-781"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="firstExecutionRunId"><span class="annot"><span class="annottext">forall result. ChildWorkflowHandle result -&gt; IVar RunId
</span><a href="Temporal.Workflow.Internal.Monad.html#firstExecutionRunId"><span class="hs-identifier hs-var hs-var">firstExecutionRunId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#IVar"><span class="hs-identifier hs-type">IVar</span></a></span><span> </span><span class="annot"><a href="Temporal.Common.html#RunId"><span class="hs-identifier hs-type">RunId</span></a></span><span>
</span><span id="line-782"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-783"></span><span>
</span><span id="line-784"></span><span>
</span><span id="line-785"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680172455"><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ChildWorkflowHandle"><span class="hs-identifier hs-type">ChildWorkflowHandle</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-786"></span><span>  </span><span id="local-6989586621680172459"><span class="annot"><span class="annottext">fmap :: forall a b.
(a -&gt; b) -&gt; ChildWorkflowHandle a -&gt; ChildWorkflowHandle b
</span><span class="hs-identifier hs-var hs-var hs-var">fmap</span></span></span><span> </span><span id="local-6989586621680172460"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621680172460"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680172461"><span class="annot"><span class="annottext">ChildWorkflowHandle a
</span><a href="#local-6989586621680172461"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChildWorkflowHandle a
</span><a href="#local-6989586621680172461"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#childWorkflowResultConverter"><span class="hs-identifier hs-var">childWorkflowResultConverter</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="#local-6989586621680172460"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#childWorkflowResultConverter"><span class="hs-identifier hs-var">childWorkflowResultConverter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680172461"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-787"></span><span>
</span><span id="line-788"></span><span>
</span><span id="line-789"></span><span class="annot"><span class="hs-comment">{- | This is only intended for use by interceptors. Normal workflow code should be able to use
the 'fmap' instance for simple transformations or else provide an appropriate codec.
-}</span></span><span>
</span><span id="line-792"></span><span id="local-6989586621680171194"><span id="local-6989586621680171195"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#interceptorConvertChildWorkflowHandle"><span class="hs-identifier hs-type">interceptorConvertChildWorkflowHandle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ChildWorkflowHandle"><span class="hs-identifier hs-type">ChildWorkflowHandle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171194"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680171194"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680171195"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ChildWorkflowHandle"><span class="hs-identifier hs-type">ChildWorkflowHandle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680171195"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-793"></span><span id="interceptorConvertChildWorkflowHandle"><span class="annot"><span class="annottext">interceptorConvertChildWorkflowHandle :: forall a b.
ChildWorkflowHandle a -&gt; (a -&gt; IO b) -&gt; ChildWorkflowHandle b
</span><a href="Temporal.Workflow.Internal.Monad.html#interceptorConvertChildWorkflowHandle"><span class="hs-identifier hs-var hs-var">interceptorConvertChildWorkflowHandle</span></a></span></span><span> </span><span id="local-6989586621680172464"><span class="annot"><span class="annottext">ChildWorkflowHandle a
</span><a href="#local-6989586621680172464"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621680172465"><span class="annot"><span class="annottext">a -&gt; IO b
</span><a href="#local-6989586621680172465"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-794"></span><span>  </span><span class="annot"><span class="annottext">ChildWorkflowHandle a
</span><a href="#local-6989586621680172464"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-795"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#childWorkflowResultConverter"><span class="hs-identifier hs-var">childWorkflowResultConverter</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#childWorkflowResultConverter"><span class="hs-identifier hs-var">childWorkflowResultConverter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680172464"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;=&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680172465"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-796"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-797"></span><span>
</span><span id="line-798"></span><span>
</span><span id="line-799"></span><span class="hs-keyword">data</span><span> </span><span id="ExecuteWorkflowInput"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ExecuteWorkflowInput"><span class="hs-identifier hs-var">ExecuteWorkflowInput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ExecuteWorkflowInput"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ExecuteWorkflowInput"><span class="hs-identifier hs-var">ExecuteWorkflowInput</span></a></span></span><span>
</span><span id="line-800"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="executeWorkflowInputType"><span class="annot"><span class="annottext">ExecuteWorkflowInput -&gt; LogSource
</span><a href="Temporal.Workflow.Internal.Monad.html#executeWorkflowInputType"><span class="hs-identifier hs-var hs-var">executeWorkflowInputType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-801"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="executeWorkflowInputArgs"><span class="annot"><span class="annottext">ExecuteWorkflowInput -&gt; Vector Payload
</span><a href="Temporal.Workflow.Internal.Monad.html#executeWorkflowInputArgs"><span class="hs-identifier hs-var hs-var">executeWorkflowInputArgs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span>
</span><span id="line-802"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="executeWorkflowInputHeaders"><span class="annot"><span class="annottext">ExecuteWorkflowInput -&gt; Map LogSource Payload
</span><a href="Temporal.Workflow.Internal.Monad.html#executeWorkflowInputHeaders"><span class="hs-identifier hs-var hs-var">executeWorkflowInputHeaders</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span>
</span><span id="line-803"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="executeWorkflowInputInfo"><span class="annot"><span class="annottext">ExecuteWorkflowInput -&gt; Info
</span><a href="Temporal.Workflow.Internal.Monad.html#executeWorkflowInputInfo"><span class="hs-identifier hs-var hs-var">executeWorkflowInputInfo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span>
</span><span id="line-804"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-805"></span><span>
</span><span id="line-806"></span><span>
</span><span id="line-807"></span><span class="hs-keyword">data</span><span> </span><span id="WorkflowExitVariant"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowExitVariant"><span class="hs-identifier hs-var">WorkflowExitVariant</span></a></span></span><span> </span><span id="local-6989586621680172471"><span class="annot"><a href="#local-6989586621680172471"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-808"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="WorkflowExitContinuedAsNew"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowExitContinuedAsNew"><span class="hs-identifier hs-var">WorkflowExitContinuedAsNew</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Exception.html#ContinueAsNewException"><span class="hs-identifier hs-type">ContinueAsNewException</span></a></span><span>
</span><span id="line-809"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="WorkflowExitCancelled"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowExitCancelled"><span class="hs-identifier hs-var">WorkflowExitCancelled</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Exception.html#WorkflowCancelRequested"><span class="hs-identifier hs-type">WorkflowCancelRequested</span></a></span><span>
</span><span id="line-810"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="WorkflowExitFailed"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowExitFailed"><span class="hs-identifier hs-var">WorkflowExitFailed</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span>
</span><span id="line-811"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="WorkflowExitSuccess"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowExitSuccess"><span class="hs-identifier hs-var">WorkflowExitSuccess</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621680172471"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-812"></span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span class="hs-keyword">data</span><span> </span><span id="HandleQueryInput"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#HandleQueryInput"><span class="hs-identifier hs-var">HandleQueryInput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HandleQueryInput"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#HandleQueryInput"><span class="hs-identifier hs-var">HandleQueryInput</span></a></span></span><span>
</span><span id="line-815"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="handleQueryId"><span class="annot"><span class="annottext">HandleQueryInput -&gt; LogSource
</span><a href="Temporal.Workflow.Internal.Monad.html#handleQueryId"><span class="hs-identifier hs-var hs-var">handleQueryId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-816"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="handleQueryInputType"><span class="annot"><span class="annottext">HandleQueryInput -&gt; LogSource
</span><a href="Temporal.Workflow.Internal.Monad.html#handleQueryInputType"><span class="hs-identifier hs-var hs-var">handleQueryInputType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-817"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="handleQueryInputArgs"><span class="annot"><span class="annottext">HandleQueryInput -&gt; Vector Payload
</span><a href="Temporal.Workflow.Internal.Monad.html#handleQueryInputArgs"><span class="hs-identifier hs-var hs-var">handleQueryInputArgs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span>
</span><span id="line-818"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="handleQueryInputHeaders"><span class="annot"><span class="annottext">HandleQueryInput -&gt; Map LogSource Payload
</span><a href="Temporal.Workflow.Internal.Monad.html#handleQueryInputHeaders"><span class="hs-identifier hs-var hs-var">handleQueryInputHeaders</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span>
</span><span id="line-819"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-820"></span><span>
</span><span id="line-821"></span><span>
</span><span id="line-822"></span><span class="hs-keyword">data</span><span> </span><span id="WorkflowInboundInterceptor"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowInboundInterceptor"><span class="hs-identifier hs-var">WorkflowInboundInterceptor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WorkflowInboundInterceptor"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowInboundInterceptor"><span class="hs-identifier hs-var">WorkflowInboundInterceptor</span></a></span></span><span>
</span><span id="line-823"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="executeWorkflow"><span class="annot"><span class="annottext">WorkflowInboundInterceptor
-&gt; ExecuteWorkflowInput
-&gt; (ExecuteWorkflowInput -&gt; IO (WorkflowExitVariant Payload))
-&gt; IO (WorkflowExitVariant Payload)
</span><a href="Temporal.Workflow.Internal.Monad.html#executeWorkflow"><span class="hs-identifier hs-var hs-var">executeWorkflow</span></a></span></span><span>
</span><span id="line-824"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ExecuteWorkflowInput"><span class="hs-identifier hs-type">ExecuteWorkflowInput</span></a></span><span>
</span><span id="line-825"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ExecuteWorkflowInput"><span class="hs-identifier hs-type">ExecuteWorkflowInput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowExitVariant"><span class="hs-identifier hs-type">WorkflowExitVariant</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-826"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowExitVariant"><span class="hs-identifier hs-type">WorkflowExitVariant</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-827"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="handleQuery"><span class="annot"><span class="annottext">WorkflowInboundInterceptor
-&gt; HandleQueryInput
-&gt; (HandleQueryInput -&gt; IO (Either SomeException Payload))
-&gt; IO (Either SomeException Payload)
</span><a href="Temporal.Workflow.Internal.Monad.html#handleQuery"><span class="hs-identifier hs-var hs-var">handleQuery</span></a></span></span><span>
</span><span id="line-828"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#HandleQueryInput"><span class="hs-identifier hs-type">HandleQueryInput</span></a></span><span>
</span><span id="line-829"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#HandleQueryInput"><span class="hs-identifier hs-type">HandleQueryInput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-830"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-831"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-832"></span><span>
</span><span id="line-833"></span><span>
</span><span id="line-834"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680172488"><span id="local-6989586621680172492"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowInboundInterceptor"><span class="hs-identifier hs-type">WorkflowInboundInterceptor</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-835"></span><span>  </span><span id="local-6989586621680172500"><span class="annot"><span class="annottext">WorkflowInboundInterceptor
</span><a href="#local-6989586621680172500"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680172501"><span class="annot"><span class="annottext">&lt;&gt; :: WorkflowInboundInterceptor
-&gt; WorkflowInboundInterceptor -&gt; WorkflowInboundInterceptor
</span><span class="hs-operator hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span id="local-6989586621680172502"><span class="annot"><span class="annottext">WorkflowInboundInterceptor
</span><a href="#local-6989586621680172502"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-836"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowInboundInterceptor"><span class="hs-identifier hs-type">WorkflowInboundInterceptor</span></a></span><span>
</span><span id="line-837"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">executeWorkflow :: ExecuteWorkflowInput
-&gt; (ExecuteWorkflowInput -&gt; IO (WorkflowExitVariant Payload))
-&gt; IO (WorkflowExitVariant Payload)
</span><a href="Temporal.Workflow.Internal.Monad.html#executeWorkflow"><span class="hs-identifier hs-var">executeWorkflow</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680172503"><span class="annot"><span class="annottext">ExecuteWorkflowInput
</span><a href="#local-6989586621680172503"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621680172504"><span class="annot"><span class="annottext">ExecuteWorkflowInput -&gt; IO (WorkflowExitVariant Payload)
</span><a href="#local-6989586621680172504"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkflowInboundInterceptor
</span><a href="#local-6989586621680172500"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">executeWorkflow</span><span> </span><span class="annot"><span class="annottext">ExecuteWorkflowInput
</span><a href="#local-6989586621680172503"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">((ExecuteWorkflowInput -&gt; IO (WorkflowExitVariant Payload))
 -&gt; IO (WorkflowExitVariant Payload))
-&gt; (ExecuteWorkflowInput -&gt; IO (WorkflowExitVariant Payload))
-&gt; IO (WorkflowExitVariant Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680172505"><span class="annot"><span class="annottext">ExecuteWorkflowInput
</span><a href="#local-6989586621680172505"><span class="hs-identifier hs-var">input'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkflowInboundInterceptor
</span><a href="#local-6989586621680172502"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">executeWorkflow</span><span> </span><span class="annot"><span class="annottext">ExecuteWorkflowInput
</span><a href="#local-6989586621680172505"><span class="hs-identifier hs-var">input'</span></a></span><span> </span><span class="annot"><span class="annottext">ExecuteWorkflowInput -&gt; IO (WorkflowExitVariant Payload)
</span><a href="#local-6989586621680172504"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-838"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">handleQuery :: HandleQueryInput
-&gt; (HandleQueryInput -&gt; IO (Either SomeException Payload))
-&gt; IO (Either SomeException Payload)
</span><a href="Temporal.Workflow.Internal.Monad.html#handleQuery"><span class="hs-identifier hs-var">handleQuery</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680172506"><span class="annot"><span class="annottext">HandleQueryInput
</span><a href="#local-6989586621680172506"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621680172507"><span class="annot"><span class="annottext">HandleQueryInput -&gt; IO (Either SomeException Payload)
</span><a href="#local-6989586621680172507"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkflowInboundInterceptor
</span><a href="#local-6989586621680172500"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">handleQuery</span><span> </span><span class="annot"><span class="annottext">HandleQueryInput
</span><a href="#local-6989586621680172506"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">((HandleQueryInput -&gt; IO (Either SomeException Payload))
 -&gt; IO (Either SomeException Payload))
-&gt; (HandleQueryInput -&gt; IO (Either SomeException Payload))
-&gt; IO (Either SomeException Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680172508"><span class="annot"><span class="annottext">HandleQueryInput
</span><a href="#local-6989586621680172508"><span class="hs-identifier hs-var">input'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkflowInboundInterceptor
</span><a href="#local-6989586621680172502"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">handleQuery</span><span> </span><span class="annot"><span class="annottext">HandleQueryInput
</span><a href="#local-6989586621680172508"><span class="hs-identifier hs-var">input'</span></a></span><span> </span><span class="annot"><span class="annottext">HandleQueryInput -&gt; IO (Either SomeException Payload)
</span><a href="#local-6989586621680172507"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-839"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-840"></span><span>
</span><span id="line-841"></span><span>
</span><span id="line-842"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680172513"><span id="local-6989586621680172517"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowInboundInterceptor"><span class="hs-identifier hs-type">WorkflowInboundInterceptor</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-843"></span><span>  </span><span id="local-6989586621680172519"><span class="annot"><span class="annottext">mempty :: WorkflowInboundInterceptor
</span><span class="hs-identifier hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-844"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowInboundInterceptor"><span class="hs-identifier hs-type">WorkflowInboundInterceptor</span></a></span><span>
</span><span id="line-845"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">executeWorkflow :: ExecuteWorkflowInput
-&gt; (ExecuteWorkflowInput -&gt; IO (WorkflowExitVariant Payload))
-&gt; IO (WorkflowExitVariant Payload)
</span><a href="Temporal.Workflow.Internal.Monad.html#executeWorkflow"><span class="hs-identifier hs-var">executeWorkflow</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680172520"><span class="annot"><span class="annottext">ExecuteWorkflowInput
</span><a href="#local-6989586621680172520"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621680172521"><span class="annot"><span class="annottext">ExecuteWorkflowInput -&gt; IO (WorkflowExitVariant Payload)
</span><a href="#local-6989586621680172521"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExecuteWorkflowInput -&gt; IO (WorkflowExitVariant Payload)
</span><a href="#local-6989586621680172521"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">ExecuteWorkflowInput
</span><a href="#local-6989586621680172520"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-846"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">handleQuery :: HandleQueryInput
-&gt; (HandleQueryInput -&gt; IO (Either SomeException Payload))
-&gt; IO (Either SomeException Payload)
</span><a href="Temporal.Workflow.Internal.Monad.html#handleQuery"><span class="hs-identifier hs-var">handleQuery</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680172522"><span class="annot"><span class="annottext">HandleQueryInput
</span><a href="#local-6989586621680172522"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621680172523"><span class="annot"><span class="annottext">HandleQueryInput -&gt; IO (Either SomeException Payload)
</span><a href="#local-6989586621680172523"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HandleQueryInput -&gt; IO (Either SomeException Payload)
</span><a href="#local-6989586621680172523"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">HandleQueryInput
</span><a href="#local-6989586621680172522"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-847"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-848"></span><span>
</span><span id="line-849"></span><span>
</span><span id="line-850"></span><span class="hs-keyword">data</span><span> </span><span id="ActivityInput"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ActivityInput"><span class="hs-identifier hs-var">ActivityInput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ActivityInput"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ActivityInput"><span class="hs-identifier hs-var">ActivityInput</span></a></span></span><span>
</span><span id="line-851"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="activityType"><span class="annot"><span class="annottext">ActivityInput -&gt; LogSource
</span><a href="Temporal.Workflow.Internal.Monad.html#activityType"><span class="hs-identifier hs-var hs-var">activityType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-852"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="args"><span class="annot"><span class="annottext">ActivityInput -&gt; Vector Payload
</span><a href="Temporal.Workflow.Internal.Monad.html#args"><span class="hs-identifier hs-var hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span>
</span><span id="line-853"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="options"><span class="annot"><span class="annottext">ActivityInput -&gt; StartActivityOptions
</span><a href="Temporal.Workflow.Internal.Monad.html#options"><span class="hs-identifier hs-var hs-var">options</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#StartActivityOptions"><span class="hs-identifier hs-type">StartActivityOptions</span></a></span><span>
</span><span id="line-854"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="seq"><span class="annot"><span class="annottext">ActivityInput -&gt; Sequence
</span><a href="Temporal.Workflow.Internal.Monad.html#seq"><span class="hs-identifier hs-var hs-var">seq</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Common.html#Sequence"><span class="hs-identifier hs-type">Sequence</span></a></span><span>
</span><span id="line-855"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-856"></span><span>
</span><span id="line-857"></span><span>
</span><span id="line-858"></span><span class="hs-keyword">data</span><span> </span><span id="WorkflowOutboundInterceptor"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowOutboundInterceptor"><span class="hs-identifier hs-var">WorkflowOutboundInterceptor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WorkflowOutboundInterceptor"><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowOutboundInterceptor"><span class="hs-identifier hs-var">WorkflowOutboundInterceptor</span></a></span></span><span>
</span><span id="line-859"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="scheduleActivity"><span class="annot"><span class="annottext">WorkflowOutboundInterceptor
-&gt; ActivityInput
-&gt; (ActivityInput -&gt; IO (Task Payload))
-&gt; IO (Task Payload)
</span><a href="Temporal.Workflow.Internal.Monad.html#scheduleActivity"><span class="hs-identifier hs-var hs-var">scheduleActivity</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ActivityInput"><span class="hs-identifier hs-type">ActivityInput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ActivityInput"><span class="hs-identifier hs-type">ActivityInput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-860"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="startChildWorkflowExecution"><span class="annot"><span class="annottext">WorkflowOutboundInterceptor
-&gt; LogSource
-&gt; StartChildWorkflowOptions
-&gt; (LogSource
    -&gt; StartChildWorkflowOptions -&gt; IO (ChildWorkflowHandle Payload))
-&gt; IO (ChildWorkflowHandle Payload)
</span><a href="Temporal.Workflow.Internal.Monad.html#startChildWorkflowExecution"><span class="hs-identifier hs-var hs-var">startChildWorkflowExecution</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#StartChildWorkflowOptions"><span class="hs-identifier hs-type">StartChildWorkflowOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#StartChildWorkflowOptions"><span class="hs-identifier hs-type">StartChildWorkflowOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ChildWorkflowHandle"><span class="hs-identifier hs-type">ChildWorkflowHandle</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#ChildWorkflowHandle"><span class="hs-identifier hs-type">ChildWorkflowHandle</span></a></span><span> </span><span class="annot"><a href="Temporal.Payload.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-861"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="continueAsNew"><span class="annot"><span class="annottext">WorkflowOutboundInterceptor
-&gt; forall a.
   LogSource
   -&gt; ContinueAsNewOptions
   -&gt; (LogSource -&gt; ContinueAsNewOptions -&gt; IO a)
   -&gt; IO a
</span><a href="Temporal.Workflow.Internal.Monad.html#continueAsNew"><span class="hs-identifier hs-var hs-var">continueAsNew</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680171206"><span class="annot"><a href="#local-6989586621680171206"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#ContinueAsNewOptions"><span class="hs-identifier hs-type">ContinueAsNewOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Workflow.Types.html#ContinueAsNewOptions"><span class="hs-identifier hs-type">ContinueAsNewOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680171206"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680171206"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-862"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-863"></span><span>
</span><span id="line-864"></span><span>
</span><span id="line-865"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680172535"><span id="local-6989586621680172539"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowOutboundInterceptor"><span class="hs-identifier hs-type">WorkflowOutboundInterceptor</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-866"></span><span>  </span><span id="local-6989586621680172543"><span class="annot"><span class="annottext">WorkflowOutboundInterceptor
</span><a href="#local-6989586621680172543"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621680172544"><span class="annot"><span class="annottext">&lt;&gt; :: WorkflowOutboundInterceptor
-&gt; WorkflowOutboundInterceptor -&gt; WorkflowOutboundInterceptor
</span><span class="hs-operator hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span id="local-6989586621680172545"><span class="annot"><span class="annottext">WorkflowOutboundInterceptor
</span><a href="#local-6989586621680172545"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-867"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowOutboundInterceptor"><span class="hs-identifier hs-type">WorkflowOutboundInterceptor</span></a></span><span>
</span><span id="line-868"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scheduleActivity :: ActivityInput
-&gt; (ActivityInput -&gt; IO (Task Payload)) -&gt; IO (Task Payload)
</span><a href="Temporal.Workflow.Internal.Monad.html#scheduleActivity"><span class="hs-identifier hs-var">scheduleActivity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680172546"><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680172546"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621680172547"><span class="annot"><span class="annottext">ActivityInput -&gt; IO (Task Payload)
</span><a href="#local-6989586621680172547"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkflowOutboundInterceptor
-&gt; ActivityInput
-&gt; (ActivityInput -&gt; IO (Task Payload))
-&gt; IO (Task Payload)
</span><a href="Temporal.Workflow.Internal.Monad.html#scheduleActivity"><span class="hs-identifier hs-var">scheduleActivity</span></a></span><span> </span><span class="annot"><span class="annottext">WorkflowOutboundInterceptor
</span><a href="#local-6989586621680172543"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680172546"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">((ActivityInput -&gt; IO (Task Payload)) -&gt; IO (Task Payload))
-&gt; (ActivityInput -&gt; IO (Task Payload)) -&gt; IO (Task Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680172548"><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680172548"><span class="hs-identifier hs-var">input'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkflowOutboundInterceptor
-&gt; ActivityInput
-&gt; (ActivityInput -&gt; IO (Task Payload))
-&gt; IO (Task Payload)
</span><a href="Temporal.Workflow.Internal.Monad.html#scheduleActivity"><span class="hs-identifier hs-var">scheduleActivity</span></a></span><span> </span><span class="annot"><span class="annottext">WorkflowOutboundInterceptor
</span><a href="#local-6989586621680172545"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680172548"><span class="hs-identifier hs-var">input'</span></a></span><span> </span><span class="annot"><span class="annottext">ActivityInput -&gt; IO (Task Payload)
</span><a href="#local-6989586621680172547"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-869"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">startChildWorkflowExecution :: LogSource
-&gt; StartChildWorkflowOptions
-&gt; (LogSource
    -&gt; StartChildWorkflowOptions -&gt; IO (ChildWorkflowHandle Payload))
-&gt; IO (ChildWorkflowHandle Payload)
</span><a href="Temporal.Workflow.Internal.Monad.html#startChildWorkflowExecution"><span class="hs-identifier hs-var">startChildWorkflowExecution</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680172549"><span class="annot"><span class="annottext">LogSource
</span><a href="#local-6989586621680172549"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680172550"><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680172550"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621680172551"><span class="annot"><span class="annottext">LogSource
-&gt; StartChildWorkflowOptions -&gt; IO (ChildWorkflowHandle Payload)
</span><a href="#local-6989586621680172551"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkflowOutboundInterceptor
-&gt; LogSource
-&gt; StartChildWorkflowOptions
-&gt; (LogSource
    -&gt; StartChildWorkflowOptions -&gt; IO (ChildWorkflowHandle Payload))
-&gt; IO (ChildWorkflowHandle Payload)
</span><a href="Temporal.Workflow.Internal.Monad.html#startChildWorkflowExecution"><span class="hs-identifier hs-var">startChildWorkflowExecution</span></a></span><span> </span><span class="annot"><span class="annottext">WorkflowOutboundInterceptor
</span><a href="#local-6989586621680172543"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">LogSource
</span><a href="#local-6989586621680172549"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680172550"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">((LogSource
  -&gt; StartChildWorkflowOptions -&gt; IO (ChildWorkflowHandle Payload))
 -&gt; IO (ChildWorkflowHandle Payload))
-&gt; (LogSource
    -&gt; StartChildWorkflowOptions -&gt; IO (ChildWorkflowHandle Payload))
-&gt; IO (ChildWorkflowHandle Payload)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680172552"><span class="annot"><span class="annottext">LogSource
</span><a href="#local-6989586621680172552"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span id="local-6989586621680172553"><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680172553"><span class="hs-identifier hs-var">input'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkflowOutboundInterceptor
-&gt; LogSource
-&gt; StartChildWorkflowOptions
-&gt; (LogSource
    -&gt; StartChildWorkflowOptions -&gt; IO (ChildWorkflowHandle Payload))
-&gt; IO (ChildWorkflowHandle Payload)
</span><a href="Temporal.Workflow.Internal.Monad.html#startChildWorkflowExecution"><span class="hs-identifier hs-var">startChildWorkflowExecution</span></a></span><span> </span><span class="annot"><span class="annottext">WorkflowOutboundInterceptor
</span><a href="#local-6989586621680172545"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">LogSource
</span><a href="#local-6989586621680172552"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680172553"><span class="hs-identifier hs-var">input'</span></a></span><span> </span><span class="annot"><span class="annottext">LogSource
-&gt; StartChildWorkflowOptions -&gt; IO (ChildWorkflowHandle Payload)
</span><a href="#local-6989586621680172551"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-870"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">continueAsNew :: forall a.
LogSource
-&gt; ContinueAsNewOptions
-&gt; (LogSource -&gt; ContinueAsNewOptions -&gt; IO a)
-&gt; IO a
</span><a href="Temporal.Workflow.Internal.Monad.html#continueAsNew"><span class="hs-identifier hs-var">continueAsNew</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680172554"><span class="annot"><span class="annottext">LogSource
</span><a href="#local-6989586621680172554"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680172555"><span class="annot"><span class="annottext">ContinueAsNewOptions
</span><a href="#local-6989586621680172555"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621680172556"><span class="annot"><span class="annottext">LogSource -&gt; ContinueAsNewOptions -&gt; IO a
</span><a href="#local-6989586621680172556"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkflowOutboundInterceptor
-&gt; forall a.
   LogSource
   -&gt; ContinueAsNewOptions
   -&gt; (LogSource -&gt; ContinueAsNewOptions -&gt; IO a)
   -&gt; IO a
</span><a href="Temporal.Workflow.Internal.Monad.html#continueAsNew"><span class="hs-identifier hs-var">continueAsNew</span></a></span><span> </span><span class="annot"><span class="annottext">WorkflowOutboundInterceptor
</span><a href="#local-6989586621680172543"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">LogSource
</span><a href="#local-6989586621680172554"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ContinueAsNewOptions
</span><a href="#local-6989586621680172555"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">((LogSource -&gt; ContinueAsNewOptions -&gt; IO a) -&gt; IO a)
-&gt; (LogSource -&gt; ContinueAsNewOptions -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680172557"><span class="annot"><span class="annottext">LogSource
</span><a href="#local-6989586621680172557"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621680172558"><span class="annot"><span class="annottext">ContinueAsNewOptions
</span><a href="#local-6989586621680172558"><span class="hs-identifier hs-var">input'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkflowOutboundInterceptor
-&gt; forall a.
   LogSource
   -&gt; ContinueAsNewOptions
   -&gt; (LogSource -&gt; ContinueAsNewOptions -&gt; IO a)
   -&gt; IO a
</span><a href="Temporal.Workflow.Internal.Monad.html#continueAsNew"><span class="hs-identifier hs-var">continueAsNew</span></a></span><span> </span><span class="annot"><span class="annottext">WorkflowOutboundInterceptor
</span><a href="#local-6989586621680172545"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">LogSource
</span><a href="#local-6989586621680172557"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">ContinueAsNewOptions
</span><a href="#local-6989586621680172558"><span class="hs-identifier hs-var">input'</span></a></span><span> </span><span class="annot"><span class="annottext">LogSource -&gt; ContinueAsNewOptions -&gt; IO a
</span><a href="#local-6989586621680172556"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-871"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-872"></span><span>
</span><span id="line-873"></span><span>
</span><span id="line-874"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680172563"><span id="local-6989586621680172567"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowOutboundInterceptor"><span class="hs-identifier hs-type">WorkflowOutboundInterceptor</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-875"></span><span>  </span><span id="local-6989586621680172569"><span class="annot"><span class="annottext">mempty :: WorkflowOutboundInterceptor
</span><span class="hs-identifier hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-876"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#WorkflowOutboundInterceptor"><span class="hs-identifier hs-type">WorkflowOutboundInterceptor</span></a></span><span>
</span><span id="line-877"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scheduleActivity :: ActivityInput
-&gt; (ActivityInput -&gt; IO (Task Payload)) -&gt; IO (Task Payload)
</span><a href="Temporal.Workflow.Internal.Monad.html#scheduleActivity"><span class="hs-identifier hs-var">scheduleActivity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680172570"><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680172570"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621680172571"><span class="annot"><span class="annottext">ActivityInput -&gt; IO (Task Payload)
</span><a href="#local-6989586621680172571"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ActivityInput -&gt; IO (Task Payload)
</span><a href="#local-6989586621680172571"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">ActivityInput
</span><a href="#local-6989586621680172570"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-878"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">startChildWorkflowExecution :: LogSource
-&gt; StartChildWorkflowOptions
-&gt; (LogSource
    -&gt; StartChildWorkflowOptions -&gt; IO (ChildWorkflowHandle Payload))
-&gt; IO (ChildWorkflowHandle Payload)
</span><a href="Temporal.Workflow.Internal.Monad.html#startChildWorkflowExecution"><span class="hs-identifier hs-var">startChildWorkflowExecution</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680172572"><span class="annot"><span class="annottext">LogSource
</span><a href="#local-6989586621680172572"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680172573"><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680172573"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621680172574"><span class="annot"><span class="annottext">LogSource
-&gt; StartChildWorkflowOptions -&gt; IO (ChildWorkflowHandle Payload)
</span><a href="#local-6989586621680172574"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LogSource
-&gt; StartChildWorkflowOptions -&gt; IO (ChildWorkflowHandle Payload)
</span><a href="#local-6989586621680172574"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">LogSource
</span><a href="#local-6989586621680172572"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">StartChildWorkflowOptions
</span><a href="#local-6989586621680172573"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-879"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">continueAsNew :: forall a.
LogSource
-&gt; ContinueAsNewOptions
-&gt; (LogSource -&gt; ContinueAsNewOptions -&gt; IO a)
-&gt; IO a
</span><a href="Temporal.Workflow.Internal.Monad.html#continueAsNew"><span class="hs-identifier hs-var">continueAsNew</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680172575"><span class="annot"><span class="annottext">LogSource
</span><a href="#local-6989586621680172575"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680172576"><span class="annot"><span class="annottext">ContinueAsNewOptions
</span><a href="#local-6989586621680172576"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621680172577"><span class="annot"><span class="annottext">LogSource -&gt; ContinueAsNewOptions -&gt; IO a
</span><a href="#local-6989586621680172577"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LogSource -&gt; ContinueAsNewOptions -&gt; IO a
</span><a href="#local-6989586621680172577"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">LogSource
</span><a href="#local-6989586621680172575"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ContinueAsNewOptions
</span><a href="#local-6989586621680172576"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-880"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-881"></span><span>
</span><span id="line-882"></span><span>
</span><span id="line-883"></span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#nextVarIdSequence"><span class="hs-identifier hs-type">nextVarIdSequence</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#InstanceM"><span class="hs-identifier hs-type">InstanceM</span></a></span><span> </span><span class="annot"><a href="Temporal.Common.html#Sequence"><span class="hs-identifier hs-type">Sequence</span></a></span><span>
</span><span id="line-884"></span><span id="nextVarIdSequence"><span class="annot"><span class="annottext">nextVarIdSequence :: InstanceM Sequence
</span><a href="Temporal.Workflow.Internal.Monad.html#nextVarIdSequence"><span class="hs-identifier hs-var hs-var">nextVarIdSequence</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-885"></span><span>  </span><span id="local-6989586621680172578"><span class="annot"><a href="#local-6989586621680172578"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceM WorkflowInstance
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-886"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">atomicModifyIORef'</span></span><span> </span><span class="annot"><span class="hs-identifier">inst</span></span><span class="hs-operator">.</span><span class="hs-identifier">workflowSequences</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680172579"><span class="annot"><span class="annottext">Sequences
</span><a href="#local-6989586621680172579"><span class="hs-identifier hs-var">seqs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-887"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680172580"><span class="annot"><span class="annottext">seq' :: Word32
</span><a href="#local-6989586621680172580"><span class="hs-identifier hs-var hs-var">seq'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sequences -&gt; Word32
</span><a href="Temporal.Workflow.Internal.Monad.html#varId"><span class="hs-identifier hs-var">varId</span></a></span><span> </span><span class="annot"><span class="annottext">Sequences
</span><a href="#local-6989586621680172579"><span class="hs-identifier hs-var">seqs</span></a></span><span>
</span><span id="line-888"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sequences
</span><a href="#local-6989586621680172579"><span class="hs-identifier hs-var">seqs</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Workflow.Internal.Monad.html#varId"><span class="hs-identifier hs-var">varId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">succ</span></span><span> </span><span class="annot"><a href="#local-6989586621680172580"><span class="hs-identifier hs-type">seq'</span></a></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Sequence
</span><a href="Temporal.Common.html#Sequence"><span class="hs-identifier hs-var">Sequence</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621680172580"><span class="hs-identifier hs-var">seq'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-889"></span></pre></body></html>