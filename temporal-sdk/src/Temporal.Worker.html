<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DuplicateRecordFields #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="annot"><span class="hs-comment">{- |
Module: Temporal.Worker
Description: Define and manage Temporal workers for executing workflows and activities.

Temporal workers are responsible for executing workflows and activities by polling
the Temporal service for tasks in specific task queues. This module provides
types and functions for defining and configuring Temporal workers, including
both workflow and activity workers.

Types and functions for configuring workers, adding workflows and activities,
and setting worker options are included in this module.

Note: workers only poll from a single task queue. If you need to poll from
multiple task queues, you will need to start multiple workers. Multiple workers
may run in the same process.
-}</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Temporal.Worker.html"><span class="hs-identifier">Temporal.Worker</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier">Temporal.Worker.Worker</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#startWorker"><span class="hs-identifier">startWorker</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#waitWorker"><span class="hs-identifier">waitWorker</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#shutdown"><span class="hs-identifier">shutdown</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#linkWorker"><span class="hs-identifier">linkWorker</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#pollWorkerSTM"><span class="hs-identifier">pollWorkerSTM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#waitWorkerSTM"><span class="hs-identifier">waitWorkerSTM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#replaceEnvironment"><span class="hs-identifier">replaceEnvironment</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Configuration</span></span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><a href="Temporal.Worker.Types.html#WorkerConfig"><span class="hs-identifier">WorkerConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#Definitions"><span class="hs-identifier">Definitions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier">ToDefinitions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier">ConfigM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#configure"><span class="hs-identifier">configure</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Replay</span></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-comment">-- A replay worker is a worker that is used to replay a workflow execution.</span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-comment">-- It is not used for real-world execution of workflows, but is used to</span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-comment">-- replay a workflow execution from history. This is useful for test suites,</span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-comment">-- as it allows you to ensure that changes to your workflow code do not</span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-comment">-- break determinism.</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#runReplayHistory"><span class="hs-identifier">runReplayHistory</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#ReplayHistoryFailure"><span class="hs-identifier">ReplayHistoryFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#subscribeToEvictions"><span class="hs-identifier">subscribeToEvictions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#subscribeToEvictionsSTM"><span class="hs-identifier">subscribeToEvictionsSTM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Worker.html#EvictionWithRunID"><span class="hs-identifier">Workflow.EvictionWithRunID</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#evictionMessage"><span class="hs-identifier">evictionMessage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#evictionWasFatal"><span class="hs-identifier">evictionWasFatal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-comment">-- startReplayWorker,</span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-comment">-- Core.HistoryPusher,</span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-comment">-- Core.pushHistory,</span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-comment">-- Core.closeHistory,</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Worker options</span></span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowDef"><span class="hs-identifier">WorkflowDef</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDef"><span class="hs-identifier">ActivityDef</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#addErrorConverter"><span class="hs-identifier">addErrorConverter</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setLogger"><span class="hs-identifier">setLogger</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setTracerProvider"><span class="hs-identifier">setTracerProvider</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setNamespace"><span class="hs-identifier">setNamespace</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setTaskQueue"><span class="hs-identifier">setTaskQueue</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setBuildId"><span class="hs-identifier">setBuildId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setIdentity"><span class="hs-identifier">setIdentity</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setMaxCachedWorkflows"><span class="hs-identifier">setMaxCachedWorkflows</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setMaxOutstandingWorkflowTasks"><span class="hs-identifier">setMaxOutstandingWorkflowTasks</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setMaxOutstandingActivities"><span class="hs-identifier">setMaxOutstandingActivities</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setMaxOutstandingLocalActivities"><span class="hs-identifier">setMaxOutstandingLocalActivities</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setMaxConcurrentWorkflowTaskPolls"><span class="hs-identifier">setMaxConcurrentWorkflowTaskPolls</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setNonstickyToStickyPollRatio"><span class="hs-identifier">setNonstickyToStickyPollRatio</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setMaxConcurrentActivityTaskPolls"><span class="hs-identifier">setMaxConcurrentActivityTaskPolls</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setNoRemoteActivities"><span class="hs-identifier">setNoRemoteActivities</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setStickyQueueScheduleToStartTimeoutMillis"><span class="hs-identifier">setStickyQueueScheduleToStartTimeoutMillis</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setMaxHeartbeatThrottleIntervalMillis"><span class="hs-identifier">setMaxHeartbeatThrottleIntervalMillis</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setDefaultHeartbeatThrottleIntervalMillis"><span class="hs-identifier">setDefaultHeartbeatThrottleIntervalMillis</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setMaxActivitiesPerSecond"><span class="hs-identifier">setMaxActivitiesPerSecond</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setMaxTaskQueueActivitiesPerSecond"><span class="hs-identifier">setMaxTaskQueueActivitiesPerSecond</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setGracefulShutdownPeriodMillis"><span class="hs-identifier">setGracefulShutdownPeriodMillis</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#addInterceptors"><span class="hs-identifier">addInterceptors</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><a href="Temporal.Worker.html#setPayloadProcessor"><span class="hs-identifier">setPayloadProcessor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>  </span><span class="annot"><a href="Temporal.Common.html#WorkflowId"><span class="hs-identifier">WorkflowId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Exception</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Catch</span></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Logger</span></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lefts</span></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HashMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HashMap</span></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ProtoLens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">encodeMessage</span></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.UUID</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UUID</span></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.UUID</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UUID</span></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.UUID.V4</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">nextRandom</span></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Lens.Family2</span></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OpenTelemetry.Attributes</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">emptyAttributes</span></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OpenTelemetry.Trace.Core</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">inSpan</span></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">OpenTelemetry.Trace.Core</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OT</span></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OpenTelemetry.Trace.Monad</span></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Proto.Temporal.Api.History.V1.Message</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">History</span></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Proto.Temporal.Api.History.V1.Message_Fields</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">maybe'workflowExecutionStartedEventAttributes</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">vec'events</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">workflowId</span></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Proto.Temporal.Sdk.Core.WorkflowActivation.WorkflowActivation</span></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Proto.Temporal.Sdk.Core.WorkflowActivation.WorkflowActivation_Fields</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Activation</span></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">RequireCallStack</span></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Unsafe</span></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Activity.Definition.html"><span class="hs-identifier">Temporal.Activity.Definition</span></a></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Temporal.Activity.Worker.html"><span class="hs-identifier">Temporal.Activity.Worker</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Activity</span></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Common.html"><span class="hs-identifier">Temporal.Common</span></a></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Common.Async.html"><span class="hs-identifier">Temporal.Common.Async</span></a></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Temporal.Core.Client</span></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Temporal.Core.Worker</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">InactiveForReplay</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">WorkerError</span></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Temporal.Core.Worker</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Core</span></span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Exception.html"><span class="hs-identifier">Temporal.Exception</span></a></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Interceptor.html"><span class="hs-identifier">Temporal.Interceptor</span></a></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Payload.html"><span class="hs-identifier">Temporal.Payload</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Payload.html#PayloadProcessor"><span class="hs-identifier">PayloadProcessor</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Temporal.Runtime</span></span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Worker.Types.html"><span class="hs-identifier">Temporal.Worker.Types</span></a></span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Workflow.Definition.html"><span class="hs-identifier">Temporal.Workflow.Definition</span></a></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Temporal.Workflow.Worker.html"><span class="hs-identifier">Temporal.Workflow.Worker</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Workflow</span></span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO</span></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-keyword">newtype</span><span> </span><span id="ConfigM"><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-var">ConfigM</span></a></span></span><span> </span><span id="local-6989586621680179819"><span class="annot"><a href="#local-6989586621680179819"><span class="hs-identifier hs-type">actEnv</span></a></span></span><span> </span><span id="local-6989586621680179820"><span class="annot"><a href="#local-6989586621680179820"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ConfigM"><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-var">ConfigM</span></a></span></span><span> </span><span class="hs-special">{</span><span id="unConfigM"><span class="annot"><span class="annottext">forall actEnv a. ConfigM actEnv a -&gt; State (WorkerConfig actEnv) a
</span><a href="Temporal.Worker.html#unConfigM"><span class="hs-identifier hs-var hs-var">unConfigM</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.Types.html#WorkerConfig"><span class="hs-identifier hs-type">WorkerConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179819"><span class="hs-identifier hs-type">actEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680179820"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680180464"><span id="local-6989586621680180470"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; ConfigM actEnv a -&gt; ConfigM actEnv b)
-&gt; (forall a b. a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv a)
-&gt; Functor (ConfigM actEnv)
forall a b. a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv a
forall a b. (a -&gt; b) -&gt; ConfigM actEnv a -&gt; ConfigM actEnv b
forall actEnv a b. a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv a
forall actEnv a b. (a -&gt; b) -&gt; ConfigM actEnv a -&gt; ConfigM actEnv b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall actEnv a b. (a -&gt; b) -&gt; ConfigM actEnv a -&gt; ConfigM actEnv b
fmap :: forall a b. (a -&gt; b) -&gt; ConfigM actEnv a -&gt; ConfigM actEnv b
$c&lt;$ :: forall actEnv a b. a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv a
&lt;$ :: forall a b. a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680180481"><span id="local-6989586621680180488"><span id="local-6989586621680180494"><span id="local-6989586621680180500"><span id="local-6989586621680180506"><span class="annot"><span class="annottext">Functor (ConfigM actEnv)
Functor (ConfigM actEnv) =&gt;
(forall a. a -&gt; ConfigM actEnv a)
-&gt; (forall a b.
    ConfigM actEnv (a -&gt; b) -&gt; ConfigM actEnv a -&gt; ConfigM actEnv b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c)
    -&gt; ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv c)
-&gt; (forall a b.
    ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv b)
-&gt; (forall a b.
    ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv a)
-&gt; Applicative (ConfigM actEnv)
forall actEnv. Functor (ConfigM actEnv)
forall a. a -&gt; ConfigM actEnv a
forall actEnv a. a -&gt; ConfigM actEnv a
forall a b.
ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv a
forall a b.
ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv b
forall a b.
ConfigM actEnv (a -&gt; b) -&gt; ConfigM actEnv a -&gt; ConfigM actEnv b
forall actEnv a b.
ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv a
forall actEnv a b.
ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv b
forall actEnv a b.
ConfigM actEnv (a -&gt; b) -&gt; ConfigM actEnv a -&gt; ConfigM actEnv b
forall a b c.
(a -&gt; b -&gt; c)
-&gt; ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv c
forall actEnv a b c.
(a -&gt; b -&gt; c)
-&gt; ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv c
forall (f :: * -&gt; *).
Functor f =&gt;
(forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
$cpure :: forall actEnv a. a -&gt; ConfigM actEnv a
pure :: forall a. a -&gt; ConfigM actEnv a
$c&lt;*&gt; :: forall actEnv a b.
ConfigM actEnv (a -&gt; b) -&gt; ConfigM actEnv a -&gt; ConfigM actEnv b
&lt;*&gt; :: forall a b.
ConfigM actEnv (a -&gt; b) -&gt; ConfigM actEnv a -&gt; ConfigM actEnv b
$cliftA2 :: forall actEnv a b c.
(a -&gt; b -&gt; c)
-&gt; ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv c
liftA2 :: forall a b c.
(a -&gt; b -&gt; c)
-&gt; ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv c
$c*&gt; :: forall actEnv a b.
ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv b
*&gt; :: forall a b.
ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv b
$c&lt;* :: forall actEnv a b.
ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv a
&lt;* :: forall a b.
ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680180519"><span id="local-6989586621680180525"><span id="local-6989586621680180530"><span class="annot"><span class="annottext">Applicative (ConfigM actEnv)
Applicative (ConfigM actEnv) =&gt;
(forall a b.
 ConfigM actEnv a -&gt; (a -&gt; ConfigM actEnv b) -&gt; ConfigM actEnv b)
-&gt; (forall a b.
    ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv b)
-&gt; (forall a. a -&gt; ConfigM actEnv a)
-&gt; Monad (ConfigM actEnv)
forall actEnv. Applicative (ConfigM actEnv)
forall a. a -&gt; ConfigM actEnv a
forall actEnv a. a -&gt; ConfigM actEnv a
forall a b.
ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv b
forall a b.
ConfigM actEnv a -&gt; (a -&gt; ConfigM actEnv b) -&gt; ConfigM actEnv b
forall actEnv a b.
ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv b
forall actEnv a b.
ConfigM actEnv a -&gt; (a -&gt; ConfigM actEnv b) -&gt; ConfigM actEnv b
forall (m :: * -&gt; *).
Applicative m =&gt;
(forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall actEnv a b.
ConfigM actEnv a -&gt; (a -&gt; ConfigM actEnv b) -&gt; ConfigM actEnv b
&gt;&gt;= :: forall a b.
ConfigM actEnv a -&gt; (a -&gt; ConfigM actEnv b) -&gt; ConfigM actEnv b
$c&gt;&gt; :: forall actEnv a b.
ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv b
&gt;&gt; :: forall a b.
ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv b
$creturn :: forall actEnv a. a -&gt; ConfigM actEnv a
return :: forall a. a -&gt; ConfigM actEnv a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680179889"><span id="local-6989586621680179890"><span id="local-6989586621680180539"><span id="local-6989586621680180543"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="#local-6989586621680179889"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179890"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179889"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-144"></span><span>  </span><span id="local-6989586621680180550"><span class="annot"><span class="annottext">&lt;&gt; :: ConfigM actEnv a -&gt; ConfigM actEnv a -&gt; ConfigM actEnv a
</span><span class="hs-operator hs-var hs-var hs-var">(&lt;&gt;)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a)
-&gt; ConfigM actEnv a -&gt; ConfigM actEnv a -&gt; ConfigM actEnv a
forall a b c.
(a -&gt; b -&gt; c)
-&gt; ConfigM actEnv a -&gt; ConfigM actEnv b -&gt; ConfigM actEnv c
forall (f :: * -&gt; *) a b c.
Applicative f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><span class="hs-identifier hs-var">liftA2</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680179894"><span id="local-6989586621680179895"><span id="local-6989586621680180557"><span id="local-6989586621680180561"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621680179894"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179895"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179894"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-148"></span><span>  </span><span id="local-6989586621680180567"><span class="annot"><span class="annottext">mempty :: ConfigM actEnv a
</span><span class="hs-identifier hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; ConfigM actEnv a
forall a. a -&gt; ConfigM actEnv a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-comment">------------------------------------------------------------------------------------</span><span>
</span><span id="line-152"></span><span class="hs-comment">-- Configuration</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">-- TODO, it would be nice to expose an inert Tracer Provider in hs-opentelemetry-api</span><span>
</span><span id="line-155"></span><span class="annot"><a href="Temporal.Worker.html#inertTracerProvider"><span class="hs-identifier hs-type">inertTracerProvider</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TracerProvider</span></span><span>
</span><span id="line-156"></span><span id="inertTracerProvider"><span class="annot"><span class="annottext">inertTracerProvider :: TracerProvider
</span><a href="Temporal.Worker.html#inertTracerProvider"><span class="hs-identifier hs-var hs-var">inertTracerProvider</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO TracerProvider -&gt; TracerProvider
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO TracerProvider -&gt; TracerProvider)
-&gt; IO TracerProvider -&gt; TracerProvider
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Processor] -&gt; TracerProviderOptions -&gt; IO TracerProvider
forall (m :: * -&gt; *).
MonadIO m =&gt;
[Processor] -&gt; TracerProviderOptions -&gt; m TracerProvider
</span><span class="hs-identifier hs-var">createTracerProvider</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TracerProviderOptions
</span><span class="hs-identifier hs-var">emptyTracerProviderOptions</span></span><span>
</span><span id="line-157"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="Temporal.Worker.html#inertTracerProvider"><span class="hs-pragma hs-type">inertTracerProvider</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="annot"><span class="hs-comment">-- | Turn a configuration block into the final configuration.</span></span><span>
</span><span id="line-161"></span><span id="local-6989586621680179905"><span id="local-6989586621680179906"><span class="annot"><a href="Temporal.Worker.html#configure"><span class="hs-identifier hs-type">configure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179905"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179906"><span class="hs-identifier hs-type">defs</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680179905"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680179906"><span class="hs-identifier hs-type">defs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179905"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.Types.html#WorkerConfig"><span class="hs-identifier hs-type">WorkerConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179905"><span class="hs-identifier hs-type">actEnv</span></a></span></span></span><span>
</span><span id="line-162"></span><span id="configure"><span class="annot"><span class="annottext">configure :: forall actEnv defs.
ToDefinitions actEnv defs =&gt;
actEnv -&gt; defs -&gt; ConfigM actEnv () -&gt; WorkerConfig actEnv
</span><a href="Temporal.Worker.html#configure"><span class="hs-identifier hs-var hs-var">configure</span></a></span></span><span> </span><span id="local-6989586621680180582"><span class="annot"><span class="annottext">actEnv
</span><a href="#local-6989586621680180582"><span class="hs-identifier hs-var">actEnv</span></a></span></span><span> </span><span id="local-6989586621680180583"><span class="annot"><span class="annottext">defs
</span><a href="#local-6989586621680180583"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(State (WorkerConfig actEnv) ()
 -&gt; WorkerConfig actEnv -&gt; WorkerConfig actEnv)
-&gt; WorkerConfig actEnv
-&gt; State (WorkerConfig actEnv) ()
-&gt; WorkerConfig actEnv
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">State (WorkerConfig actEnv) ()
-&gt; WorkerConfig actEnv -&gt; WorkerConfig actEnv
forall s a. State s a -&gt; s -&gt; s
</span><span class="hs-identifier hs-var">execState</span></span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180586"><span class="hs-identifier hs-var">defaultConfig</span></a></span><span> </span><span class="annot"><span class="annottext">(State (WorkerConfig actEnv) () -&gt; WorkerConfig actEnv)
-&gt; (ConfigM actEnv () -&gt; State (WorkerConfig actEnv) ())
-&gt; ConfigM actEnv ()
-&gt; WorkerConfig actEnv
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConfigM actEnv () -&gt; State (WorkerConfig actEnv) ()
forall actEnv a. ConfigM actEnv a -&gt; State (WorkerConfig actEnv) a
</span><a href="Temporal.Worker.html#unConfigM"><span class="hs-identifier hs-var">unConfigM</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-164"></span><span>    </span><span id="local-6989586621680180586"><span class="annot"><span class="annottext">defaultConfig :: WorkerConfig actEnv
</span><a href="#local-6989586621680180586"><span class="hs-identifier hs-var hs-var">defaultConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-165"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#Definitions"><span class="hs-identifier hs-type">Definitions</span></a></span><span> </span><span id="local-6989586621680180589"><span class="annot"><span class="annottext">HashMap Text WorkflowDefinition
</span><a href="#local-6989586621680180589"><span class="hs-identifier hs-var">wfDefs</span></a></span></span><span> </span><span id="local-6989586621680180590"><span class="annot"><span class="annottext">HashMap Text (ActivityDefinition actEnv)
</span><a href="#local-6989586621680180590"><span class="hs-identifier hs-var">actDefs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">defs -&gt; Definitions actEnv
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">defs
</span><a href="#local-6989586621680180583"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-166"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="Temporal.Worker.Types.html#WorkerConfig"><span class="hs-identifier hs-type">WorkerConfig</span></a></span><span>
</span><span id="line-167"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">coreConfig :: WorkerConfig
</span><a href="Temporal.Worker.Types.html#coreConfig"><span class="hs-identifier hs-var">coreConfig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerConfig
</span><span class="hs-identifier hs-var">Core.defaultWorkerConfig</span></span><span>
</span><span id="line-168"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">deadlockTimeout :: Maybe Int
</span><a href="Temporal.Worker.Types.html#deadlockTimeout"><span class="hs-identifier hs-var">deadlockTimeout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000000</span></span><span>
</span><span id="line-169"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">interceptorConfig :: Interceptors actEnv
</span><a href="Temporal.Worker.Types.html#interceptorConfig"><span class="hs-identifier hs-var">interceptorConfig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interceptors actEnv
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-170"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">applicationErrorConverters :: [ApplicationFailureHandler]
</span><a href="Temporal.Worker.Types.html#applicationErrorConverters"><span class="hs-identifier hs-var">applicationErrorConverters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ApplicationFailureHandler]
</span><a href="Temporal.Exception.html#standardApplicationFailureHandlers"><span class="hs-identifier hs-var">standardApplicationFailureHandlers</span></a></span><span>
</span><span id="line-171"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">logger :: Loc -&gt; Text -&gt; LogLevel -&gt; LogStr -&gt; IO ()
</span><a href="Temporal.Worker.Types.html#logger"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Loc
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LogStr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tracerProvider :: TracerProvider
</span><a href="Temporal.Worker.Types.html#tracerProvider"><span class="hs-identifier hs-var">tracerProvider</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TracerProvider
</span><a href="Temporal.Worker.html#inertTracerProvider"><span class="hs-identifier hs-var">inertTracerProvider</span></a></span><span>
</span><span id="line-173"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">payloadProcessor :: PayloadProcessor
</span><a href="Temporal.Worker.Types.html#payloadProcessor"><span class="hs-identifier hs-var">payloadProcessor</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Payload -&gt; IO Payload)
-&gt; (Payload -&gt; IO (Either String Payload)) -&gt; PayloadProcessor
</span><a href="Temporal.Payload.html#PayloadProcessor"><span class="hs-identifier hs-var">PayloadProcessor</span></a></span><span> </span><span class="annot"><span class="annottext">Payload -&gt; IO Payload
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either String Payload -&gt; IO (Either String Payload)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either String Payload -&gt; IO (Either String Payload))
-&gt; (Payload -&gt; Either String Payload)
-&gt; Payload
-&gt; IO (Either String Payload)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Payload -&gt; Either String Payload
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">actEnv
HashMap Text WorkflowDefinition
HashMap Text (ActivityDefinition actEnv)
actEnv :: actEnv
wfDefs :: HashMap Text WorkflowDefinition
actDefs :: HashMap Text (ActivityDefinition actEnv)
actDefs :: HashMap Text (ActivityDefinition actEnv)
actEnv :: actEnv
wfDefs :: HashMap Text WorkflowDefinition
</span><a href="#local-6989586621680180582"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span>
</span><span id="line-175"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-keyword">data</span><span> </span><span id="Definitions"><span class="annot"><a href="Temporal.Worker.html#Definitions"><span class="hs-identifier hs-var">Definitions</span></a></span></span><span> </span><span id="local-6989586621680179936"><span class="annot"><a href="#local-6989586621680179936"><span class="hs-identifier hs-type">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Definitions"><span class="annot"><a href="Temporal.Worker.html#Definitions"><span class="hs-identifier hs-var">Definitions</span></a></span></span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="workflowDefinitions"><span class="annot"><span class="annottext">forall env. Definitions env -&gt; HashMap Text WorkflowDefinition
</span><a href="Temporal.Worker.html#workflowDefinitions"><span class="hs-identifier hs-var hs-var">workflowDefinitions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowDefinition"><span class="hs-identifier hs-type">WorkflowDefinition</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="activityDefinitions"><span class="annot"><span class="annottext">forall env.
Definitions env -&gt; HashMap Text (ActivityDefinition env)
</span><a href="Temporal.Worker.html#activityDefinitions"><span class="hs-identifier hs-var hs-var">activityDefinitions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDefinition"><span class="hs-identifier hs-type">ActivityDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179936"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680179941"><span id="local-6989586621680180610"><span id="local-6989586621680180614"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#Definitions"><span class="hs-identifier hs-type">Definitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179941"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#Definitions"><span class="hs-identifier hs-type">Definitions</span></a></span><span> </span><span id="local-6989586621680180625"><span class="annot"><span class="annottext">HashMap Text WorkflowDefinition
</span><a href="#local-6989586621680180625"><span class="hs-identifier hs-var">w1</span></a></span></span><span> </span><span id="local-6989586621680180626"><span class="annot"><span class="annottext">HashMap Text (ActivityDefinition env)
</span><a href="#local-6989586621680180626"><span class="hs-identifier hs-var">a1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680180627"><span class="annot"><span class="annottext">&lt;&gt; :: Definitions env -&gt; Definitions env -&gt; Definitions env
</span><span class="hs-operator hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#Definitions"><span class="hs-identifier hs-type">Definitions</span></a></span><span> </span><span id="local-6989586621680180628"><span class="annot"><span class="annottext">HashMap Text WorkflowDefinition
</span><a href="#local-6989586621680180628"><span class="hs-identifier hs-var">w2</span></a></span></span><span> </span><span id="local-6989586621680180629"><span class="annot"><span class="annottext">HashMap Text (ActivityDefinition env)
</span><a href="#local-6989586621680180629"><span class="hs-identifier hs-var">a2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap Text WorkflowDefinition
-&gt; HashMap Text (ActivityDefinition env) -&gt; Definitions env
forall env.
HashMap Text WorkflowDefinition
-&gt; HashMap Text (ActivityDefinition env) -&gt; Definitions env
</span><a href="Temporal.Worker.html#Definitions"><span class="hs-identifier hs-var">Definitions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap Text WorkflowDefinition
</span><a href="#local-6989586621680180625"><span class="hs-identifier hs-var">w1</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text WorkflowDefinition
-&gt; HashMap Text WorkflowDefinition
-&gt; HashMap Text WorkflowDefinition
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashMap Text WorkflowDefinition
</span><a href="#local-6989586621680180628"><span class="hs-identifier hs-var">w2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap Text (ActivityDefinition env)
</span><a href="#local-6989586621680180626"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text (ActivityDefinition env)
-&gt; HashMap Text (ActivityDefinition env)
-&gt; HashMap Text (ActivityDefinition env)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashMap Text (ActivityDefinition env)
</span><a href="#local-6989586621680180629"><span class="hs-identifier hs-var">a2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680179946"><span id="local-6989586621680180634"><span id="local-6989586621680180638"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#Definitions"><span class="hs-identifier hs-type">Definitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179946"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-189"></span><span>  </span><span id="local-6989586621680180645"><span class="annot"><span class="annottext">mempty :: Definitions env
</span><span class="hs-identifier hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap Text WorkflowDefinition
-&gt; HashMap Text (ActivityDefinition env) -&gt; Definitions env
forall env.
HashMap Text WorkflowDefinition
-&gt; HashMap Text (ActivityDefinition env) -&gt; Definitions env
</span><a href="Temporal.Worker.html#Definitions"><span class="hs-identifier hs-var">Definitions</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text WorkflowDefinition
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">HashMap Text (ActivityDefinition env)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680179950"><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179950"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#Definitions"><span class="hs-identifier hs-type">Definitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179950"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-193"></span><span>  </span><span id="local-6989586621680180649"><span class="annot"><span class="annottext">toDefinitions :: Definitions env -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var hs-var hs-var">toDefinitions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definitions env -&gt; Definitions env
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-keyword">class</span><span> </span><span id="ToDefinitions"><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-var">ToDefinitions</span></a></span></span><span> </span><span id="local-6989586621680179930"><span class="annot"><a href="#local-6989586621680179930"><span class="hs-identifier hs-type">env</span></a></span></span><span> </span><span id="local-6989586621680179931"><span class="annot"><a href="#local-6989586621680179931"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-197"></span><span>  </span><span id="toDefinitions"><span class="annot"><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-type">toDefinitions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680179931"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#Definitions"><span class="hs-identifier hs-type">Definitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179930"><span class="hs-identifier hs-type">env</span></a></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680179953"><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179953"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="Temporal.Workflow.Definition.html#WorkflowDefinition"><span class="hs-identifier hs-type">WorkflowDefinition</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-201"></span><span>  </span><span id="local-6989586621680180656"><span class="annot"><span class="annottext">toDefinitions :: WorkflowDefinition -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var hs-var hs-var">toDefinitions</span></a></span></span><span> </span><span id="local-6989586621680180657"><span class="annot"><span class="annottext">WorkflowDefinition
</span><a href="#local-6989586621680180657"><span class="hs-identifier hs-var">wf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap Text WorkflowDefinition
-&gt; HashMap Text (ActivityDefinition env) -&gt; Definitions env
forall env.
HashMap Text WorkflowDefinition
-&gt; HashMap Text (ActivityDefinition env) -&gt; Definitions env
</span><a href="Temporal.Worker.html#Definitions"><span class="hs-identifier hs-var">Definitions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; WorkflowDefinition -&gt; HashMap Text WorkflowDefinition
forall k v. Hashable k =&gt; k -&gt; v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HashMap.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorkflowDefinition -&gt; Text
</span><a href="Temporal.Workflow.Definition.html#workflowName"><span class="hs-identifier hs-var">workflowName</span></a></span><span> </span><span class="annot"><span class="annottext">WorkflowDefinition
</span><a href="#local-6989586621680180657"><span class="hs-identifier hs-var">wf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WorkflowDefinition
</span><a href="#local-6989586621680180657"><span class="hs-identifier hs-var">wf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap Text (ActivityDefinition env)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680179959"><span id="local-6989586621680179960"><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179959"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Workflow.Definition.html#ProvidedWorkflow"><span class="hs-identifier hs-type">ProvidedWorkflow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179960"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-205"></span><span>  </span><span id="local-6989586621680180664"><span class="annot"><span class="annottext">toDefinitions :: ProvidedWorkflow f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var hs-var hs-var">toDefinitions</span></a></span></span><span> </span><span id="local-6989586621680180665"><span class="annot"><span class="annottext">ProvidedWorkflow f
</span><a href="#local-6989586621680180665"><span class="hs-identifier hs-var">wf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkflowDefinition -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">ProvidedWorkflow f
</span><a href="#local-6989586621680180665"><span class="hs-identifier hs-var">wf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">definition</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680179962"><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179962"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ActivityDefinition"><span class="hs-identifier hs-type">ActivityDefinition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179962"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-209"></span><span>  </span><span id="local-6989586621680180672"><span class="annot"><span class="annottext">toDefinitions :: ActivityDefinition env -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var hs-var hs-var">toDefinitions</span></a></span></span><span> </span><span id="local-6989586621680180673"><span class="annot"><span class="annottext">ActivityDefinition env
</span><a href="#local-6989586621680180673"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap Text WorkflowDefinition
-&gt; HashMap Text (ActivityDefinition env) -&gt; Definitions env
forall env.
HashMap Text WorkflowDefinition
-&gt; HashMap Text (ActivityDefinition env) -&gt; Definitions env
</span><a href="Temporal.Worker.html#Definitions"><span class="hs-identifier hs-var">Definitions</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text WorkflowDefinition
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
-&gt; ActivityDefinition env -&gt; HashMap Text (ActivityDefinition env)
forall k v. Hashable k =&gt; k -&gt; v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HashMap.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActivityDefinition env -&gt; Text
forall env. ActivityDefinition env -&gt; Text
</span><a href="Temporal.Activity.Definition.html#activityName"><span class="hs-identifier hs-var">activityName</span></a></span><span> </span><span class="annot"><span class="annottext">ActivityDefinition env
</span><a href="#local-6989586621680180673"><span class="hs-identifier hs-var">act</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ActivityDefinition env
</span><a href="#local-6989586621680180673"><span class="hs-identifier hs-var">act</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680179967"><span id="local-6989586621680179968"><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179967"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Definition.html#ProvidedActivity"><span class="hs-identifier hs-type">ProvidedActivity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179967"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179968"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-213"></span><span>  </span><span id="local-6989586621680180679"><span class="annot"><span class="annottext">toDefinitions :: ProvidedActivity env f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var hs-var hs-var">toDefinitions</span></a></span></span><span> </span><span id="local-6989586621680180680"><span class="annot"><span class="annottext">ProvidedActivity env f
</span><a href="#local-6989586621680180680"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ActivityDefinition env -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">ProvidedActivity env f
</span><a href="#local-6989586621680180680"><span class="hs-identifier hs-var">act</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">definition</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680179972"><span id="local-6989586621680179973"><span id="local-6989586621680179974"><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179972"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179973"><span class="hs-identifier hs-type">_1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179972"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179974"><span class="hs-identifier hs-type">_2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179972"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680179973"><span class="hs-identifier hs-type">_1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680179974"><span class="hs-identifier hs-type">_2</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-217"></span><span>  </span><span id="local-6989586621680180688"><span class="annot"><span class="annottext">toDefinitions :: (_1, _2) -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var hs-var hs-var">toDefinitions</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680180689"><span class="annot"><span class="annottext">_1
</span><a href="#local-6989586621680180689"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680180690"><span class="annot"><span class="annottext">_2
</span><a href="#local-6989586621680180690"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">_1 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_1
</span><a href="#local-6989586621680180689"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Definitions env -&gt; Definitions env -&gt; Definitions env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">_2 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_2
</span><a href="#local-6989586621680180690"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680179979"><span id="local-6989586621680179980"><span id="local-6989586621680179981"><span id="local-6989586621680179982"><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179979"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179980"><span class="hs-identifier hs-type">_1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179979"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179981"><span class="hs-identifier hs-type">_2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179979"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179982"><span class="hs-identifier hs-type">_3</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179979"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680179980"><span class="hs-identifier hs-type">_1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680179981"><span class="hs-identifier hs-type">_2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680179982"><span class="hs-identifier hs-type">_3</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-221"></span><span>  </span><span id="local-6989586621680180701"><span class="annot"><span class="annottext">toDefinitions :: (_1, _2, _3) -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var hs-var hs-var">toDefinitions</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680180702"><span class="annot"><span class="annottext">_1
</span><a href="#local-6989586621680180702"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680180703"><span class="annot"><span class="annottext">_2
</span><a href="#local-6989586621680180703"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680180704"><span class="annot"><span class="annottext">_3
</span><a href="#local-6989586621680180704"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">_1 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_1
</span><a href="#local-6989586621680180702"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Definitions env -&gt; Definitions env -&gt; Definitions env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">_2 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_2
</span><a href="#local-6989586621680180703"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Definitions env -&gt; Definitions env -&gt; Definitions env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">_3 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_3
</span><a href="#local-6989586621680180704"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680179988"><span id="local-6989586621680179989"><span id="local-6989586621680179990"><span id="local-6989586621680179991"><span id="local-6989586621680179992"><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179988"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179989"><span class="hs-identifier hs-type">_1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179988"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179990"><span class="hs-identifier hs-type">_2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179988"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179991"><span class="hs-identifier hs-type">_3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179988"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179992"><span class="hs-identifier hs-type">_4</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179988"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680179989"><span class="hs-identifier hs-type">_1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680179990"><span class="hs-identifier hs-type">_2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680179991"><span class="hs-identifier hs-type">_3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680179992"><span class="hs-identifier hs-type">_4</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-225"></span><span>  </span><span id="local-6989586621680180718"><span class="annot"><span class="annottext">toDefinitions :: (_1, _2, _3, _4) -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var hs-var hs-var">toDefinitions</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680180719"><span class="annot"><span class="annottext">_1
</span><a href="#local-6989586621680180719"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680180720"><span class="annot"><span class="annottext">_2
</span><a href="#local-6989586621680180720"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680180721"><span class="annot"><span class="annottext">_3
</span><a href="#local-6989586621680180721"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680180722"><span class="annot"><span class="annottext">_4
</span><a href="#local-6989586621680180722"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">_1 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_1
</span><a href="#local-6989586621680180719"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Definitions env -&gt; Definitions env -&gt; Definitions env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">_2 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_2
</span><a href="#local-6989586621680180720"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Definitions env -&gt; Definitions env -&gt; Definitions env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">_3 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_3
</span><a href="#local-6989586621680180721"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Definitions env -&gt; Definitions env -&gt; Definitions env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">_4 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_4
</span><a href="#local-6989586621680180722"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680179999"><span id="local-6989586621680180000"><span id="local-6989586621680180001"><span id="local-6989586621680180002"><span id="local-6989586621680180003"><span id="local-6989586621680180004"><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179999"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180000"><span class="hs-identifier hs-type">_1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179999"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180001"><span class="hs-identifier hs-type">_2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179999"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180002"><span class="hs-identifier hs-type">_3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179999"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180003"><span class="hs-identifier hs-type">_4</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179999"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180004"><span class="hs-identifier hs-type">_5</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680179999"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680180000"><span class="hs-identifier hs-type">_1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680180001"><span class="hs-identifier hs-type">_2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680180002"><span class="hs-identifier hs-type">_3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680180003"><span class="hs-identifier hs-type">_4</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680180004"><span class="hs-identifier hs-type">_5</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-229"></span><span>  </span><span id="local-6989586621680180739"><span class="annot"><span class="annottext">toDefinitions :: (_1, _2, _3, _4, _5) -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var hs-var hs-var">toDefinitions</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680180740"><span class="annot"><span class="annottext">_1
</span><a href="#local-6989586621680180740"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680180741"><span class="annot"><span class="annottext">_2
</span><a href="#local-6989586621680180741"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680180742"><span class="annot"><span class="annottext">_3
</span><a href="#local-6989586621680180742"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680180743"><span class="annot"><span class="annottext">_4
</span><a href="#local-6989586621680180743"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680180744"><span class="annot"><span class="annottext">_5
</span><a href="#local-6989586621680180744"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">_1 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_1
</span><a href="#local-6989586621680180740"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Definitions env -&gt; Definitions env -&gt; Definitions env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">_2 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_2
</span><a href="#local-6989586621680180741"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Definitions env -&gt; Definitions env -&gt; Definitions env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">_3 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_3
</span><a href="#local-6989586621680180742"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Definitions env -&gt; Definitions env -&gt; Definitions env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">_4 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_4
</span><a href="#local-6989586621680180743"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Definitions env -&gt; Definitions env -&gt; Definitions env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">_5 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_5
</span><a href="#local-6989586621680180744"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680180012"><span id="local-6989586621680180013"><span id="local-6989586621680180014"><span id="local-6989586621680180015"><span id="local-6989586621680180016"><span id="local-6989586621680180017"><span id="local-6989586621680180018"><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180012"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180013"><span class="hs-identifier hs-type">_1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180012"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180014"><span class="hs-identifier hs-type">_2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180012"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180015"><span class="hs-identifier hs-type">_3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180012"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180016"><span class="hs-identifier hs-type">_4</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180012"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180017"><span class="hs-identifier hs-type">_5</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180012"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180018"><span class="hs-identifier hs-type">_6</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ToDefinitions"><span class="hs-identifier hs-type">ToDefinitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180012"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680180013"><span class="hs-identifier hs-type">_1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680180014"><span class="hs-identifier hs-type">_2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680180015"><span class="hs-identifier hs-type">_3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680180016"><span class="hs-identifier hs-type">_4</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680180017"><span class="hs-identifier hs-type">_5</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680180018"><span class="hs-identifier hs-type">_6</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-233"></span><span>  </span><span id="local-6989586621680180764"><span class="annot"><span class="annottext">toDefinitions :: (_1, _2, _3, _4, _5, _6) -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var hs-var hs-var">toDefinitions</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680180765"><span class="annot"><span class="annottext">_1
</span><a href="#local-6989586621680180765"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680180766"><span class="annot"><span class="annottext">_2
</span><a href="#local-6989586621680180766"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680180767"><span class="annot"><span class="annottext">_3
</span><a href="#local-6989586621680180767"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680180768"><span class="annot"><span class="annottext">_4
</span><a href="#local-6989586621680180768"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680180769"><span class="annot"><span class="annottext">_5
</span><a href="#local-6989586621680180769"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680180770"><span class="annot"><span class="annottext">_6
</span><a href="#local-6989586621680180770"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">_1 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_1
</span><a href="#local-6989586621680180765"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Definitions env -&gt; Definitions env -&gt; Definitions env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">_2 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_2
</span><a href="#local-6989586621680180766"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Definitions env -&gt; Definitions env -&gt; Definitions env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">_3 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_3
</span><a href="#local-6989586621680180767"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Definitions env -&gt; Definitions env -&gt; Definitions env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">_4 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_4
</span><a href="#local-6989586621680180768"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Definitions env -&gt; Definitions env -&gt; Definitions env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">_5 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_5
</span><a href="#local-6989586621680180769"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Definitions env -&gt; Definitions env -&gt; Definitions env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">_6 -&gt; Definitions env
forall env f. ToDefinitions env f =&gt; f -&gt; Definitions env
</span><a href="Temporal.Worker.html#toDefinitions"><span class="hs-identifier hs-var">toDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">_6
</span><a href="#local-6989586621680180770"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span id="local-6989586621680180019"><span class="annot"><a href="Temporal.Worker.html#addInterceptors"><span class="hs-identifier hs-type">addInterceptors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Interceptor.html#Interceptors"><span class="hs-identifier hs-type">Interceptors</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180019"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180019"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-237"></span><span id="addInterceptors"><span class="annot"><span class="annottext">addInterceptors :: forall actEnv. Interceptors actEnv -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#addInterceptors"><span class="hs-identifier hs-var hs-var">addInterceptors</span></a></span></span><span> </span><span id="local-6989586621680180776"><span class="annot"><span class="annottext">Interceptors actEnv
</span><a href="#local-6989586621680180776"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State (WorkerConfig actEnv) () -&gt; ConfigM actEnv ()
forall actEnv a. State (WorkerConfig actEnv) a -&gt; ConfigM actEnv a
</span><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-var">ConfigM</span></a></span><span> </span><span class="annot"><span class="annottext">(State (WorkerConfig actEnv) () -&gt; ConfigM actEnv ())
-&gt; State (WorkerConfig actEnv) () -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(WorkerConfig actEnv -&gt; WorkerConfig actEnv)
-&gt; State (WorkerConfig actEnv) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify'</span></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig actEnv -&gt; WorkerConfig actEnv)
 -&gt; State (WorkerConfig actEnv) ())
-&gt; (WorkerConfig actEnv -&gt; WorkerConfig actEnv)
-&gt; State (WorkerConfig actEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180778"><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180778"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180778"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-239"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Temporal.Worker.Types.html#interceptorConfig"><span class="hs-identifier hs-var">interceptorConfig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180776"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Temporal.Worker.Types.html#interceptorConfig"><span class="hs-identifier hs-var">interceptorConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180778"><span class="hs-identifier hs-type">conf</span></a></span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span id="local-6989586621680180028"><span id="local-6989586621680180031"><span class="annot"><a href="Temporal.Worker.html#addErrorConverter"><span class="hs-identifier hs-type">addErrorConverter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="#local-6989586621680180028"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680180028"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Exception.html#ApplicationFailure"><span class="hs-identifier hs-type">ApplicationFailure</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180031"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-244"></span><span id="addErrorConverter"><span class="annot"><span class="annottext">addErrorConverter :: forall e actEnv.
Exception e =&gt;
(e -&gt; ApplicationFailure) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#addErrorConverter"><span class="hs-identifier hs-var hs-var">addErrorConverter</span></a></span></span><span> </span><span id="local-6989586621680180783"><span class="annot"><span class="annottext">e -&gt; ApplicationFailure
</span><a href="#local-6989586621680180783"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State (WorkerConfig actEnv) () -&gt; ConfigM actEnv ()
forall actEnv a. State (WorkerConfig actEnv) a -&gt; ConfigM actEnv a
</span><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-var">ConfigM</span></a></span><span> </span><span class="annot"><span class="annottext">(State (WorkerConfig actEnv) () -&gt; ConfigM actEnv ())
-&gt; State (WorkerConfig actEnv) () -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(WorkerConfig actEnv -&gt; WorkerConfig actEnv)
-&gt; State (WorkerConfig actEnv) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify'</span></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig actEnv -&gt; WorkerConfig actEnv)
 -&gt; State (WorkerConfig actEnv) ())
-&gt; (WorkerConfig actEnv -&gt; WorkerConfig actEnv)
-&gt; State (WorkerConfig actEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180784"><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180784"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-245"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180784"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Temporal.Worker.Types.html#applicationErrorConverters"><span class="hs-identifier hs-var">applicationErrorConverters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Temporal.Exception.html#ApplicationFailureHandler"><span class="hs-identifier hs-type">ApplicationFailureHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180783"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="Temporal.Worker.Types.html#applicationErrorConverters"><span class="hs-identifier hs-var">applicationErrorConverters</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180784"><span class="hs-identifier hs-type">conf</span></a></span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span id="local-6989586621680180036"><span class="annot"><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-type">modifyCore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Core.WorkerConfig</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Core.WorkerConfig</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180036"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-251"></span><span id="modifyCore"><span class="annot"><span class="annottext">modifyCore :: forall actEnv. (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-var hs-var">modifyCore</span></a></span></span><span> </span><span id="local-6989586621680180789"><span class="annot"><span class="annottext">WorkerConfig -&gt; WorkerConfig
</span><a href="#local-6989586621680180789"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State (WorkerConfig actEnv) () -&gt; ConfigM actEnv ()
forall actEnv a. State (WorkerConfig actEnv) a -&gt; ConfigM actEnv a
</span><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-var">ConfigM</span></a></span><span> </span><span class="annot"><span class="annottext">(State (WorkerConfig actEnv) () -&gt; ConfigM actEnv ())
-&gt; State (WorkerConfig actEnv) () -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(WorkerConfig actEnv -&gt; WorkerConfig actEnv)
-&gt; State (WorkerConfig actEnv) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify'</span></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig actEnv -&gt; WorkerConfig actEnv)
 -&gt; State (WorkerConfig actEnv) ())
-&gt; (WorkerConfig actEnv -&gt; WorkerConfig actEnv)
-&gt; State (WorkerConfig actEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180790"><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180790"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-252"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180790"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Temporal.Worker.Types.html#coreConfig"><span class="hs-identifier hs-var">coreConfig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180789"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.Types.html#coreConfig"><span class="hs-identifier hs-var">coreConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180790"><span class="hs-identifier hs-type">conf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="annot"><span class="hs-comment">{- | The namespace that all workflows and activities will be
registered in for this worker.

If you need to register workflows and activities in multiple namespaces,
you will need to start multiple workers. Multiple workers may run in the
same process.
-}</span></span><span>
</span><span id="line-264"></span><span id="local-6989586621680180040"><span class="annot"><a href="Temporal.Worker.html#setNamespace"><span class="hs-identifier hs-type">setNamespace</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Common.html#Namespace"><span class="hs-identifier hs-type">Namespace</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180040"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-265"></span><span id="setNamespace"><span class="annot"><span class="annottext">setNamespace :: forall actEnv. Namespace -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setNamespace"><span class="hs-identifier hs-var hs-var">setNamespace</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Common.html#Namespace"><span class="hs-identifier hs-type">Namespace</span></a></span><span> </span><span id="local-6989586621680180792"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680180792"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall actEnv. (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-var">modifyCore</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ())
-&gt; (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180793"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180793"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-266"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180793"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.namespace</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180792"><span class="hs-identifier hs-type">ns</span></a></span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="annot"><span class="hs-comment">{- | A temporal worker, whether polling for workflows or activities, does so by polling a specific &quot;Task Queue&quot;.

Any time there is a new activity task or workflow task that needs to be performed by a worker, it'll be queued in a specific task queue.
-}</span></span><span>
</span><span id="line-275"></span><span id="local-6989586621680180043"><span class="annot"><a href="Temporal.Worker.html#setTaskQueue"><span class="hs-identifier hs-type">setTaskQueue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Common.html#TaskQueue"><span class="hs-identifier hs-type">TaskQueue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180043"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-276"></span><span id="setTaskQueue"><span class="annot"><span class="annottext">setTaskQueue :: forall actEnv. TaskQueue -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setTaskQueue"><span class="hs-identifier hs-var hs-var">setTaskQueue</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Common.html#TaskQueue"><span class="hs-identifier hs-type">TaskQueue</span></a></span><span> </span><span id="local-6989586621680180796"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680180796"><span class="hs-identifier hs-var">tq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall actEnv. (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-var">modifyCore</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ())
-&gt; (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180797"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180797"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-277"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180797"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.taskQueue</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180796"><span class="hs-identifier hs-type">tq</span></a></span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="annot"><span class="hs-comment">{- | A string that should be unique to the exact worker code/binary being executed.

This is used to uniquely identify the worker's code for a handful of purposes,
including the worker versioning feature if you have opted into that with useVersioning.
It will also populate the binaryChecksum field on older servers.

N.B. this is not the same as the worker's identity, which is a string that identifies
the worker instance. The identity is used to identify the worker instance in logs and
in the Temporal UI. The buildId is used to identify the exact version of the code and
its dependencies. In e.g. Nix, the executable path in the Nix store would be a useful
buildId.
-}</span></span><span>
</span><span id="line-294"></span><span id="local-6989586621680180045"><span class="annot"><a href="Temporal.Worker.html#setBuildId"><span class="hs-identifier hs-type">setBuildId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180045"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-295"></span><span id="setBuildId"><span class="annot"><span class="annottext">setBuildId :: forall actEnv. Text -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setBuildId"><span class="hs-identifier hs-var hs-var">setBuildId</span></a></span></span><span> </span><span id="local-6989586621680180799"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680180799"><span class="hs-identifier hs-var">bid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall actEnv. (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-var">modifyCore</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ())
-&gt; (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180800"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180800"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-296"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180800"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-297"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.buildId</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180799"><span class="hs-identifier hs-type">bid</span></a></span><span>
</span><span id="line-298"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span id="local-6989586621680180802"><span class="annot"><a href="Temporal.Worker.html#setIdentity"><span class="hs-identifier hs-type">setIdentity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180802"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-302"></span><span id="setIdentity"><span class="annot"><span class="annottext">setIdentity :: forall actEnv. Text -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setIdentity"><span class="hs-identifier hs-var hs-var">setIdentity</span></a></span></span><span> </span><span id="local-6989586621680180803"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680180803"><span class="hs-identifier hs-var">ident</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall actEnv. (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-var">modifyCore</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ())
-&gt; (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180804"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180804"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-303"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180804"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.identityOverride</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621680180803"><span class="hs-identifier hs-type">ident</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span id="local-6989586621680180048"><span class="annot"><a href="Temporal.Worker.html#setMaxCachedWorkflows"><span class="hs-identifier hs-type">setMaxCachedWorkflows</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180048"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-309"></span><span id="setMaxCachedWorkflows"><span class="annot"><span class="annottext">setMaxCachedWorkflows :: forall actEnv. Word64 -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setMaxCachedWorkflows"><span class="hs-identifier hs-var hs-var">setMaxCachedWorkflows</span></a></span></span><span> </span><span id="local-6989586621680180806"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680180806"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall actEnv. (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-var">modifyCore</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ())
-&gt; (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180807"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180807"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-310"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180807"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.maxCachedWorkflows</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180806"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span id="local-6989586621680180809"><span class="annot"><a href="Temporal.Worker.html#setMaxOutstandingWorkflowTasks"><span class="hs-identifier hs-type">setMaxOutstandingWorkflowTasks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180809"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-316"></span><span id="setMaxOutstandingWorkflowTasks"><span class="annot"><span class="annottext">setMaxOutstandingWorkflowTasks :: forall actEnv. Word64 -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setMaxOutstandingWorkflowTasks"><span class="hs-identifier hs-var hs-var">setMaxOutstandingWorkflowTasks</span></a></span></span><span> </span><span id="local-6989586621680180810"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680180810"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall actEnv. (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-var">modifyCore</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ())
-&gt; (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180811"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180811"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-317"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180811"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.maxOutstandingWorkflowTasks</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180810"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span id="local-6989586621680180813"><span class="annot"><a href="Temporal.Worker.html#setMaxOutstandingActivities"><span class="hs-identifier hs-type">setMaxOutstandingActivities</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180813"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-323"></span><span id="setMaxOutstandingActivities"><span class="annot"><span class="annottext">setMaxOutstandingActivities :: forall actEnv. Word64 -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setMaxOutstandingActivities"><span class="hs-identifier hs-var hs-var">setMaxOutstandingActivities</span></a></span></span><span> </span><span id="local-6989586621680180814"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680180814"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall actEnv. (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-var">modifyCore</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ())
-&gt; (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180815"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180815"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-324"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180815"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.maxOutstandingActivities</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180814"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-326"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span id="local-6989586621680180817"><span class="annot"><a href="Temporal.Worker.html#setMaxOutstandingLocalActivities"><span class="hs-identifier hs-type">setMaxOutstandingLocalActivities</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180817"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-330"></span><span id="setMaxOutstandingLocalActivities"><span class="annot"><span class="annottext">setMaxOutstandingLocalActivities :: forall actEnv. Word64 -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setMaxOutstandingLocalActivities"><span class="hs-identifier hs-var hs-var">setMaxOutstandingLocalActivities</span></a></span></span><span> </span><span id="local-6989586621680180818"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680180818"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall actEnv. (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-var">modifyCore</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ())
-&gt; (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180819"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180819"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-331"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180819"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-332"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.maxOutstandingLocalActivities</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180818"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span id="local-6989586621680180821"><span class="annot"><a href="Temporal.Worker.html#setMaxConcurrentWorkflowTaskPolls"><span class="hs-identifier hs-type">setMaxConcurrentWorkflowTaskPolls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180821"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-337"></span><span id="setMaxConcurrentWorkflowTaskPolls"><span class="annot"><span class="annottext">setMaxConcurrentWorkflowTaskPolls :: forall actEnv. Word64 -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setMaxConcurrentWorkflowTaskPolls"><span class="hs-identifier hs-var hs-var">setMaxConcurrentWorkflowTaskPolls</span></a></span></span><span> </span><span id="local-6989586621680180822"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680180822"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall actEnv. (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-var">modifyCore</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ())
-&gt; (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180823"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180823"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-338"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180823"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.maxConcurrentWorkflowTaskPolls</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180822"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span id="local-6989586621680180054"><span class="annot"><a href="Temporal.Worker.html#setNonstickyToStickyPollRatio"><span class="hs-identifier hs-type">setNonstickyToStickyPollRatio</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180054"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-344"></span><span id="setNonstickyToStickyPollRatio"><span class="annot"><span class="annottext">setNonstickyToStickyPollRatio :: forall actEnv. Float -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setNonstickyToStickyPollRatio"><span class="hs-identifier hs-var hs-var">setNonstickyToStickyPollRatio</span></a></span></span><span> </span><span id="local-6989586621680180825"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621680180825"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall actEnv. (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-var">modifyCore</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ())
-&gt; (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180826"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180826"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-345"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180826"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.nonstickyToStickyPollRatio</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180825"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span class="annot"><span class="hs-comment">{- | Maximum number of Activity tasks to poll concurrently.

Increase this setting if your Worker is failing to fill in all
of its maxConcurrentActivityTaskExecutions slots despite a
backlog of Activity Tasks in the Task Queue (ie. due to network latency).
Can't be higher than maxConcurrentActivityTaskExecutions.
-}</span></span><span>
</span><span id="line-357"></span><span id="local-6989586621680180828"><span class="annot"><a href="Temporal.Worker.html#setMaxConcurrentActivityTaskPolls"><span class="hs-identifier hs-type">setMaxConcurrentActivityTaskPolls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180828"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-358"></span><span id="setMaxConcurrentActivityTaskPolls"><span class="annot"><span class="annottext">setMaxConcurrentActivityTaskPolls :: forall actEnv. Word64 -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setMaxConcurrentActivityTaskPolls"><span class="hs-identifier hs-var hs-var">setMaxConcurrentActivityTaskPolls</span></a></span></span><span> </span><span id="local-6989586621680180829"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680180829"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall actEnv. (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-var">modifyCore</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ())
-&gt; (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180830"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180830"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-359"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180830"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.maxConcurrentActivityTaskPolls</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180829"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span id="local-6989586621680180057"><span class="annot"><a href="Temporal.Worker.html#setNoRemoteActivities"><span class="hs-identifier hs-type">setNoRemoteActivities</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180057"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-365"></span><span id="setNoRemoteActivities"><span class="annot"><span class="annottext">setNoRemoteActivities :: forall actEnv. Bool -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setNoRemoteActivities"><span class="hs-identifier hs-var hs-var">setNoRemoteActivities</span></a></span></span><span> </span><span id="local-6989586621680180832"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680180832"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall actEnv. (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-var">modifyCore</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ())
-&gt; (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180833"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180833"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-366"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180833"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.noRemoteActivities</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180832"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="annot"><span class="hs-comment">-- | How long a workflow task is allowed to sit on the sticky queue before it is timed out and moved to the non-sticky queue where it may be picked up by any worker.</span></span><span>
</span><span id="line-372"></span><span id="local-6989586621680180835"><span class="annot"><a href="Temporal.Worker.html#setStickyQueueScheduleToStartTimeoutMillis"><span class="hs-identifier hs-type">setStickyQueueScheduleToStartTimeoutMillis</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180835"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-373"></span><span id="setStickyQueueScheduleToStartTimeoutMillis"><span class="annot"><span class="annottext">setStickyQueueScheduleToStartTimeoutMillis :: forall actEnv. Word64 -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setStickyQueueScheduleToStartTimeoutMillis"><span class="hs-identifier hs-var hs-var">setStickyQueueScheduleToStartTimeoutMillis</span></a></span></span><span> </span><span id="local-6989586621680180836"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680180836"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall actEnv. (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-var">modifyCore</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ())
-&gt; (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180837"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180837"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-374"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180837"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.stickyQueueScheduleToStartTimeoutMillis</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180836"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span class="annot"><span class="hs-comment">-- | Longest interval for throttling activity heartbeats</span></span><span>
</span><span id="line-380"></span><span id="local-6989586621680180839"><span class="annot"><a href="Temporal.Worker.html#setMaxHeartbeatThrottleIntervalMillis"><span class="hs-identifier hs-type">setMaxHeartbeatThrottleIntervalMillis</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180839"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-381"></span><span id="setMaxHeartbeatThrottleIntervalMillis"><span class="annot"><span class="annottext">setMaxHeartbeatThrottleIntervalMillis :: forall actEnv. Word64 -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setMaxHeartbeatThrottleIntervalMillis"><span class="hs-identifier hs-var hs-var">setMaxHeartbeatThrottleIntervalMillis</span></a></span></span><span> </span><span id="local-6989586621680180840"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680180840"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall actEnv. (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-var">modifyCore</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ())
-&gt; (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180841"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180841"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-382"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180841"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-383"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.maxHeartbeatThrottleIntervalMillis</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180840"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-384"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span class="hs-comment">-- Default interval for throttling activity heartbeats in case</span><span>
</span><span id="line-388"></span><span class="hs-comment">-- ActivityOptions.heartbeat_timeout is unset.</span><span>
</span><span id="line-389"></span><span class="hs-comment">-- When the timeout is set in the ActivityOptions,</span><span>
</span><span id="line-390"></span><span class="hs-comment">-- throttling is set to @heartbeat_timeout * 0.8@.</span><span>
</span><span id="line-391"></span><span id="local-6989586621680180843"><span class="annot"><a href="Temporal.Worker.html#setDefaultHeartbeatThrottleIntervalMillis"><span class="hs-identifier hs-type">setDefaultHeartbeatThrottleIntervalMillis</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180843"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-392"></span><span id="setDefaultHeartbeatThrottleIntervalMillis"><span class="annot"><span class="annottext">setDefaultHeartbeatThrottleIntervalMillis :: forall actEnv. Word64 -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setDefaultHeartbeatThrottleIntervalMillis"><span class="hs-identifier hs-var hs-var">setDefaultHeartbeatThrottleIntervalMillis</span></a></span></span><span> </span><span id="local-6989586621680180844"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680180844"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall actEnv. (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-var">modifyCore</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ())
-&gt; (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180845"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180845"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-393"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180845"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.defaultHeartbeatThrottleIntervalMillis</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180844"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span class="annot"><span class="hs-comment">{- | Limits the number of Activities per second that this Worker will process.
(Does not limit the number of Local Activities.) The Worker will not poll for
new Activities if by doing so it might receive and execute an Activity which
would cause it to exceed this limit. Must be a positive number.

If unset, no rate limiting will be applied to Worker's Activities. (tctl task-queue describe will display the absence of a limit as 100,000.)
-}</span></span><span>
</span><span id="line-405"></span><span id="local-6989586621680180062"><span class="annot"><a href="Temporal.Worker.html#setMaxActivitiesPerSecond"><span class="hs-identifier hs-type">setMaxActivitiesPerSecond</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180062"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-406"></span><span id="setMaxActivitiesPerSecond"><span class="annot"><span class="annottext">setMaxActivitiesPerSecond :: forall actEnv. Double -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setMaxActivitiesPerSecond"><span class="hs-identifier hs-var hs-var">setMaxActivitiesPerSecond</span></a></span></span><span> </span><span id="local-6989586621680180847"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680180847"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall actEnv. (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-var">modifyCore</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ())
-&gt; (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180848"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180848"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-407"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180848"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-408"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.maxActivitiesPerSecond</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621680180847"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span class="annot"><span class="hs-comment">{- | Sets the maximum number of activities per second the task queue will dispatch, controlled server-side. Note that this only takes effect upon an activity poll request.
If multiple workers on the same queue have different values set, they will thrash with the last poller winning.

If unset, no rate limiting will be applied to the task queue.
-}</span></span><span>
</span><span id="line-417"></span><span id="local-6989586621680180850"><span class="annot"><a href="Temporal.Worker.html#setMaxTaskQueueActivitiesPerSecond"><span class="hs-identifier hs-type">setMaxTaskQueueActivitiesPerSecond</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180850"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-418"></span><span id="setMaxTaskQueueActivitiesPerSecond"><span class="annot"><span class="annottext">setMaxTaskQueueActivitiesPerSecond :: forall actEnv. Double -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setMaxTaskQueueActivitiesPerSecond"><span class="hs-identifier hs-var hs-var">setMaxTaskQueueActivitiesPerSecond</span></a></span></span><span> </span><span id="local-6989586621680180851"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680180851"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall actEnv. (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-var">modifyCore</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ())
-&gt; (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180852"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180852"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-419"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180852"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-420"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.maxTaskQueueActivitiesPerSecond</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621680180851"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-421"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="annot"><span class="hs-comment">{- | Time to wait for pending tasks to drain after shutdown was requested.

In-flight activities will be cancelled after this period and their current
attempt will be resolved as failed if they confirm cancellation
(by throwing a CancelledFailure or AbortError).
-}</span></span><span>
</span><span id="line-430"></span><span id="local-6989586621680180854"><span class="annot"><a href="Temporal.Worker.html#setGracefulShutdownPeriodMillis"><span class="hs-identifier hs-type">setGracefulShutdownPeriodMillis</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180854"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-431"></span><span id="setGracefulShutdownPeriodMillis"><span class="annot"><span class="annottext">setGracefulShutdownPeriodMillis :: forall actEnv. Word64 -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setGracefulShutdownPeriodMillis"><span class="hs-identifier hs-var hs-var">setGracefulShutdownPeriodMillis</span></a></span></span><span> </span><span id="local-6989586621680180855"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680180855"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall actEnv. (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#modifyCore"><span class="hs-identifier hs-var">modifyCore</span></a></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ())
-&gt; (WorkerConfig -&gt; WorkerConfig) -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180856"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180856"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-432"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180856"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-433"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.gracefulShutdownPeriodMillis</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180855"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-434"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span class="annot"><span class="hs-comment">-- | Set the logger for the worker. This is used to log messages from the worker.</span></span><span>
</span><span id="line-438"></span><span id="local-6989586621680180066"><span class="annot"><a href="Temporal.Worker.html#setLogger"><span class="hs-identifier hs-type">setLogger</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Loc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogSource</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Control.Monad.Logger.LogLevel</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogStr</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180066"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-439"></span><span id="setLogger"><span class="annot"><span class="annottext">setLogger :: forall actEnv.
(Loc -&gt; Text -&gt; LogLevel -&gt; LogStr -&gt; IO ()) -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setLogger"><span class="hs-identifier hs-var hs-var">setLogger</span></a></span></span><span> </span><span id="local-6989586621680180861"><span class="annot"><span class="annottext">Loc -&gt; Text -&gt; LogLevel -&gt; LogStr -&gt; IO ()
</span><a href="#local-6989586621680180861"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State (WorkerConfig actEnv) () -&gt; ConfigM actEnv ()
forall actEnv a. State (WorkerConfig actEnv) a -&gt; ConfigM actEnv a
</span><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-var">ConfigM</span></a></span><span> </span><span class="annot"><span class="annottext">(State (WorkerConfig actEnv) () -&gt; ConfigM actEnv ())
-&gt; State (WorkerConfig actEnv) () -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(WorkerConfig actEnv -&gt; WorkerConfig actEnv)
-&gt; State (WorkerConfig actEnv) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify'</span></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig actEnv -&gt; WorkerConfig actEnv)
 -&gt; State (WorkerConfig actEnv) ())
-&gt; (WorkerConfig actEnv -&gt; WorkerConfig actEnv)
-&gt; State (WorkerConfig actEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180862"><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180862"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-440"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180862"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-441"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Temporal.Worker.Types.html#logger"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180861"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-442"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span class="annot"><span class="hs-comment">-- | Set the tracer provider for the worker. This is used to trace the worker's internal activity.</span></span><span>
</span><span id="line-446"></span><span id="local-6989586621680180068"><span class="annot"><a href="Temporal.Worker.html#setTracerProvider"><span class="hs-identifier hs-type">setTracerProvider</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TracerProvider</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180068"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-447"></span><span id="setTracerProvider"><span class="annot"><span class="annottext">setTracerProvider :: forall actEnv. TracerProvider -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setTracerProvider"><span class="hs-identifier hs-var hs-var">setTracerProvider</span></a></span></span><span> </span><span id="local-6989586621680180865"><span class="annot"><span class="annottext">TracerProvider
</span><a href="#local-6989586621680180865"><span class="hs-identifier hs-var">tp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State (WorkerConfig actEnv) () -&gt; ConfigM actEnv ()
forall actEnv a. State (WorkerConfig actEnv) a -&gt; ConfigM actEnv a
</span><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-var">ConfigM</span></a></span><span> </span><span class="annot"><span class="annottext">(State (WorkerConfig actEnv) () -&gt; ConfigM actEnv ())
-&gt; State (WorkerConfig actEnv) () -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(WorkerConfig actEnv -&gt; WorkerConfig actEnv)
-&gt; State (WorkerConfig actEnv) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify'</span></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig actEnv -&gt; WorkerConfig actEnv)
 -&gt; State (WorkerConfig actEnv) ())
-&gt; (WorkerConfig actEnv -&gt; WorkerConfig actEnv)
-&gt; State (WorkerConfig actEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180866"><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180866"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-448"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180866"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-449"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Temporal.Worker.Types.html#tracerProvider"><span class="hs-identifier hs-var">tracerProvider</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180865"><span class="hs-identifier hs-type">tp</span></a></span><span>
</span><span id="line-450"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span id="local-6989586621680180070"><span class="annot"><a href="Temporal.Worker.html#setPayloadProcessor"><span class="hs-identifier hs-type">setPayloadProcessor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Payload.html#PayloadProcessor"><span class="hs-identifier hs-type">PayloadProcessor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-type">ConfigM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180070"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-454"></span><span id="setPayloadProcessor"><span class="annot"><span class="annottext">setPayloadProcessor :: forall actEnv. PayloadProcessor -&gt; ConfigM actEnv ()
</span><a href="Temporal.Worker.html#setPayloadProcessor"><span class="hs-identifier hs-var hs-var">setPayloadProcessor</span></a></span></span><span> </span><span id="local-6989586621680180869"><span class="annot"><span class="annottext">PayloadProcessor
</span><a href="#local-6989586621680180869"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State (WorkerConfig actEnv) () -&gt; ConfigM actEnv ()
forall actEnv a. State (WorkerConfig actEnv) a -&gt; ConfigM actEnv a
</span><a href="Temporal.Worker.html#ConfigM"><span class="hs-identifier hs-var">ConfigM</span></a></span><span> </span><span class="annot"><span class="annottext">(State (WorkerConfig actEnv) () -&gt; ConfigM actEnv ())
-&gt; State (WorkerConfig actEnv) () -&gt; ConfigM actEnv ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(WorkerConfig actEnv -&gt; WorkerConfig actEnv)
-&gt; State (WorkerConfig actEnv) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify'</span></span><span> </span><span class="annot"><span class="annottext">((WorkerConfig actEnv -&gt; WorkerConfig actEnv)
 -&gt; State (WorkerConfig actEnv) ())
-&gt; (WorkerConfig actEnv -&gt; WorkerConfig actEnv)
-&gt; State (WorkerConfig actEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680180870"><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180870"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-455"></span><span>  </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180870"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-456"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Temporal.Worker.Types.html#payloadProcessor"><span class="hs-identifier hs-var">payloadProcessor</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680180869"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span class="hs-comment">------------------------------------------------------------------------------------</span><span>
</span><span id="line-461"></span><span>
</span><span id="line-462"></span><span class="annot"><span class="hs-comment">{- | A Worker is responsible for polling a Task Queue, dequeueing a Task, executing
your code in response to a Task, and responding to the Temporal Cluster with the results.

Worker Processes are external to a Temporal Cluster. Temporal Application developers are
responsible for developing Worker Programs and operating Worker Processes. Said another way,
the Temporal Cluster (including the Temporal Cloud) doesn't execute any of your code
(Workflow and Activity Definitions) on Temporal Cluster machines. The Cluster is solely
responsible for orchestrating State Transitions and providing Tasks to the next available
Worker Entity.

A Worker Process can be both a Workflow Worker Process and an Activity Worker Process.
Haskell the ability to have multiple Worker Entities in a single Worker Process.

A single Worker Entity can listen to only a single Task Queue. But if a Worker Process has multiple Worker Entities, the Worker Process could be listening to multiple Task Queues.
-}</span></span><span>
</span><span id="line-477"></span><span class="hs-keyword">data</span><span> </span><span id="Worker"><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-var">Worker</span></a></span></span><span> </span><span id="local-6989586621680180072"><span class="annot"><a href="#local-6989586621680180072"><span class="hs-identifier hs-type">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680180871"><span class="annot"><a href="#local-6989586621680180871"><span class="hs-identifier hs-type">ty</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-478"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Core.KnownWorkerType</span></span><span> </span><span class="annot"><a href="#local-6989586621680180871"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-479"></span><span>  </span><span id="Worker"><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-var">Worker</span></a></span></span><span>
</span><span id="line-480"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="workerType"><span class="annot"><span class="annottext">()
</span><a href="Temporal.Worker.html#workerType"><span class="hs-identifier hs-var hs-var">workerType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Core.SWorkerType</span></span><span> </span><span class="annot"><a href="#local-6989586621680180871"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workerWorkflowLoop"><span class="annot"><span class="annottext">forall env. Worker env -&gt; Async ()
</span><a href="Temporal.Worker.html#workerWorkflowLoop"><span class="hs-identifier hs-var hs-var">workerWorkflowLoop</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Async</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workerActivityLoop"><span class="annot"><span class="annottext">()
</span><a href="Temporal.Worker.html#workerActivityLoop"><span class="hs-identifier hs-var hs-var">workerActivityLoop</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InactiveForReplay</span></span><span> </span><span class="annot"><a href="#local-6989586621680180871"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Async</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workerActivityWorker"><span class="annot"><span class="annottext">()
</span><a href="Temporal.Worker.html#workerActivityWorker"><span class="hs-identifier hs-var hs-var">workerActivityWorker</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InactiveForReplay</span></span><span> </span><span class="annot"><a href="#local-6989586621680180871"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Activity.Worker.html#ActivityWorker"><span class="hs-identifier hs-type">Activity.ActivityWorker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180072"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workerCore"><span class="annot"><span class="annottext">()
</span><a href="Temporal.Worker.html#workerCore"><span class="hs-identifier hs-var hs-var">workerCore</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Core.Worker</span></span><span> </span><span class="annot"><a href="#local-6989586621680180871"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workerTracer"><span class="annot"><span class="annottext">forall env. Worker env -&gt; Tracer
</span><a href="Temporal.Worker.html#workerTracer"><span class="hs-identifier hs-var hs-var">workerTracer</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Tracer</span></span><span>
</span><span id="line-486"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workerEvictionEmitter"><span class="annot"><span class="annottext">forall env. Worker env -&gt; TChan EvictionWithRunID
</span><a href="Temporal.Worker.html#workerEvictionEmitter"><span class="hs-identifier hs-var hs-var">workerEvictionEmitter</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TChan</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Worker.html#EvictionWithRunID"><span class="hs-identifier hs-type">Workflow.EvictionWithRunID</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-488"></span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span id="local-6989586621680180085"><span id="local-6989586621680180089"><span class="annot"><a href="Temporal.Worker.html#startReplayWorker"><span class="hs-identifier hs-type">startReplayWorker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621680180085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadCatch</span></span><span> </span><span class="annot"><a href="#local-6989586621680180085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Runtime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.Types.html#WorkerConfig"><span class="hs-identifier hs-type">WorkerConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180089"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680180085"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-type">Temporal.Worker.Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180089"><span class="hs-identifier hs-type">actEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Core.HistoryPusher</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-491"></span><span id="startReplayWorker"><span class="annot"><span class="annottext">startReplayWorker :: forall (m :: * -&gt; *) actEnv.
(MonadUnliftIO m, MonadCatch m) =&gt;
Runtime -&gt; WorkerConfig actEnv -&gt; m (Worker actEnv, HistoryPusher)
</span><a href="Temporal.Worker.html#startReplayWorker"><span class="hs-identifier hs-var hs-var">startReplayWorker</span></a></span></span><span> </span><span id="local-6989586621680180892"><span class="annot"><span class="annottext">Runtime
</span><a href="#local-6989586621680180892"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621680180893"><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180893"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RequireCallStackImpl =&gt; m (Worker actEnv, HistoryPusher))
-&gt; m (Worker actEnv, HistoryPusher)
forall r. (RequireCallStackImpl =&gt; r) -&gt; r
</span><span class="hs-identifier hs-var">provideCallStack</span></span><span> </span><span class="annot"><span class="annottext">((RequireCallStackImpl =&gt; m (Worker actEnv, HistoryPusher))
 -&gt; m (Worker actEnv, HistoryPusher))
-&gt; (RequireCallStackImpl =&gt; m (Worker actEnv, HistoryPusher))
-&gt; m (Worker actEnv, HistoryPusher)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
-&gt; WorkerContextM m (Worker actEnv, HistoryPusher)
-&gt; m (Worker actEnv, HistoryPusher)
forall conf (m :: * -&gt; *) a.
WorkerConfig conf -&gt; WorkerContextM m a -&gt; m a
</span><a href="Temporal.Worker.html#runWorkerContext"><span class="hs-identifier hs-var">runWorkerContext</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180893"><span class="hs-identifier hs-var">conf</span></a></span><span> </span><span class="annot"><span class="annottext">(WorkerContextM m (Worker actEnv, HistoryPusher)
 -&gt; m (Worker actEnv, HistoryPusher))
-&gt; WorkerContextM m (Worker actEnv, HistoryPusher)
-&gt; m (Worker actEnv, HistoryPusher)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-492"></span><span>  </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">logDebug</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Starting worker&quot;</span></span><span>
</span><span id="line-493"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680180980"><span class="annot"><span class="annottext">coreConfig' :: WorkerConfig
</span><a href="#local-6989586621680180980"><span class="hs-identifier hs-var hs-var hs-var">coreConfig'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180893"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">coreConfig</span><span> </span><span class="hs-special">{</span><span class="annot"><span class="hs-identifier hs-var">Core.nondeterminismAsWorkflowFail</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">}</span><span>
</span><span id="line-494"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680180982"><span class="annot"><a href="#local-6989586621680180982"><span class="hs-identifier hs-var">workerCore</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680180983"><span class="annot"><a href="#local-6989586621680180983"><span class="hs-identifier hs-var">replay</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(WorkerError -&gt; WorkerContextM m (Worker 'Replay, HistoryPusher))
-&gt; ((Worker 'Replay, HistoryPusher)
    -&gt; WorkerContextM m (Worker 'Replay, HistoryPusher))
-&gt; Either WorkerError (Worker 'Replay, HistoryPusher)
-&gt; WorkerContextM m (Worker 'Replay, HistoryPusher)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">WorkerError -&gt; WorkerContextM m (Worker 'Replay, HistoryPusher)
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(Worker 'Replay, HistoryPusher)
-&gt; WorkerContextM m (Worker 'Replay, HistoryPusher)
forall a. a -&gt; WorkerContextM m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either WorkerError (Worker 'Replay, HistoryPusher)
 -&gt; WorkerContextM m (Worker 'Replay, HistoryPusher))
-&gt; WorkerContextM
     m (Either WorkerError (Worker 'Replay, HistoryPusher))
-&gt; WorkerContextM m (Worker 'Replay, HistoryPusher)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">IO (Either WorkerError (Worker 'Replay, HistoryPusher))
-&gt; WorkerContextM
     m (Either WorkerError (Worker 'Replay, HistoryPusher))
forall a. IO a -&gt; WorkerContextM m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Runtime
-&gt; WorkerConfig
-&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher))
</span><span class="hs-identifier hs-var">Core.newReplayWorker</span></span><span> </span><span class="annot"><span class="annottext">Runtime
</span><a href="#local-6989586621680180892"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621680180980"><span class="hs-identifier hs-var">coreConfig'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">logDebug</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-string">&quot;Instantiated core&quot;</span></span><span>
</span><span id="line-496"></span><span>  </span><span id="local-6989586621680180989"><span class="annot"><a href="#local-6989586621680180989"><span class="hs-identifier hs-var">workerEvictionEmitter</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newBroadcastTChanIO</span></span><span>
</span><span id="line-497"></span><span>  </span><span id="local-6989586621680180991"><span class="annot"><a href="#local-6989586621680180991"><span class="hs-identifier hs-var">runningWorkflows</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newTVarIO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span>
</span><span id="line-498"></span><span>  </span><span id="local-6989586621680180993"><span class="annot"><a href="#local-6989586621680180993"><span class="hs-identifier hs-var">uuid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">nextRandom</span></span><span>
</span><span id="line-499"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680180994"><span class="annot"><a href="#local-6989586621680180994"><span class="hs-identifier hs-var hs-var">workerWorkflowFunctions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180893"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">wfDefs</span><span>
</span><span id="line-500"></span><span>      </span><span id="local-6989586621680180995"><span class="annot"><a href="#local-6989586621680180995"><span class="hs-identifier hs-var hs-var">workerTaskQueue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TaskQueue
</span><a href="Temporal.Common.html#TaskQueue"><span class="hs-identifier hs-var">TaskQueue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorkerConfig -&gt; Text
</span><span class="hs-identifier hs-var">Core.taskQueue</span></span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180893"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">coreConfig</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">UUID -&gt; Text
</span><span class="hs-identifier hs-var">UUID.toText</span></span><span> </span><span class="annot"><span class="annottext">UUID
</span><a href="#local-6989586621680180993"><span class="hs-identifier hs-var">uuid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-501"></span><span>      </span><span id="local-6989586621680180997"><span class="annot"><a href="#local-6989586621680180997"><span class="hs-identifier hs-var hs-var">workerInboundInterceptors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180893"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">interceptorConfig</span><span class="hs-operator">.</span><span class="hs-identifier">workflowInboundInterceptors</span><span>
</span><span id="line-502"></span><span>      </span><span id="local-6989586621680180998"><span class="annot"><a href="#local-6989586621680180998"><span class="hs-identifier hs-var hs-var">workerOutboundInterceptors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180893"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">interceptorConfig</span><span class="hs-operator">.</span><span class="hs-identifier">workflowOutboundInterceptors</span><span>
</span><span id="line-503"></span><span>      </span><span id="local-6989586621680180999"><span class="annot"><a href="#local-6989586621680180999"><span class="hs-identifier hs-var hs-var">workerDeadlockTimeout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180893"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">deadlockTimeout</span><span>
</span><span id="line-504"></span><span>      </span><span id="local-6989586621680181000"><span class="annot"><a href="#local-6989586621680181000"><span class="hs-identifier hs-var hs-var">workerClient</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-505"></span><span>      </span><span id="local-6989586621680181001"><span class="annot"><a href="#local-6989586621680181001"><span class="hs-identifier hs-var hs-var">workerErrorConverters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180893"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">applicationErrorConverters</span><span>
</span><span id="line-506"></span><span>      </span><span id="local-6989586621680181002"><span class="annot"><a href="#local-6989586621680181002"><span class="hs-identifier hs-var hs-var">processor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180893"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">payloadProcessor</span><span>
</span><span id="line-507"></span><span>      </span><span id="local-6989586621680181003"><span class="annot"><a href="#local-6989586621680181003"><span class="hs-identifier hs-var hs-var">workflowWorker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Temporal.Workflow.Worker.html#WorkflowWorker"><span class="hs-identifier hs-type">Workflow.WorkflowWorker</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">[ApplicationFailureHandler]
Maybe Int
()
HashMap Text WorkflowDefinition
TVar (HashMap RunId WorkflowInstance)
TChan EvictionWithRunID
Worker 'Replay
InactiveForReplay 'Replay Client
PayloadProcessor
TaskQueue
WorkflowOutboundInterceptor
WorkflowInboundInterceptor
workerCore :: Worker 'Replay
workerEvictionEmitter :: TChan EvictionWithRunID
runningWorkflows :: TVar (HashMap RunId WorkflowInstance)
workerWorkflowFunctions :: HashMap Text WorkflowDefinition
workerTaskQueue :: TaskQueue
workerInboundInterceptors :: WorkflowInboundInterceptor
workerOutboundInterceptors :: WorkflowOutboundInterceptor
workerDeadlockTimeout :: Maybe Int
workerClient :: ()
workerErrorConverters :: [ApplicationFailureHandler]
processor :: PayloadProcessor
workerEvictionEmitter :: TChan EvictionWithRunID
processor :: PayloadProcessor
workerErrorConverters :: [ApplicationFailureHandler]
workerTaskQueue :: TaskQueue
workerDeadlockTimeout :: Maybe Int
workerOutboundInterceptors :: WorkflowOutboundInterceptor
workerInboundInterceptors :: WorkflowInboundInterceptor
workerCore :: Worker 'Replay
workerClient :: InactiveForReplay 'Replay Client
runningWorkflows :: TVar (HashMap RunId WorkflowInstance)
workerWorkflowFunctions :: HashMap Text WorkflowDefinition
</span><a href="#local-6989586621680180982"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-508"></span><span>      </span><span id="local-6989586621680181016"><span class="annot"><a href="#local-6989586621680181016"><span class="hs-identifier hs-var hs-var">workerActivityWorker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>      </span><span id="local-6989586621680181017"><span class="annot"><a href="#local-6989586621680181017"><span class="hs-identifier hs-var hs-var">workerActivityLoop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>      </span><span id="local-6989586621680181018"><span class="annot"><a href="#local-6989586621680181018"><span class="hs-identifier hs-var hs-var">workerType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SWorkerType 'Replay
</span><span class="hs-identifier hs-var">Core.SReplay</span></span><span>
</span><span id="line-511"></span><span>      </span><span id="local-6989586621680181020"><span class="annot"><a href="#local-6989586621680181020"><span class="hs-identifier hs-var hs-var">workerTracer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TracerProvider -&gt; InstrumentationLibrary -&gt; TracerOptions -&gt; Tracer
</span><span class="hs-identifier hs-var">makeTracer</span></span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680180893"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">tracerProvider</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; InstrumentationLibrary
</span><span class="hs-identifier hs-var">InstrumentationLibrary</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;hs-temporal-sdk&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;0.0.1.0&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TracerOptions
</span><span class="hs-identifier hs-var">tracerOptions</span></span><span>
</span><span id="line-512"></span><span>  </span><span id="local-6989586621680181024"><span class="annot"><a href="#local-6989586621680181024"><span class="hs-identifier hs-var">workerWorkflowLoop</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Common.Async.html#asyncLabelled"><span class="hs-identifier hs-type">asyncLabelled</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T.unpack</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;temporal/worker/workflow/&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.namespace</span></span><span> </span><span class="annot"><span class="hs-identifier">conf</span></span><span class="hs-operator">.</span><span class="hs-identifier">coreConfig</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;/&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.taskQueue</span></span><span> </span><span class="annot"><span class="hs-identifier">conf</span></span><span class="hs-operator">.</span><span class="hs-identifier">coreConfig</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-513"></span><span>    </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">logDebug</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-string">&quot;Starting workflow worker loop&quot;</span></span><span>
</span><span id="line-514"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Worker.html#execute"><span class="hs-identifier hs-type">Workflow.execute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181003"><span class="hs-identifier hs-type">workflowWorker</span></a></span><span>
</span><span id="line-515"></span><span>      </span><span class="annot"><span class="hs-operator hs-type">`UnliftIO.finally`</span></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">logDebug</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-string">&quot;Exiting workflow worker loop&quot;</span></span><span>
</span><span id="line-516"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-type">Temporal.Worker.Worker</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Worker.html#workerType"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-type hs-type hs-type hs-type hs-type hs-type hs-type">..</span></a></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680180983"><span class="hs-identifier hs-type">replay</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span class="hs-keyword">data</span><span> </span><span id="ReplayHistoryFailure"><span class="annot"><a href="Temporal.Worker.html#ReplayHistoryFailure"><span class="hs-identifier hs-var">ReplayHistoryFailure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ReplayHistoryFailure"><span class="annot"><a href="Temporal.Worker.html#ReplayHistoryFailure"><span class="hs-identifier hs-var">ReplayHistoryFailure</span></a></span></span><span>
</span><span id="line-520"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="message"><span class="annot"><span class="annottext">ReplayHistoryFailure -&gt; Text
</span><a href="Temporal.Worker.html#message"><span class="hs-identifier hs-var hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-521"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-522"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680181033"><span id="local-6989586621680181039"><span id="local-6989586621680181043"><span class="annot"><span class="annottext">Int -&gt; ReplayHistoryFailure -&gt; ShowS
[ReplayHistoryFailure] -&gt; ShowS
ReplayHistoryFailure -&gt; String
(Int -&gt; ReplayHistoryFailure -&gt; ShowS)
-&gt; (ReplayHistoryFailure -&gt; String)
-&gt; ([ReplayHistoryFailure] -&gt; ShowS)
-&gt; Show ReplayHistoryFailure
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; ReplayHistoryFailure -&gt; ShowS
showsPrec :: Int -&gt; ReplayHistoryFailure -&gt; ShowS
$cshow :: ReplayHistoryFailure -&gt; String
show :: ReplayHistoryFailure -&gt; String
$cshowList :: [ReplayHistoryFailure] -&gt; ShowS
showList :: [ReplayHistoryFailure] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181048"><span id="local-6989586621680181051"><span class="annot"><span class="annottext">ReplayHistoryFailure -&gt; ReplayHistoryFailure -&gt; Bool
(ReplayHistoryFailure -&gt; ReplayHistoryFailure -&gt; Bool)
-&gt; (ReplayHistoryFailure -&gt; ReplayHistoryFailure -&gt; Bool)
-&gt; Eq ReplayHistoryFailure
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: ReplayHistoryFailure -&gt; ReplayHistoryFailure -&gt; Bool
== :: ReplayHistoryFailure -&gt; ReplayHistoryFailure -&gt; Bool
$c/= :: ReplayHistoryFailure -&gt; ReplayHistoryFailure -&gt; Bool
/= :: ReplayHistoryFailure -&gt; ReplayHistoryFailure -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680181060"><span id="local-6989586621680181064"><span id="local-6989586621680181067"><span id="local-6989586621680181070"><span class="annot"><span class="annottext">Show ReplayHistoryFailure
Typeable ReplayHistoryFailure
(Typeable ReplayHistoryFailure, Show ReplayHistoryFailure) =&gt;
(ReplayHistoryFailure -&gt; SomeException)
-&gt; (SomeException -&gt; Maybe ReplayHistoryFailure)
-&gt; (ReplayHistoryFailure -&gt; String)
-&gt; (ReplayHistoryFailure -&gt; Bool)
-&gt; Exception ReplayHistoryFailure
SomeException -&gt; Maybe ReplayHistoryFailure
ReplayHistoryFailure -&gt; Bool
ReplayHistoryFailure -&gt; String
ReplayHistoryFailure -&gt; SomeException
forall e.
(Typeable e, Show e) =&gt;
(e -&gt; SomeException)
-&gt; (SomeException -&gt; Maybe e)
-&gt; (e -&gt; String)
-&gt; (e -&gt; Bool)
-&gt; Exception e
$ctoException :: ReplayHistoryFailure -&gt; SomeException
toException :: ReplayHistoryFailure -&gt; SomeException
$cfromException :: SomeException -&gt; Maybe ReplayHistoryFailure
fromException :: SomeException -&gt; Maybe ReplayHistoryFailure
$cdisplayException :: ReplayHistoryFailure -&gt; String
displayException :: ReplayHistoryFailure -&gt; String
$cbacktraceDesired :: ReplayHistoryFailure -&gt; Bool
backtraceDesired :: ReplayHistoryFailure -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Exception</span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span>
</span><span id="line-526"></span><span class="annot"><span class="hs-comment">{- | Run a worker in replay mode, feeding a history to the worker in order to ensure that
the worker execution still works as expected.
-}</span></span><span>
</span><span id="line-529"></span><span id="local-6989586621680180161"><span id="local-6989586621680180162"><span class="annot"><a href="Temporal.Worker.html#runReplayHistory"><span class="hs-identifier hs-type">runReplayHistory</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621680180161"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadCatch</span></span><span> </span><span class="annot"><a href="#local-6989586621680180161"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Runtime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.Types.html#WorkerConfig"><span class="hs-identifier hs-type">WorkerConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180162"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">History</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680180161"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Temporal.Worker.html#ReplayHistoryFailure"><span class="hs-identifier hs-type">ReplayHistoryFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-530"></span><span id="runReplayHistory"><span class="annot"><span class="annottext">runReplayHistory :: forall (m :: * -&gt; *) actEnv.
(MonadUnliftIO m, MonadCatch m) =&gt;
Runtime
-&gt; WorkerConfig actEnv
-&gt; History
-&gt; m (Either ReplayHistoryFailure ())
</span><a href="Temporal.Worker.html#runReplayHistory"><span class="hs-identifier hs-var hs-var">runReplayHistory</span></a></span></span><span> </span><span id="local-6989586621680181119"><span class="annot"><span class="annottext">Runtime
</span><a href="#local-6989586621680181119"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621680181120"><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680181120"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span id="local-6989586621680181121"><span class="annot"><span class="annottext">History
</span><a href="#local-6989586621680181121"><span class="hs-identifier hs-var">history</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
-&gt; WorkerContextM m (Either ReplayHistoryFailure ())
-&gt; m (Either ReplayHistoryFailure ())
forall conf (m :: * -&gt; *) a.
WorkerConfig conf -&gt; WorkerContextM m a -&gt; m a
</span><a href="Temporal.Worker.html#runWorkerContext"><span class="hs-identifier hs-var">runWorkerContext</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680181120"><span class="hs-identifier hs-var">conf</span></a></span><span> </span><span class="annot"><span class="annottext">(WorkerContextM m (Either ReplayHistoryFailure ())
 -&gt; m (Either ReplayHistoryFailure ()))
-&gt; WorkerContextM m (Either ReplayHistoryFailure ())
-&gt; m (Either ReplayHistoryFailure ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WorkerContextM m (Worker actEnv, HistoryPusher)
-&gt; ((Worker actEnv, HistoryPusher) -&gt; WorkerContextM m ())
-&gt; ((Worker actEnv, HistoryPusher)
    -&gt; WorkerContextM m (Either ReplayHistoryFailure ()))
-&gt; WorkerContextM m (Either ReplayHistoryFailure ())
forall (m :: * -&gt; *) a b c.
MonadUnliftIO m =&gt;
m a -&gt; (a -&gt; m b) -&gt; (a -&gt; m c) -&gt; m c
</span><span class="hs-identifier hs-var">UnliftIO.bracket</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Runtime
-&gt; WorkerConfig actEnv
-&gt; WorkerContextM m (Worker actEnv, HistoryPusher)
forall (m :: * -&gt; *) actEnv.
(MonadUnliftIO m, MonadCatch m) =&gt;
Runtime -&gt; WorkerConfig actEnv -&gt; m (Worker actEnv, HistoryPusher)
</span><a href="Temporal.Worker.html#startReplayWorker"><span class="hs-identifier hs-var">startReplayWorker</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime
</span><a href="#local-6989586621680181119"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680181120"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680181123"><span class="annot"><span class="annottext">Worker actEnv
</span><a href="#local-6989586621680181123"><span class="hs-identifier hs-var">worker</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181124"><span class="annot"><span class="annottext">HistoryPusher
</span><a href="#local-6989586621680181124"><span class="hs-identifier hs-var">pusher</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; WorkerContextM m ()
forall a. IO a -&gt; WorkerContextM m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HistoryPusher -&gt; IO ()
</span><span class="hs-identifier hs-var">Core.closeHistory</span></span><span> </span><span class="annot"><span class="annottext">HistoryPusher
</span><a href="#local-6989586621680181124"><span class="hs-identifier hs-var">pusher</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WorkerContextM m () -&gt; WorkerContextM m () -&gt; WorkerContextM m ()
forall a b.
WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Worker actEnv -&gt; WorkerContextM m ()
forall (m :: * -&gt; *) actEnv.
MonadUnliftIO m =&gt;
Worker actEnv -&gt; m ()
</span><a href="Temporal.Worker.html#shutdown"><span class="hs-identifier hs-var">shutdown</span></a></span><span> </span><span class="annot"><span class="annottext">Worker actEnv
</span><a href="#local-6989586621680181123"><span class="hs-identifier hs-var">worker</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((Worker actEnv, HistoryPusher)
  -&gt; WorkerContextM m (Either ReplayHistoryFailure ()))
 -&gt; WorkerContextM m (Either ReplayHistoryFailure ()))
-&gt; ((Worker actEnv, HistoryPusher)
    -&gt; WorkerContextM m (Either ReplayHistoryFailure ()))
-&gt; WorkerContextM m (Either ReplayHistoryFailure ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680181126"><span class="annot"><span class="annottext">Worker actEnv
</span><a href="#local-6989586621680181126"><span class="hs-identifier hs-var">worker</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181127"><span class="annot"><span class="annottext">HistoryPusher
</span><a href="#local-6989586621680181127"><span class="hs-identifier hs-var">pusher</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-531"></span><span>  </span><span id="local-6989586621680181128"><span class="annot"><a href="#local-6989586621680181128"><span class="hs-identifier hs-var">evictions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Worker actEnv -&gt; WorkerContextM m (TChan EvictionWithRunID)
forall (m :: * -&gt; *) actEnv.
MonadIO m =&gt;
Worker actEnv -&gt; m (TChan EvictionWithRunID)
</span><a href="Temporal.Worker.html#subscribeToEvictions"><span class="hs-identifier hs-var">subscribeToEvictions</span></a></span><span> </span><span class="annot"><span class="annottext">Worker actEnv
</span><a href="#local-6989586621680181126"><span class="hs-identifier hs-var">worker</span></a></span><span>
</span><span id="line-532"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680181129"><span class="annot"><a href="#local-6989586621680181129"><span class="hs-identifier hs-var hs-var">mWfId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">History
</span><a href="#local-6989586621680181121"><span class="hs-identifier hs-var">history</span></a></span><span> </span><span class="annot"><span class="annottext">History -&gt; Fold History History ByteString Any -&gt; Maybe ByteString
forall s t a b. s -&gt; Fold s t a b -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f History (Vector HistoryEvent)
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;vec'events&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">vec'events</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f History (Vector HistoryEvent)
-&gt; ((ByteString -&gt; f Any)
    -&gt; Vector HistoryEvent -&gt; f (Vector HistoryEvent))
-&gt; (ByteString -&gt; f Any)
-&gt; History
-&gt; f History
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(HistoryEvent -&gt; f HistoryEvent)
-&gt; Vector HistoryEvent -&gt; f (Vector HistoryEvent)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; Vector a -&gt; f (Vector b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">((HistoryEvent -&gt; f HistoryEvent)
 -&gt; Vector HistoryEvent -&gt; f (Vector HistoryEvent))
-&gt; ((ByteString -&gt; f Any) -&gt; HistoryEvent -&gt; f HistoryEvent)
-&gt; (ByteString -&gt; f Any)
-&gt; Vector HistoryEvent
-&gt; f (Vector HistoryEvent)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LensLike'
  f HistoryEvent (Maybe WorkflowExecutionStartedEventAttributes)
forall (f :: * -&gt; *) s a.
(Functor f,
 HasField s &quot;maybe'workflowExecutionStartedEventAttributes&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">maybe'workflowExecutionStartedEventAttributes</span></span><span> </span><span class="annot"><span class="annottext">LensLike'
  f HistoryEvent (Maybe WorkflowExecutionStartedEventAttributes)
-&gt; ((ByteString -&gt; f Any)
    -&gt; Maybe WorkflowExecutionStartedEventAttributes
    -&gt; f (Maybe WorkflowExecutionStartedEventAttributes))
-&gt; (ByteString -&gt; f Any)
-&gt; HistoryEvent
-&gt; f HistoryEvent
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(WorkflowExecutionStartedEventAttributes
 -&gt; f WorkflowExecutionStartedEventAttributes)
-&gt; Maybe WorkflowExecutionStartedEventAttributes
-&gt; f (Maybe WorkflowExecutionStartedEventAttributes)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; Maybe a -&gt; f (Maybe b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">((WorkflowExecutionStartedEventAttributes
  -&gt; f WorkflowExecutionStartedEventAttributes)
 -&gt; Maybe WorkflowExecutionStartedEventAttributes
 -&gt; f (Maybe WorkflowExecutionStartedEventAttributes))
-&gt; ((ByteString -&gt; f Any)
    -&gt; WorkflowExecutionStartedEventAttributes
    -&gt; f WorkflowExecutionStartedEventAttributes)
-&gt; (ByteString -&gt; f Any)
-&gt; Maybe WorkflowExecutionStartedEventAttributes
-&gt; f (Maybe WorkflowExecutionStartedEventAttributes)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f WorkflowExecutionStartedEventAttributes Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;workflowId&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">workflowId</span></span><span> </span><span class="annot"><span class="annottext">LensLike' f WorkflowExecutionStartedEventAttributes Text
-&gt; ((ByteString -&gt; f Any) -&gt; Text -&gt; f Text)
-&gt; (ByteString -&gt; f Any)
-&gt; WorkflowExecutionStartedEventAttributes
-&gt; f WorkflowExecutionStartedEventAttributes
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ByteString) -&gt; Getter Text Text ByteString Any
forall s a t b. (s -&gt; a) -&gt; Getter s t a b
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><span class="hs-identifier hs-var">T.encodeUtf8</span></span><span>
</span><span id="line-533"></span><span>  </span><span id="local-6989586621680181154"><span class="annot"><a href="#local-6989586621680181154"><span class="hs-identifier hs-var">wfId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">throwIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">userError</span></span><span> </span><span class="annot"><span class="hs-string">&quot;No workflow ID found in history&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621680181129"><span class="hs-identifier hs-type">mWfId</span></a></span><span>
</span><span id="line-534"></span><span>  </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">logDebug</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Pushing history for workflow ID &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621680181154"><span class="hs-identifier hs-type">wfId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-535"></span><span>  </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">logDebug</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.pack</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621680181121"><span class="hs-identifier hs-type">history</span></a></span><span>
</span><span id="line-536"></span><span>  </span><span id="local-6989586621680181158"><span class="annot"><a href="#local-6989586621680181158"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Core.pushHistory</span></span><span> </span><span class="annot"><a href="#local-6989586621680181127"><span class="hs-identifier hs-type">pusher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181154"><span class="hs-identifier hs-type">wfId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">encodeMessage</span></span><span> </span><span class="annot"><a href="#local-6989586621680181121"><span class="hs-identifier hs-type">history</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-537"></span><span>  </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">logDebug</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Pushed history for workflow ID &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621680181154"><span class="hs-identifier hs-type">wfId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-538"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680181158"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-539"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680181160"><span class="annot"><span class="annottext">WorkerError
</span><a href="#local-6989586621680181160"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either ReplayHistoryFailure ()
-&gt; WorkerContextM m (Either ReplayHistoryFailure ())
forall a. a -&gt; WorkerContextM m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either ReplayHistoryFailure ()
 -&gt; WorkerContextM m (Either ReplayHistoryFailure ()))
-&gt; Either ReplayHistoryFailure ()
-&gt; WorkerContextM m (Either ReplayHistoryFailure ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ReplayHistoryFailure -&gt; Either ReplayHistoryFailure ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(ReplayHistoryFailure -&gt; Either ReplayHistoryFailure ())
-&gt; ReplayHistoryFailure -&gt; Either ReplayHistoryFailure ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Temporal.Worker.html#ReplayHistoryFailure"><span class="hs-identifier hs-type">ReplayHistoryFailure</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">message :: Text
</span><a href="Temporal.Worker.html#message"><span class="hs-identifier hs-var">message</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerError
</span><a href="#local-6989586621680181160"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">message</span><span class="hs-special">}</span><span>
</span><span id="line-540"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-541"></span><span>      </span><span id="local-6989586621680181161"><span class="annot"><a href="#local-6989586621680181161"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STM EvictionWithRunID -&gt; WorkerContextM m EvictionWithRunID
forall (m :: * -&gt; *) a. MonadIO m =&gt; STM a -&gt; m a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM EvictionWithRunID -&gt; WorkerContextM m EvictionWithRunID)
-&gt; STM EvictionWithRunID -&gt; WorkerContextM m EvictionWithRunID
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TChan EvictionWithRunID -&gt; STM EvictionWithRunID
forall a. TChan a -&gt; STM a
</span><span class="hs-identifier hs-var">readTChan</span></span><span> </span><span class="annot"><span class="annottext">TChan EvictionWithRunID
</span><a href="#local-6989586621680181128"><span class="hs-identifier hs-var">evictions</span></a></span><span>
</span><span id="line-542"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="Temporal.Worker.html#evictionWasFatal"><span class="hs-identifier hs-type">evictionWasFatal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181161"><span class="hs-identifier hs-type">res</span></a></span><span>
</span><span id="line-543"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Worker.html#ReplayHistoryFailure"><span class="hs-identifier hs-type">ReplayHistoryFailure</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Worker.html#message"><span class="hs-identifier hs-var">message</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Temporal.Worker.html#evictionMessage"><span class="hs-identifier hs-type">evictionMessage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181161"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-544"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span id="local-6989586621680180214"><span id="local-6989586621680180215"><span id="local-6989586621680180216"><span class="annot"><a href="Temporal.Worker.html#traced"><span class="hs-identifier hs-type">traced</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Worker.Types.html#WorkerConfig"><span class="hs-identifier hs-type">WorkerConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180214"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tracer</span></span><span> </span><span class="annot"><a href="#local-6989586621680180215"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180216"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680180215"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180216"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-548"></span><span id="traced"><span class="annot"><span class="annottext">traced :: forall env (m :: * -&gt; *) a.
WorkerConfig env -&gt; ReaderT Tracer m a -&gt; m a
</span><a href="Temporal.Worker.html#traced"><span class="hs-identifier hs-var hs-var">traced</span></a></span></span><span> </span><span id="local-6989586621680181168"><span class="annot"><span class="annottext">WorkerConfig env
</span><a href="#local-6989586621680181168"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span id="local-6989586621680181169"><span class="annot"><span class="annottext">ReaderT Tracer m a
</span><a href="#local-6989586621680181169"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-549"></span><span>  </span><span class="annot"><span class="annottext">ReaderT Tracer m a -&gt; Tracer -&gt; m a
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">ReaderT Tracer m a
</span><a href="#local-6989586621680181169"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(Tracer -&gt; m a) -&gt; Tracer -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-550"></span><span>    </span><span class="annot"><span class="annottext">TracerProvider -&gt; InstrumentationLibrary -&gt; TracerOptions -&gt; Tracer
</span><span class="hs-identifier hs-var">makeTracer</span></span><span>
</span><span id="line-551"></span><span>      </span><span class="annot"><span class="annottext">WorkerConfig env
</span><a href="#local-6989586621680181168"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">tracerProvider</span><span>
</span><span id="line-552"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; InstrumentationLibrary
</span><span class="hs-identifier hs-var">InstrumentationLibrary</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;hs-temporal-sdk&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;0.0.1.0&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>      </span><span class="annot"><span class="annottext">TracerOptions
</span><span class="hs-identifier hs-var">tracerOptions</span></span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span id="local-6989586621680180118"><span id="local-6989586621680180119"><span id="local-6989586621680180120"><span class="annot"><a href="Temporal.Worker.html#runWorkerContext"><span class="hs-identifier hs-type">runWorkerContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Worker.Types.html#WorkerConfig"><span class="hs-identifier hs-type">WorkerConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180118"><span class="hs-identifier hs-type">conf</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#WorkerContextM"><span class="hs-identifier hs-type">WorkerContextM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180119"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180120"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680180119"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180120"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-557"></span><span id="runWorkerContext"><span class="annot"><span class="annottext">runWorkerContext :: forall conf (m :: * -&gt; *) a.
WorkerConfig conf -&gt; WorkerContextM m a -&gt; m a
</span><a href="Temporal.Worker.html#runWorkerContext"><span class="hs-identifier hs-var hs-var">runWorkerContext</span></a></span></span><span> </span><span id="local-6989586621680181172"><span class="annot"><span class="annottext">WorkerConfig conf
</span><a href="#local-6989586621680181172"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#WorkerContextM"><span class="hs-identifier hs-type">WorkerContextM</span></a></span><span> </span><span id="local-6989586621680181174"><span class="annot"><span class="annottext">ReaderT Tracer (LoggingT m) a
</span><a href="#local-6989586621680181174"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LoggingT m a
 -&gt; (Loc -&gt; Text -&gt; LogLevel -&gt; LogStr -&gt; IO ()) -&gt; m a)
-&gt; (Loc -&gt; Text -&gt; LogLevel -&gt; LogStr -&gt; IO ())
-&gt; LoggingT m a
-&gt; m a
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">LoggingT m a -&gt; (Loc -&gt; Text -&gt; LogLevel -&gt; LogStr -&gt; IO ()) -&gt; m a
forall (m :: * -&gt; *) a.
LoggingT m a -&gt; (Loc -&gt; Text -&gt; LogLevel -&gt; LogStr -&gt; IO ()) -&gt; m a
</span><span class="hs-identifier hs-var">runLoggingT</span></span><span> </span><span class="annot"><span class="annottext">WorkerConfig conf
</span><a href="#local-6989586621680181172"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">logger</span><span> </span><span class="annot"><span class="annottext">(LoggingT m a -&gt; m a) -&gt; LoggingT m a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WorkerConfig conf -&gt; ReaderT Tracer (LoggingT m) a -&gt; LoggingT m a
forall env (m :: * -&gt; *) a.
WorkerConfig env -&gt; ReaderT Tracer m a -&gt; m a
</span><a href="Temporal.Worker.html#traced"><span class="hs-identifier hs-var">traced</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerConfig conf
</span><a href="#local-6989586621680181172"><span class="hs-identifier hs-var">conf</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT Tracer (LoggingT m) a
</span><a href="#local-6989586621680181174"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span>
</span><span id="line-560"></span><span class="hs-keyword">newtype</span><span> </span><span id="WorkerContextM"><span class="annot"><a href="Temporal.Worker.html#WorkerContextM"><span class="hs-identifier hs-var">WorkerContextM</span></a></span></span><span> </span><span id="local-6989586621680180312"><span class="annot"><a href="#local-6989586621680180312"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680180313"><span class="annot"><a href="#local-6989586621680180313"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WorkerContextM"><span class="annot"><a href="Temporal.Worker.html#WorkerContextM"><span class="hs-identifier hs-var">WorkerContextM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tracer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LoggingT</span></span><span> </span><span class="annot"><a href="#local-6989586621680180312"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680180313"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680181178"><span id="local-6989586621680181184"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; WorkerContextM m a -&gt; WorkerContextM m b)
-&gt; (forall a b. a -&gt; WorkerContextM m b -&gt; WorkerContextM m a)
-&gt; Functor (WorkerContextM m)
forall a b. a -&gt; WorkerContextM m b -&gt; WorkerContextM m a
forall a b. (a -&gt; b) -&gt; WorkerContextM m a -&gt; WorkerContextM m b
forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; WorkerContextM m b -&gt; WorkerContextM m a
forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; WorkerContextM m a -&gt; WorkerContextM m b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; WorkerContextM m a -&gt; WorkerContextM m b
fmap :: forall a b. (a -&gt; b) -&gt; WorkerContextM m a -&gt; WorkerContextM m b
$c&lt;$ :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; WorkerContextM m b -&gt; WorkerContextM m a
&lt;$ :: forall a b. a -&gt; WorkerContextM m b -&gt; WorkerContextM m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181195"><span id="local-6989586621680181201"><span id="local-6989586621680181206"><span id="local-6989586621680181211"><span id="local-6989586621680181216"><span class="annot"><span class="annottext">Functor (WorkerContextM m)
Functor (WorkerContextM m) =&gt;
(forall a. a -&gt; WorkerContextM m a)
-&gt; (forall a b.
    WorkerContextM m (a -&gt; b)
    -&gt; WorkerContextM m a -&gt; WorkerContextM m b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c)
    -&gt; WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m c)
-&gt; (forall a b.
    WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m b)
-&gt; (forall a b.
    WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m a)
-&gt; Applicative (WorkerContextM m)
forall a. a -&gt; WorkerContextM m a
forall a b.
WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m a
forall a b.
WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m b
forall a b.
WorkerContextM m (a -&gt; b)
-&gt; WorkerContextM m a -&gt; WorkerContextM m b
forall a b c.
(a -&gt; b -&gt; c)
-&gt; WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m c
forall (f :: * -&gt; *).
Functor f =&gt;
(forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
forall (m :: * -&gt; *). Applicative m =&gt; Functor (WorkerContextM m)
forall (m :: * -&gt; *) a. Applicative m =&gt; a -&gt; WorkerContextM m a
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m a
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m b
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
WorkerContextM m (a -&gt; b)
-&gt; WorkerContextM m a -&gt; WorkerContextM m b
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; c)
-&gt; WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m c
$cpure :: forall (m :: * -&gt; *) a. Applicative m =&gt; a -&gt; WorkerContextM m a
pure :: forall a. a -&gt; WorkerContextM m a
$c&lt;*&gt; :: forall (m :: * -&gt; *) a b.
Applicative m =&gt;
WorkerContextM m (a -&gt; b)
-&gt; WorkerContextM m a -&gt; WorkerContextM m b
&lt;*&gt; :: forall a b.
WorkerContextM m (a -&gt; b)
-&gt; WorkerContextM m a -&gt; WorkerContextM m b
$cliftA2 :: forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; c)
-&gt; WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m c
liftA2 :: forall a b c.
(a -&gt; b -&gt; c)
-&gt; WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m c
$c*&gt; :: forall (m :: * -&gt; *) a b.
Applicative m =&gt;
WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m b
*&gt; :: forall a b.
WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m b
$c&lt;* :: forall (m :: * -&gt; *) a b.
Applicative m =&gt;
WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m a
&lt;* :: forall a b.
WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181227"><span id="local-6989586621680181233"><span id="local-6989586621680181238"><span class="annot"><span class="annottext">Applicative (WorkerContextM m)
Applicative (WorkerContextM m) =&gt;
(forall a b.
 WorkerContextM m a
 -&gt; (a -&gt; WorkerContextM m b) -&gt; WorkerContextM m b)
-&gt; (forall a b.
    WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m b)
-&gt; (forall a. a -&gt; WorkerContextM m a)
-&gt; Monad (WorkerContextM m)
forall a. a -&gt; WorkerContextM m a
forall a b.
WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m b
forall a b.
WorkerContextM m a
-&gt; (a -&gt; WorkerContextM m b) -&gt; WorkerContextM m b
forall (m :: * -&gt; *). Monad m =&gt; Applicative (WorkerContextM m)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; WorkerContextM m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
WorkerContextM m a
-&gt; (a -&gt; WorkerContextM m b) -&gt; WorkerContextM m b
forall (m :: * -&gt; *).
Applicative m =&gt;
(forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
WorkerContextM m a
-&gt; (a -&gt; WorkerContextM m b) -&gt; WorkerContextM m b
&gt;&gt;= :: forall a b.
WorkerContextM m a
-&gt; (a -&gt; WorkerContextM m b) -&gt; WorkerContextM m b
$c&gt;&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m b
&gt;&gt; :: forall a b.
WorkerContextM m a -&gt; WorkerContextM m b -&gt; WorkerContextM m b
$creturn :: forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; WorkerContextM m a
return :: forall a. a -&gt; WorkerContextM m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181248"><span class="annot"><span class="annottext">Monad (WorkerContextM m)
Monad (WorkerContextM m) =&gt;
(forall a. IO a -&gt; WorkerContextM m a)
-&gt; MonadIO (WorkerContextM m)
forall a. IO a -&gt; WorkerContextM m a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall a. IO a -&gt; m a) -&gt; MonadIO m
forall (m :: * -&gt; *). MonadIO m =&gt; Monad (WorkerContextM m)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; WorkerContextM m a
$cliftIO :: forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; WorkerContextM m a
liftIO :: forall a. IO a -&gt; WorkerContextM m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181260"><span class="annot"><span class="annottext">MonadIO (WorkerContextM m)
MonadIO (WorkerContextM m) =&gt;
(forall b.
 ((forall a. WorkerContextM m a -&gt; IO a) -&gt; IO b)
 -&gt; WorkerContextM m b)
-&gt; MonadUnliftIO (WorkerContextM m)
forall b.
((forall a. WorkerContextM m a -&gt; IO a) -&gt; IO b)
-&gt; WorkerContextM m b
forall (m :: * -&gt; *).
MonadIO m =&gt;
(forall b. ((forall a. m a -&gt; IO a) -&gt; IO b) -&gt; m b)
-&gt; MonadUnliftIO m
forall (m :: * -&gt; *). MonadUnliftIO m =&gt; MonadIO (WorkerContextM m)
forall (m :: * -&gt; *) b.
MonadUnliftIO m =&gt;
((forall a. WorkerContextM m a -&gt; IO a) -&gt; IO b)
-&gt; WorkerContextM m b
$cwithRunInIO :: forall (m :: * -&gt; *) b.
MonadUnliftIO m =&gt;
((forall a. WorkerContextM m a -&gt; IO a) -&gt; IO b)
-&gt; WorkerContextM m b
withRunInIO :: forall b.
((forall a. WorkerContextM m a -&gt; IO a) -&gt; IO b)
-&gt; WorkerContextM m b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadUnliftIO</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181275"><span class="annot"><span class="annottext">Monad (WorkerContextM m)
Monad (WorkerContextM m) =&gt;
(forall msg.
 ToLogStr msg =&gt;
 Loc -&gt; Text -&gt; LogLevel -&gt; msg -&gt; WorkerContextM m ())
-&gt; MonadLogger (WorkerContextM m)
forall msg.
ToLogStr msg =&gt;
Loc -&gt; Text -&gt; LogLevel -&gt; msg -&gt; WorkerContextM m ()
forall (m :: * -&gt; *).
Monad m =&gt;
(forall msg.
 ToLogStr msg =&gt;
 Loc -&gt; Text -&gt; LogLevel -&gt; msg -&gt; m ())
-&gt; MonadLogger m
forall (m :: * -&gt; *). MonadIO m =&gt; Monad (WorkerContextM m)
forall (m :: * -&gt; *) msg.
(MonadIO m, ToLogStr msg) =&gt;
Loc -&gt; Text -&gt; LogLevel -&gt; msg -&gt; WorkerContextM m ()
$cmonadLoggerLog :: forall (m :: * -&gt; *) msg.
(MonadIO m, ToLogStr msg) =&gt;
Loc -&gt; Text -&gt; LogLevel -&gt; msg -&gt; WorkerContextM m ()
monadLoggerLog :: forall msg.
ToLogStr msg =&gt;
Loc -&gt; Text -&gt; LogLevel -&gt; msg -&gt; WorkerContextM m ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadLogger</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181290"><span class="annot"><span class="annottext">MonadIO (WorkerContextM m)
MonadLogger (WorkerContextM m)
WorkerContextM m (Loc -&gt; Text -&gt; LogLevel -&gt; LogStr -&gt; IO ())
(MonadLogger (WorkerContextM m), MonadIO (WorkerContextM m)) =&gt;
WorkerContextM m (Loc -&gt; Text -&gt; LogLevel -&gt; LogStr -&gt; IO ())
-&gt; MonadLoggerIO (WorkerContextM m)
forall (m :: * -&gt; *). MonadIO m =&gt; MonadIO (WorkerContextM m)
forall (m :: * -&gt; *). MonadIO m =&gt; MonadLogger (WorkerContextM m)
forall (m :: * -&gt; *).
MonadIO m =&gt;
WorkerContextM m (Loc -&gt; Text -&gt; LogLevel -&gt; LogStr -&gt; IO ())
forall (m :: * -&gt; *).
(MonadLogger m, MonadIO m) =&gt;
m (Loc -&gt; Text -&gt; LogLevel -&gt; LogStr -&gt; IO ()) -&gt; MonadLoggerIO m
$caskLoggerIO :: forall (m :: * -&gt; *).
MonadIO m =&gt;
WorkerContextM m (Loc -&gt; Text -&gt; LogLevel -&gt; LogStr -&gt; IO ())
askLoggerIO :: WorkerContextM m (Loc -&gt; Text -&gt; LogLevel -&gt; LogStr -&gt; IO ())
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">MonadLoggerIO</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181309"><span class="annot"><span class="annottext">MonadThrow (WorkerContextM m)
MonadThrow (WorkerContextM m) =&gt;
(forall e a.
 (HasCallStack, Exception e) =&gt;
 WorkerContextM m a
 -&gt; (e -&gt; WorkerContextM m a) -&gt; WorkerContextM m a)
-&gt; MonadCatch (WorkerContextM m)
forall e a.
(HasCallStack, Exception e) =&gt;
WorkerContextM m a
-&gt; (e -&gt; WorkerContextM m a) -&gt; WorkerContextM m a
forall (m :: * -&gt; *).
MonadThrow m =&gt;
(forall e a.
 (HasCallStack, Exception e) =&gt;
 m a -&gt; (e -&gt; m a) -&gt; m a)
-&gt; MonadCatch m
forall (m :: * -&gt; *). MonadCatch m =&gt; MonadThrow (WorkerContextM m)
forall (m :: * -&gt; *) e a.
(MonadCatch m, HasCallStack, Exception e) =&gt;
WorkerContextM m a
-&gt; (e -&gt; WorkerContextM m a) -&gt; WorkerContextM m a
$ccatch :: forall (m :: * -&gt; *) e a.
(MonadCatch m, HasCallStack, Exception e) =&gt;
WorkerContextM m a
-&gt; (e -&gt; WorkerContextM m a) -&gt; WorkerContextM m a
catch :: forall e a.
(HasCallStack, Exception e) =&gt;
WorkerContextM m a
-&gt; (e -&gt; WorkerContextM m a) -&gt; WorkerContextM m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadCatch</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181333"><span class="annot"><span class="annottext">Monad (WorkerContextM m)
Monad (WorkerContextM m) =&gt;
(forall e a.
 (HasCallStack, Exception e) =&gt;
 e -&gt; WorkerContextM m a)
-&gt; MonadThrow (WorkerContextM m)
forall e a. (HasCallStack, Exception e) =&gt; e -&gt; WorkerContextM m a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall e a. (HasCallStack, Exception e) =&gt; e -&gt; m a)
-&gt; MonadThrow m
forall (m :: * -&gt; *). MonadThrow m =&gt; Monad (WorkerContextM m)
forall (m :: * -&gt; *) e a.
(MonadThrow m, HasCallStack, Exception e) =&gt;
e -&gt; WorkerContextM m a
$cthrowM :: forall (m :: * -&gt; *) e a.
(MonadThrow m, HasCallStack, Exception e) =&gt;
e -&gt; WorkerContextM m a
throwM :: forall e a. (HasCallStack, Exception e) =&gt; e -&gt; WorkerContextM m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadThrow</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680180110"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621680180110"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTracer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#WorkerContextM"><span class="hs-identifier hs-type">WorkerContextM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180110"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-565"></span><span>  </span><span id="local-6989586621680181355"><span class="annot"><span class="annottext">getTracer :: WorkerContextM m Tracer
</span><a href="#local-6989586621680181355"><span class="hs-identifier hs-var hs-var hs-var">getTracer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT Tracer (LoggingT m) Tracer -&gt; WorkerContextM m Tracer
forall (m :: * -&gt; *) a.
ReaderT Tracer (LoggingT m) a -&gt; WorkerContextM m a
</span><a href="Temporal.Worker.html#WorkerContextM"><span class="hs-identifier hs-var">WorkerContextM</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT Tracer (LoggingT m) Tracer
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span>
</span><span id="line-568"></span><span id="local-6989586621680180316"><span id="local-6989586621680180317"><span class="annot"><a href="Temporal.Worker.html#startWorker"><span class="hs-identifier hs-type">startWorker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621680180316"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadCatch</span></span><span> </span><span class="annot"><a href="#local-6989586621680180316"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Client</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.Types.html#WorkerConfig"><span class="hs-identifier hs-type">WorkerConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180317"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680180316"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-type">Temporal.Worker.Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180317"><span class="hs-identifier hs-type">actEnv</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-569"></span><span id="startWorker"><span class="annot"><span class="annottext">startWorker :: forall (m :: * -&gt; *) actEnv.
(MonadUnliftIO m, MonadCatch m) =&gt;
Client -&gt; WorkerConfig actEnv -&gt; m (Worker actEnv)
</span><a href="Temporal.Worker.html#startWorker"><span class="hs-identifier hs-var hs-var">startWorker</span></a></span></span><span> </span><span id="local-6989586621680181363"><span class="annot"><span class="annottext">Client
</span><a href="#local-6989586621680181363"><span class="hs-identifier hs-var">client</span></a></span></span><span> </span><span id="local-6989586621680181364"><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680181364"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RequireCallStackImpl =&gt; m (Worker actEnv)) -&gt; m (Worker actEnv)
forall r. (RequireCallStackImpl =&gt; r) -&gt; r
</span><span class="hs-identifier hs-var">provideCallStack</span></span><span> </span><span class="annot"><span class="annottext">((RequireCallStackImpl =&gt; m (Worker actEnv)) -&gt; m (Worker actEnv))
-&gt; (RequireCallStackImpl =&gt; m (Worker actEnv)) -&gt; m (Worker actEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
-&gt; WorkerContextM m (Worker actEnv) -&gt; m (Worker actEnv)
forall conf (m :: * -&gt; *) a.
WorkerConfig conf -&gt; WorkerContextM m a -&gt; m a
</span><a href="Temporal.Worker.html#runWorkerContext"><span class="hs-identifier hs-var">runWorkerContext</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680181364"><span class="hs-identifier hs-var">conf</span></a></span><span> </span><span class="annot"><span class="annottext">(WorkerContextM m (Worker actEnv) -&gt; m (Worker actEnv))
-&gt; WorkerContextM m (Worker actEnv) -&gt; m (Worker actEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; SpanArguments
-&gt; WorkerContextM m (Worker actEnv)
-&gt; WorkerContextM m (Worker actEnv)
forall (m :: * -&gt; *) a.
(MonadUnliftIO m, MonadTracer m, HasCallStack) =&gt;
Text -&gt; SpanArguments -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">inSpan</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;startWorker&quot;</span></span><span> </span><span class="annot"><span class="annottext">SpanArguments
</span><span class="hs-identifier hs-var">defaultSpanArguments</span></span><span> </span><span class="annot"><span class="annottext">(WorkerContextM m (Worker actEnv)
 -&gt; WorkerContextM m (Worker actEnv))
-&gt; WorkerContextM m (Worker actEnv)
-&gt; WorkerContextM m (Worker actEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-570"></span><span>  </span><span id="local-6989586621680181470"><span class="annot"><a href="#local-6989586621680181470"><span class="hs-identifier hs-var">workerCore</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-571"></span><span>    </span><span class="annot"><span class="annottext">Text
-&gt; SpanArguments
-&gt; WorkerContextM m (Worker 'Real)
-&gt; WorkerContextM m (Worker 'Real)
forall (m :: * -&gt; *) a.
(MonadUnliftIO m, MonadTracer m, HasCallStack) =&gt;
Text -&gt; SpanArguments -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">inSpan</span></span><span>
</span><span id="line-572"></span><span>      </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Core.newWorker&quot;</span></span><span>
</span><span id="line-573"></span><span>      </span><span class="annot"><span class="annottext">SpanArguments
</span><span class="hs-identifier hs-var">defaultSpanArguments</span></span><span>
</span><span id="line-574"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(WorkerError -&gt; WorkerContextM m (Worker 'Real))
-&gt; (Worker 'Real -&gt; WorkerContextM m (Worker 'Real))
-&gt; Either WorkerError (Worker 'Real)
-&gt; WorkerContextM m (Worker 'Real)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">WorkerError -&gt; WorkerContextM m (Worker 'Real)
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">Worker 'Real -&gt; WorkerContextM m (Worker 'Real)
forall a. a -&gt; WorkerContextM m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either WorkerError (Worker 'Real)
 -&gt; WorkerContextM m (Worker 'Real))
-&gt; WorkerContextM m (Either WorkerError (Worker 'Real))
-&gt; WorkerContextM m (Worker 'Real)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">IO (Either WorkerError (Worker 'Real))
-&gt; WorkerContextM m (Either WorkerError (Worker 'Real))
forall a. IO a -&gt; WorkerContextM m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Client -&gt; WorkerConfig -&gt; IO (Either WorkerError (Worker 'Real))
</span><span class="hs-identifier hs-var">Core.newWorker</span></span><span> </span><span class="annot"><span class="annottext">Client
</span><a href="#local-6989586621680181363"><span class="hs-identifier hs-var">client</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680181364"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">coreConfig</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>  </span><span id="local-6989586621680181472"><span class="annot"><a href="#local-6989586621680181472"><span class="hs-identifier hs-var">validationRes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Core.validateWorker</span></span><span> </span><span class="annot"><a href="#local-6989586621680181470"><span class="hs-identifier hs-type">workerCore</span></a></span><span>
</span><span id="line-576"></span><span>  </span><span id="local-6989586621680181474"><span class="annot"><a href="#local-6989586621680181474"><span class="hs-identifier hs-var">workerEvictionEmitter</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newBroadcastTChanIO</span></span><span>
</span><span id="line-577"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680181472"><span class="hs-identifier hs-type">validationRes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-578"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680181475"><span class="annot"><span class="annottext">WorkerValidationError
</span><a href="#local-6989586621680181475"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkerValidationError -&gt; WorkerContextM m ()
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">WorkerValidationError
</span><a href="#local-6989586621680181475"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-579"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; WorkerContextM m ()
forall a. a -&gt; WorkerContextM m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-580"></span><span>  </span><span id="local-6989586621680181476"><span class="annot"><a href="#local-6989586621680181476"><span class="hs-identifier hs-var">runningWorkflows</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newTVarIO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span>
</span><span id="line-581"></span><span>  </span><span id="local-6989586621680181477"><span class="annot"><a href="#local-6989586621680181477"><span class="hs-identifier hs-var">runningActivities</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newTVarIO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span>
</span><span id="line-582"></span><span>  </span><span id="local-6989586621680181478"><span class="annot"><a href="#local-6989586621680181478"><span class="hs-identifier hs-var">activityEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><span class="hs-identifier">conf</span></span><span class="hs-operator">.</span><span class="hs-identifier">actEnv</span><span>
</span><span id="line-583"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680181480"><span class="annot"><a href="#local-6989586621680181480"><span class="hs-identifier hs-var hs-var">errorConverters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ApplicationFailureHandler] -&gt; [ApplicationFailureHandler]
</span><a href="Temporal.Exception.html#mkAnnotatedHandlers"><span class="hs-identifier hs-var">mkAnnotatedHandlers</span></a></span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680181364"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">applicationErrorConverters</span><span>
</span><span id="line-584"></span><span>      </span><span id="local-6989586621680181482"><span class="annot"><a href="#local-6989586621680181482"><span class="hs-identifier hs-var hs-var">workerWorkflowFunctions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680181364"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">wfDefs</span><span>
</span><span id="line-585"></span><span>      </span><span id="local-6989586621680181483"><span class="annot"><a href="#local-6989586621680181483"><span class="hs-identifier hs-var hs-var">workerTaskQueue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TaskQueue
</span><a href="Temporal.Common.html#TaskQueue"><span class="hs-identifier hs-var">TaskQueue</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; TaskQueue) -&gt; Text -&gt; TaskQueue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WorkerConfig -&gt; Text
</span><span class="hs-identifier hs-var">Core.taskQueue</span></span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680181364"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">coreConfig</span><span>
</span><span id="line-586"></span><span>      </span><span id="local-6989586621680181484"><span class="annot"><a href="#local-6989586621680181484"><span class="hs-identifier hs-var hs-var">workerInboundInterceptors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680181364"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">interceptorConfig</span><span class="hs-operator">.</span><span class="hs-identifier">workflowInboundInterceptors</span><span>
</span><span id="line-587"></span><span>      </span><span id="local-6989586621680181485"><span class="annot"><a href="#local-6989586621680181485"><span class="hs-identifier hs-var hs-var">workerOutboundInterceptors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680181364"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">interceptorConfig</span><span class="hs-operator">.</span><span class="hs-identifier">workflowOutboundInterceptors</span><span>
</span><span id="line-588"></span><span>      </span><span id="local-6989586621680181486"><span class="annot"><a href="#local-6989586621680181486"><span class="hs-identifier hs-var hs-var">workerDeadlockTimeout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680181364"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">deadlockTimeout</span><span>
</span><span id="line-589"></span><span>      </span><span id="local-6989586621680181487"><span class="annot"><a href="#local-6989586621680181487"><span class="hs-identifier hs-var hs-var">workerErrorConverters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ApplicationFailureHandler]
</span><a href="#local-6989586621680181480"><span class="hs-identifier hs-var">errorConverters</span></a></span><span>
</span><span id="line-590"></span><span>      </span><span id="local-6989586621680181488"><span class="annot"><a href="#local-6989586621680181488"><span class="hs-identifier hs-var hs-var">processor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680181364"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">payloadProcessor</span><span>
</span><span id="line-591"></span><span>      </span><span id="local-6989586621680181489"><span class="annot"><a href="#local-6989586621680181489"><span class="hs-identifier hs-var hs-var">workflowWorker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Temporal.Workflow.Worker.html#WorkflowWorker"><span class="hs-identifier hs-type">Workflow.WorkflowWorker</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">[ApplicationFailureHandler]
Maybe Int
HashMap Text WorkflowDefinition
TVar (HashMap RunId WorkflowInstance)
TChan EvictionWithRunID
Client
Worker 'Real
InactiveForReplay 'Real Client
PayloadProcessor
TaskQueue
WorkflowOutboundInterceptor
WorkflowInboundInterceptor
workerEvictionEmitter :: TChan EvictionWithRunID
processor :: PayloadProcessor
workerErrorConverters :: [ApplicationFailureHandler]
workerTaskQueue :: TaskQueue
workerDeadlockTimeout :: Maybe Int
workerOutboundInterceptors :: WorkflowOutboundInterceptor
workerInboundInterceptors :: WorkflowInboundInterceptor
workerCore :: Worker 'Real
workerClient :: InactiveForReplay 'Real Client
runningWorkflows :: TVar (HashMap RunId WorkflowInstance)
workerWorkflowFunctions :: HashMap Text WorkflowDefinition
workerCore :: Worker 'Real
workerEvictionEmitter :: TChan EvictionWithRunID
runningWorkflows :: TVar (HashMap RunId WorkflowInstance)
workerWorkflowFunctions :: HashMap Text WorkflowDefinition
workerTaskQueue :: TaskQueue
workerInboundInterceptors :: WorkflowInboundInterceptor
workerOutboundInterceptors :: WorkflowOutboundInterceptor
workerDeadlockTimeout :: Maybe Int
workerErrorConverters :: [ApplicationFailureHandler]
processor :: PayloadProcessor
workerClient :: Client
</span><a href="#local-6989586621680181005"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-592"></span><span>      </span><span id="local-6989586621680181491"><span class="annot"><a href="#local-6989586621680181491"><span class="hs-identifier hs-var hs-var">definitions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680181364"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">actDefs</span><span>
</span><span id="line-593"></span><span>      </span><span id="local-6989586621680181492"><span class="annot"><a href="#local-6989586621680181492"><span class="hs-identifier hs-var hs-var">activityInboundInterceptors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680181364"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">interceptorConfig</span><span class="hs-operator">.</span><span class="hs-identifier">activityInboundInterceptors</span><span>
</span><span id="line-594"></span><span>      </span><span id="local-6989586621680181493"><span class="annot"><a href="#local-6989586621680181493"><span class="hs-identifier hs-var hs-var">activityOutboundInterceptors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680181364"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">interceptorConfig</span><span class="hs-operator">.</span><span class="hs-identifier">activityOutboundInterceptors</span><span>
</span><span id="line-595"></span><span>      </span><span id="local-6989586621680181494"><span class="annot"><a href="#local-6989586621680181494"><span class="hs-identifier hs-var hs-var">clientInterceptors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680181364"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">interceptorConfig</span><span class="hs-operator">.</span><span class="hs-identifier">clientInterceptors</span><span>
</span><span id="line-596"></span><span>      </span><span id="local-6989586621680181495"><span class="annot"><a href="#local-6989586621680181495"><span class="hs-identifier hs-var hs-var">activityErrorConverters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ApplicationFailureHandler]
</span><a href="#local-6989586621680181480"><span class="hs-identifier hs-var">errorConverters</span></a></span><span>
</span><span id="line-597"></span><span>      </span><span id="local-6989586621680181496"><span class="annot"><a href="#local-6989586621680181496"><span class="hs-identifier hs-var hs-var">payloadProcessor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680181364"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">payloadProcessor</span><span>
</span><span id="line-598"></span><span>      </span><span id="local-6989586621680181497"><span class="annot"><a href="#local-6989586621680181497"><span class="hs-identifier hs-var hs-var">workerActivityWorker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Temporal.Activity.Worker.html#ActivityWorker"><span class="hs-identifier hs-type">Activity.ActivityWorker</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">[ApplicationFailureHandler]
HashMap Text (ActivityDefinition actEnv)
TVar (HashMap TaskToken (Async ()))
IORef actEnv
Worker 'Real
PayloadProcessor
ClientInterceptors
ActivityOutboundInterceptor actEnv
ActivityInboundInterceptor actEnv
workerCore :: Worker 'Real
runningActivities :: TVar (HashMap TaskToken (Async ()))
activityEnv :: IORef actEnv
definitions :: HashMap Text (ActivityDefinition actEnv)
activityInboundInterceptors :: ActivityInboundInterceptor actEnv
activityOutboundInterceptors :: ActivityOutboundInterceptor actEnv
clientInterceptors :: ClientInterceptors
activityErrorConverters :: [ApplicationFailureHandler]
payloadProcessor :: PayloadProcessor
payloadProcessor :: PayloadProcessor
activityErrorConverters :: [ApplicationFailureHandler]
clientInterceptors :: ClientInterceptors
activityOutboundInterceptors :: ActivityOutboundInterceptor actEnv
activityInboundInterceptors :: ActivityInboundInterceptor actEnv
workerCore :: Worker 'Real
runningActivities :: TVar (HashMap TaskToken (Async ()))
definitions :: HashMap Text (ActivityDefinition actEnv)
activityEnv :: IORef actEnv
</span><a href="#local-6989586621680181470"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-599"></span><span>      </span><span id="local-6989586621680181490"><span class="annot"><a href="#local-6989586621680181490"><span class="hs-identifier hs-var hs-var">workerClient</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Client
</span><a href="#local-6989586621680181363"><span class="hs-identifier hs-var">client</span></a></span><span>
</span><span id="line-600"></span><span>      </span><span id="local-6989586621680181508"><span class="annot"><a href="#local-6989586621680181508"><span class="hs-identifier hs-var hs-var">workerTracer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TracerProvider -&gt; InstrumentationLibrary -&gt; TracerOptions -&gt; Tracer
</span><span class="hs-identifier hs-var">makeTracer</span></span><span> </span><span class="annot"><span class="annottext">WorkerConfig actEnv
</span><a href="#local-6989586621680181364"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">tracerProvider</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; InstrumentationLibrary
</span><span class="hs-identifier hs-var">InstrumentationLibrary</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;hs-temporal-sdk&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;0.0.1.0&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TracerOptions
</span><span class="hs-identifier hs-var">tracerOptions</span></span><span>
</span><span id="line-601"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680181509"><span class="annot"><a href="#local-6989586621680181509"><span class="hs-identifier hs-var hs-var">workerType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SWorkerType 'Real
</span><span class="hs-identifier hs-var">Core.SReal</span></span><span>
</span><span id="line-602"></span><span>  </span><span class="hs-comment">-- logs &lt;- liftIO $ fetchLogs globalRuntime</span><span>
</span><span id="line-603"></span><span>  </span><span class="hs-comment">-- forM_ logs $ \l -&gt; case l.level of</span><span>
</span><span id="line-604"></span><span>  </span><span class="hs-comment">--   Trace -&gt; $(logDebug) l.message</span><span>
</span><span id="line-605"></span><span>  </span><span class="hs-comment">--   Debug -&gt; $(logDebug) l.message</span><span>
</span><span id="line-606"></span><span>  </span><span class="hs-comment">--   Info -&gt; $(logInfo) l.message</span><span>
</span><span id="line-607"></span><span>  </span><span class="hs-comment">--   Warn -&gt; $(logWarn) l.message</span><span>
</span><span id="line-608"></span><span>  </span><span class="hs-comment">--   Error -&gt; $(logError) l.message</span><span>
</span><span id="line-609"></span><span>  </span><span id="local-6989586621680181511"><span class="annot"><a href="#local-6989586621680181511"><span class="hs-identifier hs-var">workerWorkflowLoop</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Common.Async.html#asyncLabelled"><span class="hs-identifier hs-type">asyncLabelled</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T.unpack</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;temporal/worker/workflow/&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.namespace</span></span><span> </span><span class="annot"><span class="hs-identifier">conf</span></span><span class="hs-operator">.</span><span class="hs-identifier">coreConfig</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;/&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.taskQueue</span></span><span> </span><span class="annot"><span class="hs-identifier">conf</span></span><span class="hs-operator">.</span><span class="hs-identifier">coreConfig</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-610"></span><span>    </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">logDebug</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-string">&quot;Starting workflow worker loop&quot;</span></span><span>
</span><span id="line-611"></span><span>    </span><span class="annot"><a href="Temporal.Workflow.Worker.html#execute"><span class="hs-identifier hs-type">Workflow.execute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181489"><span class="hs-identifier hs-type">workflowWorker</span></a></span><span>
</span><span id="line-612"></span><span>      </span><span class="annot"><span class="hs-operator hs-type">`UnliftIO.finally`</span></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">logDebug</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-string">&quot;Exiting workflow worker loop&quot;</span></span><span>
</span><span id="line-613"></span><span>  </span><span id="local-6989586621680181512"><span class="annot"><a href="#local-6989586621680181512"><span class="hs-identifier hs-var">workerActivityLoop</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Temporal.Common.Async.html#asyncLabelled"><span class="hs-identifier hs-type">asyncLabelled</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T.unpack</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;temporal/worker/activity/&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.namespace</span></span><span> </span><span class="annot"><span class="hs-identifier">conf</span></span><span class="hs-operator">.</span><span class="hs-identifier">coreConfig</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;/&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.taskQueue</span></span><span> </span><span class="annot"><span class="hs-identifier">conf</span></span><span class="hs-operator">.</span><span class="hs-identifier">coreConfig</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-614"></span><span>    </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">logDebug</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-string">&quot;Starting activity worker loop&quot;</span></span><span>
</span><span id="line-615"></span><span>    </span><span class="annot"><a href="Temporal.Activity.Worker.html#execute"><span class="hs-identifier hs-type">Activity.execute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181497"><span class="hs-identifier hs-type">workerActivityWorker</span></a></span><span>
</span><span id="line-616"></span><span>      </span><span class="annot"><span class="hs-operator hs-type">`UnliftIO.finally`</span></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">logDebug</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-string">&quot;Exiting activity worker loop&quot;</span></span><span>
</span><span id="line-617"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-type">Temporal.Worker.Worker</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Worker.html#workerType"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-type hs-type hs-type hs-type hs-type hs-type hs-type">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-618"></span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span class="annot"><span class="hs-comment">{- | Wait for a worker to exit. This waits for both the workflow and activity loops to complete.

Any exceptions thrown by the workflow or activity loops will be rethrown.

This function is generally not needed, as 'shutdown' will wait for the worker to exit.
-}</span></span><span>
</span><span id="line-626"></span><span id="local-6989586621680180334"><span id="local-6989586621680180335"><span class="annot"><a href="Temporal.Worker.html#waitWorker"><span class="hs-identifier hs-type">waitWorker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621680180334"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-type">Temporal.Worker.Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180335"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680180334"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-627"></span><span id="waitWorker"><span class="annot"><span class="annottext">waitWorker :: forall (m :: * -&gt; *) actEnv. MonadIO m =&gt; Worker actEnv -&gt; m ()
</span><a href="Temporal.Worker.html#waitWorker"><span class="hs-identifier hs-var hs-var">waitWorker</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-type">Temporal.Worker.Worker</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680181518"><span class="annot"><span class="annottext">SWorkerType ty
workerType :: ()
workerType :: SWorkerType ty
</span><a href="Temporal.Worker.html#workerType"><span class="hs-identifier hs-var hs-var">workerType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181519"><span class="annot"><span class="annottext">Async ()
workerWorkflowLoop :: forall env. Worker env -&gt; Async ()
workerWorkflowLoop :: Async ()
</span><a href="Temporal.Worker.html#workerWorkflowLoop"><span class="hs-identifier hs-var hs-var">workerWorkflowLoop</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181520"><span class="annot"><span class="annottext">InactiveForReplay ty (Async ())
workerActivityLoop :: ()
workerActivityLoop :: InactiveForReplay ty (Async ())
</span><a href="Temporal.Worker.html#workerActivityLoop"><span class="hs-identifier hs-var hs-var">workerActivityLoop</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-628"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SWorkerType ty
</span><a href="#local-6989586621680181518"><span class="hs-identifier hs-var">workerType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-629"></span><span>    </span><span class="annot"><span class="annottext">SWorkerType ty
</span><span class="hs-identifier hs-var">Core.SReal</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-630"></span><span>      </span><span id="local-6989586621680181532"><span class="annot"><a href="#local-6989586621680181532"><span class="hs-identifier hs-var">wfRes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Async () -&gt; m (Either SomeException ())
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
Async a -&gt; m (Either SomeException a)
</span><span class="hs-identifier hs-var">waitCatch</span></span><span> </span><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621680181519"><span class="hs-identifier hs-var">workerWorkflowLoop</span></a></span><span>
</span><span id="line-631"></span><span>      </span><span id="local-6989586621680181534"><span class="annot"><a href="#local-6989586621680181534"><span class="hs-identifier hs-var">actRes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">waitCatch</span></span><span> </span><span class="annot"><a href="#local-6989586621680181520"><span class="hs-identifier hs-type">workerActivityLoop</span></a></span><span>
</span><span id="line-632"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">lefts</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680181532"><span class="hs-identifier hs-type">wfRes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680181534"><span class="hs-identifier hs-type">actRes</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">throwIO</span></span><span>
</span><span id="line-633"></span><span>    </span><span class="annot"><span class="annottext">SWorkerType ty
</span><span class="hs-identifier hs-var">Core.SReplay</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-634"></span><span>      </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Async () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; Async a -&gt; m a
</span><span class="hs-identifier hs-var">wait</span></span><span> </span><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621680181519"><span class="hs-identifier hs-var">workerWorkflowLoop</span></a></span><span>
</span><span id="line-635"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-636"></span><span>
</span><span id="line-637"></span><span>
</span><span id="line-638"></span><span class="hs-comment">-- logs &lt;- liftIO $ fetchLogs globalRuntime</span><span>
</span><span id="line-639"></span><span class="hs-comment">-- forM_ logs $ \l -&gt; do</span><span>
</span><span id="line-640"></span><span class="hs-comment">--   $(logInfo) $ Text.pack $ show l</span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span class="annot"><span class="hs-comment">{- | Link a worker to the current thread. This will cause uncaught worker exceptions to be rethrown in the current thread.

If the worker has both workflow and activity definitions registered, this will link both the workflow and activity loops.
If one of the loops fails, the worker will initiate graceful shutdown (but not block) before rethrowing the exception.
-}</span></span><span>
</span><span id="line-647"></span><span id="local-6989586621680180350"><span class="annot"><a href="Temporal.Worker.html#linkWorker"><span class="hs-identifier hs-type">linkWorker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-type">Temporal.Worker.Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180350"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-648"></span><span id="linkWorker"><span class="annot"><span class="annottext">linkWorker :: forall actEnv. Worker actEnv -&gt; IO ()
</span><a href="Temporal.Worker.html#linkWorker"><span class="hs-identifier hs-var hs-var">linkWorker</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-type">Temporal.Worker.Worker</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680181553"><span class="annot"><span class="annottext">Worker ty
workerCore :: ()
workerCore :: Worker ty
</span><a href="Temporal.Worker.html#workerCore"><span class="hs-identifier hs-var hs-var">workerCore</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181554"><span class="annot"><span class="annottext">SWorkerType ty
workerType :: ()
workerType :: SWorkerType ty
</span><a href="Temporal.Worker.html#workerType"><span class="hs-identifier hs-var hs-var">workerType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181555"><span class="annot"><span class="annottext">Async ()
workerWorkflowLoop :: forall env. Worker env -&gt; Async ()
workerWorkflowLoop :: Async ()
</span><a href="Temporal.Worker.html#workerWorkflowLoop"><span class="hs-identifier hs-var hs-var">workerWorkflowLoop</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181556"><span class="annot"><span class="annottext">InactiveForReplay ty (Async ())
workerActivityLoop :: ()
workerActivityLoop :: InactiveForReplay ty (Async ())
</span><a href="Temporal.Worker.html#workerActivityLoop"><span class="hs-identifier hs-var hs-var">workerActivityLoop</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-649"></span><span>  </span><span id="local-6989586621680181557"><span class="annot"><a href="#local-6989586621680181557"><span class="hs-identifier hs-var">tid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ThreadId
</span><span class="hs-identifier hs-var">myThreadId</span></span><span>
</span><span id="line-650"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">void</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Common.Async.html#forkIOLabelled"><span class="hs-identifier hs-type">forkIOLabelled</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T.unpack</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;temporal/worker/link/&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.namespace</span></span><span> </span><span class="annot"><a href="#local-6989586621680181561"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;/&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">Core.taskQueue</span></span><span> </span><span class="annot"><a href="#local-6989586621680181561"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-651"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680181562"><span class="hs-identifier hs-type">errorClause</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-652"></span><span>        </span><span id="local-6989586621680181562"><span class="annot"><a href="#local-6989586621680181562"><span class="hs-identifier hs-var hs-var">errorClause</span></a></span></span><span> </span><span id="local-6989586621680181563"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680181563"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-653"></span><span>          </span><span class="annot"><span class="annottext">Worker ty -&gt; IO ()
forall (ty :: WorkerType). KnownWorkerType ty =&gt; Worker ty -&gt; IO ()
</span><span class="hs-identifier hs-var">Core.initiateShutdown</span></span><span> </span><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621680181553"><span class="hs-identifier hs-var">workerCore</span></a></span><span>
</span><span id="line-654"></span><span>          </span><span class="annot"><span class="annottext">ThreadId -&gt; SomeException -&gt; IO ()
forall e. Exception e =&gt; ThreadId -&gt; e -&gt; IO ()
</span><span class="hs-identifier hs-var">Control.Concurrent.throwTo</span></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680181557"><span class="hs-identifier hs-var">tid</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680181563"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-655"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680181554"><span class="hs-identifier hs-type">workerType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-656"></span><span>      </span><span class="annot"><span class="annottext">SWorkerType ty
</span><span class="hs-identifier hs-var">Core.SReal</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-657"></span><span>        </span><span id="local-6989586621680181572"><span class="annot"><a href="#local-6989586621680181572"><span class="hs-identifier hs-var">eeRes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either SomeException ())
-&gt; IO (Either SomeException ())
-&gt; IO (Either (Either SomeException ()) (Either SomeException ()))
forall (m :: * -&gt; *) a b.
MonadUnliftIO m =&gt;
m a -&gt; m b -&gt; m (Either a b)
</span><span class="hs-identifier hs-var">race</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Async () -&gt; IO (Either SomeException ())
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
Async a -&gt; m (Either SomeException a)
</span><span class="hs-identifier hs-var">waitCatch</span></span><span> </span><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621680181555"><span class="hs-identifier hs-var">workerWorkflowLoop</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Async () -&gt; IO (Either SomeException ())
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
Async a -&gt; m (Either SomeException a)
</span><span class="hs-identifier hs-var">waitCatch</span></span><span> </span><span class="annot"><span class="annottext">Async ()
InactiveForReplay ty (Async ())
</span><a href="#local-6989586621680181556"><span class="hs-identifier hs-var">workerActivityLoop</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-658"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680181572"><span class="hs-identifier hs-type">eeRes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-659"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680181574"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680181574"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; IO ()
</span><a href="#local-6989586621680181562"><span class="hs-identifier hs-var">errorClause</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680181574"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-660"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680181575"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680181575"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; IO ()
</span><a href="#local-6989586621680181562"><span class="hs-identifier hs-var">errorClause</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680181575"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-661"></span><span>          </span><span class="annot"><span class="annottext">Either (Either SomeException ()) (Either SomeException ())
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-662"></span><span>      </span><span class="annot"><span class="annottext">SWorkerType ty
</span><span class="hs-identifier hs-var">Core.SReplay</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-663"></span><span>        </span><span id="local-6989586621680181580"><span class="annot"><a href="#local-6989586621680181580"><span class="hs-identifier hs-var">eRes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Async () -&gt; IO (Either SomeException ())
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
Async a -&gt; m (Either SomeException a)
</span><span class="hs-identifier hs-var">waitCatch</span></span><span> </span><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621680181555"><span class="hs-identifier hs-var">workerWorkflowLoop</span></a></span><span>
</span><span id="line-664"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680181580"><span class="hs-identifier hs-type">eRes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-665"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680181581"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680181581"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; IO ()
</span><a href="#local-6989586621680181562"><span class="hs-identifier hs-var">errorClause</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680181581"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-666"></span><span>          </span><span class="annot"><span class="annottext">Either SomeException ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-668"></span><span>    </span><span id="local-6989586621680181561"><span class="annot"><span class="annottext">c :: WorkerConfig
</span><a href="#local-6989586621680181561"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Worker ty -&gt; WorkerConfig
forall (ty :: WorkerType). Worker ty -&gt; WorkerConfig
</span><span class="hs-identifier hs-var">Core.getWorkerConfig</span></span><span> </span><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621680181553"><span class="hs-identifier hs-var">workerCore</span></a></span><span>
</span><span id="line-669"></span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span id="local-6989586621680180363"><span class="annot"><a href="Temporal.Worker.html#pollWorkerSTM"><span class="hs-identifier hs-type">pollWorkerSTM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-type">Temporal.Worker.Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180363"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-672"></span><span id="pollWorkerSTM"><span class="annot"><span class="annottext">pollWorkerSTM :: forall actEnv.
Worker actEnv -&gt; STM (Maybe (Either SomeException ()))
</span><a href="Temporal.Worker.html#pollWorkerSTM"><span class="hs-identifier hs-var hs-var">pollWorkerSTM</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-type">Temporal.Worker.Worker</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680181584"><span class="annot"><span class="annottext">SWorkerType ty
workerType :: ()
workerType :: SWorkerType ty
</span><a href="Temporal.Worker.html#workerType"><span class="hs-identifier hs-var hs-var">workerType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181585"><span class="annot"><span class="annottext">Async ()
workerWorkflowLoop :: forall env. Worker env -&gt; Async ()
workerWorkflowLoop :: Async ()
</span><a href="Temporal.Worker.html#workerWorkflowLoop"><span class="hs-identifier hs-var hs-var">workerWorkflowLoop</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181586"><span class="annot"><span class="annottext">InactiveForReplay ty (Async ())
workerActivityLoop :: ()
workerActivityLoop :: InactiveForReplay ty (Async ())
</span><a href="Temporal.Worker.html#workerActivityLoop"><span class="hs-identifier hs-var hs-var">workerActivityLoop</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-673"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SWorkerType ty
</span><a href="#local-6989586621680181584"><span class="hs-identifier hs-var">workerType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-674"></span><span>    </span><span class="annot"><span class="annottext">SWorkerType ty
</span><span class="hs-identifier hs-var">Core.SReal</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-675"></span><span>      </span><span id="local-6989586621680181593"><span class="annot"><a href="#local-6989586621680181593"><span class="hs-identifier hs-var">wfRes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Async () -&gt; STM (Maybe (Either SomeException ()))
forall a. Async a -&gt; STM (Maybe (Either SomeException a))
</span><span class="hs-identifier hs-var">pollSTM</span></span><span> </span><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621680181585"><span class="hs-identifier hs-var">workerWorkflowLoop</span></a></span><span>
</span><span id="line-676"></span><span>      </span><span id="local-6989586621680181595"><span class="annot"><a href="#local-6989586621680181595"><span class="hs-identifier hs-var">actRes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pollSTM</span></span><span> </span><span class="annot"><a href="#local-6989586621680181586"><span class="hs-identifier hs-type">workerActivityLoop</span></a></span><span>
</span><span id="line-677"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680181593"><span class="hs-identifier hs-type">wfRes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680181595"><span class="hs-identifier hs-type">actRes</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-678"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680181596"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680181596"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Either SomeException ())
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either SomeException () -&gt; Maybe (Either SomeException ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException -&gt; Either SomeException ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680181596"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Either SomeException ())
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680181597"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680181597"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either SomeException () -&gt; Maybe (Either SomeException ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException -&gt; Either SomeException ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621680181597"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-680"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either SomeException () -&gt; Maybe (Either SomeException ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; Either SomeException ()
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>        </span><span class="annot"><span class="annottext">(Maybe (Either SomeException ()), Maybe (Either SomeException ()))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Either SomeException ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-682"></span><span>    </span><span class="annot"><span class="annottext">SWorkerType ty
</span><span class="hs-identifier hs-var">Core.SReplay</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Async () -&gt; STM (Maybe (Either SomeException ()))
forall a. Async a -&gt; STM (Maybe (Either SomeException a))
</span><span class="hs-identifier hs-var">pollSTM</span></span><span> </span><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621680181585"><span class="hs-identifier hs-var">workerWorkflowLoop</span></a></span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span id="local-6989586621680180367"><span class="annot"><a href="Temporal.Worker.html#waitWorkerSTM"><span class="hs-identifier hs-type">waitWorkerSTM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-type">Temporal.Worker.Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180367"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-686"></span><span id="waitWorkerSTM"><span class="annot"><span class="annottext">waitWorkerSTM :: forall actEnv. Worker actEnv -&gt; STM ()
</span><a href="Temporal.Worker.html#waitWorkerSTM"><span class="hs-identifier hs-var hs-var">waitWorkerSTM</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-type">Temporal.Worker.Worker</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680181600"><span class="annot"><span class="annottext">SWorkerType ty
workerType :: ()
workerType :: SWorkerType ty
</span><a href="Temporal.Worker.html#workerType"><span class="hs-identifier hs-var hs-var">workerType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181601"><span class="annot"><span class="annottext">Async ()
workerWorkflowLoop :: forall env. Worker env -&gt; Async ()
workerWorkflowLoop :: Async ()
</span><a href="Temporal.Worker.html#workerWorkflowLoop"><span class="hs-identifier hs-var hs-var">workerWorkflowLoop</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181602"><span class="annot"><span class="annottext">InactiveForReplay ty (Async ())
workerActivityLoop :: ()
workerActivityLoop :: InactiveForReplay ty (Async ())
</span><a href="Temporal.Worker.html#workerActivityLoop"><span class="hs-identifier hs-var hs-var">workerActivityLoop</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-687"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SWorkerType ty
</span><a href="#local-6989586621680181600"><span class="hs-identifier hs-var">workerType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-688"></span><span>    </span><span class="annot"><span class="annottext">SWorkerType ty
</span><span class="hs-identifier hs-var">Core.SReal</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-689"></span><span>      </span><span class="annot"><span class="annottext">Async () -&gt; STM ()
forall a. Async a -&gt; STM a
</span><span class="hs-identifier hs-var">waitSTM</span></span><span> </span><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621680181601"><span class="hs-identifier hs-var">workerWorkflowLoop</span></a></span><span>
</span><span id="line-690"></span><span>      </span><span class="annot"><span class="annottext">Async () -&gt; STM ()
forall a. Async a -&gt; STM a
</span><span class="hs-identifier hs-var">waitSTM</span></span><span> </span><span class="annot"><span class="annottext">Async ()
InactiveForReplay ty (Async ())
</span><a href="#local-6989586621680181602"><span class="hs-identifier hs-var">workerActivityLoop</span></a></span><span>
</span><span id="line-691"></span><span>    </span><span class="annot"><span class="annottext">SWorkerType ty
</span><span class="hs-identifier hs-var">Core.SReplay</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Async () -&gt; STM ()
forall a. Async a -&gt; STM a
</span><span class="hs-identifier hs-var">waitSTM</span></span><span> </span><span class="annot"><span class="annottext">Async ()
</span><a href="#local-6989586621680181601"><span class="hs-identifier hs-var">workerWorkflowLoop</span></a></span><span>
</span><span id="line-692"></span><span>
</span><span id="line-693"></span><span>
</span><span id="line-694"></span><span class="annot"><span class="hs-comment">{- | Shut down a worker. This will initiate a graceful shutdown of the worker, waiting for all
in-flight tasks to complete before finalizing the shutdown.
-}</span></span><span>
</span><span id="line-697"></span><span id="local-6989586621680180173"><span id="local-6989586621680180174"><span class="annot"><a href="Temporal.Worker.html#shutdown"><span class="hs-identifier hs-type">shutdown</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadUnliftIO</span></span><span> </span><span class="annot"><a href="#local-6989586621680180173"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-type">Temporal.Worker.Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180174"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680180173"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-698"></span><span id="shutdown"><span class="annot"><span class="annottext">shutdown :: forall (m :: * -&gt; *) actEnv.
MonadUnliftIO m =&gt;
Worker actEnv -&gt; m ()
</span><a href="Temporal.Worker.html#shutdown"><span class="hs-identifier hs-var hs-var">shutdown</span></a></span></span><span> </span><span id="local-6989586621680181611"><span class="annot"><span class="annottext">worker :: Worker actEnv
</span><a href="#local-6989586621680181611"><span class="hs-identifier hs-var">worker</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-type">Temporal.Worker.Worker</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680181642"><span class="annot"><span class="annottext">Worker ty
workerCore :: ()
workerCore :: Worker ty
</span><a href="Temporal.Worker.html#workerCore"><span class="hs-identifier hs-var hs-var">workerCore</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181643"><span class="annot"><span class="annottext">Tracer
workerTracer :: forall env. Worker env -&gt; Tracer
workerTracer :: Tracer
</span><a href="Temporal.Worker.html#workerTracer"><span class="hs-identifier hs-var hs-var">workerTracer</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181644"><span class="annot"><span class="annottext">SWorkerType ty
workerType :: ()
workerType :: SWorkerType ty
</span><a href="Temporal.Worker.html#workerType"><span class="hs-identifier hs-var hs-var">workerType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680181645"><span class="annot"><span class="annottext">InactiveForReplay ty (ActivityWorker actEnv)
workerActivityWorker :: ()
workerActivityWorker :: InactiveForReplay ty (ActivityWorker actEnv)
</span><a href="Temporal.Worker.html#workerActivityWorker"><span class="hs-identifier hs-var hs-var">workerActivityWorker</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer -&gt; Text -&gt; SpanArguments -&gt; m () -&gt; m ()
forall (m :: * -&gt; *) a.
(MonadUnliftIO m, HasCallStack) =&gt;
Tracer -&gt; Text -&gt; SpanArguments -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">OT.inSpan</span></span><span> </span><span class="annot"><span class="annottext">Tracer
</span><a href="#local-6989586621680181643"><span class="hs-identifier hs-var">workerTracer</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;shutdown&quot;</span></span><span> </span><span class="annot"><span class="annottext">SpanArguments
</span><span class="hs-identifier hs-var">defaultSpanArguments</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((forall a. m a -&gt; m a) -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) b.
MonadUnliftIO m =&gt;
((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b
</span><span class="hs-identifier hs-var">UnliftIO.mask</span></span><span> </span><span class="annot"><span class="annottext">(((forall a. m a -&gt; m a) -&gt; m ()) -&gt; m ())
-&gt; ((forall a. m a -&gt; m a) -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680181647"><span class="annot"><span class="annottext">forall a. m a -&gt; m a
</span><a href="#local-6989586621680181647"><span class="hs-identifier hs-var">restore</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-699"></span><span>  </span><span class="annot"><span class="annottext">Tracer -&gt; Text -&gt; SpanArguments -&gt; m () -&gt; m ()
forall (m :: * -&gt; *) a.
(MonadUnliftIO m, HasCallStack) =&gt;
Tracer -&gt; Text -&gt; SpanArguments -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">OT.inSpan</span></span><span> </span><span class="annot"><span class="annottext">Tracer
</span><a href="#local-6989586621680181643"><span class="hs-identifier hs-var">workerTracer</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;initiateShutdown&quot;</span></span><span> </span><span class="annot"><span class="annottext">SpanArguments
</span><span class="hs-identifier hs-var">defaultSpanArguments</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Worker ty -&gt; IO ()
forall (ty :: WorkerType). KnownWorkerType ty =&gt; Worker ty -&gt; IO ()
</span><span class="hs-identifier hs-var">Core.initiateShutdown</span></span><span> </span><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621680181642"><span class="hs-identifier hs-var">workerCore</span></a></span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span>  </span><span class="hs-comment">-- Worker shutdown will wait on all activities to complete, so if a long-running activity does not respect cancellation,</span><span>
</span><span id="line-702"></span><span>  </span><span class="hs-comment">-- the shutdown may never complete. However, we do issue a shutdown notification to the activities in the form of an</span><span>
</span><span id="line-703"></span><span>  </span><span class="hs-comment">-- async exception, so they would have to be actively ignoring the shutdown notification to prevent the shutdown from completing.</span><span>
</span><span id="line-704"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SWorkerType ty
</span><a href="#local-6989586621680181644"><span class="hs-identifier hs-var">workerType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-705"></span><span>    </span><span class="annot"><span class="annottext">SWorkerType ty
</span><span class="hs-identifier hs-var">Core.SReal</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ActivityWorker actEnv -&gt; m ()
forall (m :: * -&gt; *) env. MonadIO m =&gt; ActivityWorker env -&gt; m ()
</span><a href="Temporal.Activity.Worker.html#notifyShutdown"><span class="hs-identifier hs-var">Activity.notifyShutdown</span></a></span><span> </span><span class="annot"><span class="annottext">InactiveForReplay ty (ActivityWorker actEnv)
ActivityWorker actEnv
</span><a href="#local-6989586621680181645"><span class="hs-identifier hs-var">workerActivityWorker</span></a></span><span>
</span><span id="line-706"></span><span>    </span><span class="annot"><span class="annottext">SWorkerType ty
</span><span class="hs-identifier hs-var">Core.SReplay</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-707"></span><span>
</span><span id="line-708"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">OT.inSpan</span></span><span> </span><span class="annot"><a href="#local-6989586621680181643"><span class="hs-identifier hs-type">workerTracer</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;waitWorker&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">defaultSpanArguments</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621680181647"><span class="hs-identifier hs-type">restore</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Worker.html#waitWorker"><span class="hs-identifier hs-type">waitWorker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680181611"><span class="hs-identifier hs-type">worker</span></a></span><span>
</span><span id="line-709"></span><span>
</span><span id="line-710"></span><span>  </span><span id="local-6989586621680181653"><span class="annot"><a href="#local-6989586621680181653"><span class="hs-identifier hs-var">err'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OT.inSpan</span></span><span> </span><span class="annot"><a href="#local-6989586621680181643"><span class="hs-identifier hs-type">workerTracer</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;finalizeShutdown&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">defaultSpanArguments</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Core.finalizeShutdown</span></span><span> </span><span class="annot"><a href="#local-6989586621680181642"><span class="hs-identifier hs-type">workerCore</span></a></span><span>
</span><span id="line-711"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680181653"><span class="hs-identifier hs-type">err'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-712"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680181655"><span class="annot"><span class="annottext">WorkerError
</span><a href="#local-6989586621680181655"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkerError -&gt; m ()
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">WorkerError
</span><a href="#local-6989586621680181655"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-713"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-714"></span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span class="hs-comment">-- logs &lt;- liftIO $ fetchLogs globalRuntime</span><span>
</span><span id="line-717"></span><span class="hs-comment">-- forM_ logs $ \l -&gt; do</span><span>
</span><span id="line-718"></span><span class="hs-comment">--   $(logInfo) $ Text.pack $ show l</span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span class="annot"><span class="hs-comment">-- | Subscribe to evictions from the worker. This is not generally needed, but can be useful for debugging.</span></span><span>
</span><span id="line-721"></span><span id="local-6989586621680180175"><span id="local-6989586621680180176"><span class="annot"><a href="Temporal.Worker.html#subscribeToEvictions"><span class="hs-identifier hs-type">subscribeToEvictions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621680180175"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-type">Temporal.Worker.Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180176"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680180175"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TChan</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Worker.html#EvictionWithRunID"><span class="hs-identifier hs-type">Workflow.EvictionWithRunID</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-722"></span><span id="subscribeToEvictions"><span class="annot"><span class="annottext">subscribeToEvictions :: forall (m :: * -&gt; *) actEnv.
MonadIO m =&gt;
Worker actEnv -&gt; m (TChan EvictionWithRunID)
</span><a href="Temporal.Worker.html#subscribeToEvictions"><span class="hs-identifier hs-var hs-var">subscribeToEvictions</span></a></span></span><span> </span><span id="local-6989586621680181660"><span class="annot"><span class="annottext">Worker actEnv
</span><a href="#local-6989586621680181660"><span class="hs-identifier hs-var">worker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (TChan EvictionWithRunID) -&gt; m (TChan EvictionWithRunID)
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (TChan EvictionWithRunID) -&gt; m (TChan EvictionWithRunID))
-&gt; IO (TChan EvictionWithRunID) -&gt; m (TChan EvictionWithRunID)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">STM (TChan EvictionWithRunID) -&gt; IO (TChan EvictionWithRunID)
forall (m :: * -&gt; *) a. MonadIO m =&gt; STM a -&gt; m a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM (TChan EvictionWithRunID) -&gt; IO (TChan EvictionWithRunID))
-&gt; STM (TChan EvictionWithRunID) -&gt; IO (TChan EvictionWithRunID)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TChan EvictionWithRunID -&gt; STM (TChan EvictionWithRunID)
forall a. TChan a -&gt; STM (TChan a)
</span><span class="hs-identifier hs-var">dupTChan</span></span><span> </span><span class="annot"><span class="annottext">Worker actEnv
</span><a href="#local-6989586621680181660"><span class="hs-identifier hs-var">worker</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">workerEvictionEmitter</span><span>
</span><span id="line-723"></span><span>
</span><span id="line-724"></span><span>
</span><span id="line-725"></span><span class="annot"><span class="hs-comment">-- | Subscribe to evictions from the worker. This is not generally needed, but can be useful for debugging.</span></span><span>
</span><span id="line-726"></span><span id="local-6989586621680180385"><span class="annot"><a href="Temporal.Worker.html#subscribeToEvictionsSTM"><span class="hs-identifier hs-type">subscribeToEvictionsSTM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-type">Temporal.Worker.Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180385"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TChan</span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Worker.html#EvictionWithRunID"><span class="hs-identifier hs-type">Workflow.EvictionWithRunID</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-727"></span><span id="subscribeToEvictionsSTM"><span class="annot"><span class="annottext">subscribeToEvictionsSTM :: forall actEnv. Worker actEnv -&gt; STM (TChan EvictionWithRunID)
</span><a href="Temporal.Worker.html#subscribeToEvictionsSTM"><span class="hs-identifier hs-var hs-var">subscribeToEvictionsSTM</span></a></span></span><span> </span><span id="local-6989586621680181663"><span class="annot"><span class="annottext">Worker actEnv
</span><a href="#local-6989586621680181663"><span class="hs-identifier hs-var">worker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TChan EvictionWithRunID -&gt; STM (TChan EvictionWithRunID)
forall a. TChan a -&gt; STM (TChan a)
</span><span class="hs-identifier hs-var">dupTChan</span></span><span> </span><span class="annot"><span class="annottext">Worker actEnv
</span><a href="#local-6989586621680181663"><span class="hs-identifier hs-var">worker</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">workerEvictionEmitter</span><span>
</span><span id="line-728"></span><span>
</span><span id="line-729"></span><span>
</span><span id="line-730"></span><span class="annot"><a href="Temporal.Worker.html#evictionMessage"><span class="hs-identifier hs-type">evictionMessage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Worker.html#EvictionWithRunID"><span class="hs-identifier hs-type">Workflow.EvictionWithRunID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-731"></span><span id="evictionMessage"><span class="annot"><span class="annottext">evictionMessage :: EvictionWithRunID -&gt; Text
</span><a href="Temporal.Worker.html#evictionMessage"><span class="hs-identifier hs-var hs-var">evictionMessage</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Worker.html#EvictionWithRunID"><span class="hs-identifier hs-type">Workflow.EvictionWithRunID</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680181665"><span class="annot"><span class="annottext">RemoveFromCache
eviction :: RemoveFromCache
eviction :: EvictionWithRunID -&gt; RemoveFromCache
</span><a href="#local-6989586621680181665"><span class="hs-identifier hs-var hs-var">eviction</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RemoveFromCache
</span><a href="#local-6989586621680181665"><span class="hs-identifier hs-var">eviction</span></a></span><span> </span><span class="annot"><span class="annottext">RemoveFromCache
-&gt; FoldLike Text RemoveFromCache RemoveFromCache Text Text -&gt; Text
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">FoldLike Text RemoveFromCache RemoveFromCache Text Text
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;message&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Activation.message</span></span><span>
</span><span id="line-732"></span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span class="annot"><a href="Temporal.Worker.html#evictionWasFatal"><span class="hs-identifier hs-type">evictionWasFatal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Workflow.Worker.html#EvictionWithRunID"><span class="hs-identifier hs-type">Workflow.EvictionWithRunID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-735"></span><span id="evictionWasFatal"><span class="annot"><span class="annottext">evictionWasFatal :: EvictionWithRunID -&gt; Bool
</span><a href="Temporal.Worker.html#evictionWasFatal"><span class="hs-identifier hs-var hs-var">evictionWasFatal</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Workflow.Worker.html#EvictionWithRunID"><span class="hs-identifier hs-type">Workflow.EvictionWithRunID</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680181669"><span class="annot"><span class="annottext">RemoveFromCache
eviction :: EvictionWithRunID -&gt; RemoveFromCache
eviction :: RemoveFromCache
</span><a href="Temporal.Workflow.Worker.html#eviction"><span class="hs-identifier hs-var hs-var">eviction</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RemoveFromCache
</span><a href="#local-6989586621680181669"><span class="hs-identifier hs-var">eviction</span></a></span><span> </span><span class="annot"><span class="annottext">RemoveFromCache
-&gt; FoldLike
     RemoveFromCache'EvictionReason
     RemoveFromCache
     RemoveFromCache
     RemoveFromCache'EvictionReason
     RemoveFromCache'EvictionReason
-&gt; RemoveFromCache'EvictionReason
forall s a t b. s -&gt; FoldLike a s t a b -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">FoldLike
  RemoveFromCache'EvictionReason
  RemoveFromCache
  RemoveFromCache
  RemoveFromCache'EvictionReason
  RemoveFromCache'EvictionReason
forall (f :: * -&gt; *) s a.
(Functor f, HasField s &quot;reason&quot; a) =&gt;
LensLike' f s a
</span><span class="hs-identifier hs-var">Activation.reason</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-736"></span><span>  </span><span class="annot"><span class="annottext">RemoveFromCache'EvictionReason
</span><span class="hs-identifier hs-var">RemoveFromCache'FATAL</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-737"></span><span>  </span><span class="annot"><span class="annottext">RemoveFromCache'EvictionReason
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-738"></span><span>
</span><span id="line-739"></span><span>
</span><span id="line-740"></span><span class="annot"><span class="hs-comment">{- | Replace the environment for activities run within a Worker. This is generally not needed, but can be useful for reusing
a Worker under test.
-}</span></span><span>
</span><span id="line-743"></span><span id="local-6989586621680180398"><span id="local-6989586621680180399"><span class="annot"><a href="Temporal.Worker.html#replaceEnvironment"><span class="hs-identifier hs-type">replaceEnvironment</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621680180398"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-type">Temporal.Worker.Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680180399"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680180399"><span class="hs-identifier hs-type">actEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680180398"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-744"></span><span id="replaceEnvironment"><span class="annot"><span class="annottext">replaceEnvironment :: forall (m :: * -&gt; *) actEnv.
MonadIO m =&gt;
Worker actEnv -&gt; actEnv -&gt; m ()
</span><a href="Temporal.Worker.html#replaceEnvironment"><span class="hs-identifier hs-var hs-var">replaceEnvironment</span></a></span></span><span> </span><span class="annot"><a href="Temporal.Worker.html#Worker"><span class="hs-identifier hs-type">Temporal.Worker.Worker</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680181676"><span id="local-6989586621680181677"><span id="local-6989586621680181678"><span id="local-6989586621680181679"><span id="local-6989586621680181680"><span id="local-6989586621680181681"><span id="local-6989586621680181682"><span class="annot"><span class="annottext">Async ()
Tracer
TChan EvictionWithRunID
Worker ty
InactiveForReplay ty (Async ())
InactiveForReplay ty (ActivityWorker actEnv)
SWorkerType ty
workerType :: ()
workerWorkflowLoop :: forall env. Worker env -&gt; Async ()
workerActivityLoop :: ()
workerActivityWorker :: ()
workerCore :: ()
workerTracer :: forall env. Worker env -&gt; Tracer
workerEvictionEmitter :: forall env. Worker env -&gt; TChan EvictionWithRunID
workerType :: SWorkerType ty
workerWorkflowLoop :: Async ()
workerActivityLoop :: InactiveForReplay ty (Async ())
workerActivityWorker :: InactiveForReplay ty (ActivityWorker actEnv)
workerCore :: Worker ty
workerTracer :: Tracer
workerEvictionEmitter :: TChan EvictionWithRunID
</span><a href="Temporal.Worker.html#workerType"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680181683"><span class="annot"><span class="annottext">actEnv
</span><a href="#local-6989586621680181683"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-745"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SWorkerType ty
</span><a href="#local-6989586621680181676"><span class="hs-identifier hs-var">workerType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-746"></span><span>    </span><span class="annot"><span class="annottext">SWorkerType ty
</span><span class="hs-identifier hs-var">Core.SReal</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-747"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IORef actEnv -&gt; actEnv -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">writeIORef</span></span><span> </span><span class="annot"><span class="annottext">InactiveForReplay ty (ActivityWorker actEnv)
ActivityWorker actEnv
</span><a href="#local-6989586621680181679"><span class="hs-identifier hs-var">workerActivityWorker</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">activityEnv</span><span> </span><span class="annot"><span class="annottext">actEnv
</span><a href="#local-6989586621680181683"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-748"></span><span>    </span><span class="annot"><span class="annottext">SWorkerType ty
</span><span class="hs-identifier hs-var">Core.SReplay</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-749"></span></pre></body></html>