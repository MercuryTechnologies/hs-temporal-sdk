<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html"><span class="hs-identifier">Temporal.Core.Worker</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-11"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier">Worker</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#getWorkerClient"><span class="hs-identifier">getWorkerClient</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#WorkerConfig"><span class="hs-identifier">WorkerConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#getWorkerConfig"><span class="hs-identifier">getWorkerConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#defaultWorkerConfig"><span class="hs-identifier">defaultWorkerConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><a href="Temporal.Core.CTypes.html#WorkerError"><span class="hs-identifier">WorkerError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><a href="Temporal.Core.CTypes.html#WorkerErrorCode"><span class="hs-identifier">WorkerErrorCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#WorkerType"><span class="hs-identifier">WorkerType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#SWorkerType"><span class="hs-identifier">SWorkerType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#SomeWorkerType"><span class="hs-identifier">SomeWorkerType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#newWorker"><span class="hs-identifier">newWorker</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#validateWorker"><span class="hs-identifier">validateWorker</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#newReplayWorker"><span class="hs-identifier">newReplayWorker</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#closeWorker"><span class="hs-identifier">closeWorker</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#InactiveForReplay"><span class="hs-identifier">InactiveForReplay</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><span class="hs-identifier">WorkflowActivation</span></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#pollWorkflowActivation"><span class="hs-identifier">pollWorkflowActivation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><span class="hs-identifier">ActivityTask</span></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#pollActivityTask"><span class="hs-identifier">pollActivityTask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><span class="hs-identifier">WorkflowActivationCompletion</span></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#completeWorkflowActivation"><span class="hs-identifier">completeWorkflowActivation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><span class="hs-identifier">ActivityTaskCompletion</span></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#completeActivityTask"><span class="hs-identifier">completeActivityTask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><span class="hs-identifier">ActivityHeartbeat</span></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#recordActivityHeartbeat"><span class="hs-identifier">recordActivityHeartbeat</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#requestWorkflowEviction"><span class="hs-identifier">requestWorkflowEviction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#initiateShutdown"><span class="hs-identifier">initiateShutdown</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#finalizeShutdown"><span class="hs-identifier">finalizeShutdown</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#HistoryPusher"><span class="hs-identifier">HistoryPusher</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><span class="hs-identifier">History</span></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#pushHistory"><span class="hs-identifier">pushHistory</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#closeHistory"><span class="hs-identifier">closeHistory</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#KnownWorkerType"><span class="hs-identifier">KnownWorkerType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.TH</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IORef</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ProtoLens.Encoding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">decodeMessageOrDie</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">encodeMessage</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Void</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Void</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.C.String</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.ForeignPtr</span></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.Marshal</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.Ptr</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.Storable</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Proto.Temporal.Api.History.V1.Message</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">History</span></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Proto.Temporal.Sdk.Core.ActivityTask.ActivityTask</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ActivityTask</span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Proto.Temporal.Sdk.Core.CoreInterface</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ActivityHeartbeat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ActivityTaskCompletion</span></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Proto.Temporal.Sdk.Core.WorkflowActivation.WorkflowActivation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">WorkflowActivation</span></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Proto.Temporal.Sdk.Core.WorkflowCompletion.WorkflowCompletion</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">WorkflowActivationCompletion</span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html"><span class="hs-identifier">Temporal.Core.CTypes</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Core.Client.html"><span class="hs-identifier">Temporal.Core.Client</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Internal.FFI.html"><span class="hs-identifier">Temporal.Internal.FFI</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Runtime.html"><span class="hs-identifier">Temporal.Runtime</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-keyword">data</span><span> </span><span id="WorkerType"><span class="annot"><a href="Temporal.Core.Worker.html#WorkerType"><span class="hs-identifier hs-var">WorkerType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Real"><span class="annot"><a href="Temporal.Core.Worker.html#Real"><span class="hs-identifier hs-var">Real</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Replay"><span class="annot"><a href="Temporal.Core.Worker.html#Replay"><span class="hs-identifier hs-var">Replay</span></a></span></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="annot"><span class="hs-comment">-- | A singleton type for 'WorkerType'.</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">data</span><span> </span><span id="SWorkerType"><span class="annot"><a href="Temporal.Core.Worker.html#SWorkerType"><span class="hs-identifier hs-var">SWorkerType</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679253866"><span class="annot"><a href="#local-6989586621679253866"><span class="hs-identifier hs-type">ty</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#WorkerType"><span class="hs-identifier hs-type">WorkerType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-78"></span><span>  </span><span id="SReal"><span class="annot"><a href="Temporal.Core.Worker.html#SReal"><span class="hs-identifier hs-var">SReal</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#SWorkerType"><span class="hs-identifier hs-type">SWorkerType</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Temporal.Core.Worker.html#Real"><span class="hs-identifier hs-type">Real</span></a></span><span>
</span><span id="line-79"></span><span>  </span><span id="SReplay"><span class="annot"><a href="Temporal.Core.Worker.html#SReplay"><span class="hs-identifier hs-var">SReplay</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#SWorkerType"><span class="hs-identifier hs-type">SWorkerType</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Temporal.Core.Worker.html#Replay"><span class="hs-identifier hs-type">Replay</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-comment">-- Promote a 'WorkerType' to a singleton type.</span><span>
</span><span id="line-83"></span><span class="hs-keyword">data</span><span> </span><span id="SomeWorkerType"><span class="annot"><a href="Temporal.Core.Worker.html#SomeWorkerType"><span class="hs-identifier hs-var">SomeWorkerType</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-84"></span><span>  </span><span id="local-6989586621679253869"><span id="SomeWorkerType"><span class="annot"><a href="Temporal.Core.Worker.html#SomeWorkerType"><span class="hs-identifier hs-var">SomeWorkerType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#SWorkerType"><span class="hs-identifier hs-type">SWorkerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253869"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#SomeWorkerType"><span class="hs-identifier hs-type">SomeWorkerType</span></a></span></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="InactiveForReplay"><span class="annot"><a href="Temporal.Core.Worker.html#InactiveForReplay"><span class="hs-identifier hs-var">InactiveForReplay</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679253871"><span class="annot"><a href="#local-6989586621679253871"><span class="hs-identifier hs-type">ty</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#WorkerType"><span class="hs-identifier hs-type">WorkerType</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679253872"><span class="annot"><a href="#local-6989586621679253872"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-88"></span><span>  </span><span id="InactiveForReplay"><span class="annot"><a href="Temporal.Core.Worker.html#InactiveForReplay"><span class="hs-identifier hs-var">InactiveForReplay</span></a></span></span><span> </span><span id="local-6989586621679253873"><span class="hs-special">'</span><span class="annot"><a href="Temporal.Core.Worker.html#Real"><span class="hs-identifier hs-type">Real</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253873"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679253873"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-89"></span><span>  </span><span id="InactiveForReplay"><span class="annot"><a href="Temporal.Core.Worker.html#InactiveForReplay"><span class="hs-identifier hs-var">InactiveForReplay</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Temporal.Core.Worker.html#Replay"><span class="hs-identifier hs-type">Replay</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-keyword">class</span><span> </span><span id="KnownWorkerType"><span class="annot"><a href="Temporal.Core.Worker.html#KnownWorkerType"><span class="hs-identifier hs-var">KnownWorkerType</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679253605"><span class="annot"><a href="#local-6989586621679253605"><span class="hs-identifier hs-type">ty</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#WorkerType"><span class="hs-identifier hs-type">WorkerType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-93"></span><span>  </span><span id="knownWorkerType"><span class="annot"><a href="Temporal.Core.Worker.html#knownWorkerType"><span class="hs-identifier hs-type">knownWorkerType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#SWorkerType"><span class="hs-identifier hs-type">SWorkerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253605"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#KnownWorkerType"><span class="hs-identifier hs-type">KnownWorkerType</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Temporal.Core.Worker.html#Real"><span class="hs-identifier hs-type">Real</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-97"></span><span>  </span><span id="local-6989586621679253877"><span class="annot"><span class="annottext">knownWorkerType :: SWorkerType 'Real
</span><a href="Temporal.Core.Worker.html#knownWorkerType"><span class="hs-identifier hs-var hs-var hs-var">knownWorkerType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SWorkerType 'Real
</span><a href="Temporal.Core.Worker.html#SReal"><span class="hs-identifier hs-var">SReal</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#KnownWorkerType"><span class="hs-identifier hs-type">KnownWorkerType</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Temporal.Core.Worker.html#Replay"><span class="hs-identifier hs-type">Replay</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-101"></span><span>  </span><span id="local-6989586621679253880"><span class="annot"><span class="annottext">knownWorkerType :: SWorkerType 'Replay
</span><a href="Temporal.Core.Worker.html#knownWorkerType"><span class="hs-identifier hs-var hs-var hs-var">knownWorkerType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SWorkerType 'Replay
</span><a href="Temporal.Core.Worker.html#SReplay"><span class="hs-identifier hs-var">SReplay</span></a></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span id="local-6989586621679253606"><span id="local-6989586621679253607"><span class="annot"><a href="Temporal.Core.Worker.html#singFor"><span class="hs-identifier hs-type">singFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#KnownWorkerType"><span class="hs-identifier hs-type">KnownWorkerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253606"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679253607"><span class="hs-identifier hs-type">proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253606"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#SWorkerType"><span class="hs-identifier hs-type">SWorkerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253606"><span class="hs-identifier hs-type">ty</span></a></span></span></span><span>
</span><span id="line-105"></span><span id="singFor"><span class="annot"><span class="annottext">singFor :: forall (ty :: WorkerType) (proxy :: WorkerType -&gt; *).
KnownWorkerType ty =&gt;
proxy ty -&gt; SWorkerType ty
</span><a href="Temporal.Core.Worker.html#singFor"><span class="hs-identifier hs-var hs-var">singFor</span></a></span></span><span> </span><span class="annot"><span class="annottext">proxy ty
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SWorkerType ty
forall (ty :: WorkerType). KnownWorkerType ty =&gt; SWorkerType ty
</span><a href="Temporal.Core.Worker.html#knownWorkerType"><span class="hs-identifier hs-var">knownWorkerType</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-keyword">data</span><span> </span><span id="Worker"><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-var">Worker</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679253610"><span class="annot"><a href="#local-6989586621679253610"><span class="hs-identifier hs-type">ty</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#WorkerType"><span class="hs-identifier hs-type">WorkerType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Worker"><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-var">Worker</span></a></span></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="workerPtr"><span class="annot"><span class="annottext">forall (ty :: WorkerType).
Worker ty -&gt; IORef (ForeignPtr (Worker ty))
</span><a href="Temporal.Core.Worker.html#workerPtr"><span class="hs-identifier hs-var hs-var">workerPtr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ForeignPtr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253610"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workerConfig"><span class="annot"><span class="annottext">forall (ty :: WorkerType). Worker ty -&gt; WorkerConfig
</span><a href="Temporal.Core.Worker.html#workerConfig"><span class="hs-identifier hs-var hs-var">workerConfig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Temporal.Core.Worker.html#WorkerConfig"><span class="hs-identifier hs-type">WorkerConfig</span></a></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workerClient"><span class="annot"><span class="annottext">forall (ty :: WorkerType). Worker ty -&gt; InactiveForReplay ty Client
</span><a href="Temporal.Core.Worker.html#workerClient"><span class="hs-identifier hs-var hs-var">workerClient</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#InactiveForReplay"><span class="hs-identifier hs-type">InactiveForReplay</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253610"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="workerRuntime"><span class="annot"><span class="annottext">forall (ty :: WorkerType). Worker ty -&gt; Runtime
</span><a href="Temporal.Core.Worker.html#workerRuntime"><span class="hs-identifier hs-var hs-var">workerRuntime</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Temporal.Core.CTypes.html#Runtime"><span class="hs-identifier hs-type">Runtime</span></a></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="annot"><a href="Temporal.Core.Worker.html#withWorker"><span class="hs-identifier hs-type">withWorker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679253620"><span class="annot"><a href="#local-6989586621679253620"><span class="hs-identifier hs-type">ty</span></a></span></span><span> </span><span id="local-6989586621679253621"><span class="annot"><a href="#local-6989586621679253621"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#KnownWorkerType"><span class="hs-identifier hs-type">KnownWorkerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253620"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253620"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253620"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679253621"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679253621"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-117"></span><span id="withWorker"><span class="annot"><span class="annottext">withWorker :: forall (ty :: WorkerType) a.
KnownWorkerType ty =&gt;
Worker ty -&gt; (Ptr (Worker ty) -&gt; IO a) -&gt; IO a
</span><a href="Temporal.Core.Worker.html#withWorker"><span class="hs-identifier hs-var hs-var">withWorker</span></a></span></span><span> </span><span id="local-6989586621679253892"><span class="annot"><span class="annottext">w :: Worker ty
</span><a href="#local-6989586621679253892"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span id="local-6989586621679253893"><span class="annot"><span class="annottext">IORef (ForeignPtr (Worker ty))
</span><a href="#local-6989586621679253893"><span class="hs-identifier hs-var">ptrRef</span></a></span></span><span> </span><span class="annot"><span class="annottext">WorkerConfig
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679253894"><span class="annot"><span class="annottext">InactiveForReplay ty Client
</span><a href="#local-6989586621679253894"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679253895"><span class="annot"><span class="annottext">Runtime
</span><a href="#local-6989586621679253895"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679253896"><span class="annot"><span class="annottext">Ptr (Worker ty) -&gt; IO a
</span><a href="#local-6989586621679253896"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Runtime -&gt; (Ptr Runtime -&gt; IO a) -&gt; IO a
forall a. Runtime -&gt; (Ptr Runtime -&gt; IO a) -&gt; IO a
</span><a href="Temporal.Runtime.html#withRuntime"><span class="hs-identifier hs-var">withRuntime</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime
</span><a href="#local-6989586621679253895"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr Runtime -&gt; IO a) -&gt; IO a) -&gt; (Ptr Runtime -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Ptr Runtime
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679253629"><span class="annot"><a href="#local-6989586621679253898"><span class="hs-identifier hs-type">keepClientAlive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679253629"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679253629"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-119"></span><span>      </span><span id="local-6989586621679253898"><span class="annot"><span class="annottext">keepClientAlive :: forall a. IO a -&gt; IO a
</span><a href="#local-6989586621679253898"><span class="hs-identifier hs-var hs-var">keepClientAlive</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Worker ty -&gt; SWorkerType ty
forall (ty :: WorkerType) (proxy :: WorkerType -&gt; *).
KnownWorkerType ty =&gt;
proxy ty -&gt; SWorkerType ty
</span><a href="Temporal.Core.Worker.html#singFor"><span class="hs-identifier hs-var">singFor</span></a></span><span> </span><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621679253892"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-120"></span><span>        </span><span class="annot"><span class="annottext">SWorkerType ty
</span><a href="Temporal.Core.Worker.html#SReal"><span class="hs-identifier hs-var">SReal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679253904"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679253904"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-121"></span><span>          </span><span id="local-6989586621679253905"><span class="annot"><a href="#local-6989586621679253905"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679253904"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-122"></span><span>          </span><span class="annot"><a href="Temporal.Core.Client.html#touchClient"><span class="hs-identifier hs-type">touchClient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253894"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-123"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621679253905"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-124"></span><span>        </span><span class="annot"><span class="annottext">SWorkerType ty
</span><a href="Temporal.Core.Worker.html#SReplay"><span class="hs-identifier hs-var">SReplay</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO a
forall a. IO a -&gt; IO a
</span><a href="#local-6989586621679253898"><span class="hs-identifier hs-var">keepClientAlive</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO a) -&gt; IO a -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-126"></span><span>      </span><span id="local-6989586621679253909"><span class="annot"><a href="#local-6989586621679253909"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef (ForeignPtr (Worker ty)) -&gt; IO (ForeignPtr (Worker ty))
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (ForeignPtr (Worker ty))
</span><a href="#local-6989586621679253893"><span class="hs-identifier hs-var">ptrRef</span></a></span><span>
</span><span id="line-127"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">withForeignPtr</span></span><span> </span><span class="annot"><a href="#local-6989586621679253909"><span class="hs-identifier hs-type">ptr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253896"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="annot"><a href="Temporal.Core.Worker.html#getWorkerClient"><span class="hs-identifier hs-type">getWorkerClient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Temporal.Core.Worker.html#Real"><span class="hs-identifier hs-type">Real</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a></span><span>
</span><span id="line-131"></span><span id="getWorkerClient"><span class="annot"><span class="annottext">getWorkerClient :: Worker 'Real -&gt; Client
</span><a href="Temporal.Core.Worker.html#getWorkerClient"><span class="hs-identifier hs-var hs-var">getWorkerClient</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Worker 'Real -&gt; Client
Worker 'Real -&gt; InactiveForReplay 'Real Client
forall (ty :: WorkerType). Worker ty -&gt; InactiveForReplay ty Client
</span><a href="Temporal.Core.Worker.html#workerClient"><span class="hs-identifier hs-var">workerClient</span></a></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span id="local-6989586621679253912"><span class="annot"><a href="Temporal.Core.Worker.html#getWorkerConfig"><span class="hs-identifier hs-type">getWorkerConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253912"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#WorkerConfig"><span class="hs-identifier hs-type">WorkerConfig</span></a></span></span><span>
</span><span id="line-135"></span><span id="getWorkerConfig"><span class="annot"><span class="annottext">getWorkerConfig :: forall (ty :: WorkerType). Worker ty -&gt; WorkerConfig
</span><a href="Temporal.Core.Worker.html#getWorkerConfig"><span class="hs-identifier hs-var hs-var">getWorkerConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Worker ty -&gt; WorkerConfig
forall (ty :: WorkerType). Worker ty -&gt; WorkerConfig
</span><a href="Temporal.Core.Worker.html#workerConfig"><span class="hs-identifier hs-var">workerConfig</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-keyword">newtype</span><span> </span><span id="HistoryPusher"><span class="annot"><a href="Temporal.Core.Worker.html#HistoryPusher"><span class="hs-identifier hs-var">HistoryPusher</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HistoryPusher"><span class="annot"><a href="Temporal.Core.Worker.html#HistoryPusher"><span class="hs-identifier hs-var">HistoryPusher</span></a></span></span><span> </span><span class="hs-special">{</span><span id="historyPusher"><span class="annot"><span class="annottext">HistoryPusher -&gt; Ptr HistoryPusher
</span><a href="Temporal.Core.Worker.html#historyPusher"><span class="hs-identifier hs-var hs-var">historyPusher</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#HistoryPusher"><span class="hs-identifier hs-type">HistoryPusher</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-keyword">type</span><span> </span><span id="Proto"><span class="annot"><a href="Temporal.Core.Worker.html#Proto"><span class="hs-identifier hs-var">Proto</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="hs-keyword">type</span><span> </span><span id="RunId"><span class="annot"><a href="Temporal.Core.Worker.html#RunId"><span class="hs-identifier hs-var">RunId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-keyword">type</span><span> </span><span id="WorkflowId"><span class="annot"><a href="Temporal.Core.Worker.html#WorkflowId"><span class="hs-identifier hs-var">WorkflowId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-keyword">data</span><span> </span><span id="WorkerConfig"><span class="annot"><a href="Temporal.Core.Worker.html#WorkerConfig"><span class="hs-identifier hs-var">WorkerConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WorkerConfig"><span class="annot"><a href="Temporal.Core.Worker.html#WorkerConfig"><span class="hs-identifier hs-var">WorkerConfig</span></a></span></span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="namespace"><span class="annot"><span class="annottext">WorkerConfig -&gt; Text
</span><a href="Temporal.Core.Worker.html#namespace"><span class="hs-identifier hs-var hs-var">namespace</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="taskQueue"><span class="annot"><span class="annottext">WorkerConfig -&gt; Text
</span><a href="Temporal.Core.Worker.html#taskQueue"><span class="hs-identifier hs-var hs-var">taskQueue</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="buildId"><span class="annot"><span class="annottext">WorkerConfig -&gt; Text
</span><a href="Temporal.Core.Worker.html#buildId"><span class="hs-identifier hs-var hs-var">buildId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="identityOverride"><span class="annot"><span class="annottext">WorkerConfig -&gt; Maybe Text
</span><a href="Temporal.Core.Worker.html#identityOverride"><span class="hs-identifier hs-var hs-var">identityOverride</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="maxCachedWorkflows"><span class="annot"><span class="annottext">WorkerConfig -&gt; Word64
</span><a href="Temporal.Core.Worker.html#maxCachedWorkflows"><span class="hs-identifier hs-var hs-var">maxCachedWorkflows</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="maxOutstandingWorkflowTasks"><span class="annot"><span class="annottext">WorkerConfig -&gt; Word64
</span><a href="Temporal.Core.Worker.html#maxOutstandingWorkflowTasks"><span class="hs-identifier hs-var hs-var">maxOutstandingWorkflowTasks</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="maxOutstandingActivities"><span class="annot"><span class="annottext">WorkerConfig -&gt; Word64
</span><a href="Temporal.Core.Worker.html#maxOutstandingActivities"><span class="hs-identifier hs-var hs-var">maxOutstandingActivities</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="maxOutstandingLocalActivities"><span class="annot"><span class="annottext">WorkerConfig -&gt; Word64
</span><a href="Temporal.Core.Worker.html#maxOutstandingLocalActivities"><span class="hs-identifier hs-var hs-var">maxOutstandingLocalActivities</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="maxConcurrentWorkflowTaskPolls"><span class="annot"><span class="annottext">WorkerConfig -&gt; Word64
</span><a href="Temporal.Core.Worker.html#maxConcurrentWorkflowTaskPolls"><span class="hs-identifier hs-var hs-var">maxConcurrentWorkflowTaskPolls</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="nonstickyToStickyPollRatio"><span class="annot"><span class="annottext">WorkerConfig -&gt; Float
</span><a href="Temporal.Core.Worker.html#nonstickyToStickyPollRatio"><span class="hs-identifier hs-var hs-var">nonstickyToStickyPollRatio</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="maxConcurrentActivityTaskPolls"><span class="annot"><span class="annottext">WorkerConfig -&gt; Word64
</span><a href="Temporal.Core.Worker.html#maxConcurrentActivityTaskPolls"><span class="hs-identifier hs-var hs-var">maxConcurrentActivityTaskPolls</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="noRemoteActivities"><span class="annot"><span class="annottext">WorkerConfig -&gt; Bool
</span><a href="Temporal.Core.Worker.html#noRemoteActivities"><span class="hs-identifier hs-var hs-var">noRemoteActivities</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="stickyQueueScheduleToStartTimeoutMillis"><span class="annot"><span class="annottext">WorkerConfig -&gt; Word64
</span><a href="Temporal.Core.Worker.html#stickyQueueScheduleToStartTimeoutMillis"><span class="hs-identifier hs-var hs-var">stickyQueueScheduleToStartTimeoutMillis</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="maxHeartbeatThrottleIntervalMillis"><span class="annot"><span class="annottext">WorkerConfig -&gt; Word64
</span><a href="Temporal.Core.Worker.html#maxHeartbeatThrottleIntervalMillis"><span class="hs-identifier hs-var hs-var">maxHeartbeatThrottleIntervalMillis</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="defaultHeartbeatThrottleIntervalMillis"><span class="annot"><span class="annottext">WorkerConfig -&gt; Word64
</span><a href="Temporal.Core.Worker.html#defaultHeartbeatThrottleIntervalMillis"><span class="hs-identifier hs-var hs-var">defaultHeartbeatThrottleIntervalMillis</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="maxActivitiesPerSecond"><span class="annot"><span class="annottext">WorkerConfig -&gt; Maybe Double
</span><a href="Temporal.Core.Worker.html#maxActivitiesPerSecond"><span class="hs-identifier hs-var hs-var">maxActivitiesPerSecond</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="maxTaskQueueActivitiesPerSecond"><span class="annot"><span class="annottext">WorkerConfig -&gt; Maybe Double
</span><a href="Temporal.Core.Worker.html#maxTaskQueueActivitiesPerSecond"><span class="hs-identifier hs-var hs-var">maxTaskQueueActivitiesPerSecond</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="gracefulShutdownPeriodMillis"><span class="annot"><span class="annottext">WorkerConfig -&gt; Word64
</span><a href="Temporal.Core.Worker.html#gracefulShutdownPeriodMillis"><span class="hs-identifier hs-var hs-var">gracefulShutdownPeriodMillis</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="nondeterminismAsWorkflowFail"><span class="annot"><span class="annottext">WorkerConfig -&gt; Bool
</span><a href="Temporal.Core.Worker.html#nondeterminismAsWorkflowFail"><span class="hs-identifier hs-var hs-var">nondeterminismAsWorkflowFail</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="nondeterminismAsWorkflowFailForTypes"><span class="annot"><span class="annottext">WorkerConfig -&gt; [Text]
</span><a href="Temporal.Core.Worker.html#nondeterminismAsWorkflowFailForTypes"><span class="hs-identifier hs-var hs-var">nondeterminismAsWorkflowFailForTypes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-comment">-- TODO:</span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-comment">-- useWorkerVersioning</span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-comment">-- tuner</span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span id="local-6989586621679253940"><span id="local-6989586621679254011"><span id="local-6989586621679254015"><span id="local-6989586621679254018"><span id="local-6989586621679254112"><span id="local-6989586621679254179"><span id="local-6989586621679254182"><span id="local-6989586621679254185"><span class="hs-identifier">deriveJSON</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">defaultOptions</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">fieldLabelModifier</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">camelTo2</span><span> </span><span class="hs-char">'_'</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">WorkerConfig</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="annot"><a href="Temporal.Core.Worker.html#defaultWorkerConfig"><span class="hs-identifier hs-type">defaultWorkerConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#WorkerConfig"><span class="hs-identifier hs-type">WorkerConfig</span></a></span><span>
</span><span id="line-181"></span><span id="defaultWorkerConfig"><span class="annot"><span class="annottext">defaultWorkerConfig :: WorkerConfig
</span><a href="Temporal.Core.Worker.html#defaultWorkerConfig"><span class="hs-identifier hs-var hs-var">defaultWorkerConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><a href="Temporal.Core.Worker.html#WorkerConfig"><span class="hs-identifier hs-type">WorkerConfig</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">namespace :: Text
</span><a href="Temporal.Core.Worker.html#namespace"><span class="hs-identifier hs-var">namespace</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;default&quot;</span></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">taskQueue :: Text
</span><a href="Temporal.Core.Worker.html#taskQueue"><span class="hs-identifier hs-var">taskQueue</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;default&quot;</span></span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">buildId :: Text
</span><a href="Temporal.Core.Worker.html#buildId"><span class="hs-identifier hs-var">buildId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">identityOverride :: Maybe Text
</span><a href="Temporal.Core.Worker.html#identityOverride"><span class="hs-identifier hs-var">identityOverride</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">maxCachedWorkflows :: Word64
</span><a href="Temporal.Core.Worker.html#maxCachedWorkflows"><span class="hs-identifier hs-var">maxCachedWorkflows</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">100000</span></span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">maxOutstandingWorkflowTasks :: Word64
</span><a href="Temporal.Core.Worker.html#maxOutstandingWorkflowTasks"><span class="hs-identifier hs-var">maxOutstandingWorkflowTasks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1000</span></span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">maxOutstandingActivities :: Word64
</span><a href="Temporal.Core.Worker.html#maxOutstandingActivities"><span class="hs-identifier hs-var">maxOutstandingActivities</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1000</span></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">maxOutstandingLocalActivities :: Word64
</span><a href="Temporal.Core.Worker.html#maxOutstandingLocalActivities"><span class="hs-identifier hs-var">maxOutstandingLocalActivities</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1000</span></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">maxConcurrentWorkflowTaskPolls :: Word64
</span><a href="Temporal.Core.Worker.html#maxConcurrentWorkflowTaskPolls"><span class="hs-identifier hs-var">maxConcurrentWorkflowTaskPolls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">5</span></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nonstickyToStickyPollRatio :: Float
</span><a href="Temporal.Core.Worker.html#nonstickyToStickyPollRatio"><span class="hs-identifier hs-var">nonstickyToStickyPollRatio</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0.85</span></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">maxConcurrentActivityTaskPolls :: Word64
</span><a href="Temporal.Core.Worker.html#maxConcurrentActivityTaskPolls"><span class="hs-identifier hs-var">maxConcurrentActivityTaskPolls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">5</span></span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">noRemoteActivities :: Bool
</span><a href="Temporal.Core.Worker.html#noRemoteActivities"><span class="hs-identifier hs-var">noRemoteActivities</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stickyQueueScheduleToStartTimeoutMillis :: Word64
</span><a href="Temporal.Core.Worker.html#stickyQueueScheduleToStartTimeoutMillis"><span class="hs-identifier hs-var">stickyQueueScheduleToStartTimeoutMillis</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">60000</span></span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">maxHeartbeatThrottleIntervalMillis :: Word64
</span><a href="Temporal.Core.Worker.html#maxHeartbeatThrottleIntervalMillis"><span class="hs-identifier hs-var">maxHeartbeatThrottleIntervalMillis</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">300000</span></span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">defaultHeartbeatThrottleIntervalMillis :: Word64
</span><a href="Temporal.Core.Worker.html#defaultHeartbeatThrottleIntervalMillis"><span class="hs-identifier hs-var">defaultHeartbeatThrottleIntervalMillis</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">300000</span></span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">maxActivitiesPerSecond :: Maybe Double
</span><a href="Temporal.Core.Worker.html#maxActivitiesPerSecond"><span class="hs-identifier hs-var">maxActivitiesPerSecond</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Double
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">maxTaskQueueActivitiesPerSecond :: Maybe Double
</span><a href="Temporal.Core.Worker.html#maxTaskQueueActivitiesPerSecond"><span class="hs-identifier hs-var">maxTaskQueueActivitiesPerSecond</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Double
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gracefulShutdownPeriodMillis :: Word64
</span><a href="Temporal.Core.Worker.html#gracefulShutdownPeriodMillis"><span class="hs-identifier hs-var">gracefulShutdownPeriodMillis</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nondeterminismAsWorkflowFail :: Bool
</span><a href="Temporal.Core.Worker.html#nondeterminismAsWorkflowFail"><span class="hs-identifier hs-var">nondeterminismAsWorkflowFail</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nondeterminismAsWorkflowFailForTypes :: [Text]
</span><a href="Temporal.Core.Worker.html#nondeterminismAsWorkflowFailForTypes"><span class="hs-identifier hs-var">nondeterminismAsWorkflowFailForTypes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_temporal_new_worker&quot;</span></span><span> </span><span id="raw_newWorker"><span class="annot"><a href="Temporal.Core.Worker.html#raw_newWorker"><span class="hs-identifier hs-var">raw_newWorker</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CoreClient"><span class="hs-identifier hs-type">CoreClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.CTypes.html#CArray"><span class="hs-identifier hs-type">CArray</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Temporal.Core.Worker.html#Real"><span class="hs-identifier hs-type">Real</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CWorkerError"><span class="hs-identifier hs-type">CWorkerError</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_temporal_validate_worker&quot;</span></span><span> </span><span id="raw_validateWorker"><span class="annot"><a href="Temporal.Core.Worker.html#raw_validateWorker"><span class="hs-identifier hs-var">raw_validateWorker</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679253687"><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253687"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Internal.FFI.html#TokioCall"><span class="hs-identifier hs-type">TokioCall</span></a></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CWorkerValidationError"><span class="hs-identifier hs-type">CWorkerValidationError</span></a></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CUnit"><span class="hs-identifier hs-type">CUnit</span></a></span></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="annot"><a href="Temporal.Core.Worker.html#validateWorker"><span class="hs-identifier hs-type">validateWorker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Temporal.Core.Worker.html#Real"><span class="hs-identifier hs-type">Real</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#WorkerValidationError"><span class="hs-identifier hs-type">WorkerValidationError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span id="validateWorker"><span class="annot"><span class="annottext">validateWorker :: Worker 'Real -&gt; IO (Either WorkerValidationError ())
</span><a href="Temporal.Core.Worker.html#validateWorker"><span class="hs-identifier hs-var hs-var">validateWorker</span></a></span></span><span> </span><span id="local-6989586621679254273"><span class="annot"><span class="annottext">Worker 'Real
</span><a href="#local-6989586621679254273"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Worker 'Real
-&gt; (Ptr (Worker 'Real) -&gt; IO (Either WorkerValidationError ()))
-&gt; IO (Either WorkerValidationError ())
forall (ty :: WorkerType) a.
KnownWorkerType ty =&gt;
Worker ty -&gt; (Ptr (Worker ty) -&gt; IO a) -&gt; IO a
</span><a href="Temporal.Core.Worker.html#withWorker"><span class="hs-identifier hs-var">withWorker</span></a></span><span> </span><span class="annot"><span class="annottext">Worker 'Real
</span><a href="#local-6989586621679254273"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr (Worker 'Real) -&gt; IO (Either WorkerValidationError ()))
 -&gt; IO (Either WorkerValidationError ()))
-&gt; (Ptr (Worker 'Real) -&gt; IO (Either WorkerValidationError ()))
-&gt; IO (Either WorkerValidationError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254274"><span class="annot"><span class="annottext">Ptr (Worker 'Real)
</span><a href="#local-6989586621679254274"><span class="hs-identifier hs-var">wp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-214"></span><span>  </span><span id="local-6989586621679254275"><span class="annot"><a href="#local-6989586621679254275"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TokioCall CWorkerValidationError CUnit
-&gt; Maybe (FinalizerPtr CWorkerValidationError)
-&gt; Maybe (FinalizerPtr CUnit)
-&gt; IO
     (Either (ForeignPtr CWorkerValidationError) (ForeignPtr CUnit))
forall err res.
TokioCall err res
-&gt; Maybe (FinalizerPtr err)
-&gt; Maybe (FinalizerPtr res)
-&gt; IO (Either (ForeignPtr err) (ForeignPtr res))
</span><a href="Temporal.Internal.FFI.html#makeTokioAsyncCall"><span class="hs-identifier hs-var">makeTokioAsyncCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr (Worker 'Real) -&gt; TokioCall CWorkerValidationError CUnit
forall (ty :: WorkerType).
Ptr (Worker ty) -&gt; TokioCall CWorkerValidationError CUnit
</span><a href="Temporal.Core.Worker.html#raw_validateWorker"><span class="hs-identifier hs-var">raw_validateWorker</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Worker 'Real)
</span><a href="#local-6989586621679254274"><span class="hs-identifier hs-var">wp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FinalizerPtr CWorkerValidationError
-&gt; Maybe (FinalizerPtr CWorkerValidationError)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr CWorkerValidationError
</span><a href="Temporal.Core.CTypes.html#rust_dropWorkerValidationError"><span class="hs-identifier hs-var">rust_dropWorkerValidationError</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FinalizerPtr CUnit -&gt; Maybe (FinalizerPtr CUnit)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr CUnit
</span><a href="Temporal.Core.CTypes.html#rust_dropUnit"><span class="hs-identifier hs-var">rust_dropUnit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679254275"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679254279"><span class="annot"><span class="annottext">ForeignPtr CWorkerValidationError
</span><a href="#local-6989586621679254279"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkerValidationError -&gt; Either WorkerValidationError ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(WorkerValidationError -&gt; Either WorkerValidationError ())
-&gt; IO WorkerValidationError -&gt; IO (Either WorkerValidationError ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CWorkerValidationError
-&gt; (Ptr CWorkerValidationError -&gt; IO WorkerValidationError)
-&gt; IO WorkerValidationError
forall a b. ForeignPtr a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CWorkerValidationError
</span><a href="#local-6989586621679254279"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr CWorkerValidationError -&gt; IO CWorkerValidationError
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">(Ptr CWorkerValidationError -&gt; IO CWorkerValidationError)
-&gt; (CWorkerValidationError -&gt; IO WorkerValidationError)
-&gt; Ptr CWorkerValidationError
-&gt; IO WorkerValidationError
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">CWorkerValidationError -&gt; IO WorkerValidationError
</span><a href="Temporal.Core.CTypes.html#peekWorkerValidationError"><span class="hs-identifier hs-var">peekWorkerValidationError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CUnit
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either WorkerValidationError ()
-&gt; IO (Either WorkerValidationError ())
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either WorkerValidationError ()
 -&gt; IO (Either WorkerValidationError ()))
-&gt; Either WorkerValidationError ()
-&gt; IO (Either WorkerValidationError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Either WorkerValidationError ()
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-string">&quot;&amp;hs_temporal_drop_worker&quot;</span></span><span> </span><span id="raw_closeWorker"><span class="annot"><a href="Temporal.Core.Worker.html#raw_closeWorker"><span class="hs-identifier hs-var">raw_closeWorker</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679253707"><span class="annot"><span class="hs-identifier hs-type">FinalizerPtr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253707"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="annot"><a href="Temporal.Core.Worker.html#getWorkerError"><span class="hs-identifier hs-type">getWorkerError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CWorkerError"><span class="hs-identifier hs-type">CWorkerError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#WorkerError"><span class="hs-identifier hs-type">WorkerError</span></a></span><span>
</span><span id="line-224"></span><span id="getWorkerError"><span class="annot"><span class="annottext">getWorkerError :: Ptr CWorkerError -&gt; IO WorkerError
</span><a href="Temporal.Core.Worker.html#getWorkerError"><span class="hs-identifier hs-var hs-var">getWorkerError</span></a></span></span><span> </span><span id="local-6989586621679254285"><span class="annot"><span class="annottext">Ptr CWorkerError
</span><a href="#local-6989586621679254285"><span class="hs-identifier hs-var">errPtr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-225"></span><span>  </span><span id="local-6989586621679254286"><span class="annot"><a href="#local-6989586621679254286"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FinalizerPtr CWorkerError
-&gt; Ptr CWorkerError -&gt; IO (ForeignPtr CWorkerError)
forall a. FinalizerPtr a -&gt; Ptr a -&gt; IO (ForeignPtr a)
</span><span class="hs-identifier hs-var">newForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr CWorkerError
</span><a href="Temporal.Core.CTypes.html#rust_dropWorkerError"><span class="hs-identifier hs-var">rust_dropWorkerError</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CWorkerError
</span><a href="#local-6989586621679254285"><span class="hs-identifier hs-var">errPtr</span></a></span><span>
</span><span id="line-226"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">withForeignPtr</span></span><span> </span><span class="annot"><a href="#local-6989586621679254286"><span class="hs-identifier hs-type">fp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">peek</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;=&gt;</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#peekWorkerError"><span class="hs-identifier hs-type">peekWorkerError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="hs-comment">-- note: removed the Runtime argument from the C function since the runtime can be accessed from the client. Might want to add it back later if</span><span>
</span><span id="line-230"></span><span class="hs-comment">-- it is some sort of load-bearing memory management thing.</span><span>
</span><span id="line-231"></span><span class="annot"><a href="Temporal.Core.Worker.html#newWorker"><span class="hs-identifier hs-type">newWorker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#WorkerConfig"><span class="hs-identifier hs-type">WorkerConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#WorkerError"><span class="hs-identifier hs-type">WorkerError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Temporal.Core.Worker.html#Real"><span class="hs-identifier hs-type">Real</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span id="newWorker"><span class="annot"><span class="annottext">newWorker :: Client -&gt; WorkerConfig -&gt; IO (Either WorkerError (Worker 'Real))
</span><a href="Temporal.Core.Worker.html#newWorker"><span class="hs-identifier hs-var hs-var">newWorker</span></a></span></span><span> </span><span id="local-6989586621679254290"><span class="annot"><span class="annottext">Client
</span><a href="#local-6989586621679254290"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679254291"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621679254291"><span class="hs-identifier hs-var">wc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Client
-&gt; (Ptr CoreClient -&gt; IO (Either WorkerError (Worker 'Real)))
-&gt; IO (Either WorkerError (Worker 'Real))
forall a. Client -&gt; (Ptr CoreClient -&gt; IO a) -&gt; IO a
</span><a href="Temporal.Core.Client.html#withClient"><span class="hs-identifier hs-var">withClient</span></a></span><span> </span><span class="annot"><span class="annottext">Client
</span><a href="#local-6989586621679254290"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr CoreClient -&gt; IO (Either WorkerError (Worker 'Real)))
 -&gt; IO (Either WorkerError (Worker 'Real)))
-&gt; (Ptr CoreClient -&gt; IO (Either WorkerError (Worker 'Real)))
-&gt; IO (Either WorkerError (Worker 'Real))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254293"><span class="annot"><span class="annottext">Ptr CoreClient
</span><a href="#local-6989586621679254293"><span class="hs-identifier hs-var">cPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-233"></span><span>  </span><span class="annot"><span class="annottext">ByteString
-&gt; (Ptr (CArray Word8) -&gt; IO (Either WorkerError (Worker 'Real)))
-&gt; IO (Either WorkerError (Worker 'Real))
forall b. ByteString -&gt; (Ptr (CArray Word8) -&gt; IO b) -&gt; IO b
</span><a href="Temporal.Internal.FFI.html#withCArrayBS"><span class="hs-identifier hs-var">withCArrayBS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LazyByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BL.toStrict</span></span><span> </span><span class="annot"><span class="annottext">(LazyByteString -&gt; ByteString) -&gt; LazyByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WorkerConfig -&gt; LazyByteString
forall a. ToJSON a =&gt; a -&gt; LazyByteString
</span><span class="hs-identifier hs-var">encode</span></span><span> </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621679254291"><span class="hs-identifier hs-var">wc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Ptr (CArray Word8) -&gt; IO (Either WorkerError (Worker 'Real)))
 -&gt; IO (Either WorkerError (Worker 'Real)))
-&gt; (Ptr (CArray Word8) -&gt; IO (Either WorkerError (Worker 'Real)))
-&gt; IO (Either WorkerError (Worker 'Real))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254297"><span class="annot"><span class="annottext">Ptr (CArray Word8)
</span><a href="#local-6989586621679254297"><span class="hs-identifier hs-var">wcPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-234"></span><span>    </span><span id="local-6989586621679254298"><span class="annot"><a href="#local-6989586621679254298"><span class="hs-identifier hs-var">wPtrPtrFP</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (ForeignPtr (Ptr (Worker 'Real)))
forall a. Storable a =&gt; IO (ForeignPtr a)
</span><span class="hs-identifier hs-var">mallocForeignPtr</span></span><span>
</span><span id="line-235"></span><span>    </span><span id="local-6989586621679254300"><span class="annot"><a href="#local-6989586621679254300"><span class="hs-identifier hs-var">errPtrPtrFP</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mallocForeignPtr</span></span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">withForeignPtr</span></span><span> </span><span class="annot"><a href="#local-6989586621679254298"><span class="hs-identifier hs-type">wPtrPtrFP</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254301"><span class="annot"><span class="annottext">Ptr (Ptr (Worker 'Real))
</span><a href="#local-6989586621679254301"><span class="hs-identifier hs-var">wPtrPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-237"></span><span>      </span><span class="annot"><span class="annottext">ForeignPtr (Ptr CWorkerError)
-&gt; (Ptr (Ptr CWorkerError)
    -&gt; IO (Either WorkerError (Worker 'Real)))
-&gt; IO (Either WorkerError (Worker 'Real))
forall a b. ForeignPtr a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr (Ptr CWorkerError)
</span><a href="#local-6989586621679254300"><span class="hs-identifier hs-var">errPtrPtrFP</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr (Ptr CWorkerError) -&gt; IO (Either WorkerError (Worker 'Real)))
 -&gt; IO (Either WorkerError (Worker 'Real)))
-&gt; (Ptr (Ptr CWorkerError)
    -&gt; IO (Either WorkerError (Worker 'Real)))
-&gt; IO (Either WorkerError (Worker 'Real))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254302"><span class="annot"><span class="annottext">Ptr (Ptr CWorkerError)
</span><a href="#local-6989586621679254302"><span class="hs-identifier hs-var">errPtrPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-238"></span><span>        </span><span class="annot"><span class="annottext">Ptr (Ptr (Worker 'Real)) -&gt; Ptr (Worker 'Real) -&gt; IO ()
forall a. Storable a =&gt; Ptr a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">poke</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr (Worker 'Real))
</span><a href="#local-6989586621679254301"><span class="hs-identifier hs-var">wPtrPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Worker 'Real)
forall a. Ptr a
</span><span class="hs-identifier hs-var">nullPtr</span></span><span>
</span><span id="line-239"></span><span>        </span><span class="annot"><span class="annottext">Ptr (Ptr CWorkerError) -&gt; Ptr CWorkerError -&gt; IO ()
forall a. Storable a =&gt; Ptr a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">poke</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr CWorkerError)
</span><a href="#local-6989586621679254302"><span class="hs-identifier hs-var">errPtrPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CWorkerError
forall a. Ptr a
</span><span class="hs-identifier hs-var">nullPtr</span></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span>        </span><span class="annot"><span class="annottext">IO (Either WorkerError (Worker 'Real))
-&gt; IO (Either WorkerError (Worker 'Real))
forall a. IO a -&gt; IO a
</span><span class="hs-identifier hs-var">mask_</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either WorkerError (Worker 'Real))
 -&gt; IO (Either WorkerError (Worker 'Real)))
-&gt; IO (Either WorkerError (Worker 'Real))
-&gt; IO (Either WorkerError (Worker 'Real))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-242"></span><span>          </span><span class="annot"><span class="annottext">Ptr CoreClient
-&gt; Ptr (CArray Word8)
-&gt; Ptr (Ptr (Worker 'Real))
-&gt; Ptr (Ptr CWorkerError)
-&gt; IO ()
</span><a href="Temporal.Core.Worker.html#raw_newWorker"><span class="hs-identifier hs-var">raw_newWorker</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CoreClient
</span><a href="#local-6989586621679254293"><span class="hs-identifier hs-var">cPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (CArray Word8)
</span><a href="#local-6989586621679254297"><span class="hs-identifier hs-var">wcPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr (Worker 'Real))
</span><a href="#local-6989586621679254301"><span class="hs-identifier hs-var">wPtrPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr CWorkerError)
</span><a href="#local-6989586621679254302"><span class="hs-identifier hs-var">errPtrPtr</span></a></span><span>
</span><span id="line-243"></span><span>          </span><span id="local-6989586621679254306"><span class="annot"><a href="#local-6989586621679254306"><span class="hs-identifier hs-var">errPtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr CWorkerError) -&gt; IO (Ptr CWorkerError)
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr CWorkerError)
</span><a href="#local-6989586621679254302"><span class="hs-identifier hs-var">errPtrPtr</span></a></span><span>
</span><span id="line-244"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679254306"><span class="hs-identifier hs-type">errPtr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">nullPtr</span></span><span>
</span><span id="line-245"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>              </span><span id="local-6989586621679254307"><span class="annot"><a href="#local-6989586621679254307"><span class="hs-identifier hs-var">wPtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">peek</span></span><span> </span><span class="annot"><a href="#local-6989586621679254301"><span class="hs-identifier hs-type">wPtrPtr</span></a></span><span>
</span><span id="line-247"></span><span>              </span><span id="local-6989586621679254308"><span class="annot"><a href="#local-6989586621679254308"><span class="hs-identifier hs-var">wPtrFP</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newForeignPtr</span></span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#raw_closeWorker"><span class="hs-identifier hs-type">raw_closeWorker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679254307"><span class="hs-identifier hs-type">wPtr</span></a></span><span>
</span><span id="line-248"></span><span>              </span><span id="local-6989586621679254309"><span class="annot"><a href="#local-6989586621679254309"><span class="hs-identifier hs-var">wPtrRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621679254308"><span class="hs-identifier hs-type">wPtrFP</span></a></span><span>
</span><span id="line-249"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679254309"><span class="hs-identifier hs-type">wPtrRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679254291"><span class="hs-identifier hs-type">wc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679254290"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Client.html#clientRuntime"><span class="hs-identifier hs-type">clientRuntime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679254290"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#getWorkerError"><span class="hs-identifier hs-type">getWorkerError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679254306"><span class="hs-identifier hs-type">errPtr</span></a></span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="hs-keyword">data</span><span> </span><span id="WorkerAlreadyClosed"><span class="annot"><a href="Temporal.Core.Worker.html#WorkerAlreadyClosed"><span class="hs-identifier hs-var">WorkerAlreadyClosed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WorkerAlreadyClosed"><span class="annot"><a href="Temporal.Core.Worker.html#WorkerAlreadyClosed"><span class="hs-identifier hs-var">WorkerAlreadyClosed</span></a></span></span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679254314"><span id="local-6989586621679254316"><span id="local-6989586621679254320"><span class="annot"><span class="annottext">Int -&gt; WorkerAlreadyClosed -&gt; ShowS
[WorkerAlreadyClosed] -&gt; ShowS
WorkerAlreadyClosed -&gt; String
(Int -&gt; WorkerAlreadyClosed -&gt; ShowS)
-&gt; (WorkerAlreadyClosed -&gt; String)
-&gt; ([WorkerAlreadyClosed] -&gt; ShowS)
-&gt; Show WorkerAlreadyClosed
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; WorkerAlreadyClosed -&gt; ShowS
showsPrec :: Int -&gt; WorkerAlreadyClosed -&gt; ShowS
$cshow :: WorkerAlreadyClosed -&gt; String
show :: WorkerAlreadyClosed -&gt; String
$cshowList :: [WorkerAlreadyClosed] -&gt; ShowS
showList :: [WorkerAlreadyClosed] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679254329"><span id="local-6989586621679254333"><span id="local-6989586621679254336"><span id="local-6989586621679254339"><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#WorkerAlreadyClosed"><span class="hs-identifier hs-type">WorkerAlreadyClosed</span></a></span></span></span></span></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span id="local-6989586621679253715"><span class="annot"><a href="Temporal.Core.Worker.html#closeWorker"><span class="hs-identifier hs-type">closeWorker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253715"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-261"></span><span id="closeWorker"><span class="annot"><span class="annottext">closeWorker :: forall (ty :: WorkerType). Worker ty -&gt; IO ()
</span><a href="Temporal.Core.Worker.html#closeWorker"><span class="hs-identifier hs-var hs-var">closeWorker</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span id="local-6989586621679254346"><span class="annot"><span class="annottext">IORef (ForeignPtr (Worker ty))
</span><a href="#local-6989586621679254346"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="annot"><span class="annottext">WorkerConfig
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">InactiveForReplay ty Client
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Runtime
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
</span><span class="hs-identifier hs-var">mask_</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-262"></span><span>  </span><span id="local-6989586621679254347"><span class="annot"><a href="#local-6989586621679254347"><span class="hs-identifier hs-var">wp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef (ForeignPtr (Worker ty))
-&gt; (ForeignPtr (Worker ty)
    -&gt; (ForeignPtr (Worker ty), ForeignPtr (Worker ty)))
-&gt; IO (ForeignPtr (Worker ty))
forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><span class="hs-identifier hs-var">atomicModifyIORef'</span></span><span> </span><span class="annot"><span class="annottext">IORef (ForeignPtr (Worker ty))
</span><a href="#local-6989586621679254346"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">((ForeignPtr (Worker ty)
  -&gt; (ForeignPtr (Worker ty), ForeignPtr (Worker ty)))
 -&gt; IO (ForeignPtr (Worker ty)))
-&gt; (ForeignPtr (Worker ty)
    -&gt; (ForeignPtr (Worker ty), ForeignPtr (Worker ty)))
-&gt; IO (ForeignPtr (Worker ty))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254349"><span class="annot"><span class="annottext">ForeignPtr (Worker ty)
</span><a href="#local-6989586621679254349"><span class="hs-identifier hs-var">wp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorkerAlreadyClosed -&gt; ForeignPtr (Worker ty)
forall a e. (?callStack::CallStack, Exception e) =&gt; e -&gt; a
</span><span class="hs-identifier hs-var">throw</span></span><span> </span><span class="annot"><span class="annottext">WorkerAlreadyClosed
</span><a href="Temporal.Core.Worker.html#WorkerAlreadyClosed"><span class="hs-identifier hs-var">WorkerAlreadyClosed</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForeignPtr (Worker ty)
</span><a href="#local-6989586621679254349"><span class="hs-identifier hs-var">wp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">finalizeForeignPtr</span></span><span> </span><span class="annot"><a href="#local-6989586621679254347"><span class="hs-identifier hs-type">wp</span></a></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_temporal_new_replay_worker&quot;</span></span><span> </span><span id="raw_newReplayWorker"><span class="annot"><a href="Temporal.Core.Worker.html#raw_newReplayWorker"><span class="hs-identifier hs-var">raw_newReplayWorker</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#Runtime"><span class="hs-identifier hs-type">Runtime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.CTypes.html#CArray"><span class="hs-identifier hs-type">CArray</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Temporal.Core.Worker.html#Replay"><span class="hs-identifier hs-type">Replay</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#HistoryPusher"><span class="hs-identifier hs-type">HistoryPusher</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CWorkerError"><span class="hs-identifier hs-type">CWorkerError</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="annot"><a href="Temporal.Core.Worker.html#newReplayWorker"><span class="hs-identifier hs-type">newReplayWorker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#Runtime"><span class="hs-identifier hs-type">Runtime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#WorkerConfig"><span class="hs-identifier hs-type">WorkerConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#WorkerError"><span class="hs-identifier hs-type">WorkerError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Temporal.Core.Worker.html#Replay"><span class="hs-identifier hs-type">Replay</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#HistoryPusher"><span class="hs-identifier hs-type">HistoryPusher</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span id="newReplayWorker"><span class="annot"><span class="annottext">newReplayWorker :: Runtime
-&gt; WorkerConfig
-&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher))
</span><a href="Temporal.Core.Worker.html#newReplayWorker"><span class="hs-identifier hs-var hs-var">newReplayWorker</span></a></span></span><span> </span><span id="local-6989586621679254353"><span class="annot"><span class="annottext">Runtime
</span><a href="#local-6989586621679254353"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679254354"><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621679254354"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Runtime
-&gt; (Ptr Runtime
    -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
-&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher))
forall a. Runtime -&gt; (Ptr Runtime -&gt; IO a) -&gt; IO a
</span><a href="Temporal.Runtime.html#withRuntime"><span class="hs-identifier hs-var">withRuntime</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime
</span><a href="#local-6989586621679254353"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr Runtime
  -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
 -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
-&gt; (Ptr Runtime
    -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
-&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254355"><span class="annot"><span class="annottext">Ptr Runtime
</span><a href="#local-6989586621679254355"><span class="hs-identifier hs-var">rPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-271"></span><span>  </span><span class="annot"><span class="annottext">(Ptr (Ptr (Worker 'Replay))
 -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
-&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher))
forall a b. Storable a =&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">alloca</span></span><span> </span><span class="annot"><span class="annottext">((Ptr (Ptr (Worker 'Replay))
  -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
 -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
-&gt; (Ptr (Ptr (Worker 'Replay))
    -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
-&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254357"><span class="annot"><span class="annottext">Ptr (Ptr (Worker 'Replay))
</span><a href="#local-6989586621679254357"><span class="hs-identifier hs-var">wPtrPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-272"></span><span>    </span><span class="annot"><span class="annottext">(Ptr (Ptr HistoryPusher)
 -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
-&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher))
forall a b. Storable a =&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">alloca</span></span><span> </span><span class="annot"><span class="annottext">((Ptr (Ptr HistoryPusher)
  -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
 -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
-&gt; (Ptr (Ptr HistoryPusher)
    -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
-&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254358"><span class="annot"><span class="annottext">Ptr (Ptr HistoryPusher)
</span><a href="#local-6989586621679254358"><span class="hs-identifier hs-var">hpPtrPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-273"></span><span>      </span><span class="annot"><span class="annottext">ByteString
-&gt; (Ptr (CArray Word8)
    -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
-&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher))
forall b. ByteString -&gt; (Ptr (CArray Word8) -&gt; IO b) -&gt; IO b
</span><a href="Temporal.Internal.FFI.html#withCArrayBS"><span class="hs-identifier hs-var">withCArrayBS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LazyByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BL.toStrict</span></span><span> </span><span class="annot"><span class="annottext">(LazyByteString -&gt; ByteString) -&gt; LazyByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WorkerConfig -&gt; LazyByteString
forall a. ToJSON a =&gt; a -&gt; LazyByteString
</span><span class="hs-identifier hs-var">encode</span></span><span> </span><span class="annot"><span class="annottext">WorkerConfig
</span><a href="#local-6989586621679254354"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Ptr (CArray Word8)
  -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
 -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
-&gt; (Ptr (CArray Word8)
    -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
-&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254359"><span class="annot"><span class="annottext">Ptr (CArray Word8)
</span><a href="#local-6989586621679254359"><span class="hs-identifier hs-var">confPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-274"></span><span>        </span><span class="annot"><span class="annottext">(Ptr (Ptr CWorkerError)
 -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
-&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher))
forall a b. Storable a =&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">alloca</span></span><span> </span><span class="annot"><span class="annottext">((Ptr (Ptr CWorkerError)
  -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
 -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
-&gt; (Ptr (Ptr CWorkerError)
    -&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher)))
-&gt; IO (Either WorkerError (Worker 'Replay, HistoryPusher))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254360"><span class="annot"><span class="annottext">Ptr (Ptr CWorkerError)
</span><a href="#local-6989586621679254360"><span class="hs-identifier hs-var">errPtrPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-275"></span><span>          </span><span class="annot"><span class="annottext">Ptr (Ptr (Worker 'Replay)) -&gt; Ptr (Worker 'Replay) -&gt; IO ()
forall a. Storable a =&gt; Ptr a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">poke</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr (Worker 'Replay))
</span><a href="#local-6989586621679254357"><span class="hs-identifier hs-var">wPtrPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Worker 'Replay)
forall a. Ptr a
</span><span class="hs-identifier hs-var">nullPtr</span></span><span>
</span><span id="line-276"></span><span>          </span><span class="annot"><span class="annottext">Ptr (Ptr HistoryPusher) -&gt; Ptr HistoryPusher -&gt; IO ()
forall a. Storable a =&gt; Ptr a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">poke</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr HistoryPusher)
</span><a href="#local-6989586621679254358"><span class="hs-identifier hs-var">hpPtrPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr HistoryPusher
forall a. Ptr a
</span><span class="hs-identifier hs-var">nullPtr</span></span><span>
</span><span id="line-277"></span><span>          </span><span class="annot"><span class="annottext">Ptr (Ptr CWorkerError) -&gt; Ptr CWorkerError -&gt; IO ()
forall a. Storable a =&gt; Ptr a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">poke</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr CWorkerError)
</span><a href="#local-6989586621679254360"><span class="hs-identifier hs-var">errPtrPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CWorkerError
forall a. Ptr a
</span><span class="hs-identifier hs-var">nullPtr</span></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>          </span><span class="annot"><span class="annottext">Ptr Runtime
-&gt; Ptr (CArray Word8)
-&gt; Ptr (Ptr (Worker 'Replay))
-&gt; Ptr (Ptr HistoryPusher)
-&gt; Ptr (Ptr CWorkerError)
-&gt; IO ()
</span><a href="Temporal.Core.Worker.html#raw_newReplayWorker"><span class="hs-identifier hs-var">raw_newReplayWorker</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Runtime
</span><a href="#local-6989586621679254355"><span class="hs-identifier hs-var">rPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (CArray Word8)
</span><a href="#local-6989586621679254359"><span class="hs-identifier hs-var">confPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr (Worker 'Replay))
</span><a href="#local-6989586621679254357"><span class="hs-identifier hs-var">wPtrPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr HistoryPusher)
</span><a href="#local-6989586621679254358"><span class="hs-identifier hs-var">hpPtrPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr CWorkerError)
</span><a href="#local-6989586621679254360"><span class="hs-identifier hs-var">errPtrPtr</span></a></span><span>
</span><span id="line-280"></span><span>          </span><span id="local-6989586621679254361"><span class="annot"><a href="#local-6989586621679254361"><span class="hs-identifier hs-var">errPtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr CWorkerError) -&gt; IO (Ptr CWorkerError)
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr CWorkerError)
</span><a href="#local-6989586621679254360"><span class="hs-identifier hs-var">errPtrPtr</span></a></span><span>
</span><span id="line-281"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679254361"><span class="hs-identifier hs-type">errPtr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">nullPtr</span></span><span>
</span><span id="line-282"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-283"></span><span>              </span><span id="local-6989586621679254362"><span class="annot"><a href="#local-6989586621679254362"><span class="hs-identifier hs-var">wPtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">peek</span></span><span> </span><span class="annot"><a href="#local-6989586621679254357"><span class="hs-identifier hs-type">wPtrPtr</span></a></span><span>
</span><span id="line-284"></span><span>              </span><span id="local-6989586621679254363"><span class="annot"><a href="#local-6989586621679254363"><span class="hs-identifier hs-var">hpPtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">peek</span></span><span> </span><span class="annot"><a href="#local-6989586621679254358"><span class="hs-identifier hs-type">hpPtrPtr</span></a></span><span>
</span><span id="line-285"></span><span>              </span><span id="local-6989586621679254364"><span class="annot"><a href="#local-6989586621679254364"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newForeignPtr</span></span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#raw_closeWorker"><span class="hs-identifier hs-type">raw_closeWorker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679254362"><span class="hs-identifier hs-type">wPtr</span></a></span><span>
</span><span id="line-286"></span><span>              </span><span id="local-6989586621679254365"><span class="annot"><a href="#local-6989586621679254365"><span class="hs-identifier hs-var">wRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621679254364"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-287"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679254365"><span class="hs-identifier hs-type">wRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679254354"><span class="hs-identifier hs-type">conf</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679254353"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#HistoryPusher"><span class="hs-identifier hs-type">HistoryPusher</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679254363"><span class="hs-identifier hs-type">hpPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#getWorkerError"><span class="hs-identifier hs-type">getWorkerError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679254361"><span class="hs-identifier hs-type">errPtr</span></a></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_temporal_worker_poll_workflow_activation&quot;</span></span><span> </span><span id="raw_pollWorkflowActivation"><span class="annot"><a href="Temporal.Core.Worker.html#raw_pollWorkflowActivation"><span class="hs-identifier hs-var">raw_pollWorkflowActivation</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679253729"><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253729"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Internal.FFI.html#TokioCall"><span class="hs-identifier hs-type">TokioCall</span></a></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CWorkerError"><span class="hs-identifier hs-type">CWorkerError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.CTypes.html#CArray"><span class="hs-identifier hs-type">CArray</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span id="local-6989586621679253725"><span class="annot"><a href="Temporal.Core.Worker.html#pollWorkflowActivation"><span class="hs-identifier hs-type">pollWorkflowActivation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#KnownWorkerType"><span class="hs-identifier hs-type">KnownWorkerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253725"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253725"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#WorkerError"><span class="hs-identifier hs-type">WorkerError</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">WorkflowActivation</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-295"></span><span id="pollWorkflowActivation"><span class="annot"><span class="annottext">pollWorkflowActivation :: forall (ty :: WorkerType).
KnownWorkerType ty =&gt;
Worker ty -&gt; IO (Either WorkerError WorkflowActivation)
</span><a href="Temporal.Core.Worker.html#pollWorkflowActivation"><span class="hs-identifier hs-var hs-var">pollWorkflowActivation</span></a></span></span><span> </span><span id="local-6989586621679254381"><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621679254381"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Worker ty
-&gt; (Ptr (Worker ty) -&gt; IO (Either WorkerError WorkflowActivation))
-&gt; IO (Either WorkerError WorkflowActivation)
forall (ty :: WorkerType) a.
KnownWorkerType ty =&gt;
Worker ty -&gt; (Ptr (Worker ty) -&gt; IO a) -&gt; IO a
</span><a href="Temporal.Core.Worker.html#withWorker"><span class="hs-identifier hs-var">withWorker</span></a></span><span> </span><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621679254381"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr (Worker ty) -&gt; IO (Either WorkerError WorkflowActivation))
 -&gt; IO (Either WorkerError WorkflowActivation))
-&gt; (Ptr (Worker ty) -&gt; IO (Either WorkerError WorkflowActivation))
-&gt; IO (Either WorkerError WorkflowActivation)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254382"><span class="annot"><span class="annottext">Ptr (Worker ty)
</span><a href="#local-6989586621679254382"><span class="hs-identifier hs-var">wp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-296"></span><span>  </span><span id="local-6989586621679254383"><span class="annot"><a href="#local-6989586621679254383"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-297"></span><span>    </span><span class="annot"><span class="annottext">TokioCall CWorkerError (CArray Word8)
-&gt; Maybe (FinalizerPtr CWorkerError)
-&gt; Maybe (FinalizerPtr (CArray Word8))
-&gt; IO
     (Either (ForeignPtr CWorkerError) (ForeignPtr (CArray Word8)))
forall err res.
TokioCall err res
-&gt; Maybe (FinalizerPtr err)
-&gt; Maybe (FinalizerPtr res)
-&gt; IO (Either (ForeignPtr err) (ForeignPtr res))
</span><a href="Temporal.Internal.FFI.html#makeTokioAsyncCall"><span class="hs-identifier hs-var">makeTokioAsyncCall</span></a></span><span>
</span><span id="line-298"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr (Worker ty) -&gt; TokioCall CWorkerError (CArray Word8)
forall (ty :: WorkerType).
Ptr (Worker ty) -&gt; TokioCall CWorkerError (CArray Word8)
</span><a href="Temporal.Core.Worker.html#raw_pollWorkflowActivation"><span class="hs-identifier hs-var">raw_pollWorkflowActivation</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Worker ty)
</span><a href="#local-6989586621679254382"><span class="hs-identifier hs-var">wp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FinalizerPtr CWorkerError -&gt; Maybe (FinalizerPtr CWorkerError)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr CWorkerError
</span><a href="Temporal.Core.CTypes.html#rust_dropWorkerError"><span class="hs-identifier hs-var">rust_dropWorkerError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FinalizerPtr (CArray Word8) -&gt; Maybe (FinalizerPtr (CArray Word8))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr (CArray Word8)
</span><a href="Temporal.Core.CTypes.html#rust_dropByteArray"><span class="hs-identifier hs-var">rust_dropByteArray</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679254383"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-302"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679254385"><span class="annot"><span class="annottext">ForeignPtr CWorkerError
</span><a href="#local-6989586621679254385"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkerError -&gt; Either WorkerError WorkflowActivation
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(WorkerError -&gt; Either WorkerError WorkflowActivation)
-&gt; IO WorkerError -&gt; IO (Either WorkerError WorkflowActivation)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CWorkerError
-&gt; (Ptr CWorkerError -&gt; IO WorkerError) -&gt; IO WorkerError
forall a b. ForeignPtr a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CWorkerError
</span><a href="#local-6989586621679254385"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr CWorkerError -&gt; IO CWorkerError
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">(Ptr CWorkerError -&gt; IO CWorkerError)
-&gt; (CWorkerError -&gt; IO WorkerError)
-&gt; Ptr CWorkerError
-&gt; IO WorkerError
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">CWorkerError -&gt; IO WorkerError
</span><a href="Temporal.Core.CTypes.html#peekWorkerError"><span class="hs-identifier hs-var">peekWorkerError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679254386"><span class="annot"><span class="annottext">ForeignPtr (CArray Word8)
</span><a href="#local-6989586621679254386"><span class="hs-identifier hs-var">ok</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkflowActivation -&gt; Either WorkerError WorkflowActivation
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(WorkflowActivation -&gt; Either WorkerError WorkflowActivation)
-&gt; (ByteString -&gt; WorkflowActivation)
-&gt; ByteString
-&gt; Either WorkerError WorkflowActivation
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; WorkflowActivation
forall msg. Message msg =&gt; ByteString -&gt; msg
</span><span class="hs-identifier hs-var">decodeMessageOrDie</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Either WorkerError WorkflowActivation)
-&gt; IO ByteString -&gt; IO (Either WorkerError WorkflowActivation)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr (CArray Word8)
-&gt; (Ptr (CArray Word8) -&gt; IO ByteString) -&gt; IO ByteString
forall a b. ForeignPtr a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr (CArray Word8)
</span><a href="#local-6989586621679254386"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr (CArray Word8) -&gt; IO (CArray Word8)
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">(Ptr (CArray Word8) -&gt; IO (CArray Word8))
-&gt; (CArray Word8 -&gt; IO ByteString)
-&gt; Ptr (CArray Word8)
-&gt; IO ByteString
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">CArray Word8 -&gt; IO ByteString
</span><a href="Temporal.Core.CTypes.html#cArrayToByteString"><span class="hs-identifier hs-var">cArrayToByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_temporal_worker_poll_activity_task&quot;</span></span><span> </span><span id="raw_pollActivityTask"><span class="annot"><a href="Temporal.Core.Worker.html#raw_pollActivityTask"><span class="hs-identifier hs-var">raw_pollActivityTask</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679254390"><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679254390"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Internal.FFI.html#TokioCall"><span class="hs-identifier hs-type">TokioCall</span></a></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CWorkerError"><span class="hs-identifier hs-type">CWorkerError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.CTypes.html#CArray"><span class="hs-identifier hs-type">CArray</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span id="local-6989586621679253734"><span class="annot"><a href="Temporal.Core.Worker.html#pollActivityTask"><span class="hs-identifier hs-type">pollActivityTask</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#KnownWorkerType"><span class="hs-identifier hs-type">KnownWorkerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253734"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253734"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#WorkerError"><span class="hs-identifier hs-type">WorkerError</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ActivityTask</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-310"></span><span id="pollActivityTask"><span class="annot"><span class="annottext">pollActivityTask :: forall (ty :: WorkerType).
KnownWorkerType ty =&gt;
Worker ty -&gt; IO (Either WorkerError ActivityTask)
</span><a href="Temporal.Core.Worker.html#pollActivityTask"><span class="hs-identifier hs-var hs-var">pollActivityTask</span></a></span></span><span> </span><span id="local-6989586621679254403"><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621679254403"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Worker ty
-&gt; (Ptr (Worker ty) -&gt; IO (Either WorkerError ActivityTask))
-&gt; IO (Either WorkerError ActivityTask)
forall (ty :: WorkerType) a.
KnownWorkerType ty =&gt;
Worker ty -&gt; (Ptr (Worker ty) -&gt; IO a) -&gt; IO a
</span><a href="Temporal.Core.Worker.html#withWorker"><span class="hs-identifier hs-var">withWorker</span></a></span><span> </span><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621679254403"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr (Worker ty) -&gt; IO (Either WorkerError ActivityTask))
 -&gt; IO (Either WorkerError ActivityTask))
-&gt; (Ptr (Worker ty) -&gt; IO (Either WorkerError ActivityTask))
-&gt; IO (Either WorkerError ActivityTask)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254404"><span class="annot"><span class="annottext">Ptr (Worker ty)
</span><a href="#local-6989586621679254404"><span class="hs-identifier hs-var">wp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-311"></span><span>  </span><span id="local-6989586621679254405"><span class="annot"><a href="#local-6989586621679254405"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-312"></span><span>    </span><span class="annot"><span class="annottext">TokioCall CWorkerError (CArray Word8)
-&gt; Maybe (FinalizerPtr CWorkerError)
-&gt; Maybe (FinalizerPtr (CArray Word8))
-&gt; IO
     (Either (ForeignPtr CWorkerError) (ForeignPtr (CArray Word8)))
forall err res.
TokioCall err res
-&gt; Maybe (FinalizerPtr err)
-&gt; Maybe (FinalizerPtr res)
-&gt; IO (Either (ForeignPtr err) (ForeignPtr res))
</span><a href="Temporal.Internal.FFI.html#makeTokioAsyncCall"><span class="hs-identifier hs-var">makeTokioAsyncCall</span></a></span><span>
</span><span id="line-313"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr (Worker ty) -&gt; TokioCall CWorkerError (CArray Word8)
forall (ty :: WorkerType).
Ptr (Worker ty) -&gt; TokioCall CWorkerError (CArray Word8)
</span><a href="Temporal.Core.Worker.html#raw_pollActivityTask"><span class="hs-identifier hs-var">raw_pollActivityTask</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Worker ty)
</span><a href="#local-6989586621679254404"><span class="hs-identifier hs-var">wp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FinalizerPtr CWorkerError -&gt; Maybe (FinalizerPtr CWorkerError)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr CWorkerError
</span><a href="Temporal.Core.CTypes.html#rust_dropWorkerError"><span class="hs-identifier hs-var">rust_dropWorkerError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FinalizerPtr (CArray Word8) -&gt; Maybe (FinalizerPtr (CArray Word8))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr (CArray Word8)
</span><a href="Temporal.Core.CTypes.html#rust_dropByteArray"><span class="hs-identifier hs-var">rust_dropByteArray</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679254405"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-317"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679254406"><span class="annot"><span class="annottext">ForeignPtr CWorkerError
</span><a href="#local-6989586621679254406"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkerError -&gt; Either WorkerError ActivityTask
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(WorkerError -&gt; Either WorkerError ActivityTask)
-&gt; IO WorkerError -&gt; IO (Either WorkerError ActivityTask)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CWorkerError
-&gt; (Ptr CWorkerError -&gt; IO WorkerError) -&gt; IO WorkerError
forall a b. ForeignPtr a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CWorkerError
</span><a href="#local-6989586621679254406"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr CWorkerError -&gt; IO CWorkerError
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">(Ptr CWorkerError -&gt; IO CWorkerError)
-&gt; (CWorkerError -&gt; IO WorkerError)
-&gt; Ptr CWorkerError
-&gt; IO WorkerError
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">CWorkerError -&gt; IO WorkerError
</span><a href="Temporal.Core.CTypes.html#peekWorkerError"><span class="hs-identifier hs-var">peekWorkerError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679254407"><span class="annot"><span class="annottext">ForeignPtr (CArray Word8)
</span><a href="#local-6989586621679254407"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ActivityTask -&gt; Either WorkerError ActivityTask
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(ActivityTask -&gt; Either WorkerError ActivityTask)
-&gt; (ByteString -&gt; ActivityTask)
-&gt; ByteString
-&gt; Either WorkerError ActivityTask
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ActivityTask
forall msg. Message msg =&gt; ByteString -&gt; msg
</span><span class="hs-identifier hs-var">decodeMessageOrDie</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Either WorkerError ActivityTask)
-&gt; IO ByteString -&gt; IO (Either WorkerError ActivityTask)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr (CArray Word8)
-&gt; (Ptr (CArray Word8) -&gt; IO ByteString) -&gt; IO ByteString
forall a b. ForeignPtr a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr (CArray Word8)
</span><a href="#local-6989586621679254407"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr (CArray Word8) -&gt; IO (CArray Word8)
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">(Ptr (CArray Word8) -&gt; IO (CArray Word8))
-&gt; (CArray Word8 -&gt; IO ByteString)
-&gt; Ptr (CArray Word8)
-&gt; IO ByteString
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">CArray Word8 -&gt; IO ByteString
</span><a href="Temporal.Core.CTypes.html#cArrayToByteString"><span class="hs-identifier hs-var">cArrayToByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_temporal_worker_complete_workflow_activation&quot;</span></span><span> </span><span id="raw_completeWorkflowActivation"><span class="annot"><a href="Temporal.Core.Worker.html#raw_completeWorkflowActivation"><span class="hs-identifier hs-var">raw_completeWorkflowActivation</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679253741"><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253741"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.CTypes.html#CArray"><span class="hs-identifier hs-type">CArray</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Internal.FFI.html#TokioCall"><span class="hs-identifier hs-type">TokioCall</span></a></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CWorkerError"><span class="hs-identifier hs-type">CWorkerError</span></a></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CUnit"><span class="hs-identifier hs-type">CUnit</span></a></span></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span id="local-6989586621679253737"><span class="annot"><a href="Temporal.Core.Worker.html#completeWorkflowActivation"><span class="hs-identifier hs-type">completeWorkflowActivation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#KnownWorkerType"><span class="hs-identifier hs-type">KnownWorkerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253737"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253737"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WorkflowActivationCompletion</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#WorkerError"><span class="hs-identifier hs-type">WorkerError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-325"></span><span id="completeWorkflowActivation"><span class="annot"><span class="annottext">completeWorkflowActivation :: forall (ty :: WorkerType).
KnownWorkerType ty =&gt;
Worker ty
-&gt; WorkflowActivationCompletion -&gt; IO (Either WorkerError ())
</span><a href="Temporal.Core.Worker.html#completeWorkflowActivation"><span class="hs-identifier hs-var hs-var">completeWorkflowActivation</span></a></span></span><span> </span><span id="local-6989586621679254418"><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621679254418"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621679254419"><span class="annot"><span class="annottext">WorkflowActivationCompletion
</span><a href="#local-6989586621679254419"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Worker ty
-&gt; (Ptr (Worker ty) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall (ty :: WorkerType) a.
KnownWorkerType ty =&gt;
Worker ty -&gt; (Ptr (Worker ty) -&gt; IO a) -&gt; IO a
</span><a href="Temporal.Core.Worker.html#withWorker"><span class="hs-identifier hs-var">withWorker</span></a></span><span> </span><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621679254418"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr (Worker ty) -&gt; IO (Either WorkerError ()))
 -&gt; IO (Either WorkerError ()))
-&gt; (Ptr (Worker ty) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254420"><span class="annot"><span class="annottext">Ptr (Worker ty)
</span><a href="#local-6989586621679254420"><span class="hs-identifier hs-var">wp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-326"></span><span>  </span><span class="annot"><span class="annottext">ByteString
-&gt; (Ptr (CArray Word8) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall b. ByteString -&gt; (Ptr (CArray Word8) -&gt; IO b) -&gt; IO b
</span><a href="Temporal.Internal.FFI.html#withCArrayBS"><span class="hs-identifier hs-var">withCArrayBS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorkflowActivationCompletion -&gt; ByteString
forall msg. Message msg =&gt; msg -&gt; ByteString
</span><span class="hs-identifier hs-var">encodeMessage</span></span><span> </span><span class="annot"><span class="annottext">WorkflowActivationCompletion
</span><a href="#local-6989586621679254419"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Ptr (CArray Word8) -&gt; IO (Either WorkerError ()))
 -&gt; IO (Either WorkerError ()))
-&gt; (Ptr (CArray Word8) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254421"><span class="annot"><span class="annottext">Ptr (CArray Word8)
</span><a href="#local-6989586621679254421"><span class="hs-identifier hs-var">pPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-327"></span><span>    </span><span id="local-6989586621679254422"><span class="annot"><a href="#local-6989586621679254422"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-328"></span><span>      </span><span class="annot"><span class="annottext">TokioCall CWorkerError CUnit
-&gt; Maybe (FinalizerPtr CWorkerError)
-&gt; Maybe (FinalizerPtr CUnit)
-&gt; IO (Either (ForeignPtr CWorkerError) (ForeignPtr CUnit))
forall err res.
TokioCall err res
-&gt; Maybe (FinalizerPtr err)
-&gt; Maybe (FinalizerPtr res)
-&gt; IO (Either (ForeignPtr err) (ForeignPtr res))
</span><a href="Temporal.Internal.FFI.html#makeTokioAsyncCall"><span class="hs-identifier hs-var">makeTokioAsyncCall</span></a></span><span>
</span><span id="line-329"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr (Worker ty)
-&gt; Ptr (CArray Word8) -&gt; TokioCall CWorkerError CUnit
forall (ty :: WorkerType).
Ptr (Worker ty)
-&gt; Ptr (CArray Word8) -&gt; TokioCall CWorkerError CUnit
</span><a href="Temporal.Core.Worker.html#raw_completeWorkflowActivation"><span class="hs-identifier hs-var">raw_completeWorkflowActivation</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Worker ty)
</span><a href="#local-6989586621679254420"><span class="hs-identifier hs-var">wp</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (CArray Word8)
</span><a href="#local-6989586621679254421"><span class="hs-identifier hs-var">pPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FinalizerPtr CWorkerError -&gt; Maybe (FinalizerPtr CWorkerError)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr CWorkerError
</span><a href="Temporal.Core.CTypes.html#rust_dropWorkerError"><span class="hs-identifier hs-var">rust_dropWorkerError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FinalizerPtr CUnit -&gt; Maybe (FinalizerPtr CUnit)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr CUnit
</span><a href="Temporal.Core.CTypes.html#rust_dropUnit"><span class="hs-identifier hs-var">rust_dropUnit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679254422"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-333"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679254423"><span class="annot"><span class="annottext">ForeignPtr CWorkerError
</span><a href="#local-6989586621679254423"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkerError -&gt; Either WorkerError ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(WorkerError -&gt; Either WorkerError ())
-&gt; IO WorkerError -&gt; IO (Either WorkerError ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CWorkerError
-&gt; (Ptr CWorkerError -&gt; IO WorkerError) -&gt; IO WorkerError
forall a b. ForeignPtr a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CWorkerError
</span><a href="#local-6989586621679254423"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr CWorkerError -&gt; IO CWorkerError
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">(Ptr CWorkerError -&gt; IO CWorkerError)
-&gt; (CWorkerError -&gt; IO WorkerError)
-&gt; Ptr CWorkerError
-&gt; IO WorkerError
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">CWorkerError -&gt; IO WorkerError
</span><a href="Temporal.Core.CTypes.html#peekWorkerError"><span class="hs-identifier hs-var">peekWorkerError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CUnit
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either WorkerError () -&gt; IO (Either WorkerError ())
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either WorkerError () -&gt; IO (Either WorkerError ()))
-&gt; Either WorkerError () -&gt; IO (Either WorkerError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Either WorkerError ()
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_temporal_worker_complete_activity_task&quot;</span></span><span> </span><span id="raw_completeActivityTask"><span class="annot"><a href="Temporal.Core.Worker.html#raw_completeActivityTask"><span class="hs-identifier hs-var">raw_completeActivityTask</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679254425"><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679254425"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.CTypes.html#CArray"><span class="hs-identifier hs-type">CArray</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Internal.FFI.html#TokioCall"><span class="hs-identifier hs-type">TokioCall</span></a></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CWorkerError"><span class="hs-identifier hs-type">CWorkerError</span></a></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CUnit"><span class="hs-identifier hs-type">CUnit</span></a></span></span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span id="local-6989586621679253742"><span class="annot"><a href="Temporal.Core.Worker.html#completeActivityTask"><span class="hs-identifier hs-type">completeActivityTask</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#KnownWorkerType"><span class="hs-identifier hs-type">KnownWorkerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253742"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253742"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ActivityTaskCompletion</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#WorkerError"><span class="hs-identifier hs-type">WorkerError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-341"></span><span id="completeActivityTask"><span class="annot"><span class="annottext">completeActivityTask :: forall (ty :: WorkerType).
KnownWorkerType ty =&gt;
Worker ty -&gt; ActivityTaskCompletion -&gt; IO (Either WorkerError ())
</span><a href="Temporal.Core.Worker.html#completeActivityTask"><span class="hs-identifier hs-var hs-var">completeActivityTask</span></a></span></span><span> </span><span id="local-6989586621679254435"><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621679254435"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621679254436"><span class="annot"><span class="annottext">ActivityTaskCompletion
</span><a href="#local-6989586621679254436"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Worker ty
-&gt; (Ptr (Worker ty) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall (ty :: WorkerType) a.
KnownWorkerType ty =&gt;
Worker ty -&gt; (Ptr (Worker ty) -&gt; IO a) -&gt; IO a
</span><a href="Temporal.Core.Worker.html#withWorker"><span class="hs-identifier hs-var">withWorker</span></a></span><span> </span><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621679254435"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr (Worker ty) -&gt; IO (Either WorkerError ()))
 -&gt; IO (Either WorkerError ()))
-&gt; (Ptr (Worker ty) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254437"><span class="annot"><span class="annottext">Ptr (Worker ty)
</span><a href="#local-6989586621679254437"><span class="hs-identifier hs-var">wp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-342"></span><span>  </span><span class="annot"><span class="annottext">ByteString
-&gt; (Ptr (CArray Word8) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall b. ByteString -&gt; (Ptr (CArray Word8) -&gt; IO b) -&gt; IO b
</span><a href="Temporal.Internal.FFI.html#withCArrayBS"><span class="hs-identifier hs-var">withCArrayBS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActivityTaskCompletion -&gt; ByteString
forall msg. Message msg =&gt; msg -&gt; ByteString
</span><span class="hs-identifier hs-var">encodeMessage</span></span><span> </span><span class="annot"><span class="annottext">ActivityTaskCompletion
</span><a href="#local-6989586621679254436"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Ptr (CArray Word8) -&gt; IO (Either WorkerError ()))
 -&gt; IO (Either WorkerError ()))
-&gt; (Ptr (CArray Word8) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254438"><span class="annot"><span class="annottext">Ptr (CArray Word8)
</span><a href="#local-6989586621679254438"><span class="hs-identifier hs-var">pPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-343"></span><span>    </span><span id="local-6989586621679254439"><span class="annot"><a href="#local-6989586621679254439"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-344"></span><span>      </span><span class="annot"><span class="annottext">TokioCall CWorkerError CUnit
-&gt; Maybe (FinalizerPtr CWorkerError)
-&gt; Maybe (FinalizerPtr CUnit)
-&gt; IO (Either (ForeignPtr CWorkerError) (ForeignPtr CUnit))
forall err res.
TokioCall err res
-&gt; Maybe (FinalizerPtr err)
-&gt; Maybe (FinalizerPtr res)
-&gt; IO (Either (ForeignPtr err) (ForeignPtr res))
</span><a href="Temporal.Internal.FFI.html#makeTokioAsyncCall"><span class="hs-identifier hs-var">makeTokioAsyncCall</span></a></span><span>
</span><span id="line-345"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr (Worker ty)
-&gt; Ptr (CArray Word8) -&gt; TokioCall CWorkerError CUnit
forall (ty :: WorkerType).
Ptr (Worker ty)
-&gt; Ptr (CArray Word8) -&gt; TokioCall CWorkerError CUnit
</span><a href="Temporal.Core.Worker.html#raw_completeActivityTask"><span class="hs-identifier hs-var">raw_completeActivityTask</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Worker ty)
</span><a href="#local-6989586621679254437"><span class="hs-identifier hs-var">wp</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (CArray Word8)
</span><a href="#local-6989586621679254438"><span class="hs-identifier hs-var">pPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FinalizerPtr CWorkerError -&gt; Maybe (FinalizerPtr CWorkerError)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr CWorkerError
</span><a href="Temporal.Core.CTypes.html#rust_dropWorkerError"><span class="hs-identifier hs-var">rust_dropWorkerError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FinalizerPtr CUnit -&gt; Maybe (FinalizerPtr CUnit)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr CUnit
</span><a href="Temporal.Core.CTypes.html#rust_dropUnit"><span class="hs-identifier hs-var">rust_dropUnit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679254439"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-349"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679254440"><span class="annot"><span class="annottext">ForeignPtr CWorkerError
</span><a href="#local-6989586621679254440"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkerError -&gt; Either WorkerError ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(WorkerError -&gt; Either WorkerError ())
-&gt; IO WorkerError -&gt; IO (Either WorkerError ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CWorkerError
-&gt; (Ptr CWorkerError -&gt; IO WorkerError) -&gt; IO WorkerError
forall a b. ForeignPtr a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CWorkerError
</span><a href="#local-6989586621679254440"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr CWorkerError -&gt; IO CWorkerError
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">(Ptr CWorkerError -&gt; IO CWorkerError)
-&gt; (CWorkerError -&gt; IO WorkerError)
-&gt; Ptr CWorkerError
-&gt; IO WorkerError
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">CWorkerError -&gt; IO WorkerError
</span><a href="Temporal.Core.CTypes.html#peekWorkerError"><span class="hs-identifier hs-var">peekWorkerError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CUnit
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either WorkerError () -&gt; IO (Either WorkerError ())
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either WorkerError () -&gt; IO (Either WorkerError ()))
-&gt; Either WorkerError () -&gt; IO (Either WorkerError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Either WorkerError ()
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_temporal_worker_record_activity_heartbeat&quot;</span></span><span> </span><span id="raw_recordActivityHeartbeat"><span class="annot"><a href="Temporal.Core.Worker.html#raw_recordActivityHeartbeat"><span class="hs-identifier hs-var">raw_recordActivityHeartbeat</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679253748"><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253748"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.CTypes.html#CArray"><span class="hs-identifier hs-type">CArray</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CWorkerError"><span class="hs-identifier hs-type">CWorkerError</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CUnit"><span class="hs-identifier hs-type">CUnit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span id="local-6989586621679253745"><span class="annot"><a href="Temporal.Core.Worker.html#recordActivityHeartbeat"><span class="hs-identifier hs-type">recordActivityHeartbeat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#KnownWorkerType"><span class="hs-identifier hs-type">KnownWorkerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253745"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253745"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ActivityHeartbeat</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#WorkerError"><span class="hs-identifier hs-type">WorkerError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-357"></span><span id="recordActivityHeartbeat"><span class="annot"><span class="annottext">recordActivityHeartbeat :: forall (ty :: WorkerType).
KnownWorkerType ty =&gt;
Worker ty -&gt; ActivityHeartbeat -&gt; IO (Either WorkerError ())
</span><a href="Temporal.Core.Worker.html#recordActivityHeartbeat"><span class="hs-identifier hs-var hs-var">recordActivityHeartbeat</span></a></span></span><span> </span><span id="local-6989586621679254461"><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621679254461"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621679254462"><span class="annot"><span class="annottext">ActivityHeartbeat
</span><a href="#local-6989586621679254462"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Worker ty
-&gt; (Ptr (Worker ty) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall (ty :: WorkerType) a.
KnownWorkerType ty =&gt;
Worker ty -&gt; (Ptr (Worker ty) -&gt; IO a) -&gt; IO a
</span><a href="Temporal.Core.Worker.html#withWorker"><span class="hs-identifier hs-var">withWorker</span></a></span><span> </span><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621679254461"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr (Worker ty) -&gt; IO (Either WorkerError ()))
 -&gt; IO (Either WorkerError ()))
-&gt; (Ptr (Worker ty) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254463"><span class="annot"><span class="annottext">Ptr (Worker ty)
</span><a href="#local-6989586621679254463"><span class="hs-identifier hs-var">wp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-358"></span><span>  </span><span class="annot"><span class="annottext">ByteString
-&gt; (Ptr (CArray Word8) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall b. ByteString -&gt; (Ptr (CArray Word8) -&gt; IO b) -&gt; IO b
</span><a href="Temporal.Internal.FFI.html#withCArrayBS"><span class="hs-identifier hs-var">withCArrayBS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActivityHeartbeat -&gt; ByteString
forall msg. Message msg =&gt; msg -&gt; ByteString
</span><span class="hs-identifier hs-var">encodeMessage</span></span><span> </span><span class="annot"><span class="annottext">ActivityHeartbeat
</span><a href="#local-6989586621679254462"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Ptr (CArray Word8) -&gt; IO (Either WorkerError ()))
 -&gt; IO (Either WorkerError ()))
-&gt; (Ptr (CArray Word8) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254464"><span class="annot"><span class="annottext">Ptr (CArray Word8)
</span><a href="#local-6989586621679254464"><span class="hs-identifier hs-var">pPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-359"></span><span>    </span><span class="annot"><span class="annottext">(Ptr (Ptr CWorkerError) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall a b. Storable a =&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">alloca</span></span><span> </span><span class="annot"><span class="annottext">((Ptr (Ptr CWorkerError) -&gt; IO (Either WorkerError ()))
 -&gt; IO (Either WorkerError ()))
-&gt; (Ptr (Ptr CWorkerError) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254465"><span class="annot"><span class="annottext">Ptr (Ptr CWorkerError)
</span><a href="#local-6989586621679254465"><span class="hs-identifier hs-var">errPtrPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-360"></span><span>      </span><span class="annot"><span class="annottext">(Ptr (Ptr CUnit) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall a b. Storable a =&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">alloca</span></span><span> </span><span class="annot"><span class="annottext">((Ptr (Ptr CUnit) -&gt; IO (Either WorkerError ()))
 -&gt; IO (Either WorkerError ()))
-&gt; (Ptr (Ptr CUnit) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254466"><span class="annot"><span class="annottext">Ptr (Ptr CUnit)
</span><a href="#local-6989586621679254466"><span class="hs-identifier hs-var">resPtrPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Either WorkerError ()) -&gt; IO (Either WorkerError ())
forall a. IO a -&gt; IO a
</span><span class="hs-identifier hs-var">mask_</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either WorkerError ()) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ()) -&gt; IO (Either WorkerError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-361"></span><span>        </span><span class="annot"><span class="annottext">Ptr (Ptr CWorkerError) -&gt; Ptr CWorkerError -&gt; IO ()
forall a. Storable a =&gt; Ptr a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">poke</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr CWorkerError)
</span><a href="#local-6989586621679254465"><span class="hs-identifier hs-var">errPtrPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CWorkerError
forall a. Ptr a
</span><span class="hs-identifier hs-var">nullPtr</span></span><span>
</span><span id="line-362"></span><span>        </span><span class="annot"><span class="annottext">Ptr (Ptr CUnit) -&gt; Ptr CUnit -&gt; IO ()
forall a. Storable a =&gt; Ptr a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">poke</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr CUnit)
</span><a href="#local-6989586621679254466"><span class="hs-identifier hs-var">resPtrPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CUnit
forall a. Ptr a
</span><span class="hs-identifier hs-var">nullPtr</span></span><span>
</span><span id="line-363"></span><span>        </span><span class="annot"><span class="annottext">Ptr (Worker ty)
-&gt; Ptr (CArray Word8)
-&gt; Ptr (Ptr CWorkerError)
-&gt; Ptr (Ptr CUnit)
-&gt; IO ()
forall (ty :: WorkerType).
Ptr (Worker ty)
-&gt; Ptr (CArray Word8)
-&gt; Ptr (Ptr CWorkerError)
-&gt; Ptr (Ptr CUnit)
-&gt; IO ()
</span><a href="Temporal.Core.Worker.html#raw_recordActivityHeartbeat"><span class="hs-identifier hs-var">raw_recordActivityHeartbeat</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Worker ty)
</span><a href="#local-6989586621679254463"><span class="hs-identifier hs-var">wp</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (CArray Word8)
</span><a href="#local-6989586621679254464"><span class="hs-identifier hs-var">pPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr CWorkerError)
</span><a href="#local-6989586621679254465"><span class="hs-identifier hs-var">errPtrPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr CUnit)
</span><a href="#local-6989586621679254466"><span class="hs-identifier hs-var">resPtrPtr</span></a></span><span>
</span><span id="line-364"></span><span>        </span><span id="local-6989586621679254467"><span class="annot"><a href="#local-6989586621679254467"><span class="hs-identifier hs-var">errPtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr CWorkerError) -&gt; IO (Ptr CWorkerError)
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr CWorkerError)
</span><a href="#local-6989586621679254465"><span class="hs-identifier hs-var">errPtrPtr</span></a></span><span>
</span><span id="line-365"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679254467"><span class="hs-identifier hs-type">errPtr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">nullPtr</span></span><span>
</span><span id="line-366"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-367"></span><span>            </span><span class="annot"><a href="Temporal.Core.CTypes.html#rust_dropUnitNow"><span class="hs-identifier hs-type">rust_dropUnitNow</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">peek</span></span><span> </span><span class="annot"><a href="#local-6989586621679254466"><span class="hs-identifier hs-type">resPtrPtr</span></a></span><span>
</span><span id="line-368"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#getWorkerError"><span class="hs-identifier hs-type">getWorkerError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679254467"><span class="hs-identifier hs-type">errPtr</span></a></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_temporal_worker_request_workflow_eviction&quot;</span></span><span> </span><span id="raw_requestWorkflowEviction"><span class="annot"><a href="Temporal.Core.Worker.html#raw_requestWorkflowEviction"><span class="hs-identifier hs-var">raw_requestWorkflowEviction</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679253754"><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253754"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.CTypes.html#CArray"><span class="hs-identifier hs-type">CArray</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span id="local-6989586621679253752"><span class="annot"><a href="Temporal.Core.Worker.html#requestWorkflowEviction"><span class="hs-identifier hs-type">requestWorkflowEviction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#KnownWorkerType"><span class="hs-identifier hs-type">KnownWorkerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253752"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253752"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#RunId"><span class="hs-identifier hs-type">RunId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-376"></span><span id="requestWorkflowEviction"><span class="annot"><span class="annottext">requestWorkflowEviction :: forall (ty :: WorkerType).
KnownWorkerType ty =&gt;
Worker ty -&gt; ByteString -&gt; IO ()
</span><a href="Temporal.Core.Worker.html#requestWorkflowEviction"><span class="hs-identifier hs-var hs-var">requestWorkflowEviction</span></a></span></span><span> </span><span id="local-6989586621679254473"><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621679254473"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621679254474"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679254474"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Worker ty -&gt; (Ptr (Worker ty) -&gt; IO ()) -&gt; IO ()
forall (ty :: WorkerType) a.
KnownWorkerType ty =&gt;
Worker ty -&gt; (Ptr (Worker ty) -&gt; IO a) -&gt; IO a
</span><a href="Temporal.Core.Worker.html#withWorker"><span class="hs-identifier hs-var">withWorker</span></a></span><span> </span><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621679254473"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr (Worker ty) -&gt; IO ()) -&gt; IO ())
-&gt; (Ptr (Worker ty) -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254475"><span class="annot"><span class="annottext">Ptr (Worker ty)
</span><a href="#local-6989586621679254475"><span class="hs-identifier hs-var">wp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-377"></span><span>  </span><span class="annot"><span class="annottext">ByteString -&gt; (Ptr (CArray Word8) -&gt; IO ()) -&gt; IO ()
forall b. ByteString -&gt; (Ptr (CArray Word8) -&gt; IO b) -&gt; IO b
</span><a href="Temporal.Internal.FFI.html#withCArrayBS"><span class="hs-identifier hs-var">withCArrayBS</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679254474"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr (CArray Word8) -&gt; IO ()) -&gt; IO ())
-&gt; (Ptr (CArray Word8) -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254476"><span class="annot"><span class="annottext">Ptr (CArray Word8)
</span><a href="#local-6989586621679254476"><span class="hs-identifier hs-var">rPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-378"></span><span>    </span><span class="annot"><span class="annottext">Ptr (Worker ty) -&gt; Ptr (CArray Word8) -&gt; IO ()
forall (ty :: WorkerType).
Ptr (Worker ty) -&gt; Ptr (CArray Word8) -&gt; IO ()
</span><a href="Temporal.Core.Worker.html#raw_requestWorkflowEviction"><span class="hs-identifier hs-var">raw_requestWorkflowEviction</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Worker ty)
</span><a href="#local-6989586621679254475"><span class="hs-identifier hs-var">wp</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (CArray Word8)
</span><a href="#local-6989586621679254476"><span class="hs-identifier hs-var">rPtr</span></a></span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_temporal_worker_initiate_shutdown&quot;</span></span><span> </span><span id="raw_initiateShutdown"><span class="annot"><a href="Temporal.Core.Worker.html#raw_initiateShutdown"><span class="hs-identifier hs-var">raw_initiateShutdown</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679253757"><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253757"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span class="annot"><span class="hs-comment">-- | Initiate shutdown.</span></span><span>
</span><span id="line-385"></span><span id="local-6989586621679253755"><span class="annot"><a href="Temporal.Core.Worker.html#initiateShutdown"><span class="hs-identifier hs-type">initiateShutdown</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#KnownWorkerType"><span class="hs-identifier hs-type">KnownWorkerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253755"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253755"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-386"></span><span id="initiateShutdown"><span class="annot"><span class="annottext">initiateShutdown :: forall (ty :: WorkerType). KnownWorkerType ty =&gt; Worker ty -&gt; IO ()
</span><a href="Temporal.Core.Worker.html#initiateShutdown"><span class="hs-identifier hs-var hs-var">initiateShutdown</span></a></span></span><span> </span><span id="local-6989586621679254480"><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621679254480"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Worker ty -&gt; (Ptr (Worker ty) -&gt; IO ()) -&gt; IO ()
forall (ty :: WorkerType) a.
KnownWorkerType ty =&gt;
Worker ty -&gt; (Ptr (Worker ty) -&gt; IO a) -&gt; IO a
</span><a href="Temporal.Core.Worker.html#withWorker"><span class="hs-identifier hs-var">withWorker</span></a></span><span> </span><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621679254480"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Worker ty) -&gt; IO ()
forall (ty :: WorkerType). Ptr (Worker ty) -&gt; IO ()
</span><a href="Temporal.Core.Worker.html#raw_initiateShutdown"><span class="hs-identifier hs-var">raw_initiateShutdown</span></a></span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_temporal_worker_finalize_shutdown&quot;</span></span><span> </span><span id="raw_finalizeShutdown"><span class="annot"><a href="Temporal.Core.Worker.html#raw_finalizeShutdown"><span class="hs-identifier hs-var">raw_finalizeShutdown</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679253760"><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253760"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Internal.FFI.html#TokioCall"><span class="hs-identifier hs-type">TokioCall</span></a></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CWorkerError"><span class="hs-identifier hs-type">CWorkerError</span></a></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CUnit"><span class="hs-identifier hs-type">CUnit</span></a></span></span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span class="annot"><span class="hs-comment">{- |
Completes shutdown and frees all resources. You should avoid simply dropping workers, as
this does not allow async tasks to report any panics that may have occurred cleanly.

This should be called only after 'initiateShutdown' has resolved and/or both polling
functions have returned `ShutDown` errors.
-}</span></span><span>
</span><span id="line-399"></span><span id="local-6989586621679253758"><span class="annot"><a href="Temporal.Core.Worker.html#finalizeShutdown"><span class="hs-identifier hs-type">finalizeShutdown</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#KnownWorkerType"><span class="hs-identifier hs-type">KnownWorkerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253758"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#Worker"><span class="hs-identifier hs-type">Worker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253758"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#WorkerError"><span class="hs-identifier hs-type">WorkerError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-400"></span><span id="finalizeShutdown"><span class="annot"><span class="annottext">finalizeShutdown :: forall (ty :: WorkerType).
KnownWorkerType ty =&gt;
Worker ty -&gt; IO (Either WorkerError ())
</span><a href="Temporal.Core.Worker.html#finalizeShutdown"><span class="hs-identifier hs-var hs-var">finalizeShutdown</span></a></span></span><span> </span><span id="local-6989586621679254489"><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621679254489"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Worker ty
-&gt; (Ptr (Worker ty) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall (ty :: WorkerType) a.
KnownWorkerType ty =&gt;
Worker ty -&gt; (Ptr (Worker ty) -&gt; IO a) -&gt; IO a
</span><a href="Temporal.Core.Worker.html#withWorker"><span class="hs-identifier hs-var">withWorker</span></a></span><span> </span><span class="annot"><span class="annottext">Worker ty
</span><a href="#local-6989586621679254489"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr (Worker ty) -&gt; IO (Either WorkerError ()))
 -&gt; IO (Either WorkerError ()))
-&gt; (Ptr (Worker ty) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254490"><span class="annot"><span class="annottext">Ptr (Worker ty)
</span><a href="#local-6989586621679254490"><span class="hs-identifier hs-var">wp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-401"></span><span>  </span><span id="local-6989586621679254491"><span class="annot"><a href="#local-6989586621679254491"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-402"></span><span>    </span><span class="annot"><span class="annottext">TokioCall CWorkerError CUnit
-&gt; Maybe (FinalizerPtr CWorkerError)
-&gt; Maybe (FinalizerPtr CUnit)
-&gt; IO (Either (ForeignPtr CWorkerError) (ForeignPtr CUnit))
forall err res.
TokioCall err res
-&gt; Maybe (FinalizerPtr err)
-&gt; Maybe (FinalizerPtr res)
-&gt; IO (Either (ForeignPtr err) (ForeignPtr res))
</span><a href="Temporal.Internal.FFI.html#makeTokioAsyncCall"><span class="hs-identifier hs-var">makeTokioAsyncCall</span></a></span><span>
</span><span id="line-403"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr (Worker ty) -&gt; TokioCall CWorkerError CUnit
forall (ty :: WorkerType).
Ptr (Worker ty) -&gt; TokioCall CWorkerError CUnit
</span><a href="Temporal.Core.Worker.html#raw_finalizeShutdown"><span class="hs-identifier hs-var">raw_finalizeShutdown</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Worker ty)
</span><a href="#local-6989586621679254490"><span class="hs-identifier hs-var">wp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FinalizerPtr CWorkerError -&gt; Maybe (FinalizerPtr CWorkerError)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr CWorkerError
</span><a href="Temporal.Core.CTypes.html#rust_dropWorkerError"><span class="hs-identifier hs-var">rust_dropWorkerError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FinalizerPtr CUnit -&gt; Maybe (FinalizerPtr CUnit)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr CUnit
</span><a href="Temporal.Core.CTypes.html#rust_dropUnit"><span class="hs-identifier hs-var">rust_dropUnit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679254491"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-407"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679254492"><span class="annot"><span class="annottext">ForeignPtr CWorkerError
</span><a href="#local-6989586621679254492"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkerError -&gt; Either WorkerError ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(WorkerError -&gt; Either WorkerError ())
-&gt; IO WorkerError -&gt; IO (Either WorkerError ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CWorkerError
-&gt; (Ptr CWorkerError -&gt; IO WorkerError) -&gt; IO WorkerError
forall a b. ForeignPtr a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CWorkerError
</span><a href="#local-6989586621679254492"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr CWorkerError -&gt; IO CWorkerError
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">(Ptr CWorkerError -&gt; IO CWorkerError)
-&gt; (CWorkerError -&gt; IO WorkerError)
-&gt; Ptr CWorkerError
-&gt; IO WorkerError
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">CWorkerError -&gt; IO WorkerError
</span><a href="Temporal.Core.CTypes.html#peekWorkerError"><span class="hs-identifier hs-var">peekWorkerError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CUnit
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either WorkerError () -&gt; IO (Either WorkerError ())
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either WorkerError () -&gt; IO (Either WorkerError ()))
-&gt; Either WorkerError () -&gt; IO (Either WorkerError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Either WorkerError ()
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_temporal_history_pusher_push_history&quot;</span></span><span> </span><span id="raw_pushHistory"><span class="annot"><a href="Temporal.Core.Worker.html#raw_pushHistory"><span class="hs-identifier hs-var">raw_pushHistory</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#HistoryPusher"><span class="hs-identifier hs-type">HistoryPusher</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.CTypes.html#CArray"><span class="hs-identifier hs-type">CArray</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.CTypes.html#CArray"><span class="hs-identifier hs-type">CArray</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Internal.FFI.html#TokioCall"><span class="hs-identifier hs-type">TokioCall</span></a></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CWorkerError"><span class="hs-identifier hs-type">CWorkerError</span></a></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CUnit"><span class="hs-identifier hs-type">CUnit</span></a></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span class="annot"><a href="Temporal.Core.Worker.html#pushHistory"><span class="hs-identifier hs-type">pushHistory</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#HistoryPusher"><span class="hs-identifier hs-type">HistoryPusher</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#WorkflowId"><span class="hs-identifier hs-type">WorkflowId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">History</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#WorkerError"><span class="hs-identifier hs-type">WorkerError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span id="pushHistory"><span class="annot"><span class="annottext">pushHistory :: HistoryPusher
-&gt; ByteString
-&gt; Either ByteString History
-&gt; IO (Either WorkerError ())
</span><a href="Temporal.Core.Worker.html#pushHistory"><span class="hs-identifier hs-var hs-var">pushHistory</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#HistoryPusher"><span class="hs-identifier hs-type">HistoryPusher</span></a></span><span> </span><span id="local-6989586621679254494"><span class="annot"><span class="annottext">Ptr HistoryPusher
</span><a href="#local-6989586621679254494"><span class="hs-identifier hs-var">hp</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679254495"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679254495"><span class="hs-identifier hs-var">wf</span></a></span></span><span> </span><span id="local-6989586621679254496"><span class="annot"><span class="annottext">Either ByteString History
</span><a href="#local-6989586621679254496"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-416"></span><span>  </span><span class="annot"><span class="annottext">ByteString
-&gt; (Ptr (CArray Word8) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall b. ByteString -&gt; (Ptr (CArray Word8) -&gt; IO b) -&gt; IO b
</span><a href="Temporal.Internal.FFI.html#withCArrayBS"><span class="hs-identifier hs-var">withCArrayBS</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679254495"><span class="hs-identifier hs-var">wf</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr (CArray Word8) -&gt; IO (Either WorkerError ()))
 -&gt; IO (Either WorkerError ()))
-&gt; (Ptr (CArray Word8) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254497"><span class="annot"><span class="annottext">Ptr (CArray Word8)
</span><a href="#local-6989586621679254497"><span class="hs-identifier hs-var">wfPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-417"></span><span>    </span><span class="annot"><span class="annottext">ByteString
-&gt; (Ptr (CArray Word8) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall b. ByteString -&gt; (Ptr (CArray Word8) -&gt; IO b) -&gt; IO b
</span><a href="Temporal.Internal.FFI.html#withCArrayBS"><span class="hs-identifier hs-var">withCArrayBS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (History -&gt; ByteString)
-&gt; Either ByteString History
-&gt; ByteString
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">History -&gt; ByteString
forall msg. Message msg =&gt; msg -&gt; ByteString
</span><span class="hs-identifier hs-var">encodeMessage</span></span><span> </span><span class="annot"><span class="annottext">Either ByteString History
</span><a href="#local-6989586621679254496"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Ptr (CArray Word8) -&gt; IO (Either WorkerError ()))
 -&gt; IO (Either WorkerError ()))
-&gt; (Ptr (CArray Word8) -&gt; IO (Either WorkerError ()))
-&gt; IO (Either WorkerError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679254499"><span class="annot"><span class="annottext">Ptr (CArray Word8)
</span><a href="#local-6989586621679254499"><span class="hs-identifier hs-var">pPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-418"></span><span>      </span><span id="local-6989586621679254500"><span class="annot"><a href="#local-6989586621679254500"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-419"></span><span>        </span><span class="annot"><span class="annottext">TokioCall CWorkerError CUnit
-&gt; Maybe (FinalizerPtr CWorkerError)
-&gt; Maybe (FinalizerPtr CUnit)
-&gt; IO (Either (ForeignPtr CWorkerError) (ForeignPtr CUnit))
forall err res.
TokioCall err res
-&gt; Maybe (FinalizerPtr err)
-&gt; Maybe (FinalizerPtr res)
-&gt; IO (Either (ForeignPtr err) (ForeignPtr res))
</span><a href="Temporal.Internal.FFI.html#makeTokioAsyncCall"><span class="hs-identifier hs-var">makeTokioAsyncCall</span></a></span><span>
</span><span id="line-420"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr HistoryPusher
-&gt; Ptr (CArray Word8)
-&gt; Ptr (CArray Word8)
-&gt; TokioCall CWorkerError CUnit
</span><a href="Temporal.Core.Worker.html#raw_pushHistory"><span class="hs-identifier hs-var">raw_pushHistory</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr HistoryPusher
</span><a href="#local-6989586621679254494"><span class="hs-identifier hs-var">hp</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (CArray Word8)
</span><a href="#local-6989586621679254497"><span class="hs-identifier hs-var">wfPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (CArray Word8)
</span><a href="#local-6989586621679254499"><span class="hs-identifier hs-var">pPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FinalizerPtr CWorkerError -&gt; Maybe (FinalizerPtr CWorkerError)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr CWorkerError
</span><a href="Temporal.Core.CTypes.html#rust_dropWorkerError"><span class="hs-identifier hs-var">rust_dropWorkerError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FinalizerPtr CUnit -&gt; Maybe (FinalizerPtr CUnit)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr CUnit
</span><a href="Temporal.Core.CTypes.html#rust_dropUnit"><span class="hs-identifier hs-var">rust_dropUnit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679254500"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-424"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679254501"><span class="annot"><span class="annottext">ForeignPtr CWorkerError
</span><a href="#local-6989586621679254501"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorkerError -&gt; Either WorkerError ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(WorkerError -&gt; Either WorkerError ())
-&gt; IO WorkerError -&gt; IO (Either WorkerError ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CWorkerError
-&gt; (Ptr CWorkerError -&gt; IO WorkerError) -&gt; IO WorkerError
forall a b. ForeignPtr a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CWorkerError
</span><a href="#local-6989586621679254501"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr CWorkerError -&gt; IO CWorkerError
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">(Ptr CWorkerError -&gt; IO CWorkerError)
-&gt; (CWorkerError -&gt; IO WorkerError)
-&gt; Ptr CWorkerError
-&gt; IO WorkerError
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">CWorkerError -&gt; IO WorkerError
</span><a href="Temporal.Core.CTypes.html#peekWorkerError"><span class="hs-identifier hs-var">peekWorkerError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CUnit
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either WorkerError () -&gt; IO (Either WorkerError ())
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either WorkerError () -&gt; IO (Either WorkerError ()))
-&gt; Either WorkerError () -&gt; IO (Either WorkerError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Either WorkerError ()
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_temporal_history_pusher_close&quot;</span></span><span> </span><span id="raw_closeHistoryPusher"><span class="annot"><a href="Temporal.Core.Worker.html#raw_closeHistoryPusher"><span class="hs-identifier hs-var">raw_closeHistoryPusher</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#HistoryPusher"><span class="hs-identifier hs-type">HistoryPusher</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="annot"><a href="Temporal.Core.Worker.html#closeHistory"><span class="hs-identifier hs-type">closeHistory</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Worker.html#HistoryPusher"><span class="hs-identifier hs-type">HistoryPusher</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span id="closeHistory"><span class="annot"><span class="annottext">closeHistory :: HistoryPusher -&gt; IO ()
</span><a href="Temporal.Core.Worker.html#closeHistory"><span class="hs-identifier hs-var hs-var">closeHistory</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Worker.html#HistoryPusher"><span class="hs-identifier hs-type">HistoryPusher</span></a></span><span> </span><span id="local-6989586621679254503"><span class="annot"><span class="annottext">Ptr HistoryPusher
</span><a href="#local-6989586621679254503"><span class="hs-identifier hs-var">hp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-433"></span><span>  </span><span class="annot"><span class="annottext">Ptr HistoryPusher -&gt; IO ()
</span><a href="Temporal.Core.Worker.html#raw_closeHistoryPusher"><span class="hs-identifier hs-var">raw_closeHistoryPusher</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr HistoryPusher
</span><a href="#local-6989586621679254503"><span class="hs-identifier hs-var">hp</span></a></span><span>
</span><span id="line-434"></span></pre></body></html>