<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DuplicateRecordFields #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Temporal.Core.Client.html"><span class="hs-identifier">Temporal.Core.Client</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-11"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Connecting to the server</span></span><span>
</span><span id="line-12"></span><span>  </span><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier">Client</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>  </span><span class="annot"><a href="Temporal.Core.Client.html#clientConfig"><span class="hs-identifier">clientConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><a href="Temporal.Core.Client.html#connectClient"><span class="hs-identifier">connectClient</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>  </span><span class="annot"><a href="Temporal.Core.Client.html#defaultClientConfig"><span class="hs-identifier">defaultClientConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><a href="Temporal.Core.Client.html#closeClient"><span class="hs-identifier">closeClient</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><a href="Temporal.Core.Client.html#clientRuntime"><span class="hs-identifier">clientRuntime</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><a href="Temporal.Core.Client.html#touchClient"><span class="hs-identifier">touchClient</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="Temporal.Core.CTypes.html#CoreClient"><span class="hs-identifier">CoreClient</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="Temporal.Core.Client.html#ClientConfig"><span class="hs-identifier">ClientConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="Temporal.Core.Client.html#ClientTlsConfig"><span class="hs-identifier">ClientTlsConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="Temporal.Core.Client.html#ByteVector"><span class="hs-identifier">ByteVector</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="Temporal.Core.Client.html#ClientRetryConfig"><span class="hs-identifier">ClientRetryConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Making calls to the server</span></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-comment">-- Generally you should not need to use 'call' directly, but instead should</span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-comment">-- use the supplied functions in 'Temporal.Core.Client.WorkflowService' and</span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-comment">-- other service modules.</span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-comment">-- For higher-level access, see the@@temporal-sdk@ package for a more</span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-comment">-- idiomatic Haskell API.</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="Temporal.Core.Client.html#call"><span class="hs-identifier">call</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="Temporal.Core.Client.html#RpcCall"><span class="hs-identifier">RpcCall</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><a href="Temporal.Core.CTypes.html#RpcError"><span class="hs-identifier">RpcError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><a href="Temporal.Core.Client.html#ClientError"><span class="hs-identifier">ClientError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Primitive access</span></span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><a href="Temporal.Core.CTypes.html#CRpcCall"><span class="hs-identifier">CRpcCall</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="Temporal.Internal.FFI.html#TokioCall"><span class="hs-identifier">TokioCall</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="Temporal.Internal.FFI.html#TokioResult"><span class="hs-identifier">TokioResult</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="Temporal.Core.Client.html#PrimRpcCall"><span class="hs-identifier">PrimRpcCall</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Use the underlying Rust client pointer</span></span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><a href="Temporal.Core.Client.html#withClient"><span class="hs-identifier">withClient</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.TH</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Internal</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HashMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ProtoLens.Encoding</span></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ProtoLens.Service.Types</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Storable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.C.String</span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.ForeignPtr</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.Marshal</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.Ptr</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.Storable</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.BSD</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Posix.Process</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html"><span class="hs-identifier">Temporal.Core.CTypes</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Internal.FFI.html"><span class="hs-identifier">Temporal.Internal.FFI</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Temporal.Runtime.html"><span class="hs-identifier">Temporal.Runtime</span></a></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-string">&quot;hs_temporal_connect_client&quot;</span></span><span> </span><span id="raw_connectClient"><span class="annot"><a href="Temporal.Core.Client.html#raw_connectClient"><span class="hs-identifier hs-var">raw_connectClient</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#Runtime"><span class="hs-identifier hs-type">Runtime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Internal.FFI.html#TokioCall"><span class="hs-identifier hs-type">TokioCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.CTypes.html#CArray"><span class="hs-identifier hs-type">CArray</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CoreClient"><span class="hs-identifier hs-type">CoreClient</span></a></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-string">&quot;&amp;hs_temporal_drop_client&quot;</span></span><span> </span><span id="raw_freeClient"><span class="annot"><a href="Temporal.Core.Client.html#raw_freeClient"><span class="hs-identifier hs-var">raw_freeClient</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FinalizerPtr</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CoreClient"><span class="hs-identifier hs-type">CoreClient</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">data</span><span> </span><span id="ClientConfig"><span class="annot"><a href="Temporal.Core.Client.html#ClientConfig"><span class="hs-identifier hs-var">ClientConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ClientConfig"><span class="annot"><a href="Temporal.Core.Client.html#ClientConfig"><span class="hs-identifier hs-var">ClientConfig</span></a></span></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="targetUrl"><span class="annot"><span class="annottext">ClientConfig -&gt; Text
</span><a href="Temporal.Core.Client.html#targetUrl"><span class="hs-identifier hs-var hs-var">targetUrl</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="clientName"><span class="annot"><span class="annottext">ClientConfig -&gt; Text
</span><a href="Temporal.Core.Client.html#clientName"><span class="hs-identifier hs-var hs-var">clientName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="clientVersion"><span class="annot"><span class="annottext">ClientConfig -&gt; Text
</span><a href="Temporal.Core.Client.html#clientVersion"><span class="hs-identifier hs-var hs-var">clientVersion</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="metadata"><span class="annot"><span class="annottext">ClientConfig -&gt; HashMap Text Text
</span><a href="Temporal.Core.Client.html#metadata"><span class="hs-identifier hs-var hs-var">metadata</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="identity"><span class="annot"><span class="annottext">ClientConfig -&gt; Text
</span><a href="Temporal.Core.Client.html#identity"><span class="hs-identifier hs-var hs-var">identity</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="tlsConfig"><span class="annot"><span class="annottext">ClientConfig -&gt; Maybe ClientTlsConfig
</span><a href="Temporal.Core.Client.html#tlsConfig"><span class="hs-identifier hs-var hs-var">tlsConfig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#ClientTlsConfig"><span class="hs-identifier hs-type">ClientTlsConfig</span></a></span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="retryConfig"><span class="annot"><span class="annottext">ClientConfig -&gt; Maybe ClientRetryConfig
</span><a href="Temporal.Core.Client.html#retryConfig"><span class="hs-identifier hs-var hs-var">retryConfig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#ClientRetryConfig"><span class="hs-identifier hs-type">ClientRetryConfig</span></a></span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-keyword">data</span><span> </span><span id="ClientTlsConfig"><span class="annot"><a href="Temporal.Core.Client.html#ClientTlsConfig"><span class="hs-identifier hs-var">ClientTlsConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ClientTlsConfig"><span class="annot"><a href="Temporal.Core.Client.html#ClientTlsConfig"><span class="hs-identifier hs-var">ClientTlsConfig</span></a></span></span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="serverRootCaCert"><span class="annot"><span class="annottext">ClientTlsConfig -&gt; Maybe ByteVector
</span><a href="Temporal.Core.Client.html#serverRootCaCert"><span class="hs-identifier hs-var hs-var">serverRootCaCert</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#ByteVector"><span class="hs-identifier hs-type">ByteVector</span></a></span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="domain"><span class="annot"><span class="annottext">ClientTlsConfig -&gt; Maybe Text
</span><a href="Temporal.Core.Client.html#domain"><span class="hs-identifier hs-var hs-var">domain</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="clientCert"><span class="annot"><span class="annottext">ClientTlsConfig -&gt; Maybe ByteVector
</span><a href="Temporal.Core.Client.html#clientCert"><span class="hs-identifier hs-var hs-var">clientCert</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#ByteVector"><span class="hs-identifier hs-type">ByteVector</span></a></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="clientPrivateKey"><span class="annot"><span class="annottext">ClientTlsConfig -&gt; Maybe ByteVector
</span><a href="Temporal.Core.Client.html#clientPrivateKey"><span class="hs-identifier hs-var hs-var">clientPrivateKey</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#ByteVector"><span class="hs-identifier hs-type">ByteVector</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-keyword">data</span><span> </span><span id="ClientRetryConfig"><span class="annot"><a href="Temporal.Core.Client.html#ClientRetryConfig"><span class="hs-identifier hs-var">ClientRetryConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ClientRetryConfig"><span class="annot"><a href="Temporal.Core.Client.html#ClientRetryConfig"><span class="hs-identifier hs-var">ClientRetryConfig</span></a></span></span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="initialIntervalMillis"><span class="annot"><span class="annottext">ClientRetryConfig -&gt; Word64
</span><a href="Temporal.Core.Client.html#initialIntervalMillis"><span class="hs-identifier hs-var hs-var">initialIntervalMillis</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="randomizationFactor"><span class="annot"><span class="annottext">ClientRetryConfig -&gt; Double
</span><a href="Temporal.Core.Client.html#randomizationFactor"><span class="hs-identifier hs-var hs-var">randomizationFactor</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="multiplier"><span class="annot"><span class="annottext">ClientRetryConfig -&gt; Double
</span><a href="Temporal.Core.Client.html#multiplier"><span class="hs-identifier hs-var hs-var">multiplier</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="maxIntervalMillis"><span class="annot"><span class="annottext">ClientRetryConfig -&gt; Word64
</span><a href="Temporal.Core.Client.html#maxIntervalMillis"><span class="hs-identifier hs-var hs-var">maxIntervalMillis</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="maxElapsedTimeMillis"><span class="annot"><span class="annottext">ClientRetryConfig -&gt; Maybe Word64
</span><a href="Temporal.Core.Client.html#maxElapsedTimeMillis"><span class="hs-identifier hs-var hs-var">maxElapsedTimeMillis</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="maxRetries"><span class="annot"><span class="annottext">ClientRetryConfig -&gt; Word64
</span><a href="Temporal.Core.Client.html#maxRetries"><span class="hs-identifier hs-var hs-var">maxRetries</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="annot"><span class="hs-comment">{- | A client connection to the Temporal server.

The client is thread-safe and can be shared across threads.

Clients are expensive to create, so you should generally create one per
process and share it across your application..

The client doesn't have an explicit close method, but will be cleaned up
when it is garbage collected.
-}</span></span><span>
</span><span id="line-121"></span><span class="hs-keyword">data</span><span> </span><span id="Client"><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier hs-var">Client</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Client"><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier hs-var">Client</span></a></span></span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="client"><span class="annot"><span class="annottext">Client -&gt; MVar CoreClient
</span><a href="Temporal.Core.Client.html#client"><span class="hs-identifier hs-var hs-var">client</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MVar</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CoreClient"><span class="hs-identifier hs-type">CoreClient</span></a></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="runtime"><span class="annot"><span class="annottext">Client -&gt; Runtime
</span><a href="Temporal.Core.Client.html#runtime"><span class="hs-identifier hs-var hs-var">runtime</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#Runtime"><span class="hs-identifier hs-type">Runtime</span></a></span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="config"><span class="annot"><span class="annottext">Client -&gt; ClientConfig
</span><a href="Temporal.Core.Client.html#config"><span class="hs-identifier hs-var hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#ClientConfig"><span class="hs-identifier hs-type">ClientConfig</span></a></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="annot"><a href="Temporal.Core.Client.html#clientConfig"><span class="hs-identifier hs-type">clientConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#ClientConfig"><span class="hs-identifier hs-type">ClientConfig</span></a></span><span>
</span><span id="line-129"></span><span id="clientConfig"><span class="annot"><span class="annottext">clientConfig :: Client -&gt; ClientConfig
</span><a href="Temporal.Core.Client.html#clientConfig"><span class="hs-identifier hs-var hs-var">clientConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Client -&gt; ClientConfig
</span><a href="Temporal.Core.Client.html#config"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="annot"><a href="Temporal.Core.Client.html#clientRuntime"><span class="hs-identifier hs-type">clientRuntime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#Runtime"><span class="hs-identifier hs-type">Runtime</span></a></span><span>
</span><span id="line-133"></span><span id="clientRuntime"><span class="annot"><span class="annottext">clientRuntime :: Client -&gt; Runtime
</span><a href="Temporal.Core.Client.html#clientRuntime"><span class="hs-identifier hs-var hs-var">clientRuntime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Client -&gt; Runtime
</span><a href="Temporal.Core.Client.html#runtime"><span class="hs-identifier hs-var">runtime</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span id="local-6989586621679252715"><span class="annot"><a href="Temporal.Core.Client.html#withClient"><span class="hs-identifier hs-type">withClient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CoreClient"><span class="hs-identifier hs-type">CoreClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679252715"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679252715"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-137"></span><span id="withClient"><span class="annot"><span class="annottext">withClient :: forall a. Client -&gt; (Ptr CoreClient -&gt; IO a) -&gt; IO a
</span><a href="Temporal.Core.Client.html#withClient"><span class="hs-identifier hs-var hs-var">withClient</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a></span><span> </span><span id="local-6989586621679252998"><span class="annot"><span class="annottext">MVar CoreClient
</span><a href="#local-6989586621679252998"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621679252999"><span class="annot"><span class="annottext">Runtime
</span><a href="#local-6989586621679252999"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">ClientConfig
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679253000"><span class="annot"><span class="annottext">Ptr CoreClient -&gt; IO a
</span><a href="#local-6989586621679253000"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><span class="annottext">MVar CoreClient -&gt; (CoreClient -&gt; IO a) -&gt; IO a
forall a b. MVar a -&gt; (a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar CoreClient
</span><a href="#local-6989586621679252998"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">((CoreClient -&gt; IO a) -&gt; IO a) -&gt; (CoreClient -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.CTypes.html#CoreClient"><span class="hs-identifier hs-type">CoreClient</span></a></span><span> </span><span id="local-6989586621679253003"><span class="annot"><span class="annottext">ForeignPtr CoreClient
</span><a href="#local-6989586621679253003"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><span class="annottext">Runtime -&gt; (Ptr Runtime -&gt; IO a) -&gt; IO a
forall a. Runtime -&gt; (Ptr Runtime -&gt; IO a) -&gt; IO a
</span><a href="Temporal.Runtime.html#withRuntime"><span class="hs-identifier hs-var">withRuntime</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime
</span><a href="#local-6989586621679252999"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr Runtime -&gt; IO a) -&gt; IO a) -&gt; (Ptr Runtime -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Ptr Runtime
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-140"></span><span>      </span><span class="annot"><span class="annottext">ForeignPtr CoreClient -&gt; (Ptr CoreClient -&gt; IO a) -&gt; IO a
forall a b. ForeignPtr a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CoreClient
</span><a href="#local-6989586621679253003"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CoreClient -&gt; IO a
</span><a href="#local-6989586621679253000"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="annot"><a href="Temporal.Core.Client.html#touchClient"><span class="hs-identifier hs-type">touchClient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span id="touchClient"><span class="annot"><span class="annottext">touchClient :: Client -&gt; IO ()
</span><a href="Temporal.Core.Client.html#touchClient"><span class="hs-identifier hs-var hs-var">touchClient</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a></span><span> </span><span id="local-6989586621679253006"><span class="annot"><span class="annottext">MVar CoreClient
</span><a href="#local-6989586621679253006"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Runtime
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ClientConfig
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-145"></span><span>  </span><span id="local-6989586621679253007"><span class="annot"><a href="#local-6989586621679253007"><span class="hs-identifier hs-var">mcc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVar CoreClient -&gt; IO (Maybe CoreClient)
forall a. MVar a -&gt; IO (Maybe a)
</span><span class="hs-identifier hs-var">tryReadMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar CoreClient
</span><a href="#local-6989586621679253006"><span class="hs-identifier hs-var">cc</span></a></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679253007"><span class="hs-identifier hs-type">mcc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><span class="annottext">Maybe CoreClient
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.CTypes.html#CoreClient"><span class="hs-identifier hs-type">CoreClient</span></a></span><span> </span><span id="local-6989586621679253009"><span class="annot"><span class="annottext">ForeignPtr CoreClient
</span><a href="#local-6989586621679253009"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ForeignPtr CoreClient -&gt; IO ()
forall a. ForeignPtr a -&gt; IO ()
</span><span class="hs-identifier hs-var">touchForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CoreClient
</span><a href="#local-6989586621679253009"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-keyword">newtype</span><span> </span><span id="ByteVector"><span class="annot"><a href="Temporal.Core.Client.html#ByteVector"><span class="hs-identifier hs-var">ByteVector</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ByteVector"><span class="annot"><a href="Temporal.Core.Client.html#ByteVector"><span class="hs-identifier hs-var">ByteVector</span></a></span></span><span> </span><span class="hs-special">{</span><span id="byteVector"><span class="annot"><span class="annottext">ByteVector -&gt; ByteString
</span><a href="Temporal.Core.Client.html#byteVector"><span class="hs-identifier hs-var hs-var">byteVector</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">}</span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="annot"><a href="Temporal.Core.Client.html#byteStringToVector"><span class="hs-identifier hs-type">byteStringToVector</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BS.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span>
</span><span id="line-155"></span><span id="byteStringToVector"><span class="annot"><span class="annottext">byteStringToVector :: ByteString -&gt; Vector Word8
</span><a href="Temporal.Core.Client.html#byteStringToVector"><span class="hs-identifier hs-var hs-var">byteStringToVector</span></a></span></span><span> </span><span id="local-6989586621679253014"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679253014"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Word8
</span><a href="#local-6989586621679253015"><span class="hs-identifier hs-var">vec</span></a></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-157"></span><span>    </span><span id="local-6989586621679253015"><span class="annot"><span class="annottext">vec :: Vector Word8
</span><a href="#local-6989586621679253015"><span class="hs-identifier hs-var hs-var">vec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Int -&gt; Int -&gt; Vector Word8
forall a. Storable a =&gt; ForeignPtr a -&gt; Int -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">V.unsafeFromForeignPtr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; ForeignPtr Word8
forall a b. ForeignPtr a -&gt; ForeignPtr b
</span><span class="hs-identifier hs-var">castForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679253018"><span class="hs-identifier hs-var">fptr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679253019"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679253020"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679253018"><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679253018"><span class="hs-identifier hs-var">fptr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679253019"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679253019"><span class="hs-identifier hs-var">off</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679253020"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679253020"><span class="hs-identifier hs-var">len</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; (ForeignPtr Word8, Int, Int)
</span><span class="hs-identifier hs-var">BS.toForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679253014"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="annot"><a href="Temporal.Core.Client.html#vectorToByteString"><span class="hs-identifier hs-type">vectorToByteString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BS.ByteString</span></span><span>
</span><span id="line-162"></span><span id="vectorToByteString"><span class="annot"><span class="annottext">vectorToByteString :: Vector Word8 -&gt; ByteString
</span><a href="Temporal.Core.Client.html#vectorToByteString"><span class="hs-identifier hs-var hs-var">vectorToByteString</span></a></span></span><span> </span><span id="local-6989586621679253023"><span class="annot"><span class="annottext">Vector Word8
</span><a href="#local-6989586621679253023"><span class="hs-identifier hs-var">vec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; Int -&gt; Int -&gt; ByteString
</span><span class="hs-identifier hs-var">BS.fromForeignPtr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForeignPtr Word8 -&gt; ForeignPtr Word8
forall a b. ForeignPtr a -&gt; ForeignPtr b
</span><span class="hs-identifier hs-var">castForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679253025"><span class="hs-identifier hs-var">fptr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679253026"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679253027"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679253025"><span class="annot"><span class="annottext">ForeignPtr Word8
</span><a href="#local-6989586621679253025"><span class="hs-identifier hs-var">fptr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679253026"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679253026"><span class="hs-identifier hs-var">off</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679253027"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679253027"><span class="hs-identifier hs-var">len</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Word8 -&gt; (ForeignPtr Word8, Int, Int)
forall a. Vector a -&gt; (ForeignPtr a, Int, Int)
</span><span class="hs-identifier hs-var">V.unsafeToForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">Vector Word8
</span><a href="#local-6989586621679253023"><span class="hs-identifier hs-var">vec</span></a></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679253031"><span id="local-6989586621679253035"><span id="local-6989586621679253038"><span id="local-6989586621679253041"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#ByteVector"><span class="hs-identifier hs-type">ByteVector</span></a></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-168"></span><span>  </span><span id="local-6989586621679253048"><span class="annot"><span class="annottext">toJSON :: ByteVector -&gt; Value
</span><a href="#local-6989586621679253048"><span class="hs-identifier hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Word8 -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">(Vector Word8 -&gt; Value)
-&gt; (ByteVector -&gt; Vector Word8) -&gt; ByteVector -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Vector Word8
</span><a href="Temporal.Core.Client.html#byteStringToVector"><span class="hs-identifier hs-var">byteStringToVector</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Vector Word8)
-&gt; (ByteVector -&gt; ByteString) -&gt; ByteVector -&gt; Vector Word8
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteVector -&gt; ByteString
</span><a href="Temporal.Core.Client.html#byteVector"><span class="hs-identifier hs-var">byteVector</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679253053"><span id="local-6989586621679253057"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#ByteVector"><span class="hs-identifier hs-type">ByteVector</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-172"></span><span>  </span><span id="local-6989586621679253066"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser ByteVector
</span><a href="#local-6989586621679253066"><span class="hs-identifier hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Vector Word8 -&gt; ByteVector)
-&gt; Parser (Vector Word8) -&gt; Parser ByteVector
forall a b. (a -&gt; b) -&gt; Parser a -&gt; Parser b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteVector
</span><a href="Temporal.Core.Client.html#ByteVector"><span class="hs-identifier hs-var">ByteVector</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteVector)
-&gt; (Vector Word8 -&gt; ByteString) -&gt; Vector Word8 -&gt; ByteVector
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Vector Word8 -&gt; ByteString
</span><a href="Temporal.Core.Client.html#vectorToByteString"><span class="hs-identifier hs-var">vectorToByteString</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Parser (Vector Word8) -&gt; Parser ByteVector)
-&gt; (Value -&gt; Parser (Vector Word8)) -&gt; Value -&gt; Parser ByteVector
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Parser (Vector Word8)
forall a. FromJSON a =&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">parseJSON</span></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span id="local-6989586621679253069"><span id="local-6989586621679253087"><span id="local-6989586621679253091"><span id="local-6989586621679253094"><span id="local-6989586621679253120"><span id="local-6989586621679253140"><span id="local-6989586621679253144"><span id="local-6989586621679253147"><span class="hs-identifier">deriveJSON</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">defaultOptions</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">fieldLabelModifier</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">camelTo2</span><span> </span><span class="hs-char">'_'</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">ClientTlsConfig</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span id="local-6989586621679253182"><span id="local-6989586621679253204"><span id="local-6989586621679253208"><span id="local-6989586621679253211"><span id="local-6989586621679253240"><span id="local-6989586621679253261"><span id="local-6989586621679253265"><span id="local-6989586621679253268"><span class="hs-identifier">deriveJSON</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">defaultOptions</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">fieldLabelModifier</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">camelTo2</span><span> </span><span class="hs-char">'_'</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">ClientRetryConfig</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span id="local-6989586621679253294"><span id="local-6989586621679253321"><span id="local-6989586621679253325"><span id="local-6989586621679253328"><span id="local-6989586621679253363"><span id="local-6989586621679253390"><span id="local-6989586621679253393"><span id="local-6989586621679253396"><span class="hs-identifier">deriveJSON</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">defaultOptions</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">fieldLabelModifier</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">camelTo2</span><span> </span><span class="hs-char">'_'</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">ClientConfig</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="hs-keyword">data</span><span> </span><span id="RpcCall"><span class="annot"><a href="Temporal.Core.Client.html#RpcCall"><span class="hs-identifier hs-var">RpcCall</span></a></span></span><span> </span><span id="local-6989586621679252788"><span class="annot"><a href="#local-6989586621679252788"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RpcCall"><span class="annot"><a href="Temporal.Core.Client.html#RpcCall"><span class="hs-identifier hs-var">RpcCall</span></a></span></span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="req"><span class="annot"><span class="annottext">forall a. RpcCall a -&gt; a
</span><a href="Temporal.Core.Client.html#req"><span class="hs-identifier hs-var hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679252788"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="retry"><span class="annot"><span class="annottext">forall a. RpcCall a -&gt; Bool
</span><a href="Temporal.Core.Client.html#retry"><span class="hs-identifier hs-var hs-var">retry</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="metadata"><span class="annot"><span class="annottext">forall a. RpcCall a -&gt; HashMap Text Text
</span><a href="Temporal.Core.Client.html#metadata"><span class="hs-identifier hs-var hs-var">metadata</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="timeoutMillis"><span class="annot"><span class="annottext">forall a. RpcCall a -&gt; Maybe Word64
</span><a href="Temporal.Core.Client.html#timeoutMillis"><span class="hs-identifier hs-var hs-var">timeoutMillis</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-keyword">data</span><span> </span><span id="ClientError"><span class="annot"><a href="Temporal.Core.Client.html#ClientError"><span class="hs-identifier hs-var">ClientError</span></a></span></span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ClientConnectionError"><span class="annot"><a href="Temporal.Core.Client.html#ClientConnectionError"><span class="hs-identifier hs-var">ClientConnectionError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ClientClosedError"><span class="annot"><a href="Temporal.Core.Client.html#ClientClosedError"><span class="hs-identifier hs-var">ClientClosedError</span></a></span></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679253434"><span id="local-6989586621679253440"><span id="local-6989586621679253444"><span class="annot"><span class="annottext">Int -&gt; ClientError -&gt; ShowS
[ClientError] -&gt; ShowS
ClientError -&gt; String
(Int -&gt; ClientError -&gt; ShowS)
-&gt; (ClientError -&gt; String)
-&gt; ([ClientError] -&gt; ShowS)
-&gt; Show ClientError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; ClientError -&gt; ShowS
showsPrec :: Int -&gt; ClientError -&gt; ShowS
$cshow :: ClientError -&gt; String
show :: ClientError -&gt; String
$cshowList :: [ClientError] -&gt; ShowS
showList :: [ClientError] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679253453"><span id="local-6989586621679253456"><span id="local-6989586621679253459"><span id="local-6989586621679253462"><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#ClientError"><span class="hs-identifier hs-type">ClientError</span></a></span></span></span></span></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="annot"><a href="Temporal.Core.Client.html#defaultClientConfig"><span class="hs-identifier hs-type">defaultClientConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#ClientConfig"><span class="hs-identifier hs-type">ClientConfig</span></a></span><span>
</span><span id="line-202"></span><span id="defaultClientConfig"><span class="annot"><span class="annottext">defaultClientConfig :: ClientConfig
</span><a href="Temporal.Core.Client.html#defaultClientConfig"><span class="hs-identifier hs-var hs-var">defaultClientConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-203"></span><span>  </span><span class="annot"><a href="Temporal.Core.Client.html#ClientConfig"><span class="hs-identifier hs-type">ClientConfig</span></a></span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">targetUrl :: Text
</span><a href="Temporal.Core.Client.html#targetUrl"><span class="hs-identifier hs-var">targetUrl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;http://localhost:7233&quot;</span></span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">clientName :: Text
</span><a href="Temporal.Core.Client.html#clientName"><span class="hs-identifier hs-var">clientName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;temporal-haskell&quot;</span></span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">clientVersion :: Text
</span><a href="Temporal.Core.Client.html#clientVersion"><span class="hs-identifier hs-var">clientVersion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;0.0.1&quot;</span></span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">metadata :: HashMap Text Text
</span><a href="Temporal.Core.Client.html#metadata"><span class="hs-identifier hs-var">metadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap Text Text
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">identity :: Text
</span><a href="Temporal.Core.Client.html#identity"><span class="hs-identifier hs-var">identity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsConfig :: Maybe ClientTlsConfig
</span><a href="Temporal.Core.Client.html#tlsConfig"><span class="hs-identifier hs-var">tlsConfig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ClientTlsConfig
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">retryConfig :: Maybe ClientRetryConfig
</span><a href="Temporal.Core.Client.html#retryConfig"><span class="hs-identifier hs-var">retryConfig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ClientRetryConfig
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="annot"><a href="Temporal.Core.Client.html#defaultClientIdentity"><span class="hs-identifier hs-type">defaultClientIdentity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-215"></span><span id="defaultClientIdentity"><span class="annot"><span class="annottext">defaultClientIdentity :: IO Text
</span><a href="Temporal.Core.Client.html#defaultClientIdentity"><span class="hs-identifier hs-var hs-var">defaultClientIdentity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-216"></span><span>  </span><span id="local-6989586621679253466"><span class="annot"><a href="#local-6989586621679253466"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ProcessID
</span><span class="hs-identifier hs-var">getProcessID</span></span><span>
</span><span id="line-217"></span><span>  </span><span id="local-6989586621679253468"><span class="annot"><a href="#local-6989586621679253468"><span class="hs-identifier hs-var">host</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">getHostName</span></span><span>
</span><span id="line-218"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T.pack</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621679253466"><span class="hs-identifier hs-type">pid</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;@&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621679253468"><span class="hs-identifier hs-type">host</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="annot"><span class="hs-comment">{- | Connect to the Temporal server using a given runtime.

Throws 'ClientConnectionError' if the connection fails.
-}</span></span><span>
</span><span id="line-225"></span><span class="annot"><a href="Temporal.Core.Client.html#connectClient"><span class="hs-identifier hs-type">connectClient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#Runtime"><span class="hs-identifier hs-type">Runtime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#ClientConfig"><span class="hs-identifier hs-type">ClientConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a></span><span>
</span><span id="line-226"></span><span id="connectClient"><span class="annot"><span class="annottext">connectClient :: Runtime -&gt; ClientConfig -&gt; IO Client
</span><a href="Temporal.Core.Client.html#connectClient"><span class="hs-identifier hs-var hs-var">connectClient</span></a></span></span><span> </span><span id="local-6989586621679253472"><span class="annot"><span class="annottext">Runtime
</span><a href="#local-6989586621679253472"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679253473"><span class="annot"><span class="annottext">ClientConfig
</span><a href="#local-6989586621679253473"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-227"></span><span>  </span><span id="local-6989586621679253474"><span class="annot"><a href="#local-6989586621679253474"><span class="hs-identifier hs-var">conf'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ClientConfig -&gt; Text
</span><a href="Temporal.Core.Client.html#identity"><span class="hs-identifier hs-var">identity</span></a></span><span> </span><span class="annot"><span class="annottext">ClientConfig
</span><a href="#local-6989586621679253473"><span class="hs-identifier hs-var">conf</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-229"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-230"></span><span>        </span><span id="local-6989586621679253475"><span class="annot"><a href="#local-6989586621679253475"><span class="hs-identifier hs-var">ident</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Text
</span><a href="Temporal.Core.Client.html#defaultClientIdentity"><span class="hs-identifier hs-var">defaultClientIdentity</span></a></span><span>
</span><span id="line-231"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621679253473"><span class="hs-identifier hs-type">conf</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Temporal.Core.Client.html#identity"><span class="hs-identifier hs-var">identity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679253475"><span class="hs-identifier hs-type">ident</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-232"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ClientConfig -&gt; IO ClientConfig
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ClientConfig
</span><a href="#local-6989586621679253473"><span class="hs-identifier hs-var">conf</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span>  </span><span id="local-6989586621679253476"><span class="annot"><a href="#local-6989586621679253476"><span class="hs-identifier hs-var">clientPtrSlot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newEmptyMVar</span></span><span>
</span><span id="line-235"></span><span>  </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">forkIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><a href="Temporal.Runtime.html#withRuntime"><span class="hs-identifier hs-type">withRuntime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253472"><span class="hs-identifier hs-type">rt</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679253479"><span class="annot"><span class="annottext">Ptr Runtime
</span><a href="#local-6989586621679253479"><span class="hs-identifier hs-var">rtPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; (CString -&gt; IO ()) -&gt; IO ()
forall a. ByteString -&gt; (CString -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">BS.useAsCString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LazyByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BL.toStrict</span></span><span> </span><span class="annot"><span class="annottext">(LazyByteString -&gt; ByteString) -&gt; LazyByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientConfig -&gt; LazyByteString
forall a. ToJSON a =&gt; a -&gt; LazyByteString
</span><span class="hs-identifier hs-var">encode</span></span><span> </span><span class="annot"><span class="annottext">ClientConfig
</span><a href="#local-6989586621679253474"><span class="hs-identifier hs-var">conf'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((CString -&gt; IO ()) -&gt; IO ()) -&gt; (CString -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679253483"><span class="annot"><span class="annottext">CString
</span><a href="#local-6989586621679253483"><span class="hs-identifier hs-var">confPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679253484"><span class="annot"><span class="annottext">tryConnect :: IO (Either (ForeignPtr (CArray Word8)) (ForeignPtr CoreClient))
</span><a href="#local-6989586621679253484"><span class="hs-identifier hs-var hs-var">tryConnect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-238"></span><span>            </span><span class="annot"><span class="annottext">TokioCall (CArray Word8) CoreClient
-&gt; Maybe (FinalizerPtr (CArray Word8))
-&gt; Maybe (FinalizerPtr CoreClient)
-&gt; IO (Either (ForeignPtr (CArray Word8)) (ForeignPtr CoreClient))
forall err res.
TokioCall err res
-&gt; Maybe (FinalizerPtr err)
-&gt; Maybe (FinalizerPtr res)
-&gt; IO (Either (ForeignPtr err) (ForeignPtr res))
</span><a href="Temporal.Internal.FFI.html#makeTokioAsyncCall"><span class="hs-identifier hs-var">makeTokioAsyncCall</span></a></span><span>
</span><span id="line-239"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Runtime -&gt; CString -&gt; TokioCall (CArray Word8) CoreClient
</span><a href="Temporal.Core.Client.html#raw_connectClient"><span class="hs-identifier hs-var">raw_connectClient</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Runtime
</span><a href="#local-6989586621679253479"><span class="hs-identifier hs-var">rtPtr</span></a></span><span> </span><span class="annot"><span class="annottext">CString
</span><a href="#local-6989586621679253483"><span class="hs-identifier hs-var">confPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FinalizerPtr (CArray Word8) -&gt; Maybe (FinalizerPtr (CArray Word8))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr (CArray Word8)
</span><a href="Temporal.Core.CTypes.html#rust_dropByteArray"><span class="hs-identifier hs-var">rust_dropByteArray</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FinalizerPtr CoreClient -&gt; Maybe (FinalizerPtr CoreClient)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr CoreClient
</span><a href="Temporal.Core.Client.html#raw_freeClient"><span class="hs-identifier hs-var">raw_freeClient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>          </span><span id="local-6989586621679253487"><span class="annot"><span class="annottext">go :: Word64 -&gt; IO ()
</span><a href="#local-6989586621679253487"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679253488"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679253488"><span class="hs-identifier hs-var">attempt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-243"></span><span>            </span><span id="local-6989586621679253489"><span class="annot"><a href="#local-6989586621679253489"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either (ForeignPtr (CArray Word8)) (ForeignPtr CoreClient))
</span><a href="#local-6989586621679253484"><span class="hs-identifier hs-var">tryConnect</span></a></span><span>
</span><span id="line-244"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679253489"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-245"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679253490"><span class="annot"><span class="annottext">ForeignPtr (CArray Word8)
</span><a href="#local-6989586621679253490"><span class="hs-identifier hs-var">errFP</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>                </span><span id="local-6989586621679253491"><span class="annot"><a href="#local-6989586621679253491"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ForeignPtr (CArray Word8)
-&gt; (Ptr (CArray Word8) -&gt; IO Text) -&gt; IO Text
forall a b. ForeignPtr a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr (CArray Word8)
</span><a href="#local-6989586621679253490"><span class="hs-identifier hs-var">errFP</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr (CArray Word8) -&gt; IO Text) -&gt; IO Text)
-&gt; (Ptr (CArray Word8) -&gt; IO Text) -&gt; IO Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ptr (CArray Word8) -&gt; IO (CArray Word8)
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">(Ptr (CArray Word8) -&gt; IO (CArray Word8))
-&gt; (CArray Word8 -&gt; IO Text) -&gt; Ptr (CArray Word8) -&gt; IO Text
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">CArray Word8 -&gt; IO Text
</span><a href="Temporal.Core.CTypes.html#cArrayToText"><span class="hs-identifier hs-var">cArrayToText</span></a></span><span>
</span><span id="line-247"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#retryConfig"><span class="hs-identifier hs-var">retryConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253473"><span class="hs-identifier hs-type">conf</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-248"></span><span>                  </span><span class="annot"><span class="annottext">Maybe ClientRetryConfig
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MVar CoreClient -&gt; CoreClient -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar CoreClient
</span><a href="#local-6989586621679253476"><span class="hs-identifier hs-var">clientPtrSlot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClientError -&gt; CoreClient
forall a e. (?callStack::CallStack, Exception e) =&gt; e -&gt; a
</span><span class="hs-identifier hs-var">throw</span></span><span> </span><span class="annot"><span class="annottext">(ClientError -&gt; CoreClient) -&gt; ClientError -&gt; CoreClient
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ClientError
</span><a href="Temporal.Core.Client.html#ClientConnectionError"><span class="hs-identifier hs-var">ClientConnectionError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679253491"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679253497"><span class="annot"><span class="annottext">ClientRetryConfig
</span><a href="#local-6989586621679253497"><span class="hs-identifier hs-var">retryConf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679253498"><span class="annot"><span class="annottext">delayMillis :: Double
</span><a href="#local-6989586621679253498"><span class="hs-identifier hs-var hs-var">delayMillis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClientRetryConfig -&gt; Word64
</span><a href="Temporal.Core.Client.html#initialIntervalMillis"><span class="hs-identifier hs-var">initialIntervalMillis</span></a></span><span> </span><span class="annot"><span class="annottext">ClientRetryConfig
</span><a href="#local-6989586621679253497"><span class="hs-identifier hs-var">retryConf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">ClientRetryConfig -&gt; Double
</span><a href="Temporal.Core.Client.html#multiplier"><span class="hs-identifier hs-var">multiplier</span></a></span><span> </span><span class="annot"><span class="annottext">ClientRetryConfig
</span><a href="#local-6989586621679253497"><span class="hs-identifier hs-var">retryConf</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Word64 -&gt; Double
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679253488"><span class="hs-identifier hs-var">attempt</span></a></span><span>
</span><span id="line-251"></span><span>                        </span><span id="local-6989586621679253501"><span class="annot"><span class="annottext">delayMicros :: Double
</span><a href="#local-6989586621679253501"><span class="hs-identifier hs-var hs-var">delayMicros</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679253498"><span class="hs-identifier hs-var">delayMillis</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1000</span></span><span>
</span><span id="line-252"></span><span>                    </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Word64 -&gt; Double) -&gt; Maybe Word64 -&gt; Maybe Double
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClientRetryConfig -&gt; Maybe Word64
</span><a href="Temporal.Core.Client.html#maxElapsedTimeMillis"><span class="hs-identifier hs-var">maxElapsedTimeMillis</span></a></span><span> </span><span class="annot"><span class="annottext">ClientRetryConfig
</span><a href="#local-6989586621679253497"><span class="hs-identifier hs-var">retryConf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Double -&gt; Maybe Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Maybe Double
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679253498"><span class="hs-identifier hs-var">delayMillis</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClientRetryConfig -&gt; Word64
</span><a href="Temporal.Core.Client.html#maxRetries"><span class="hs-identifier hs-var">maxRetries</span></a></span><span> </span><span class="annot"><span class="annottext">ClientRetryConfig
</span><a href="#local-6989586621679253497"><span class="hs-identifier hs-var">retryConf</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679253488"><span class="hs-identifier hs-var">attempt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">MVar CoreClient -&gt; CoreClient -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar CoreClient
</span><a href="#local-6989586621679253476"><span class="hs-identifier hs-var">clientPtrSlot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClientError -&gt; CoreClient
forall a e. (?callStack::CallStack, Exception e) =&gt; e -&gt; a
</span><span class="hs-identifier hs-var">throw</span></span><span> </span><span class="annot"><span class="annottext">(ClientError -&gt; CoreClient) -&gt; ClientError -&gt; CoreClient
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ClientError
</span><a href="Temporal.Core.Client.html#ClientConnectionError"><span class="hs-identifier hs-var">ClientConnectionError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679253491"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>                      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-255"></span><span>                        </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IO ()) -&gt; Int -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int
forall b. Integral b =&gt; Double -&gt; b
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679253501"><span class="hs-identifier hs-var">delayMicros</span></a></span><span>
</span><span id="line-256"></span><span>                        </span><span class="annot"><span class="annottext">Word64 -&gt; IO ()
</span><a href="#local-6989586621679253487"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679253488"><span class="hs-identifier hs-var">attempt</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679253508"><span class="annot"><span class="annottext">ForeignPtr CoreClient
</span><a href="#local-6989586621679253508"><span class="hs-identifier hs-var">client_</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MVar CoreClient -&gt; CoreClient -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar CoreClient
</span><a href="#local-6989586621679253476"><span class="hs-identifier hs-var">clientPtrSlot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForeignPtr CoreClient -&gt; CoreClient
</span><a href="Temporal.Core.CTypes.html#CoreClient"><span class="hs-identifier hs-var">CoreClient</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CoreClient
</span><a href="#local-6989586621679253508"><span class="hs-identifier hs-var">client_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>      </span><span class="annot"><span class="annottext">Word64 -&gt; IO ()
</span><a href="#local-6989586621679253487"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1</span></span><span>
</span><span id="line-259"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253476"><span class="hs-identifier hs-type">clientPtrSlot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253472"><span class="hs-identifier hs-type">rt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253474"><span class="hs-identifier hs-type">conf'</span></a></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="annot"><a href="Temporal.Core.Client.html#reconnectClient"><span class="hs-identifier hs-type">reconnectClient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span id="reconnectClient"><span class="annot"><span class="annottext">reconnectClient :: Client -&gt; IO ()
</span><a href="Temporal.Core.Client.html#reconnectClient"><span class="hs-identifier hs-var hs-var">reconnectClient</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a></span><span> </span><span id="local-6989586621679253510"><span class="annot"><span class="annottext">MVar CoreClient
</span><a href="#local-6989586621679253510"><span class="hs-identifier hs-var">clientPtrSlot</span></a></span></span><span> </span><span id="local-6989586621679253511"><span class="annot"><span class="annottext">Runtime
</span><a href="#local-6989586621679253511"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679253512"><span class="annot"><span class="annottext">ClientConfig
</span><a href="#local-6989586621679253512"><span class="hs-identifier hs-var">conf</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO ()
forall b. ((forall a. IO a -&gt; IO a) -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">mask</span></span><span> </span><span class="annot"><span class="annottext">(((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO ())
-&gt; ((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679253514"><span class="annot"><span class="annottext">forall a. IO a -&gt; IO a
</span><a href="#local-6989586621679253514"><span class="hs-identifier hs-var">restore</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.CTypes.html#CoreClient"><span class="hs-identifier hs-type">CoreClient</span></a></span><span> </span><span id="local-6989586621679253515"><span class="annot"><a href="#local-6989586621679253515"><span class="hs-identifier hs-var">clientPtr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVar CoreClient -&gt; IO CoreClient
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">takeMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar CoreClient
</span><a href="#local-6989586621679253510"><span class="hs-identifier hs-var">clientPtrSlot</span></a></span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a></span><span> </span><span id="local-6989586621679253517"><span class="annot"><a href="#local-6989586621679253517"><span class="hs-identifier hs-var">newClientPtr</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621679253514"><span class="hs-identifier hs-type">restore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Client.html#connectClient"><span class="hs-identifier hs-type">connectClient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253511"><span class="hs-identifier hs-type">rt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253512"><span class="hs-identifier hs-type">conf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">`catch`</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679253519"><span class="annot"><span class="annottext">ClientError
</span><a href="#local-6989586621679253519"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MVar CoreClient -&gt; CoreClient -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar CoreClient
</span><a href="#local-6989586621679253510"><span class="hs-identifier hs-var">clientPtrSlot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClientError -&gt; CoreClient
forall a e. (?callStack::CallStack, Exception e) =&gt; e -&gt; a
</span><span class="hs-identifier hs-var">throw</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClientError
</span><a href="#local-6989586621679253519"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#ClientError"><span class="hs-identifier hs-type">ClientError</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO Client -&gt; IO Client
forall a b. IO a -&gt; IO b -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ClientError -&gt; IO Client
forall e a. (?callStack::CallStack, Exception e) =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">ClientError
</span><a href="#local-6989586621679253519"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">takeMVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679253517"><span class="hs-identifier hs-type">newClientPtr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">putMVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679253510"><span class="hs-identifier hs-type">clientPtrSlot</span></a></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="annot"><a href="Temporal.Core.Client.html#closeClient"><span class="hs-identifier hs-type">closeClient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span id="closeClient"><span class="annot"><span class="annottext">closeClient :: Client -&gt; IO ()
</span><a href="Temporal.Core.Client.html#closeClient"><span class="hs-identifier hs-var hs-var">closeClient</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a></span><span> </span><span id="local-6989586621679253521"><span class="annot"><span class="annottext">MVar CoreClient
</span><a href="#local-6989586621679253521"><span class="hs-identifier hs-var">clientPtrSlot</span></a></span></span><span> </span><span class="annot"><span class="annottext">Runtime
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ClientConfig
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
</span><span class="hs-identifier hs-var">mask_</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.CTypes.html#CoreClient"><span class="hs-identifier hs-type">CoreClient</span></a></span><span> </span><span id="local-6989586621679253523"><span class="annot"><a href="#local-6989586621679253523"><span class="hs-identifier hs-var">clientPtr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVar CoreClient -&gt; IO CoreClient
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">takeMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar CoreClient
</span><a href="#local-6989586621679253521"><span class="hs-identifier hs-var">clientPtrSlot</span></a></span><span>
</span><span id="line-272"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">finalizeForeignPtr</span></span><span> </span><span class="annot"><a href="#local-6989586621679253523"><span class="hs-identifier hs-type">clientPtr</span></a></span><span>
</span><span id="line-273"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">putMVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679253521"><span class="hs-identifier hs-type">clientPtrSlot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">throw</span></span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#ClientClosedError"><span class="hs-identifier hs-type">ClientClosedError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="hs-keyword">type</span><span> </span><span id="PrimRpcCall"><span class="annot"><a href="Temporal.Core.Client.html#PrimRpcCall"><span class="hs-identifier hs-var">PrimRpcCall</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CoreClient"><span class="hs-identifier hs-type">CoreClient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CRpcCall"><span class="hs-identifier hs-type">CRpcCall</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Internal.FFI.html#TokioCall"><span class="hs-identifier hs-type">TokioCall</span></a></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#CRPCError"><span class="hs-identifier hs-type">CRPCError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Temporal.Core.CTypes.html#CArray"><span class="hs-identifier hs-type">CArray</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="hs-comment">-- TODO how should we use mask here?</span><span>
</span><span id="line-280"></span><span class="annot"><a href="Temporal.Core.Client.html#call"><span class="hs-identifier hs-type">call</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252839"><span class="annot"><a href="#local-6989586621679252839"><span class="hs-identifier hs-type">svc</span></a></span></span><span> </span><span id="local-6989586621679252840"><span class="annot"><a href="#local-6989586621679252840"><span class="hs-identifier hs-type">t</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasMethodImpl</span></span><span> </span><span class="annot"><a href="#local-6989586621679252839"><span class="hs-identifier hs-type">svc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252840"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#PrimRpcCall"><span class="hs-identifier hs-type">PrimRpcCall</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Temporal.Core.Client.html#Client"><span class="hs-identifier hs-type">Client</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MethodInput</span></span><span> </span><span class="annot"><a href="#local-6989586621679252839"><span class="hs-identifier hs-type">svc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252840"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Temporal.Core.CTypes.html#RpcError"><span class="hs-identifier hs-type">RpcError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MethodOutput</span></span><span> </span><span class="annot"><a href="#local-6989586621679252839"><span class="hs-identifier hs-type">svc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252840"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span id="call"><span class="annot"><span class="annottext">call :: forall svc (t :: Symbol).
HasMethodImpl svc t =&gt;
PrimRpcCall
-&gt; Client
-&gt; MethodInput svc t
-&gt; IO (Either RpcError (MethodOutput svc t))
</span><a href="Temporal.Core.Client.html#call"><span class="hs-identifier hs-var hs-var">call</span></a></span></span><span> </span><span id="local-6989586621679253555"><span class="annot"><span class="annottext">PrimRpcCall
</span><a href="#local-6989586621679253555"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679253556"><span class="annot"><span class="annottext">Client
</span><a href="#local-6989586621679253556"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679253557"><span class="annot"><span class="annottext">MethodInput svc t
</span><a href="#local-6989586621679253557"><span class="hs-identifier hs-var">req_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Client
-&gt; (Ptr CoreClient -&gt; IO (Either RpcError (MethodOutput svc t)))
-&gt; IO (Either RpcError (MethodOutput svc t))
forall a. Client -&gt; (Ptr CoreClient -&gt; IO a) -&gt; IO a
</span><a href="Temporal.Core.Client.html#withClient"><span class="hs-identifier hs-var">withClient</span></a></span><span> </span><span class="annot"><span class="annottext">Client
</span><a href="#local-6989586621679253556"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr CoreClient -&gt; IO (Either RpcError (MethodOutput svc t)))
 -&gt; IO (Either RpcError (MethodOutput svc t)))
-&gt; (Ptr CoreClient -&gt; IO (Either RpcError (MethodOutput svc t)))
-&gt; IO (Either RpcError (MethodOutput svc t))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679253558"><span class="annot"><span class="annottext">Ptr CoreClient
</span><a href="#local-6989586621679253558"><span class="hs-identifier hs-var">cPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-282"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679253559"><span class="annot"><span class="annottext">msgBytes :: ByteString
</span><a href="#local-6989586621679253559"><span class="hs-identifier hs-var hs-var">msgBytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MethodInput svc t -&gt; ByteString
forall msg. Message msg =&gt; msg -&gt; ByteString
</span><span class="hs-identifier hs-var">encodeMessage</span></span><span> </span><span class="annot"><span class="annottext">MethodInput svc t
</span><a href="#local-6989586621679253557"><span class="hs-identifier hs-var">req_</span></a></span><span>
</span><span id="line-283"></span><span>  </span><span class="annot"><span class="annottext">ByteString
-&gt; (CStringLen -&gt; IO (Either RpcError (MethodOutput svc t)))
-&gt; IO (Either RpcError (MethodOutput svc t))
forall a. ByteString -&gt; (CStringLen -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">BS.useAsCStringLen</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679253559"><span class="hs-identifier hs-var">msgBytes</span></a></span><span> </span><span class="annot"><span class="annottext">((CStringLen -&gt; IO (Either RpcError (MethodOutput svc t)))
 -&gt; IO (Either RpcError (MethodOutput svc t)))
-&gt; (CStringLen -&gt; IO (Either RpcError (MethodOutput svc t)))
-&gt; IO (Either RpcError (MethodOutput svc t))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679253562"><span class="annot"><span class="annottext">CString
</span><a href="#local-6989586621679253562"><span class="hs-identifier hs-var">msgPtr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679253563"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679253563"><span class="hs-identifier hs-var">msgLen</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><span class="annottext">(Ptr (CArray CChar) -&gt; IO (Either RpcError (MethodOutput svc t)))
-&gt; IO (Either RpcError (MethodOutput svc t))
forall a b. Storable a =&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">alloca</span></span><span> </span><span class="annot"><span class="annottext">((Ptr (CArray CChar) -&gt; IO (Either RpcError (MethodOutput svc t)))
 -&gt; IO (Either RpcError (MethodOutput svc t)))
-&gt; (Ptr (CArray CChar)
    -&gt; IO (Either RpcError (MethodOutput svc t)))
-&gt; IO (Either RpcError (MethodOutput svc t))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679253565"><span class="annot"><span class="annottext">Ptr (CArray CChar)
</span><a href="#local-6989586621679253565"><span class="hs-identifier hs-var">cArrayPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-285"></span><span>      </span><span class="annot"><span class="annottext">Ptr (CArray CChar) -&gt; CArray CChar -&gt; IO ()
forall a. Storable a =&gt; Ptr a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">poke</span></span><span> </span><span class="annot"><span class="annottext">Ptr (CArray CChar)
</span><a href="#local-6989586621679253565"><span class="hs-identifier hs-var">cArrayPtr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CString -&gt; Word64 -&gt; CArray CChar
forall a. Ptr a -&gt; Word64 -&gt; CArray a
</span><a href="Temporal.Core.CTypes.html#CArray"><span class="hs-identifier hs-var">CArray</span></a></span><span> </span><span class="annot"><span class="annottext">CString
</span><a href="#local-6989586621679253562"><span class="hs-identifier hs-var">msgPtr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679253563"><span class="hs-identifier hs-var">msgLen</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679253568"><span class="annot"><span class="annottext">rpcCall :: CRpcCall
</span><a href="#local-6989586621679253568"><span class="hs-identifier hs-var hs-var">rpcCall</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-287"></span><span>            </span><span class="annot"><a href="Temporal.Core.CTypes.html#CRpcCall"><span class="hs-identifier hs-type">CRpcCall</span></a></span><span>
</span><span id="line-288"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rpcCallReq :: Ptr (CArray Word8)
</span><a href="#local-6989586621679253570"><span class="hs-identifier hs-var">rpcCallReq</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr (CArray CChar) -&gt; Ptr (CArray Word8)
forall a b. Ptr a -&gt; Ptr b
</span><span class="hs-identifier hs-var">castPtr</span></span><span> </span><span class="annot"><span class="annottext">Ptr (CArray CChar)
</span><a href="#local-6989586621679253565"><span class="hs-identifier hs-var">cArrayPtr</span></a></span><span>
</span><span id="line-289"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rpcCallRetry :: Word8
</span><a href="#local-6989586621679253572"><span class="hs-identifier hs-var">rpcCallRetry</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span>
</span><span id="line-290"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rpcCallMetadata :: Ptr HashMapEntries
</span><a href="#local-6989586621679253573"><span class="hs-identifier hs-var">rpcCallMetadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr HashMapEntries
forall a. Ptr a
</span><span class="hs-identifier hs-var">nullPtr</span></span><span>
</span><span id="line-291"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rpcCallTimeoutMillis :: Ptr Word64
</span><a href="#local-6989586621679253575"><span class="hs-identifier hs-var">rpcCallTimeoutMillis</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word64
forall a. Ptr a
</span><span class="hs-identifier hs-var">nullPtr</span></span><span>
</span><span id="line-292"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-293"></span><span>      </span><span class="annot"><span class="annottext">(Ptr CRpcCall -&gt; IO (Either RpcError (MethodOutput svc t)))
-&gt; IO (Either RpcError (MethodOutput svc t))
forall a b. Storable a =&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">alloca</span></span><span> </span><span class="annot"><span class="annottext">((Ptr CRpcCall -&gt; IO (Either RpcError (MethodOutput svc t)))
 -&gt; IO (Either RpcError (MethodOutput svc t)))
-&gt; (Ptr CRpcCall -&gt; IO (Either RpcError (MethodOutput svc t)))
-&gt; IO (Either RpcError (MethodOutput svc t))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679253576"><span class="annot"><span class="annottext">Ptr CRpcCall
</span><a href="#local-6989586621679253576"><span class="hs-identifier hs-var">rpcCallPtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-294"></span><span>        </span><span class="annot"><span class="annottext">Ptr CRpcCall -&gt; CRpcCall -&gt; IO ()
forall a. Storable a =&gt; Ptr a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">poke</span></span><span> </span><span class="annot"><span class="annottext">Ptr CRpcCall
</span><a href="#local-6989586621679253576"><span class="hs-identifier hs-var">rpcCallPtr</span></a></span><span> </span><span class="annot"><span class="annottext">CRpcCall
</span><a href="#local-6989586621679253568"><span class="hs-identifier hs-var">rpcCall</span></a></span><span>
</span><span id="line-295"></span><span>        </span><span id="local-6989586621679253577"><span class="annot"><a href="#local-6989586621679253577"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-296"></span><span>          </span><span class="annot"><span class="annottext">TokioCall CRPCError (CArray Word8)
-&gt; Maybe (FinalizerPtr CRPCError)
-&gt; Maybe (FinalizerPtr (CArray Word8))
-&gt; IO (Either (ForeignPtr CRPCError) (ForeignPtr (CArray Word8)))
forall err res.
TokioCall err res
-&gt; Maybe (FinalizerPtr err)
-&gt; Maybe (FinalizerPtr res)
-&gt; IO (Either (ForeignPtr err) (ForeignPtr res))
</span><a href="Temporal.Internal.FFI.html#makeTokioAsyncCall"><span class="hs-identifier hs-var">makeTokioAsyncCall</span></a></span><span>
</span><span id="line-297"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimRpcCall
</span><a href="#local-6989586621679253555"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CoreClient
</span><a href="#local-6989586621679253558"><span class="hs-identifier hs-var">cPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CRpcCall
</span><a href="#local-6989586621679253576"><span class="hs-identifier hs-var">rpcCallPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FinalizerPtr CRPCError -&gt; Maybe (FinalizerPtr CRPCError)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr CRPCError
</span><a href="Temporal.Core.CTypes.html#rust_drop_rpc_error"><span class="hs-identifier hs-var">rust_drop_rpc_error</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FinalizerPtr (CArray Word8) -&gt; Maybe (FinalizerPtr (CArray Word8))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr (CArray Word8)
</span><a href="Temporal.Core.CTypes.html#rust_dropByteArray"><span class="hs-identifier hs-var">rust_dropByteArray</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679253577"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-301"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679253579"><span class="annot"><span class="annottext">ForeignPtr CRPCError
</span><a href="#local-6989586621679253579"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RpcError -&gt; Either RpcError (MethodOutput svc t)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(RpcError -&gt; Either RpcError (MethodOutput svc t))
-&gt; IO RpcError -&gt; IO (Either RpcError (MethodOutput svc t))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CRPCError
-&gt; (Ptr CRPCError -&gt; IO RpcError) -&gt; IO RpcError
forall a b. ForeignPtr a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr CRPCError
</span><a href="#local-6989586621679253579"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr CRPCError -&gt; IO CRPCError
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">(Ptr CRPCError -&gt; IO CRPCError)
-&gt; (CRPCError -&gt; IO RpcError) -&gt; Ptr CRPCError -&gt; IO RpcError
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">CRPCError -&gt; IO RpcError
</span><a href="Temporal.Core.CTypes.html#peekCRPCError"><span class="hs-identifier hs-var">peekCRPCError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679253581"><span class="annot"><span class="annottext">ForeignPtr (CArray Word8)
</span><a href="#local-6989586621679253581"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MethodOutput svc t -&gt; Either RpcError (MethodOutput svc t)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(MethodOutput svc t -&gt; Either RpcError (MethodOutput svc t))
-&gt; (ByteString -&gt; MethodOutput svc t)
-&gt; ByteString
-&gt; Either RpcError (MethodOutput svc t)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; MethodOutput svc t
forall msg. Message msg =&gt; ByteString -&gt; msg
</span><span class="hs-identifier hs-var">decodeMessageOrDie</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Either RpcError (MethodOutput svc t))
-&gt; IO ByteString -&gt; IO (Either RpcError (MethodOutput svc t))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr (CArray Word8)
-&gt; (Ptr (CArray Word8) -&gt; IO ByteString) -&gt; IO ByteString
forall a b. ForeignPtr a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr (CArray Word8)
</span><a href="#local-6989586621679253581"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr (CArray Word8) -&gt; IO (CArray Word8)
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">(Ptr (CArray Word8) -&gt; IO (CArray Word8))
-&gt; (CArray Word8 -&gt; IO ByteString)
-&gt; Ptr (CArray Word8)
-&gt; IO ByteString
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">CArray Word8 -&gt; IO ByteString
</span><a href="Temporal.Core.CTypes.html#cArrayToByteString"><span class="hs-identifier hs-var">cArrayToByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span></pre></body></html>