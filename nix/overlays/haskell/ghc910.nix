{
  lib,
  haskell,
  fetchpatch,
  protobuf,
  ...
}:
hfinal: hprev:
let
  inherit (haskell.lib.compose) doJailbreak addSetupDepends appendPatch;
in
{
  uuid = doJailbreak hprev.uuid;
  proto-lens = doJailbreak hprev.proto-lens;
  proto-lens-setup = doJailbreak hprev.proto-lens-setup;
  proto-lens-protobuf-types = lib.pipe hprev.proto-lens-protobuf-types [
    doJailbreak
    (addSetupDepends [ protobuf ])
  ];
  proto-lens-runtime = doJailbreak hprev.proto-lens-runtime;
  proto-lens-protoc = lib.pipe hprev.proto-lens-protoc [
    doJailbreak
    (appendPatch (fetchpatch {
      url = "https://github.com/google/proto-lens/pull/494/commits/7694e28e3ebcfcbcf00ff3eae73949d069c4f21a.diff";
      relative = "proto-lens-protoc";
      # There's a patch conflict in the autogenerated hpack header.
      excludes = [
        "package.yaml"
        "proto-lens-protoc.cabal"
      ];
      hash = "sha256-qpBh8XGwb30VjIb0VGrLhu/k5az6QrL8XioE9pxDtw4=";
    }))
  ];
}
